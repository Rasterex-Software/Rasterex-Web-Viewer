!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("PDFViewCtrl"),require("jquery"),require("PDFViewCtrl").PDFViewer,require("PDFViewCtrl").commons):"function"==typeof define&&define.amd?define(["PDFViewCtrl","jquery",["PDFViewCtrl","PDFViewer"],["PDFViewCtrl","commons"]],t):"object"==typeof exports?exports.PDFViewCtrl_CreateAnnotAddonModule=t(require("PDFViewCtrl"),require("jquery"),require("PDFViewCtrl").PDFViewer,require("PDFViewCtrl").commons):e.PDFViewCtrl_CreateAnnotAddonModule=t(e.PDFViewCtrl,e.jQuery,e.PDFViewCtrl.PDFViewer,e.PDFViewCtrl.commons)}(self,((e,t,n,i)=>(()=>{var a={425:(e,t,n)=>{var i=n(118),a=n(435);function r(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}r.prototype=i(a.prototype),r.prototype.constructor=r,e.exports=r},548:(e,t,n)=>{var i=n(118),a=n(435);function r(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}r.prototype=i(a.prototype),r.prototype.constructor=r,e.exports=r},118:(e,t,n)=>{var i=n(218),a=Object.create,r=function(){function e(){}return function(t){if(!i(t))return{};if(a)return a(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=r},435:e=>{e.exports=function(){}},278:e=>{e.exports=function(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t}},913:(e,t,n)=>{var i=n(425),a=n(548),r=n(278);e.exports=function(e){if(e instanceof i)return e.clone();var t=new a(e.__wrapped__,e.__chain__);return t.__actions__=r(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}},263:(e,t,n)=>{var i=n(111);e.exports=function(e){var t=i(e);return t.__chain__=!0,t}},469:e=>{var t=Array.isArray;e.exports=t},218:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},5:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},111:(e,t,n)=>{var i=n(425),a=n(548),r=n(435),o=n(469),s=n(5),c=n(913),l=Object.prototype.hasOwnProperty;function u(e){if(s(e)&&!o(e)&&!(e instanceof i)){if(e instanceof a)return e;if(l.call(e,"__wrapped__"))return c(e)}return new a(e)}u.prototype=r.prototype,u.prototype.constructor=u,e.exports=u},778:t=>{"use strict";t.exports=e},47:e=>{"use strict";e.exports=t},602:e=>{"use strict";e.exports=n},457:e=>{"use strict";e.exports=i}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return a[e](n,n.exports,o),n.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{"use strict";function e(t,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](t):e(t,n)}function t(t,n){if(!e(t,n))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function r(e,t,n){return r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n||e):r.value}},r(e,t,n||e)}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function h(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function f(e){return function(e){if(Array.isArray(e))return u(e)}(e)||d(e)||h(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?p(e):t;var n}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=a(e);if(t){var r=a(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return v(this,n)}}function m(e){if(Array.isArray(e))return e}function y(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(e,t){return m(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,r=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return r}}(e,t)||h(e,t)||y()}o.r(s),o.d(s,{CreateAnnotAddon:()=>ts,CreateStampService:()=>Or});var S=o(778),A=S.stateHandler,b=A.IStateHandler,k=A.HandStateHandler,R=S.vendors.Hammer,x=A.StateHandlerConsts.STATE_HANDLER_CREATE_TEXT,E=S.ViewerEvents,T=S.shared,C=T.getClientX,P=T.getClientY,_=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-note",i}return i(a,[{key:"pageHandler",value:function(e){var t=this;this.pageRender=e;var n=e.$handler;n.addClass(this.cursorStyle);var i=n[0];(this.hammer=new R.Manager(i,{recognizers:[[R.Tap]]})).on("tap",(function(n){var a=i.getBoundingClientRect(),r=n.srcEvent,o=C(r),s=P(r),c=[o-a.left,s-a.top],l=c[0],u=c[1];return e.getPDFPage().then((function(n){var i=w(n.reverseDevicePoint([l,u],e.scale,e.getRotation()),2),a=i[0],r=i[1],o=t.pdfViewer.getDefaultAnnotConfig()("text"),s=Object.assign({flags:28,type:"text",rect:{left:a,right:a+20,top:r,bottom:r-20},subject:t.pdfViewer.i18n.t("viewer_:annotSubjects.Note")},o);n.addAnnot(s).then((function(t){var n=t[0],i=e.annotsRender.getAnnotRender(n.getId()).component;e.pdfViewer.eventEmitter.emit(E.addAnnotSuccess,i.annot),e.pdfViewer.getStateHandlerManager().switchTo(k.getStateName()),e.annotsRender.activeAnnot(n.getId()),setTimeout((function(){e.annotsRender.doubleTapAnnot(n.getId())}),100)}))}))}))}},{key:"getNoteRightPanelData",value:function(){var e=localStorage.getItem("NOTE-STORAGE-KEY");return e?JSON.parse(e):e||{}}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle)}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return x}}]),a}(b),I=S.stateHandler,D=I.IStateHandler,M=(I.HandStateHandler,S.vendors.Hammer),V=S.shared.DebouncePromiseQueue,L=I.StateHandlerUtils,H=L.getDevicePagePoint,N=L.deltaDeviceRect,O=L.appendSelectMark,F=L.removeSelectMark,j=L.removeTextSelectedRangeMark,B=L.showTextSelectedRangeMark,U=S.ViewerEvents,X=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="",i}return i(a,[{key:"getDefaultProps",value:function(e){return this.pdfViewer.getDefaultAnnotConfig()(e)}},{key:"pageHandler",value:function(e){var t=this;this.pageRender=e;var n=e.$handler;n.addClass(this.cursorStyle);var i,a,r=n[0],o=this.hammer=new M.Manager(r,{recognizers:[[M.Pan,{direction:M.DIRECTION_ALL}],[M.Tap]]}),s=-1,c=-1;o.on("tap",(function(n){t.pageRender.pdfViewer.activeElement();var i=t.pageRender.pdfViewer,a=n.srcEvent,r=w(e.getPDFPointFromClientPoint(a.clientX,a.clientY,!0),2),o=r[0],s=r[1],c=i.getEventEmitter();e.getPDFPage().then((function(t){var n=e.scale,i=e.rotate,a=t.getDeviceMatrix();return a.scale(n,n),a.rotate(i),t.getAnnotObjectNumAtDevicePoint([o,s],1,[a.a,a.b,a.c,a.d,a.e,a.f])})).then((function(t){var i=e.getAnnotRender(t);if(i){var a=i.component;c.emit(U.tapAnnotation,i,n),a.tapAnnot(n)}}))})),o.on("panstart",(function(n){if(!1!==t.panStart(n,t)){s=-1,c=-1;var o=H(r,n);i=[o.x,o.y],t.hideSelectMark(),a=new V,t.shouldDrawRange=!1,e.getTextContinueRectAtDevicePoints([o.x,o.y],[o.x+5,o.y+5],-1,-1).then((function(e){t.shouldDrawRange=!(e||[])[0]}))}})),o.on("panmove",(function(e){!1!==t.panMove(e,t)&&a&&a.push((function(){var n,a=t.pageRender,r=[i[0]+e.deltaX,i[1]+e.deltaY];if(t.shouldDrawRange){B(a,i,r);var o=N(i,e.deltaX,e.deltaY);n=a.getTextRectsAtRect(o)}else n=t.getTextRect(i,r,s,c);n.then((function(e){var t;return(t=e[0])&&"string"==typeof t.text&&(s=t.start,c=t.end),Promise.all([a.getPDFPage(),e])})).then((function(e){var n=w(e,2),i=n[0],r=n[1];t.pdfViewer.eventEmitter.emit("collab-creating-op",{type:"textMarkup",rects:r,page:i.getIndex()});var o=a.transformRectArray(i,r);t.showSelectMark(o)}))}))})),o.on("panend",(function(n){if(!1!==t.panEnd(n,t)&&a&&a){a.end(),a=null;var r,o=[i[0]+n.deltaX,i[1]+n.deltaY];if(t.shouldDrawRange){t.shouldDrawRange=!1,j(e,e.$handler);var l=N(i,n.deltaX,n.deltaY);r=e.getTextRectsAtRect(l)}else r=t.getTextRect(i,o,s,c);r.then((function(n){var i;return(i=n[0])&&"string"==typeof i.text&&(s=i.start,c=i.end),t.hideSelectMark(),Promise.all([e.getPDFPage(),n])})).then((function(e){var n=w(e,2),i=n[0],a=n[1];return a.length<1?Promise.resolve():t.addAnnot(i,a).then((function(e){var n=e[0],i=t.pageRender.annotsRender.getAnnotRender(n.getId()).component;return t.afterAddAnnot(i),t.pageRender.annotsRender.activeAnnot(n.getId()),e})).then((function(e){if(t.pdfViewer.config.showCommentList){var n=e[e.length-2];t.pageRender.annotsRender.getAnnotRender(n.getId()).component.showReplyDialog()}})).then((function(){0}))}))}}))}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.hideSelectMark(),this.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:this.pageRender.index})}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"panStart",value:function(){}},{key:"panMove",value:function(){}},{key:"panEnd",value:function(){}},{key:"showSelectMark",value:function(e){O(this.pageRender.$handler,e)}},{key:"hideSelectMark",value:function(){F(this.pageRender.$handler)}},{key:"getTextRect",value:function(e,t,n,i){return this.pageRender.getTextContinueRectAtDevicePoints(e,t,n,i)}},{key:"addAnnot",value:function(e,t){}},{key:"afterAddAnnot",value:function(e){this.pdfViewer.eventEmitter.emit(U.addAnnotSuccess,e.annot)}}]),a}(D),Y=S.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_HIGHLIGHT,$=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-highlight",i}return i(a,[{key:"addAnnot",value:function(e,t){return e.addAnnot(Object.assign({flags:4,type:"highlight",subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Highlight"),rect:{left:0,right:0,top:0,bottom:0},coords:t},this.getDefaultProps("highlight")))}}],[{key:"getStateName",value:function(){return Y}}]),a}(X),z=S.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_STRIKE_OUT,G=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-strikeout",i}return i(a,[{key:"addAnnot",value:function(e,t){return e.addAnnot(Object.assign({flags:4,type:"strikeout",subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Strikeout"),rect:{left:0,right:0,top:0,bottom:0},coords:t},this.getDefaultProps("strikeout")))}}],[{key:"getStateName",value:function(){return z}}]),a}(X),q=S.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_UNDERLINE,W=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-underline",i}return i(a,[{key:"addAnnot",value:function(e,t){return e.addAnnot(Object.assign({flags:4,type:"underline",rect:{left:0,right:0,top:0,bottom:0},coords:t,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Underline")},this.getDefaultProps("underline")))}}],[{key:"getStateName",value:function(){return q}}]),a}(X),J=S.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_SQUIGGLY,K=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-s-underline",i}return i(a,[{key:"addAnnot",value:function(e,t){return e.addAnnot(Object.assign({flags:4,type:"squiggly",subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Squiggly"),rect:{left:0,right:0,top:0,bottom:0},coords:t},this.getDefaultProps("squiggly")))}}],[{key:"getStateName",value:function(){return J}}]),a}(X),Z=S.stateHandler,Q=Z.StateHandlerConsts.STATE_HANDLER_CREATE_REPLACE,ee=Z.StateHandlerUtils.getCaretRectAndRotate,te=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-replace-text",i}return i(a,[{key:"addAnnot",value:function(e,t){var n=this.pdfViewer.getDefaultAnnotConfig()("replace"),i=ee(t),a=i.rect,r=i.rotate;return e.addAnnotGroup([{flags:4,type:"strikeout",rect:{left:0,right:0,top:0,bottom:0},coords:t,noPopup:!0,typeAlias:"Replace",intent:"StrikeOutTextEdit",color:n.color||255,opacity:n.opacity||1,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Replace")},{type:"caret",flags:4,rect:a,typeAlias:"Replace",intent:"Replace",rotation:r,color:n.color||255,opacity:n.opacity||1,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Replace")}],1)}}],[{key:"getStateName",value:function(){return Q}}]),a}(X),ne=S.stateHandler,ie=S.Matrix,ae=ne.IStateHandler,re=(ne.HandStateHandler,S.vendors.Hammer),oe=S.shared,se=oe.DebouncePromiseQueue,ce=oe.getClientX,le=oe.getClientY,ue=ne.StateHandlerUtils,de=ue.getDevicePagePoint,he=(ue.deltaDeviceRect,ue.appendSelectMark),fe=ue.removeSelectMark,pe=ue.getCaretRectAndRotate,ve=S.ViewerEvents,ge=ne.StateHandlerConsts.STATE_HANDLER_CREATE_CARET,me=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-insert-text",i}return i(a,[{key:"pageHandler",value:function(e){var t=this;this.pageRender=e;var n=e.$handler;n.addClass(this.cursorStyle);var i,a,r=n[0],o=this.hammer=new re.Manager(r,{recognizers:[[re.Pan,{direction:re.DIRECTION_ALL}],[re.Tap]]}),s=-1,c=-1;o.on("panstart",(function(e){if(!1!==t.panStart(e,t)){s=-1,c=-1;var n=de(r,e);i=[n.x,n.y],t.hideSelectMark(),a=new se}})),o.on("panmove",(function(e){!1!==t.panMove(e,t)&&a.push((function(){var n=t.pageRender,a=[i[0]+e.deltaX,i[1]+e.deltaY];return t.getTextRect(i,a,s,c).then((function(e){var t;return(t=e[0])&&"string"==typeof t.text&&(s=t.start,c=t.end),Promise.all([n.getPDFPage(),e])})).then((function(e){var t=w(e,2),i=t[0],a=t[1];return n.transformRectArray(i,a)})).then((function(e){t.showSelectMark(e)}))}))})),o.on("panend",(function(n){if(!1!==t.panEnd(n,t)){a.end(),a=null;var r=[i[0]+n.deltaX,i[1]+n.deltaY];return t.getTextRect(i,r,s,c).then((function(n){var i;return(i=n[0])&&"string"==typeof i.text&&(s=i.start,c=i.end),t.hideSelectMark(),Promise.all([e.getPDFPage(),n])})).then((function(e){var n=w(e,2),i=n[0],a=n[1];if(a.length<1)return Promise.resolve();var r=pe(a),o=r.rect,s=r.rotate;return i.addAnnot({type:"caret",flags:4,rect:o,rotation:s,subject:t.pdfViewer.i18n.t("viewer_:annotSubjects.Insert")}).then((function(e){var n=e[0],i=t.pageRender.annotsRender.getAnnotRender(n.getId()).component;t.pdfViewer.eventEmitter.emit(ve.addAnnotSuccess,i.annot),t.pageRender.annotsRender.activeAnnot(n.getId()),t.pdfViewer.config.showCommentList&&i.showReplyDialog()})).then((function(){0}))}))}})),o.on("tap",(function(n){if(!1!==t.tap(n,t)){var i=r.getBoundingClientRect(),a=n.srcEvent,o=ce(a),s=le(a),c=[o-i.left,s-i.top];return e.getPDFPage().then((function(n){var i=n.reverseDevicePoint([c[0],c[1]],e.scale,e.getRotation());return n.getCharInfoAtPoint(i).then((function(e){var i,a;if(e){var r=e.top-e.bottom,o=e.bottom+r/2,s=(e.right+e.left)/2,c=new ie;c.e=-s,c.f=-o;var l=(e.bottom+e.top)/2,u=l-r,d=e.right-3*r/8,h=e.right+3*r/8,p=c.transformRect(d,l,h,u),v=e.rotation*Math.PI/2;return c.reset(),c.rotate(-v),p=(i=c).transformRect.apply(i,f(p)),c.reset(),c.e=s,c.f=o,p=(a=c).transformRect.apply(a,f(p)),n.addAnnot({type:"caret",rect:{left:p[0],bottom:p[1],right:p[2],top:p[3]},rotation:v}).then((function(e){var n=e[0],i=t.pageRender.annotsRender.getAnnotRender(n.getId()).component;t.pdfViewer.eventEmitter.emit(ve.addAnnotSuccess,i.annot),t.pageRender.annotsRender.activeAnnot(n.getId()),t.pdfViewer.config.showCommentList&&i.showReplyDialog()})).then((function(){0}))}}))}))}}))}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.hideSelectMark()}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"panStart",value:function(){}},{key:"panMove",value:function(){}},{key:"panEnd",value:function(){}},{key:"tap",value:function(){}},{key:"showSelectMark",value:function(e){he(this.pageRender.$handler,e)}},{key:"hideSelectMark",value:function(){fe(this.pageRender.$handler)}},{key:"getTextRect",value:function(e,t,n,i){return this.pageRender.getTextContinueRectAtDevicePoints(e,t,n,i)}}],[{key:"getStateName",value:function(){return ge}}]),a}(ae),ye=S.stateHandler.IStateHandler,we=S.vendors,Se=(we.Hammer,we.jQuery,function(e){l(a,e);var n=g(a);function a(e){return t(this,a),n.call(this,e)}return i(a,[{key:"pageHandler",value:function(e){}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass("fv__create-stamp-state-handler")}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"textboxWidth",value:function(){return 100}},{key:"textboxHeight",value:function(){return 20}},{key:"calloutKneeLength",value:function(){return 20}},{key:"getStateName",value:function(){return"createFreetext"}},{key:"edit",value:function(e,t){var n=e.annotsRender.getAnnotRender(t[0].objectNumber).component;n.active(!0),setTimeout((function(){n.showReplyDialog("comment")}),0)}}]),a}(ye)),Ae=o(457);var be=5,ke=0,Re={left:0,center:1,right:2},xe=1,Ee=2,Te=3,Ce="editDiv",Pe=function(){function e(){t(this,e)}return i(e,null,[{key:"formatHtmlStr",value:function(e){var t=e,n={split:"split",remove:"remove",removeSelf:"removeTag"};[{startStr:"\x3c!--StartFragment--\x3e",endStr:"\x3c!--EndFragment--\x3e",operate:n.split},{startStr:"\x3c!--[if",endStr:"<![endif]--\x3e",operate:n.remove},{startStr:"<![if",endStr:"<![endif]>",operate:n.remove},{startStr:"<o:p>",endStr:"</o:p>",operate:n.remove},{startStr:"<w:Sdt",endStr:"</w:Sdt>",operate:n.removeTag},{startStr:"<w:sdtPr>",endStr:"</w:sdtPr>",operate:n.remove}].forEach((function(e){for(var i=t.indexOf(e.startStr);i>-1;){switch(e.operate){case n.split:var a=t.indexOf(e.endStr);t=t.slice(i+e.startStr.length,a>-1?a:t.length);break;case n.remove:var r=t.indexOf(e.endStr),o=t.substring(0,i),s=t.substring(r+e.endStr.length);t=o+s;break;case n.removeTag:var c=t.substring(i),l=c.indexOf(">");t=(t=t.substring(0,i)+c.substring(l+1)).split(e.endStr).join("")}i=t.indexOf(e.startStr)}}));var i=document.createElement("div");return i.contentEditable=!0,i.id=Ce,i.style.display="none",document.body.appendChild(i),i.innerHTML=t.replaceAll("\n","").replaceAll("\r",""),this.addTagClassName(i)}},{key:"getFont",value:function(e){var t=e[0],n=new RegExp("^\\s*".concat(t,"\\b")),i=["-apple-system","system-ui"," BlinkMacSystemFont"," Segoe UI"," Roboto"," Oxygen"," Ubuntu"," Fira Sans"," Droid Sans"," Helvetica Neue"," sans-serif"].some((function(e){return n.test(e)}));return i?(Ae.DeviceInfo.isWindows?t="DengXian Light":Ae.DeviceInfo.isMacOS||Ae.DeviceInfo.isIOS?t="PingFangSC":Ae.DeviceInfo.isAndroid?t="Roboto":Ae.DeviceInfo.isLinux&&(t="Noto Sans"),t):t}},{key:"formatRichText",value:function(e){var t=this,n=this.formatHtmlStr(e),i=document.getElementById("".concat(Ce)),a=n.map((function(e){var n,a,r,o,s=i.getElementsByClassName("".concat(e))[0],c=getComputedStyle(s),l=c.fontFamily.replaceAll('"',"").split(","),u=t.getFont(l);return{content:s.textContent,richTextStyle:{font:{name:u},textSize:parseInt(c.fontSize),textAlignment:Re[c.textAlign],textColor:(0,Ae.colorConvertor)(c.color,"int"),isBold:(r=c.fontWeight,o=parseFloat(r),isNaN(o)?r.includes("bold"):o>400),isItalic:(a=c.fontStyle,a.includes("italic")||a.includes("oblique")),isUnderline:c.textDecoration.includes("underline"),isStrikethrough:c.textDecoration.includes("line-through"),cornerMarkStyle:(n=c.verticalAlign,{sub:Te,super:Ee}[n]||xe)}}}));return i.remove(),a}},{key:"addTagClassName",value:function(e){var t=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=e.childNodes.length;(["block","flex"].includes(getComputedStyle(e).display)&&e.nextElementSibling&&(e.innerHTML+="\n"),a>0)&&Array.from(e.childNodes).forEach((function(a){if("#text"===a.nodeName){var r=document.createElement("span");r.innerHTML="".concat(a.textContent),r.style.textDecoration="".concat(n.underline?"underline":""," ").concat(n.lineThrough?"line-through":""),r.style.verticalAlign=n.verticalAlign;var o="foxitwebsdk-".concat(Date.now(),"-").concat(parseInt(1e3*Math.random()));i.push(o),r.classList.add(o),e.replaceChild(r,a)}else{var s=getComputedStyle(a).textDecoration,c={};s.includes("underline")&&(c.underline=!0),s.includes("line-through")&&(c.lineThrough=!0);var l=getComputedStyle(a).verticalAlign;["sub","super"].includes(l)&&(c.verticalAlign=l),t.addTagClassName(a,i,Object.assign({},n,c))}}));return i}}]),e}(),_e=S.stateHandler,Ie=S.ViewerEvents,De=_e.StateHandlerUtils.getDevicePagePoint,Me=S.vendors.Hammer,Ve=S.shared,Le=Ve.extendOptions,He=Ve.convertFromNumberToHex,Ne=_e.StateHandlerConsts.STATE_HANDLER_CREATE_FREETEXT_TYPEWRITER,Oe=S.BrowserInfo.isFirefox,Fe=function(e){l(o,e);var n=g(o);function o(e){var i;return t(this,o),(i=n.call(this,e)).cursorStyle="fv__cursor-typewriter",i}return i(o,[{key:"pageHandler",value:function(e){var t=this;this.pageRender=e,this.jqEventNamespace=(Date.now()*Math.random()).toString(34);var n=e.$handler;n.addClass("fv__create-stamp-state-handler "+this.cursorStyle);var i=n[0],a=this.hammer=new Me.Manager(i,{recognizers:[[Me.Tap]]}),r=function(e){var n=t.input=document.createElement("div");n.contentEditable=!0,i.appendChild(n),n.focus({preventScroll:!0})};n.on("touchstart",r),this.removeTouchStartListener=function(){n.off("touchstart",r)},a.on("tap",(function(n){var a=De(i,n),r=function(n){var r=100*e.scale*4/3,o=20*e.scale*2/3,s={left:a.x,right:a.x+r,top:a.y,bottom:a.y+2*o},c=t.input=t.input||document.createElement("div");Oe?"plaintext-only"!==c.contentEditable&&(c.contentEditable=!0,c.addEventListener("keyup",(function(e){e.ctrlKey&&/^v$/i.test(e.key)&&(c.innerHTML=c.innerText)}))):c.contentEditable=!0;var l=t.pdfViewer.getDefaultAnnotConfig(),u=Le({defaultAppearance:{textColor:255,textSize:12,font:"Arial"}},"function"==typeof l?l("freetext","FreeTextTypewriter"):{}),d=u.defaultAppearance.textSize*e.scale*4/3,h=function(e){var t=i.getBoundingClientRect();return{maxWidth:t.right-e.left,maxHeight:t.height-e.top}}(s),p=h.maxHeight,v=h.maxWidth;c.style.cssText="\n                    position: absolute;\n                    left: ".concat(s.left,"px;\n                    top: ").concat(s.top,"px;\n                    min-width: ").concat(d+5,"px;\n                    min-height: ").concat(d,"px;\n                    font-size: ").concat(d,"px;\n                    line-height: 1;\n                    color: ").concat(He(16777215&u.defaultAppearance.textColor),";\n                    outline:1px solid #5aa;\n                    outline-offset:1px;\n                    max-width: ").concat(v,"px;\n                    max-height: ").concat(p,"px;\n                    overflow: hidden;\n                    white-space: pre-line;\n                    word-break: break-word;\n                "),c.innerText=u.contents||"",i.appendChild(c),(0,Ae.moveCursorToEnd)(c),c.onmousedown=c.ontouchstart=c.onpointerdown=function(e){e.stopPropagation()};c.onkeydown=function(e){39!==e.keyCode&&37!==e.keyCode||e.stopPropagation()},c.onkeyup=function(e){};var g=!1,m="";c.onpaste=function(e){g=!0},c.oninput=function(e){if(g){var t,n=Array.from(c.childNodes).map((function(e){if(e.nodeType!==Node.TEXT_NODE){var t=e.style.fontFamily.replaceAll('"',"").split(",");return m=Pe.getFont(t),new Text(e.innerText)}return e}));c.innerHTML="",(t=c).append.apply(t,f(n))}g=!1},c.onblur=function(){if(t.isCreating=1,0===c.innerText.trim().length)i.removeChild(c),t.input=null,t.isCreating=0,t.pdfViewer.customs.isAnnotToolKept&&!t.pdfViewer.customs.isAnnotToolKept(Ne)&&e.pdfViewer.getStateHandlerManager().switchTo();else{var a=c.getBoundingClientRect();s.right=s.left+a.width,s.bottom=s.top+a.height;var r={type:"freetext",intent:"FreeTextTypewriter",rect:n.reverseDeviceRect(s,e.scale,e.getRotation()),contents:c.innerText.trim(),rotation:((360-90*n.getRotation()-e.getRotation())%360+360)%360,flags:4,borderInfo:{width:0},subject:t.pdfViewer.i18n.t("viewer_:annotSubjects.Typewriter")};if(m.length>0){var o=u.defaultAppearance.textColor,l=u.defaultAppearance.textSize;r.defaultAppearance={font:{name:m},textColor:o||255,textSize:l||12}}n.addAnnot(r).then((function(n){var a,r;i.removeChild(c);var o=n[0],s=null===(r=e.annotsRender)||void 0===r||null===(a=r.getAnnotRender(o.getId()))||void 0===a?void 0:a.component;s&&s.$textInput.get(0).blur(),e.pdfViewer.eventEmitter.emit(Ie.addAnnotSuccess,o),t.isCreating=0}))}}};e.getPDFPage().then((function(t){if(t.isVirtual())return-1;var n=e.scale,i=e.rotate,r=t.getDeviceMatrix(i);return r.scale(n,n),t.getAnnotObjectNumAtDevicePoint([a.x,a.y],1,[r.a,r.b,r.c,r.d,r.e,r.f])})).then((function(n){if(-1!==n&&"freetext"==e.page.getAnnotsSync([n])[0].getType())return e.annotsRender.activeAnnot(n,0,1);t.pdfViewer.killFocus(),e.page?r(e.page):e.getPDFPage().then(r)}))}))}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.removeTouchStartListener(),this.pageRender.$handler.removeClass("fv__create-stamp-state-handler "+this.cursorStyle),this.input&&this.input.blur()}},{key:"out",value:function(){r(a(o.prototype),"out",this).call(this)}}],[{key:"getStateName",value:function(){return Ne}}]),o}(Se);function je(e,t,n,i,a,r,o){try{var s=e[r](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,a)}function Be(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function o(e){je(r,i,a,o,s,"next",e)}function s(e){je(r,i,a,o,s,"throw",e)}o(void 0)}))}}function Ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xe(e,t){var n,i,a,r,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(o=0)),o;)try{if(n=1,i&&(a=2&s[0]?i.return:s[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var Ye=S.creation.CreateFreeTextCalloutService,$e=S.stateHandler,ze=S.ViewerEvents,Ge=(S.CalloutShape,$e.IStateHandler,$e.StateHandlerUtils.getDevicePagePoint),qe=S.vendors,We=qe.Hammer,Je=(qe.jQuery,S.shared),Ke=Je.getClientX,Ze=Je.getClientY,Qe=(Je.CalloutPointsReviser,$e.StateHandlerConsts.STATE_HANDLER_CREATE_FREETEXT_CALLOUT),et=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-typewriter",i}return i(a,[{key:"pageHandler",value:function(e){var t=this;this.pageRender=e;var n=e.$handler;n.addClass("fv__create-callout-state-handler "+this.cursorStyle),n.on("mousemove",(function(e){if(t.startAdding){var n=a.getBoundingClientRect(),i=Ke(e)-n.left,r=Ze(e)-n.top;t.service.update({x:i,y:r})}}));var i,a=n[0],r=this.hammer=new We.Manager(a,{recognizers:[[We.Pan,{direction:We.DIRECTION_ALL}],[We.Tap]]}),o=function(n){t.service.complete().then((function(n){return t.startAdding=0,Se.edit(e,n)})).then((function(e){t.pdfViewer.eventEmitter.once("editingFreeText",(function(){!function(e){document.body.removeChild(e)}(n)}))})).catch((function(e){}))},s=function(t){var n=Ge(a,t);return e.getPDFPage().then((function(t){if(t.isVirtual())return-1;var i=e.scale,a=e.rotate,r=t.getDeviceMatrix(a);return r.scale(i,i),t.getAnnotObjectNumAtDevicePoint([n.x,n.y],1,[r.a,r.b,r.c,r.d,r.e,r.f])})).then((function(t){if(-1!==t&&"freetext"==e.page.getAnnotsSync([t])[0].getType())return e.annotsRender.activeAnnot(t,0,1);return t}))},c=this;r.on("tap",(i=Be((function(t){var n,i;return Xe(this,(function(r){switch(r.label){case 0:return c.startAdding?[3,2]:[4,s(t)];case 1:return-1!==r.sent()?[2]:(c.service||(c.service=new Ye,c.service.prepare(e)),n=Ge(a,t),c.service.start(n),c.service.update(n),c.startAdding=1,[3,3]);case 2:c.pdfViewer.killFocus(),i=tt(),setTimeout((function(){o(i)}),100),r.label=3;case 3:return[2]}}))})),function(e){return i.apply(this,arguments)})).on("panstart",(function(n){t.service||(t.service=new Ye,t.service.prepare(e));var i=Ge(a,n);t.service.start(i)})).on("panend",(function(e){o(tt())})).on("panmove",(function(n){var i=a.getBoundingClientRect(),r=n.srcEvent,o=Ke(r)-i.left,s=Ze(r)-i.top;t.service.update({x:o,y:s}),t.service.annotInfo&&t.pdfViewer.eventEmitter.emit("collab-creating-op",{type:"freetext",page:e.index,points:t.service.annotInfo.calloutLinePoints,innerRect:t.service.annotInfo.innerRect,rect:t.service.annotInfo.rect})}))}},{key:"destroyPageHandler",value:function(){var e,t;null===(t=this.service)||void 0===t||null===(e=t.calloutShape)||void 0===e||e.hide(),this.startAdding=0,this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass("fv__create-callout-state-handler "+this.cursorStyle),this.service&&(this.service.calloutShape.hide(),this.startAdding=0,this.service.destroy()),this.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:this.pageRender.index})}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"addAnnot",value:function(e){var t=this,n=this.pageRender,i=n.pdfViewer;return n.getPDFPage().then((function(i){var a=t.pdfViewer.getDefaultAnnotConfig()("freetext","FreeTextTextbox"),r=Object.assign({},Ue({type:"freetext",intent:"FreeTextCallout",subject:"FreeTextCallout","interior-color":16777215,rotation:((360-90*i.getRotation()-n.getRotation())%360+360)%360,flags:4},"subject",t.pdfViewer.i18n.t("viewer_:annotSubjects.Callout")),e,a);return i.addAnnot(r)})).then((function(e){var t=e[0],a=n.annotsRender.getAnnotRender(t.getId()).component;return i.eventEmitter.emit(ze.addAnnotSuccess,a.annot),Se.edit(n,e)}))}}],[{key:"getStateName",value:function(){return Qe}}]),a}(Se);function tt(){var e=document.createElement("input");return e.style.position="fixed",e.style.left="-9999px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px",document.body.appendChild(e),e.focus(),e}var nt=S.stateHandler,it=S.ViewerEvents,at=(nt.IStateHandler,nt.StateHandlerUtils.getDevicePagePoint),rt=S.vendors.Hammer,ot=nt.StateHandlerConsts.STATE_HANDLER_CREATE_FREETEXT_BOX,st=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-typewriter",i}return i(a,[{key:"pageHandler",value:function(e){this.pageRender=e;var t=e.$handler;t.addClass("fv__create-stamp-state-handler "+this.cursorStyle);var n,i=t[0],a=this.hammer=new rt.Manager(i,{recognizers:[[rt.Tap]]}),r=function(t){var n=at(i,t);return e.getPDFPage().then((function(t){if(t.isVirtual())return-1;var i=e.scale,a=e.rotate,r=t.getDeviceMatrix(a);return r.scale(i,i),t.getAnnotObjectNumAtDevicePoint([n.x,n.y],1,[r.a,r.b,r.c,r.d,r.e,r.f])})).then((function(t){if(-1!==t&&"freetext"==e.page.getAnnotsSync([t])[0].getType())return e.annotsRender.activeAnnot(t,0,1);return t}))},o=this;a.on("tap",(n=Be((function(t){var n,a,s;return Xe(this,(function(c){switch(c.label){case 0:return n=function(){var e=document.createElement("input");return e.style.position="fixed",e.style.left="-9999px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px",document.body.appendChild(e),e.focus(),e}(),a=at(i,t),s=e.pdfViewer,[4,r(t)];case 1:return-1!==c.sent()?[2]:[2,e.getPDFPage().then((function(t){var n=e.getScale(),i=e.getRotation(),r=100*n*4/3,s=20*n*2/3,c={left:a.x,right:a.x+r,top:a.y-s,bottom:a.y+s},l=o.pdfViewer.getDefaultAnnotConfig()("freetext","FreeTextTextbox"),u=16777215;void 0!==l.fillColor&&(u=l.fillColor);var d=t.reverseDeviceRect(c,n,i),h=l.borderInfo;if(h&&h.style===be){var f=2===h.cloudIntensity?14.25:6;d={left:d.left-f,right:d.right+f,top:d.top+f,bottom:d.bottom-f}}var p=Object.assign({type:"freetext",rect:d,"interior-color":u,rotation:((360-90*t.getRotation()-i)%360+360)%360,flags:4,subject:o.pdfViewer.i18n.t("viewer_:annotSubjects.Textbox")},l);return t.addAnnot(p)})).then((function(t){var n=t[0],i=e.annotsRender.getAnnotRender(n.getId()).component;return s.eventEmitter.emit(it.addAnnotSuccess,i.annot),Se.edit(e,t)})).then((function(e){o.pdfViewer.eventEmitter.once("editingFreeText",(function(){!function(e){document.body.removeChild(e)}(n)})),s.getStateHandlerManager().switchTo()}))]}}))})),function(e){return n.apply(this,arguments)}))}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass("fv__create-stamp-state-handler "+this.cursorStyle),this.__removeHandlerMouseEvent__&&this.__removeHandlerMouseEvent__()}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return ot}}]),a}(Se);var ct=function(){function e(n){t(this,e),this.component=n,this.prepared=!1}return i(e,[{key:"prepare",value:function(){this.prepared||(this.prepared=!0,this.doPrepare())}},{key:"doPrepare",value:function(){}},{key:"show",value:function(){this.prepared&&this.doShow()}},{key:"doShow",value:function(){}},{key:"hide",value:function(){this.prepared&&this.doHide()}},{key:"doHide",value:function(){}},{key:"destroy",value:function(){this.component=null,this.prepared=!1}},{key:"willRender",value:function(){}},{key:"afterRender",value:function(){}},{key:"render",value:function(e,t,n){return this.prepared||this.prepare(),this.doRender(e,t,n)}},{key:"doRender",value:function(e,t){return Promise.resolve()}},{key:"numberToRGBAString",value:function(e){var t=(0,Ae.convertFromNumberToRGBA)(e);return"rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(t.a,")")}},{key:"invisibleRender",value:function(){}}]),e}(),lt="vertical",ut="horizontal",dt=function(){function e(n,i){t(this,e),this.fromInchRate=n,this.name=i,Object.defineProperties(this,{fromInchRate:{value:n,enumerable:!0,writable:!1,configurable:!0},name:{value:i,enumerable:!0,writable:!1,configurable:!0}})}return i(e,[{key:"isPixel",get:function(){return!1}},{key:"convertTo",value:function(e,t){return e/this.fromInchRate*t.fromInchRate}},{key:"convertAreaTo",value:function(e,t){return e/Math.pow(this.fromInchRate,2)*Math.pow(t.fromInchRate,2)}}]),e}(),ht=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,0,"px")).orientation=e,Object.defineProperty(p(i),"fromInchRate",{get:function(){var t=(0,Ae.getDPI)();switch(e){case ut:return t.x;case lt:return t.y;default:return t.x}}}),i}return i(a,[{key:"isPixel",get:function(){return!0}}]),a}(dt);const ft={inch:"inch",custom:"custom",mi:"mi",pt:"pt",ft:"ft",yd:"yd",km:"km",m:"m",cm:"cm",mm:"mm",pica:"pica"};var pt,vt=new dt(1,ft.inch),gt=new dt(1,ft.custom),mt=new dt(1/63360,ft.mi),yt=new dt(72,ft.pt),wt=new dt(1/12,ft.ft),St=new dt(1/36,ft.yd),At=new dt(.0254/1e3,ft.km),bt=new dt(.0254,ft.m),kt=new dt(2.54,ft.cm),Rt=new dt(25.4,ft.mm),xt=new dt(6,ft.pica),Et=new ht(ut),Tt=(new ht(lt),Ue(pt={},vt.name,vt),Ue(pt,gt.name,gt),Ue(pt,mt.name,mt),Ue(pt,yt.name,yt),Ue(pt,wt.name,wt),Ue(pt,St.name,St),Ue(pt,At.name,At),Ue(pt,bt.name,bt),Ue(pt,kt.name,kt),Ue(pt,Rt.name,Rt),Ue(pt,xt.name,xt),Ue(pt,Et.name,Et),pt);function Ct(e){switch(e=(e=e.toLowerCase()).replace(/[^a-z]/g,"")){case"in":e="inch";break;case"p":e="pica"}return Tt[e]}var Pt=function(e){l(o,e);var n=g(o);function o(e){return t(this,o),n.call(this,e)}return i(o,[{key:"prepare",value:function(){this.prepared||(this.canvas=document.createElement("canvas"),this.container=this.component.getContainerElement(),this.container.appendChild(this.canvas),r(a(o.prototype),"prepare",this).call(this))}},{key:"destroy",value:function(){r(a(o.prototype),"destroy",this).call(this),this.prepared&&this.canvas.remove()}},{key:"doShow",value:function(){this.canvas.classList.remove("fv__ui-hide")}},{key:"doHide",value:function(){this.canvas.classList.add("fv__ui-hide")}},{key:"convertPointToPixel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return yt.convertTo(e,Et)*t}},{key:"willRender",value:function(){this.canvas.style.willChange="left, top, width, height",this.container.style.willChange="left; top"}},{key:"afterRender",value:function(){this.canvas.style.willChange="auto",this.container.style.willChange="auto"}},{key:"render",value:function(e,t){this.prepared||this.prepare();var n=this.component.getRenderingData(e,t);if(!n)return Promise.resolve();var i=n.annotInfo,a=i.borderInfo||{},r=this.convertPointToPixel(a.width,e),o=n.smartScale;!n.annotFlag.checkNoZoom()||(e=1);var s=n.rect,c=n.outerDeviceRect,l=n.innerDeviceRect;Object.assign(l,{width:l.right-l.left,height:l.bottom-l.top}),Object.assign(c,{width:c.right-c.left,height:c.bottom-c.top}),this.resetCanvasSize(c.width,c.height),this.container.style.cssText+="\n            left: ".concat(s.left,"px;\n            top: ").concat(s.top,"px;\n        ");var u=this.canvas.style;if(0===r&&0===i.borderColor&&!i.fillColor)return u.visibility="hidden",Promise.resolve();if(0===i.opacity)return u.visibility="hidden",Promise.resolve();u.visibility="unset";try{return Promise.resolve(this.doRender({outerRect:c,innerRect:l,deviceRect:s,scale:e,smartScale:o,rotate:t,renderingData:n}))}catch(e){return console.error(e),Promise.resolve()}}},{key:"doRender",value:function(e){e.outerRect,e.innerRect,e.deviceRect,e.scale,e.rotate}},{key:"resetCanvasSize",value:function(e,t){this.canvas.width=Math.ceil(e),this.canvas.height=Math.ceil(t),this.canvas.style.width=null,this.canvas.style.height=null}},{key:"invisibleRender",value:function(){this.canvas&&(this.canvas.width=0)}}]),o}(ct);var _t=0,It=1,Dt=2,Mt=3,Vt=5,Lt="LineArrow",Ht="LineDimension",Nt={0:"None",1:"Square",2:"Circle",3:"Diamond",4:"OpenArrow",5:"ClosedArrow",6:"Butt",7:"ROpenArrow",8:"RClosedArrow",9:"Slash"},Ot=Object.keys(Nt).reduce((function(e,t){return e[Nt[t]]=Number(t),e}),{}),Ft=0,jt=1,Bt=(Promise.resolve(),function(){function n(e,i){t(this,n),this.x=e,this.y=i}return i(n,[{key:"add",value:function(e,t){return new n(this.x+e,this.y+t)}},{key:"addp",value:function(e){return new n(this.x+e.x,this.y+e.y)}},{key:"subtractp",value:function(e){return new n(this.x-e.x,this.y-e.y)}},{key:"subtract",value:function(e,t){return new n(this.x-e,this.y-t)}},{key:"move",value:function(e,t){var i=t.x-this.x,a=t.y-this.y,r=e/Math.sqrt(i*i+a*a);return new n(this.x+i*r,this.y+a*r)}},{key:"rotate",value:function(e,t){var i=this.x-t.x,a=this.y-t.y,r=Math.sqrt(i*i+a*a),o=Math.atan2(a,i)-e,s=r*Math.cos(o),c=r*Math.sin(o);return new n(t.x+s,t.y+c)}},{key:"distanceTo",value:function(e){var t=e.x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)}},{key:"slope",value:function(e){var t=this._dot(e);return Math.acos(t/(this._disp()*e._disp()))}},{key:"_dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"_disp",value:function(){return Math.sqrt(this._dot(this))}},{key:"equalTo",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i=Math.abs(i),e(t,n)&&Math.abs(this.x-t.x)<=i&&Math.abs(this.y-t.y)<=i}},{key:"clone",value:function(){return new n(this.x,this.y)}}]),n}()),Ut=function(){function n(){t(this,n),this.segments=[]}return i(n,[{key:"addSegment",value:function(t){e(t,Xt)&&this.segments.push(t)}},{key:"render",value:function(e){e.beginPath(),this.segments.forEach((function(t){t.render(e)})),e.closePath()}}]),n}(),Xt=function(){function e(n,i){t(this,e),this.from=n,this.to=i}return i(e,[{key:"render",value:function(e){(0,Ae.notImplemented)()}},{key:"isJoinedBefore",value:function(e){return this.to.equalTo(e.from)}},{key:"isJoinedAfter",value:function(e){return e.to.equalTo(this.from)}},{key:"isJoinedWith",value:function(e){return this.isJoinedBefore(e)||this.isJoinedAfter(e)}}]),e}(),Yt=function(){function e(){t(this,e)}return i(e,[{key:"generate",value:function(){(0,Ae.notImplemented)()}}]),e}(),$t=function(e){l(a,e);var n=g(a);function a(){return t(this,a),n.apply(this,arguments)}return i(a,[{key:"render",value:function(e){try{e.save(),e.beginPath(),this.segments.filter((function(e){return e.isOn})).forEach((function(t){t.render(e)})),e.closePath()}finally{e.restore()}}}]),a}(Ut),zt=function(e){l(a,e);var n=g(a);function a(e,i){var r,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return t(this,a),(r=n.call(this,e,i)).isOn=o,r}return i(a,[{key:"render",value:function(e){this.isOn&&(e.moveTo(this.from.x,this.from.y),e.lineTo(this.to.x,this.to.y))}}]),a}(Xt),Gt=(function(e){l(a,e);var n=g(a);function a(e,i){var r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return t(this,a),(r=n.call(this)).contour=e,r.dashes=i,r.phase=o,r.continuous=s,r.dashSum=i.reduce((function(e,t){return e+t}),0),r}i(a,[{key:"generate",value:function(){var e=this,t=new $t;if(0==this.dashes.length)this.contour.reduce((function(e,n){t.addSegment(new zt(e,n))}));else{var n=this.phase<this.dashSum?this.phase:this.phase%this.dashSum,i=0,a=0,r=!0;n>0&&this.dashes.reduce((function(e,t,o){var s=e+t;return s>n&&(a=s-n,i=o,r=o%2==0),s}),0);var o=function(){return(i+1)%e.dashes.length};this.contour.reduce((function(s,c){var l=s.distanceTo(c),u=s;for(a>0&&(t.addSegment(new zt(u,u=u.move(a,c),r)),r=!r,l-=a,i=o());;){var d=e.dashes[i];if(!(l>=d)){t.addSegment(new zt(u,c,r)),e.continuous?(a=d-l,l=0):(a=n,i=0,r=!0);break}t.addSegment(new zt(u,u=u.move(d,c),r)),l-=d,i=o(),r=!r}return c}))}return t}}])}(Yt),function(e){l(a,e);var n=g(a);function a(e,i,r){var o;return t(this,a),(o=n.call(this,null,r)).controlPoint1=e,o.controlPoint2=i,o}return i(a,[{key:"render",value:function(e){e.bezierCurveTo(this.controlPoint1.x,this.controlPoint1.y,this.controlPoint2.x,this.controlPoint2.y,this.to.x,this.to.y)}}]),a}(Xt)),qt=function(e){l(a,e);var n=g(a);function a(e){return t(this,a),n.call(this,e)}return i(a,[{key:"render",value:function(e){e.moveTo(this.from.x,this.from.y)}}]),a}(Xt),Wt=.5522847498308,Jt=3.14159265358979,Kt=function(e){l(a,e);var n=g(a);function a(e,i,r){var o;return t(this,a),(o=n.call(this)).points=e,o.innerRect=i,o.outerRect=r,o}return i(a,[{key:"generate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,n=arguments.length>2?arguments[2]:void 0,i=new Ut,a=this.points.map((function(t){var n=e.innerRect.height-t.y;return new Bt(t.x,n)})),r=a.length;n||(n=r*t);var o=a.map((function(e,t){return e.distanceTo(a[(t+1)%r])})).reduce((function(e,t){return e+t})),s={left:a[0].x,right:a[0].x,top:a[0].y,bottom:a[0].y},c=o/n;if(0==c)return i;for(var l=[],u=0,d=a[0],h=a[1],p=d.distanceTo(h),v=0,g=1;v<n;v++){for(;u>p;)u-=p,g++,d=h,h=a[g%r],p=d.distanceTo(h);l.push(d.move(u,h)),u+=c}var m=l.length,y=!0,w=5*c/8;return l.forEach((function(t,n){var a=function(e,t,n){var i,a,r=e.subtractp(t),o=n.subtractp(t),s=[],c=Math.atan2(r.y,r.x),l=Math.atan2(o.y,o.x);c+=Math.acos(e.distanceTo(t)/(2*w))-Jt/9,l-=Math.acos(n.distanceTo(t)/(2*w)),l<c&&(l+=2*Jt);var u={left:t.x-w,right:t.x+w,bottom:t.y-w,top:t.y+w},d=Zt(u,c,l,y);(i=s).push.apply(i,f(d.arrAp)),y=!1;var h=t.subtractp(n);return c=Math.atan2(h.y,h.x),c+=Math.acos(n.distanceTo(t)/(2*w)),l=c-Jt/9,u={left:n.x-w,right:n.x+w,bottom:n.y-w,top:n.y+w},d=Zt(u,c,l,y),(a=s).push.apply(a,f(d.arrAp)),s}(l[0==n?m-1:n-1],t,l[(n+1)%m]);a.forEach((function(t){var n=function(t){if(t)return new Bt(t.x+e.innerRect.left-e.outerRect.left,e.innerRect.height-t.y+(e.innerRect.top-e.outerRect.top))};t.from=n(t.from),t.to=n(t.to),t.controlPoint1=n(t.controlPoint1),t.controlPoint2=n(t.controlPoint2),i.addSegment(t)}))})),i.rect=s,i}}]),a}(Yt);function Zt(e,t,n,i){var a,r,o,s,c,l,u,d,h,f,p,v,g,m,y,w,S,A,b,k,R,x,E,T,C={};if(e.left>=e.right||e.bottom>=e.top)return{arrAp:[],pdfRect:C};if(Math.abs(n-t)<=1e-4)return{arrAp:[],pdfRect:C};var P=[];a=(e.right+e.left)/2,r=(e.top+e.bottom)/2,o=Math.abs(e.right-e.left)/2,s=Math.abs(e.top-e.bottom)/2,E=t,R=a+(p=o*Math.cos(E)),x=r+(v=s*Math.sin(E)),C.left=C.right=R,C.bottom=C.top=x,i&&P.push(new qt(new Bt(R,x)));var _=1;n<t&&(_=-1);var I=Math.floor(2*t/Jt);_>0&&(I+=1),I*=Jt/2;for(var D=!1;T=I,_>0?n<=I&&(T=n,D=!0):n>=I&&(T=n,D=!0),p=o*Math.cos(E),v=s*Math.sin(E),S=o*Math.cos(T),h=f=-o*o*s*s,g=p+(R=(b=((u=o*o*v)*f-(d=o*o*(A=s*Math.sin(T)))*h)/((c=s*s*p)*d-(l=s*s*S)*u))-p)*Wt,m=v+(x=(k=(l*h-c*f)/(c*d-l*u))-v)*Wt,y=S+(R=b-S)*Wt,w=A+(x=k-A)*Wt,g=R=a+g,m=x=r+m,C.left>g&&(C.left=g),C.bottom>m&&(C.bottom=m),C.right<g&&(C.right=g),C.top<m&&(C.top=m),y=R=a+y,w=x=r+w,C.left>y&&(C.left=y),C.bottom>w&&(C.bottom=w),C.right<y&&(C.right=y),C.top<w&&(C.top=w),S=R=a+S,A=x=r+A,C.left>S&&(C.left=S),C.bottom>A&&(C.bottom=A),C.right<S&&(C.right=S),C.top<A&&(C.top=A),P.push(new Gt(new Bt(g,m),new Bt(y,w),new Bt(S,A))),!D;)E=T,I+=_*Jt/2;return{arrAp:P,pdfRect:C}}var Qt=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i;t(this,e),this.top=n,this.left=i,this.bottom=a,this.right=r},en=function(){function n(e){t(this,n),this.offsetLeft=0,this.offsetTop=0,this.offsetRight=0,this.offsetBottom=0,this.target=e}return i(n,[{key:"moveLeft",value:function(e){return this.offsetLeft+=e,this.offsetRight+=e,this}},{key:"moveTop",value:function(e){return this.offsetTop+=e,this.offsetBottom+=e,this}},{key:"move",value:function(e,t){return this.moveLeft(e).moveTop(t)}},{key:"moveTo",value:function(e,t){return this.offsetLeft=this.offsetRight=this.target.left-e,this.offsetTop=this.offsetBottom=this.target.top-t,this}},{key:"shrink",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t;return this.add(new Qt(e,t,-n,-i))}},{key:"expand",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t;return this.add(new Qt(-e,-t,n,i))}},{key:"zoom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center",i=this.target.right+this.offsetRight-(this.target.left+this.offsetLeft),a=this.target.bottom+this.offsetBottom-(this.target.top+this.offsetTop),r=i*e-i,o=a*e-a,s=0,c=0,l=0,u=0;switch(t){case"right":s=-r;break;case"center":s=-r/2,c=r/2;break;default:c=r}switch(n){case"bottom":l=-o;break;case"center":l=-o/2,u=o/2;break;default:u=o}return this.add(new Qt(l,s,u,c))}},{key:"add",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.top,n=void 0===t?0:t,i=e.left,a=void 0===i?n:i,r=e.bottom,o=void 0===r?n:r,s=e.right,c=void 0===s?a:s;return this.offsetLeft+=a,this.offsetRight+=c,this.offsetBottom+=o,this.offsetTop+=n,this}},{key:"extract",value:function(){var e=this.target.left+this.offsetLeft,t=this.target.right+this.offsetRight;return{left:e,top:this.target.top+this.offsetTop,right:t,bottom:this.target.bottom+this.offsetBottom}}},{key:"boundary",value:function(){var e=this.target.left+this.offsetLeft,t=this.target.right+this.offsetRight,n=this.target.top+this.offsetTop;return{left:e,top:n,width:t-e,height:this.target.bottom+this.offsetBottom-n}}},{key:"intersect",value:function(t){e(t,n)||(t=n.on(t));var i=this.toPlainObject(),a=t.toPlainObject(),r={left:Math.max(i.left,a.left),right:Math.min(i.right,a.right),top:Math.max(i.top,a.top),bottom:Math.min(i.bottom,a.bottom)};return n.on(r)}},{key:"toPlainObject",value:function(){return{left:this.target.left+this.offsetLeft,right:this.target.right+this.offsetRight,top:this.target.top+this.offsetTop,bottom:this.target.bottom+this.offsetBottom}}}],[{key:"isOverlap",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Math.max(e.left,t.left),a=Math[n?"min":"max"](e.top,t.top),r=Math[n?"max":"min"](e.bottom,t.bottom),o=Math.min(e.right,t.right);if(i<=o)if(n){if(a>=r)return(o-i)*(a-r)}else if(a<=r)return(o-i)*(r-a);return 0}},{key:"isInRect",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e>=n.left&&e<=n.right)if(i){if(t>=n.bottom&&t<=n.top)return!0}else if(t<=n.bottom&&t>=n.top)return!0;return!1}},{key:"rectInRect",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!!(e.left>=t.left&&e.right<=t.right)&&(n?e.top<=t.top&&e.bottom>=t.bottom:e.top>=t.top&&e.bottom<=t.bottom)}},{key:"isSimilar",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.01;return Math.abs(e.top-t.top)<n&&Math.abs(e.bottom-t.bottom)<n&&Math.abs(e.left-t.left)<n&&Math.abs(e.right-t.right)<n}},{key:"on",value:function(e){return new n(e)}},{key:"subtract",value:function(e,t){return new Qt(e.top-t.top,e.left-t.left,e.bottom-t.bottom,e.right-t.right)}},{key:"expandOffset",value:function(e,t){return new Qt(e.top-t.top,e.left-t.left,t.bottom-e.bottom,t.right-e.right)}},{key:"copyTo",value:function(e,t){t.left=e.left,t.top=e.top,t.right=e.right,t.bottom=e.bottom}}]),n}(),tn=function(e){l(o,e);var n=g(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,[{key:"doPrepare",value:function(){r(a(o.prototype),"doPrepare",this).call(this),this.canvas.classList.add("fv__viewer-render-square-canvas")}},{key:"doRender",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.renderingData.annotInfo,i=n.borderInfo||{},a=this.convertPointToPixel(i.width||1,e.scale),r=this.canvas.getContext("2d");if(r.clearRect(0,0,this.canvas.width,this.canvas.height),r.save(),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent()){e.lineWidth=a,t&&(r.globalAlpha=n.opacity),0===a||!1===n.hasBorderColor?r.strokeStyle="transparent":r.strokeStyle=this.numberToRGBAString(n.color),r.lineWidth=a;try{switch(i.style){case Mt:case Dt:case _t:this.renderSolid(r,n,e);break;case It:this.renderDashed(r,n,e);break;case Vt:this.renderCloud(r,n,e)}var o=n.fillColor;o&&(r.fillStyle=this.numberToRGBAString(o),r.fill()),r.stroke()}finally{r.restore()}}}},{key:"shrinkRect",value:function(e,t){var n=en.on(e).shrink(t).extract();return Object.assign(n,{width:n.right-n.left,height:n.bottom-n.top})}},{key:"renderCloud",value:function(e,t,n){t.fillColor;var i=t.borderInfo.cloudIntensity,a=this.shrinkRect(n.innerRect,0),r=this.shrinkRect(n.outerRect,0),o=a.width,s=a.height;new Kt([new Bt(0,s),new Bt(o,s),new Bt(o,0),new Bt(0,0)],a,r).generate(32/3/i).render(e)}},{key:"renderDashed",value:function(e,t,n){var i=this,a=t.borderInfo,r=a.dashes||[],o=a.dashPhase||0,s=n.scale;e.save(),e.setLineDash&&e.setLineDash(r.map((function(e){return i.convertPointToPixel(e,s)}))),e.lineDashOffset=this.convertPointToPixel(o,s),this.renderSolid(e,t,n)}},{key:"renderSolid",value:function(e,t,n){var i=n.lineWidth,a=n.innerRect,r=n.outerRect,o=a.width,s=a.height,c=.5*i,l=a.left-r.left,u=a.top-r.top;e.beginPath(),e.rect(c+l,c+u,o-i,s-i),e.closePath()}}]),o}(Pt);const nn={invisible:1,hidden:2,print:4,noZoom:8,noRotate:16,noView:32,readOnly:64,locked:128,toggleNoView:256,lockedContents:512};const an=function(){function e(n){t(this,e),this.flag=n}return i(e,[{key:"getValue",value:function(){return this.flag}},{key:"checkInvisible",value:function(){return(this.flag&nn.invisible)===nn.invisible}},{key:"checkHidden",value:function(){return(this.flag&nn.hidden)===nn.hidden}},{key:"checkPrint",value:function(){return(this.flag&nn.print)===nn.print}},{key:"checkNoZoom",value:function(){return(this.flag&nn.noZoom)===nn.noZoom}},{key:"checkNoRotate",value:function(){return(this.flag&nn.noRotate)===nn.noRotate}},{key:"checkNoView",value:function(){return(this.flag&nn.noView)===nn.noView}},{key:"checkReadOnly",value:function(){return(this.flag&nn.readOnly)===nn.readOnly}},{key:"checkLocked",value:function(){return(this.flag&nn.locked)===nn.locked}},{key:"checkToggleNoView",value:function(){return(this.flag&nn.toggleNoView)===nn.toggleNoView}},{key:"checkLockedContents",value:function(){return(this.flag&nn.lockedContents)===nn.lockedContents}},{key:"check",value:function(e){return(this.flag&e)===e}},{key:"or",value:function(e){return this.flag=this.flag|e,this}}]),e}();const rn={annotationUpdated:"annotation-updated",annotationIDUpdated:"annotation-id-updated",annotationAppearanceUpdated:"annotation-appearance-updated",annotationReplyAdd:"annotation-reply-add",annotationReplyAdded:"annotation-reply-add",annotationReviewStateAnnotAdd:"annotation-review-state-annot-add",annotationReviewStateAnnotAdded:"annotation-review-state-annot-add",annotationMarkedStateAnnotAdd:"annotation-marked-state-annot-add",annotationMarkedStateAnnotAdded:"annotation-marked-state-annot-add",annotationStatesCleared:"annotation-states-cleared",annotationRemoved:"annotation-removed",annotationMovedPosition:"annotation-moved-position",annotationPositionMoved:"annotation-moved-position",annotationOrderChanged:"annotation-order-changed",annotationAdded:"annotation-add",annotationAdd:"annotation-add",moveAnnotsToPages:"moveAnnotsToPages",annotationImported:"annotation-imported",annotationImportedEx:"annotation-imported-ex",annotationLoaded:"annotation-loaded",actionUpdated:"action-updated",actionAdd:"action-add",actionAdded:"action-add",actionRemove:"action-remove",actionRemoved:"action-remove",layerVisibleChange:"layer-visible-change",layerVisibleChanged:"layer-visible-change",layerRemoved:"layer-removed",layerMerged:"layer-merged",layerAdded:"layer-added",bookmarkAdded:"bookmark-added",structureBookmarkAdded:"structure-bookmark-added",bookmarkUpdated:"bookmark-updated",bookmarkRemoved:"bookmark-removed",stateAnnotNameUpdated:"state-annot-name-updated",pageInfoChange:"page-info-change",pageInfoChanged:"page-info-change",pageRotationChange:"page-rotation-change",beforePageRotationChanged:"before-page-rotation-changed",pageRotationChanged:"page-rotation-change",imageAdded:"image-added",watermarkAdded:"watermark-added",watermarkRemoved:"watermark-removed",graphicsUpdated:"graphics-updated",permissionChanged:"permission-changed",docPasswordChanged:"doc-password-changed",drmEncryptSuccess:"drm-encrypt-success",drmEncryptSucceeded:"drm-encrypt-success",drmEncryptFailed:"drm-encrypt-failed",removePwdAndPerm:"remove-password-and-permission",pwdAndPermRemoved:"remove-password-and-permission",securityTypeChanged:"security-type-changed",pageMoved:"page-moved",pageRemoved:"page-removed",pageAdded:"page-added",insertPages:"import-pages",pagesInserted:"import-pages",importPages:"import-pages",documentAttachmentAdd:"document-attachment-add",docAttachmentAdded:"document-attachment-add",documentAttachmentModify:"document-attachment-modify",docAttachmentModified:"document-attachment-modify",documentAttachmentRemove:"document-attachment-remove",docAttachmentRemoved:"document-attachment-remove",applyRedaction:"apply-redaction",redactionApplied:"apply-redaction",removeReviewState:"remove-review-state",reviewStateRemoved:"remove-review-state",removeMarkedState:"remove-marked-state",markedStateRemoved:"remove-marked-state",formValueChanged:"form-value-changed",metaDataChanged:"meta-data-changed",docModified:"doc-modified",flattened:"flattened",headerFooterUpdated:"headerFooterUpdated",headerFooterAdded:"headerFooterAdded",COChange:"COChange",COChanged:"COChange",pagesReversed:"pages-reversed",pagesMoved:"pages-moved",pagesRemoved:"pages-removed",pagesRotated:"pages-rotated",pageMeasureScaleRatioChanged:" page-measure-scale-ratio-changed",obtainsPageFromEngine:"obtains-page-from-engine",pagesBoxChange:"pages-box-changed",pagesBoxChanged:"pages-box-changed",pagesLabelChange:"pages-label-change",pagesLabelChanged:"pages-label-change",pagesLabelNeedUpdate:"pages-label-need-change",pagesLabelNeedUpdated:"pages-label-need-change",pagesReplace:"pages-replace",pagesReplaced:"pages-replace",recognitionForm:"recognition-form",removeEmbeddedPageThumbnail:"remove-embedded-page-thumbnail",embeddedPageThumbnailRemoved:"remove-embedded-page-thumbnail",objectStartEdit:"object-start-edit",objectEndEdit:"object-end-edit",objectSelectionChanged:"object-selection-changed",objectAdded:"object-added",objectPropertyChanged:"object-property-changed",objectContentChanged:"object-content-changed",paragraphContentChanged:"paragraph-text-changed",paragraphTextOnActivate:"paragraph-text-on-activate",paragraphTextOnDeactivate:"paragraph-text-on-deactivate",paragraphTextEnterEdit:"paragraph-text-enter-edit",paragraphTextExitEdit:"paragraph-text-exit-edit",paragraphTextOnChar:"paragraph-text-on-char",findSuccess:"find-success",replaceSuccess:"replace-success",replaceAllSuccess:"replace-all-success",articleThreadAdded:"article-thread-added",articleThreadUpdated:"article-thread-updated",articleThreadRemoved:"article-thread-removed",articleBeadAdded:"article-bead-added",articleBeadRemoved:"article-bead-removed",articleBeadUpdated:"article-bead-updated",articleEnterReadMode:"article-enter-read-mode",articleOutReadMode:"article-out-read-mode",invalidRect:"invalidRect",xfaContentChanged:"xfa-content-changed",formReloaded:"formReloaded",formFieldImported:"form-field-imported"};const on=Object.assign({jrLicenseSuccess:"jr-license-success",srLicenseSuccess:"sr-license-success",beforeOpenFile:"before-open-file",openingFile:"opening-file",beforeLoadPDFDoc:"before-load-pdf-document",openFileSuccess:"open-file-success",openFileFailed:"open-file-failed",willCloseDocument:"will-close-document",renderFileSuccess:"render-file-success",renderFileFailed:"render-file-error",beforeRenderPage:"before-render-page",renderPageSuccess:"render-page-success",updateZoomMode:"update-zoom-mode",beforeZoomTo:"before-zoom-to",zoomToSuccess:"zoom-to-success",zoomToFailed:"zoom-to-failed",startChangeViewMode:"start-change-view-mode",changeViewModeSuccess:"change-view-mode-success",toggleFullScreen:"toggle-full-screen",changeViewModeFailed:"change-view-mode-failed",pagesLayoutRedrawBegin:"pages-layout-redraw-begin",pageLayoutRedraw:"page-layout-redraw",pagesLayoutRedrawEnd:"pages-layout-redraw-end",copyTextSuccess:"copy-text-success",copyTextFailed:"copy-text-failed",tapPage:"tap-page",tapAnnotation:"tap-annotation",pressPage:"press-page",pressAnnotation:"press-annotation",pressText:"press-text",rightClickPage:"right-click-page",rightClickAnnotation:"right-click-annotation",doubleTapPage:"double-tap-page",doubleTapAnnotation:"double-tap-annotation",activeAnnotationBefore:"active-annotation-before",activeAnnotation:"active-annotation",activeAnnotationAfter:"active-annotation-after",panActiveAnnotation:"pan-active-annotation",doubleTapActiveAnnotation:"double-tap-active-annotation",contextMenuActiveAnnotation:"contextmenu-action-annotation",activeMultipleAnnotations:"active-multiple-annotations",unActiveAnnotation:"unactive-annotation",updateActiveAnnotation:"update-action-annotation",updateActionAnnotation:"update-action-annotation",removeActiveAnnotationBefore:"remove-action-annotation-before",removeActionAnnotationBefore:"remove-action-annotation-before",removeActiveAnnotationSuccess:"remove-action-annotation-success",removeActionAnnotationSuccess:"remove-action-annotation-success",removeActiveAnnotationFailed:"remove-action-annotation-failed",removeActionAnnotationFailed:"remove-action-annotation-failed",beforeSwitchStateHandler:"before-switch-state-handler",switchStateHandler:"switch-state-handler",deactiveStateHandler:"deactive-state-handler",redactAnnotAllApplyed:"applyed-all-redaction",redactAnnotApplyed:"applyed-redaction",pageNumberChange:"page-number-change",beforeDocumentRotation:"before-document-rotation",afterDocumentRotation:"after-document-rotation",snapModeChanged:"snap-mode-changed",createPageAreaRenderer:"create-page-area-renderer",destroyPageAreaRenderer:"destroy-page-area-renderer",startUpdatePageAreaRenderer:"start-update-page-area-renderer",createSnapshotArea:"create-snapshot-area",updateSnapshotArea:"update-snapshot-area",stabilizedSnapshotArea:"stabilized-snapshot-area",switchPageAreaRenderer:"switch-page-area-renderer",fitWidthResizeViewport:"fit-width-resize-viewport",signatureFieldMouseLButtonDown:"signature-field-Lbutton-down",signatureFieldMouseLButtonUp:"signature-field-LButton-up",signatureFieldMouseEnter:"signature-field-mouse-enter",signatureFieldMouseExit:"signature-field-mouse-exit",visiblePagesRenderCompleted:"completed-render-visible-pages",marqueeZoomIn:"marquee-zoom-in",marqueeZoomOut:"marquee-zoom-out",inkSignAdded:"inkSign-added",inkSignDeleted:"inkSign-deleted",onlineSignAdded:"onlineSign-added",onlineSignDeleted:"onlineSign-deleted",changeReadSpeed:"changeReadSpeed",changeReadVolume:"changeReadVolume",pageMoved:"page-moved",pageRemoved:"page-removed",pageAdded:"page-added",customDataAdd:"custom-data-add",customDataImported:"custom-data-imported",customDataRemoved:"custom-data-removed",customDataUpdated:"custom-data-updated",distanceAnnotCreationStart:"distance-creation-start",perimeterAnnotCreationStart:"perimeter-creation-start",updateDistanceAnnot:"update-distance-annot",distanceAnnotCreationEnd:"distance-creation-end",distanceAnnotCreationCancel:"distance-creation-cancel",drawingAnnotCreationStart:"drawing-creation-start",drawingAnnotCreationEnd:"drawing-creation-end",drawingAnnotCreationCancel:"drawing-creation-cancel",addEditImage:"add-edit-image",InkImageSelected:"ink-image-selected",OnlineImageSelected:"online-image-selected",checkTheSearch:"check-the-search",activeElementChanged:"active-element-changed",cancelCreatingDistance:"cancel-creating-measurement",completeCreatingDistance:"complete-creating-measurement",eraserSuccess:"eraser-success",addAnnotSuccess:"add-annot-success",cancelAddAnnot:"cancel-add-annot",globalAnnotFlagChanged:"global-annot-flag-changed",toolbarTabsClicked:"toolbar-tabs-clicked",sideBarChanged:"sidebar-changed",showWhatsNew:"show-whats-new",disableScroll:"disable-scroll",enableScroll:"enable-scroll",updateScrollableStatus:"update-scrollable-status",selectText:"select-text",changeEnableJS:"change-enable-js",toggleEngineSr2JrSuccess:"toggle-engine-sr-to-jr-success",iconInited:"iconInited",iconAdded:"iconAdded",iconRemoved:"iconRemoved",annotationPermissionChanged:"annotation-premission-changed",startScrollingPage:"pdfui-start-scrolling-page",scrollingPage:"pdfui-scrolling-page",endScrollingPage:"pdfui-end-scrolling-page",designerAssistantStatusChanged:"form-designer-assistant-status-changed",mouseEnter:"mouse-enter",mouseLeave:"mouse-leave",setFromFieldHighlight:"set_form_field_highlight",AddFontMaps:"set_font_map",thumbnailClicked:"thumbnail-clicked",layerActionActived:"layer-action-actived",redeModeShowSidebar:"rede-mode-show-sidebar",gridToggle:"grid-toggle",snapGridToggle:"snap-grid-toggle",toggleCollaborationMode:"toggleCollaborationMode",findReplaceDialogVisibleChange:"find-replace-dialog-visible-change",showAllComments:"show-all-comments",hideAllComments:"hide-all-comments",focusOnControl:"focus-on-control",blurFromObject:"blur-from-object",documentWillPrint:"document-will-print",documentDidPrint:"document-did-print",documentWillSave:"document-will-save",documentDidSave:"document-did-save",verifyDocSignatureEvent:"verify-doc-signature",verifySignatureEvent:"verify-signature",clearSignatureEvent:"clear-signature",viewSignedVersionDocEvent:"view-signed-version",showFieldPropertiesEvent:"show-field-properties",showSignatureVerifyInfoEvent:"show-signature-tusted-info",compareSignedVersionEvent:"compare-signed-version",showCompareSignedVersionResultEvent:"show-compare-signed-version-result",eSignCnShowAuthPromote:"eSignCnShowAuthPromote",eSignCnShowMultiPageStamp:"eSignCnShowMultiPageStamp",eSignCNAddDateStamp:"eSignCNAddDateStamp",eSignCNCloseStamp:"eSignCNCloseStamp",eSignCNChangePagingSeal:"eSignCNChangePagingSeal",eSignCNOpenProcessSeal:"eSignCNOpenProcessSeal",eSignCnApply:"eSignCnApply",eSignCNShowOfflineResult:"eSignCNShowOfflineResult",eSignCnExit:"eSignCnExit",tapField:"tap-field",tapGraphicsObject:"tap-graphics-object",spawnPageSuccess:" spawn-page-success",progressChanged:"progress-changed",togglePageContextMenu:"toggle-page-contextmenu",beforeRenderingVisiblePages:"before-rerendering-visible-pages",afterRenderingVisiblePages:"after-rerendering-visible-pages"},rn);!function(){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(t(this,n),"function"==typeof e.transformRect){var c=e;e=c.a,i=c.b,a=c.c,r=c.d,o=c.e,s=c.f}else if(Array.isArray(e)){var l=e;e=l[0],i=l[1],a=l[2],r=l[3],o=l[4],s=l[5]}this.a=e,this.b=i,this.c=a,this.d=r,this.e=o,this.f=s}i(n,[{key:"set",value:function(e,t,n,i,a,r){this.a=e,this.b=t,this.c=n,this.d=i,this.e=a,this.f=r}},{key:"reset",value:function(){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0}},{key:"reverse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=e.a*e.d-e.b*e.c;if(0==t)return e;var i=-t;return new n(e.d/t,e.b/i,e.c/i,e.a/t,(e.c*e.f-e.d*e.e)/t,(e.a*e.f-e.b*e.e)/i)}},{key:"setReverse",value:function(e){var t=this.reverse(e);this.set(t.a,t.b,t.c,t.d,t.e,t.f)}},{key:"rotate",value:function(e,t){var i,a=Math.cos(e),r=Math.sin(e),o=new n(a,r,-r,a,0,0);i=t?n.Concat2mt(o,this):n.Concat2mt(this,o),this.set(i.a,i.b,i.c,i.d,i.e,i.f)}},{key:"rotateAt",value:function(e,t,n,i){this.translate(e,t,i),this.rotate(n,i),this.translate(-e,-t,i)}},{key:"translate",value:function(e,t,n){n?(this.e+=e*this.a+t*this.c,this.f+=t*this.d+e*this.b):(this.e+=e,this.f+=t)}},{key:"concat",value:function(t,i,a,r,o,s,c){var l,u;e(t,n)?(l=t,c=i):l=new n(t,i,a,r,o,s),u=c?n.Concat2mt(l,this):n.Concat2mt(this,l),this.set(u.a,u.b,u.c,u.d,u.e,u.f)}},{key:"is90Rotated",value:function(){var e=1e3*this.a;e<0&&(e*=-1);var t=1e3*this.d;t<0&&(t*=-1);var n=this.b;n<0&&(n*=-1);var i=this.c;return i<0&&(i*=-1),e<n&&t<i}},{key:"isScaled",value:function(){var e=1e3*this.b;e<0&&(e*=-1);var t=1e3*this.c;t<0&&(t*=-1);var n=this.a;n<0&&(n*=-1);var i=this.d;return i<0&&(i*=-1),e<n&&t<i}},{key:"getA",value:function(){return this.a}},{key:"getB",value:function(){return this.b}},{key:"getC",value:function(){return this.c}},{key:"getD",value:function(){return this.d}},{key:"getE",value:function(){return this.e}},{key:"getF",value:function(){return this.f}},{key:"scale",value:function(e,t,n){this.a*=e,this.d*=t,n?(this.b*=e,this.c*=t):(this.b*=t,this.c*=e,this.e*=e,this.f*=t)}},{key:"transformXDistance",value:function(e){var t=this.a*e,n=this.b*e;return Math.sqrt(t*t+n*n)}},{key:"transformYDistance",value:function(e){var t=this.c*e,n=this.d*e;return Math.sqrt(t*t+n*n)}},{key:"transformDistance",value:function(e,t){var n=this.a*e+this.c*t,i=this.b*e+this.d*t;return Math.sqrt(n*n+i*i)}},{key:"transformPoint",value:function(e,t){return[this.a*e+this.c*t+this.e,this.b*e+this.d*t+this.f]}},{key:"transformRect",value:function(e,t,n,i){for(var a,r=[e,e,n,n],o=[t,i,t,i],s=0;s<4;s++)a=this.transformPoint(r[s],o[s]),r[s]=a[0],o[s]=a[1];for(var c=[r[0],r[0],o[0],o[0]],l=1;l<4;l++)c[0]>r[l]&&(c[0]=r[l]),c[1]<r[l]&&(c[1]=r[l]),c[2]>o[l]&&(c[2]=o[l]),c[3]<o[l]&&(c[3]=o[l]);return[c[0],c[2],c[1],c[3]]}},{key:"getXUnit",value:function(){var e=this.a,t=this.b;return 0===t?Math.abs(e):0===e?Math.abs(t):Math.sqrt(e*e+t*t)}},{key:"getYUnit",value:function(){var e=this.c,t=this.d;return 0===e?Math.abs(t):0===t?Math.abs(e):Math.sqrt(e*e+t*t)}},{key:"getUnitRect",value:function(){return this.transformRect(0,0,1,1)}},{key:"matchRect",value:function(e,t){var n=t[0]-t[2];this.a=Math.abs(n)<.001?1:(e[0]-e[2])/n,n=t[3]-t[1],this.d=Math.abs(n)<.001?1:(e[3]-e[1])/n,this.e=e[0]-t[0]*this.a,this.f=e[3]-t[3]*this.d,this.b=0,this.c=0}},{key:"getAngle",value:function(){return Math.atan2(this.b,this.a)}},{key:"toArray",value:function(){return[this.a,this.b,this.c,this.d,this.e,this.f]}}],[{key:"Concat2mt",value:function(e,t){return new n(e.a*t.a+e.b*t.c,e.a*t.b+e.b*t.d,e.c*t.a+e.d*t.c,e.c*t.b+e.d*t.d,e.e*t.a+e.f*t.c+t.e,e.e*t.b+e.f*t.d+t.f)}}])}();var sn,cn=function(){function e(n){t(this,e),Ue(this,"values",void 0),Ue(this,"cols",void 0),(0,Ae.assertThat)(Array.isArray(n),"Illegal Matrix values, it should be an array! But actual: "+n),(0,Ae.assertThat)(16===n.length,"Incorrect matrix values size, it must be 16!"),this.values=n,this.cols=Math.sqrt(n.length)}return i(e,[{key:"multiVec4",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return[this.getAt(0,0)*e+this.getAt(0,1)*t+this.getAt(0,2)*n+this.getAt(0,3)*i,this.getAt(1,0)*e+this.getAt(1,1)*t+this.getAt(1,2)*n+this.getAt(1,3)*i,this.getAt(2,0)*e+this.getAt(2,1)*t+this.getAt(2,2)*n+this.getAt(2,3)*i,this.getAt(3,0)*e+this.getAt(3,1)*t+this.getAt(3,2)*n+this.getAt(3,3)*i]}},{key:"getAt",value:function(e,t){var n=e*this.cols+t;return(0,Ae.assertThat)(n<this.values.length,"Cannot access value at (".concat(e,",").concat(t,"), it out bound of this matrix!")),this.values[n]}}]),e}();!function(){function e(n,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t(this,e),Ue(this,"a",void 0),Ue(this,"b",void 0),Ue(this,"c",void 0),Ue(this,"d",void 0),this.a=n,this.b=i,this.c=a,this.d=r}i(e,[{key:"transform",value:function(t){var n=w(t.multiVec4(this.a,this.b,this.c,this.d),4);return new e(n[0],n[1],n[2],n[3])}},{key:"scale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return this.transform(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return new cn([e,0,0,0,0,t,0,0,0,0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,0,0,0,0,1])}(e,t,n))}},{key:"rotateZ",value:function(e){return this.transform(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/180*Math.PI,t=Math.cos(e),n=Math.sin(e);return new cn([t,n,0,0,-n,t,0,0,0,0,1,0,0,0,0,1])}(e))}},{key:"translate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.transform(function(e){return new cn([1,0,0,e,0,1,0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,0,0,1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,0,0,0,1])}(e,t,n))}}])}();function ln(e){return function(){if(!sn){var e=(0,Ae.getDPI)();sn=[e.x,e.y]}return sn}()[e]}function un(e){return e*ln(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)/72}var dn=function(){function e(n){t(this,e),Ue(this,"pdfRect",{left:0,right:0,top:0,bottom:0}),Ue(this,"deviceRect",{left:0,right:0,top:0,bottom:0}),Ue(this,"pdfViewer",void 0),Ue(this,"page",void 0),Ue(this,"pageRender",void 0),Ue(this,"scale",void 0),Ue(this,"rotate",void 0),Ue(this,"intent",void 0),Ue(this,"annotationInfo",this.getDefaultAnnotInfo()),Ue(this,"eContainer",document.createElement("div")),Ue(this,"renderer",void 0),this.eContainer.classList.add("fv__viewer-fake-annot-container"),this.pdfViewer=n.pdfViewer,this.pageRender=n.pageRender,this.intent=n.info.intent,(0,Ae.extendOptions)(this.annotationInfo,n.info,this.getDefaultAnnotConfig()),this.annotationInfo.type=this.getType(),this.page=n.pageRender.page,this.scale=n.pageRender.scale,this.rotate=n.pageRender.rotate,this.pageRender.$annotsContainer.append(this.eContainer)}return i(e,[{key:"setRect",value:function(e){this.deviceRect=e;var t=Math.abs(e.right-e.left),n=Math.abs(e.bottom-e.top),i=un(this.annotationInfo.borderInfo.width)*this.scale*2;if(t<i){var a=.5*(i-t)*(e.right-e.left>0?1:-1);e.right+=a,e.left-=a}if(n<i){var r=.5*(i-n)*(e.bottom-e.top>0?1:-1);e.top-=r,e.bottom+=r}t=Math.abs(e.right-e.left),n=Math.abs(e.bottom-e.top);var o=this.pageRender.rotate;this.pdfRect=this.page.reverseDeviceRect(e,this.scale,o),(0,Ae.cssText)(this.eContainer,{left:e.left+"px",top:e.left+"px",width:t+"px",height:n+"px"})}},{key:"setContent",value:function(e){this.annotationInfo.content=e,this.annotationInfo.contents=e}},{key:"zoomTo",value:function(e){this.scale=e}},{key:"draw",value:function(){this.renderer||(this.renderer=this.generateApRenderer(),this.renderer.prepare(),this.renderer.willRender()),this.renderer.component&&this.renderer.render(this.scale,this.rotate)}},{key:"getContainerElement",value:function(){return this.eContainer}},{key:"getRenderingData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scale,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.rotate,n=this.pdfViewer.getSmartScale(e),i=this.getDeviceRect(e,t),a=this.getOuterDeviceRect(e,t),r=this.getDeviceRect(n,t);return{annotInfo:this.annotationInfo,annotFlag:new an(this.annotationInfo.flags),smartScale:n,rect:a,outerDeviceRect:a,innerDeviceRect:i,engineRenderingRect:r,scale:e,rotate:t,page:this.page}}},{key:"getDeviceRect",value:function(e,t){return this.page.getDeviceRect(this.pdfRect,e,t)}},{key:"getOuterDeviceRect",value:function(e,t){var n=this.annotationInfo.borderInfo;if(n&&5===n.style){var i=this.pageRender.getContainerVisibleRect(),a=i.right-i.left,r=i.bottom-i.top,o=this.page.getDeviceRect(this.pdfRect,e,t),s=(a-(o.right-o.left))/2,c=(r-(o.bottom-o.top))/2;return{left:o.left-s,right:o.right+s,top:o.top-c,bottom:o.bottom+c}}return this.page.getDeviceRect(this.pdfRect,e,t)}},{key:"apply",value:function(){var e,t=this;null===(e=this.renderer)||void 0===e||e.afterRender();var n=this.getCreationJSON();return n.endingStyle&&(n.endStyle=n.endingStyle,delete n.endingStyle),n.rect=this.pdfRect,this.page.addAnnot(n).then((function(e){var n=t.pdfViewer.addEventListener("renderAnnotSuccess",(function(){t.destroy(),n()})),i=e[0];return t.pageRender.annotsRender.activeAnnot(i.getId()),t.pdfViewer.eventEmitter.emit(on.addAnnotSuccess,i),e}))}},{key:"destroy",value:function(){var e;null===(e=this.renderer)||void 0===e||e.destroy(),this.getContainerElement().remove()}},{key:"getCreationJSON",value:function(){return this.annotationInfo}},{key:"getDefaultAnnotInfo",value:function(){return{borderInfo:{width:2,style:_t},color:16711680,opacity:1,flags:4,date:new Date}}},{key:"getDefaultAnnotConfig",value:function(){var e=this.pdfViewer.getDefaultAnnotConfig();return"function"==typeof e?e(this.getType(),this.getIntent()):{}}},{key:"getIntent",value:function(){return this.intent}}]),e}(),hn=function(e){l(o,e);var n=g(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,[{key:"getTileConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scale,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.rotate,n=this.pdfViewer.getSmartScale(e),i=this.pdfViewer.config.tileSize,a=this.page.getDeviceRect(this.pdfRect,1,t),r=this.page.getDeviceRect(this.pdfRect,n,t),o=r.right-r.left,s=r.bottom-r.bottom;return[Math.ceil(s/i),Math.ceil(o/i),o,s,i,n,e,t,a.left,a.top]}},{key:"getRenderingData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scale,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.rotate,n=r(a(o.prototype),"getRenderingData",this).call(this,e,t);return Object.assign(n,{opacity:this.annotationInfo.opacity,tileConfig:this.getTileConfig(e,t)})}}]),o}(dn),fn=function(e){l(a,e);var n=g(a);function a(){return t(this,a),n.apply(this,arguments)}return i(a,[{key:"getType",value:function(){return"square"}},{key:"generateApRenderer",value:function(){return new tn(this)}}]),a}(hn),pn=function(e){l(a,e);var n=g(a);function a(){return t(this,a),n.apply(this,arguments)}return i(a,[{key:"doRender",value:function(e){var t=e.renderingData.annotInfo,n=t.borderInfo||{},i=this.convertPointToPixel(n.width||1,e.scale);if(0!=i||-1!=t.borderColor||t.fillColor){var a=this.canvas.getContext("2d");if(a.clearRect(0,0,this.canvas.width,this.canvas.height),a.save(),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent()){e.lineWidth=i,a.globalAlpha=t.opacity,0===i||!1===t.hasBorderColor?a.strokeStyle="transparent":a.strokeStyle=this.numberToRGBAString(t.color),a.lineWidth=i;try{switch(n.style){case _t:this.renderSolid(a,t,e);break;case Mt:break;case It:this.renderDashed(a,t,e);break;case Vt:0==n.cloudIntensity?this.renderSolid(a,t,e):this.renderCloud(a,t,e)}var r=t.fillColor;r&&(a.fillStyle=this.numberToRGBAString(r),a.fill()),a.stroke(),this.setContents(a,t.contents,e)}finally{a.restore()}}}}},{key:"renderSolid",value:function(e,t,n){this.renderDashed(e,t,n)}},{key:"renderDashed",value:function(e,t,n){var i=t.borderInfo,a=n.lineWidth,r=n.innerRect,o=n.outerRect,s=i.dashes||[],c=i.dashPhase||0,l=.5*a,u=new Bt(.5*(r.left+r.right)-o.left,.5*(r.top+r.bottom)-o.top),d=Math.abs(.5*r.height-l),h=Math.abs(.5*r.width-l);e.lineDashOffset=c,e.setLineDash&&e.setLineDash(s),e.beginPath(),function(e,t,n,i,a){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI,c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];e.ellipse?e.ellipse(t,n,i,a,r,o,s,c):(e.save(),e.translate(t,n),e.rotate(r),e.scale(i,a),e.arc(0,0,1,o,s,c),e.restore())}(e,u.x,u.y,h,d),e.closePath()}},{key:"renderCloud",value:function(e,t,n){var i=t.borderInfo.cloudIntensity,a=.5*n.lineWidth,r=this.shrinkRect(n.innerRect,a),o=this.shrinkRect(n.outerRect,a),s=new Bt(.5*(o.right-o.left)-(r.left-o.left),.5*(o.bottom-o.top)-(r.top-o.top)),c=.5*r.height-a,l=.5*r.width-a,u=16/i,d=Math.PI/u,h=2*Math.PI,f=Array(Math.floor(h/d)-1).fill(0).map((function(e,t){return t*d%h})).map((function(e){var t=l*Math.cos(h-e),n=c*Math.sin(h-e);return s.add(t,n)}));new Kt(f,r,o).generate(1,e).render(e)}},{key:"shrinkRect",value:function(e,t){var n=en.on(e).shrink(t).extract();return Object.assign(n,{width:n.right-n.left,height:n.bottom-n.top})}},{key:"setContents",value:function(e,t,n){if(void 0!==t){var i=n.innerRect,a=n.outerRect,r=.5*(i.left+i.right)-a.left,o=.5*(i.top+i.bottom)-a.top,s=e;s.beginPath(),s.font="14px Verdana",s.textAlign="left",s.textBaseline="top",s.direction="ltr";var c=s.measureText(t).width;s.fillStyle="#AF6B6B",s.fillText(t,r-c/2,o-7,c),s.closePath()}}}]),a}(Pt);function vn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){Ue(e,t,n[t])}))}return e}var gn,mn=o(602),yn=o.n(mn);function wn(){}!function(e){e.MEASUREMENT="measurement",e.COMPARISON="comparison",e.STAMP="stamp",e.SIGN_CERTIFY="sign-certify",e.SIGNATURE="signature"}(gn||(gn={}));var Sn="measurement-info",An={userSpaceUnit:vt,userSpaceScaleValue:1,realUnit:vt,realScaleValue:1,caption:"",markup:!0},bn="measurementInfo",kn=function(e){l(a,e);var n=g(a);function a(){var e;return t(this,a),Ue(p(e=n.apply(this,arguments)),"pdfViewer",void 0),e}return i(a,[{key:"allInjected",value:function(){var e=this;this.pdfViewer.store.dispatch(bn,An),this.getStorage().get(gn.MEASUREMENT,Sn).then((function(t){e.isDestroyed||t&&(e.pdfViewer.getStore().dispatch(bn,vn({},e.convertFromRaw(t))),e.addDestroyHook(e.pdfViewer.store.subscribe(bn,(function(t){if(!e.isDestroyed)return e.updateMeasurementInfo(t)}))))}));var t=this;this.addDestroyHook(this.getStorage().onChange((function(t){t.context.feature===gn.MEASUREMENT&&e.pdfViewer.store.dispatch(bn,e.convertFromRaw(t.newValue))})),this.pdfViewer.addEventListener(on.pageNumberChange,Be((function(){var e,n;return Xe(this,(function(i){switch(i.label){case 0:return t.isDestroyed?[2]:[4,(e=t.getStorage()).get(gn.MEASUREMENT,Sn)];case 1:return n=i.sent(),[4,e.set(gn.MEASUREMENT,Sn,n)];case 2:return i.sent(),[2]}}))}))))}},{key:"updateMeasurementInfo",value:function(e){var t=this;return Be((function(){var n,i,a;return Xe(this,(function(r){switch(r.label){case 0:return[4,t.getMeasurementInfo()];case 1:return n=r.sent(),i=vn({},n,e),a=t.convertToRaw(i),[4,t.getStorage().set(gn.MEASUREMENT,Sn,a)];case 2:return r.sent(),[2]}}))}))()}},{key:"getMeasurementInfo",value:function(){return this.pdfViewer.store.getCurrentValue(bn)}},{key:"onMeasurementInfoChange",value:function(e){return this.pdfViewer.store.subscribe(bn,e)||wn}},{key:"getStorage",value:function(){return this.pdfViewer.getStorage()}},{key:"convertFromRaw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"object"!=typeof e?Object.assign({},An):{userSpaceUnit:e.userSpaceUnit?new dt(e.userSpaceUnit.fromInchRate,e.userSpaceUnit.name):vt,userSpaceScaleValue:null==e.userSpaceScaleValue?1:e.userSpaceScaleValue,realUnit:e.realUnit?new dt(e.realUnit.fromInchRate,e.realUnit.name):vt,realScaleValue:null==e.realScaleValue?1:e.realScaleValue,caption:e.caption||"",markup:!1!==e.markup}}},{key:"convertToRaw",value:function(e){return{userSpaceUnit:e.userSpaceUnit?{fromInchRate:e.userSpaceUnit.fromInchRate,name:e.userSpaceUnit.name}:An.userSpaceUnit,userSpaceScaleValue:e.userSpaceScaleValue||An.userSpaceScaleValue,realUnit:e.realUnit?{fromInchRate:e.realUnit.fromInchRate,name:e.realUnit.name}:An.realUnit,realScaleValue:e.realScaleValue||An.realScaleValue,caption:e.caption||An.caption,markup:void 0===e.markup?An.markup:e.markup}}},{key:"isSame",value:function(e,t){return JSON.stringify(this.convertToRaw(e))===JSON.stringify(this.convertToRaw(t))}}],[{key:"inject",value:function(){return{pdfViewer:yn()}}}]),a}(Ae.Disposable),Rn=function(e){var t=e.getIoC().getInstanceByClass(kn).getMeasurementInfo();return t.markup&&t.caption?t.caption+"\n":""},xn=function(e){return{markup:e.getIoC().getInstanceByClass(kn).getMeasurementInfo().markup}},En=function(e){for(var t=e.length-1;t>=0;t--){e[t].destroy(),e.splice(t,1)}return[]},Tn=function(e,t,n){var i=e.getRenderingData(t,n);!i.annotFlag.checkNoZoom()||(t=1);var a=i.outerDeviceRect,r=i.innerDeviceRect;return Object.assign(r,{width:r.right-r.left,height:r.bottom-r.top}),Object.assign(a,{width:a.right-a.left,height:a.bottom-a.top}),{renderingData:i,innerRect:r,outerRect:a,scale:t,rotate:n}},Cn=function(e,t){var n=e.canvas,i=n.width,a=n.height,r=t.x,o=t.y;r-=4,o-=4,(r=Math.max(r,2))+8>i&&(r=i-8-2),(o=Math.max(o,2))+8>a&&(o=a-8-2),e.rotate(0),e.fillStyle="#ffffff",e.rect(r,o,8,8),e.stroke(),e.fill()},Pn=function(e){l(o,e);var n=g(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,[{key:"getType",value:function(){return"circle"}},{key:"generateApRenderer",value:function(){return new pn(this)}},{key:"apply",value:function(){var e=this;return r(a(o.prototype),"apply",this).call(this).then((function(t){return"CircleDimension"===e.annotationInfo.intent?e.page.getMeasureScaleRatio().then((function(n){if(n&&n.scale){var i=e.pdfViewer.getStore().getCurrentValue("measurementData"),a=Rn(e.pdfViewer),r=Ct(i.displayUnit.name)?e.pdfViewer.i18n.t("measurement.units.".concat(i.displayUnit.name)):i.displayUnit.name;return t[0].setContent(a+parseFloat(i.area).toFixed(2)+" sq "+r).then((function(e){return t}))}return t})):t}))}}]),o}(hn),_n=S.stateHandler,In=S.ViewerEvents,Dn=_n.IStateHandler,Mn=_n.StateHandlerUtils.getDevicePagePoint,Vn=S.shared.keyboardStatus,Ln=S.keyboard,Hn=Ln.BuiltinCommand,Nn=Ln.BuiltinShortcutContext,On=function(e){l(a,e);var n=g(a);function a(e,i){var r;return t(this,a),(r=n.call(this,e)).type=i,r.cursorStyle="fv__cursor-crosshair",r}return i(a,[{key:"pageHandler",value:function(e){var t=this;this.pageRender=e;var n=e.$handler;n.addClass(this.cursorStyle);var i=n.get(0),a=this.hammer=new Hammer.Manager(i);a.add(new Hammer.Pan({direction:Hammer.DIRECTION_ALL}));var r,o=!1,s=this.pdfViewer.getKeyboard(),c=function(){};s.withContext(Nn.CREATING_ANNOTATION,(function(e){e.keyup(Hn.CANCEL_CREATING_ANNOTATION_OPERATION,(function(){t.cancel(),o=!0,c()}),{interceptors:[function(e,t){o||t(e)}]})})),a.on("panstart",(function(e){c=s.activeContext(Nn.CREATING_ANNOTATION),o=!1,r=i.getBoundingClientRect(),t.startPoint=Mn(i,e),t.start({left:t.startPoint.x,top:t.startPoint.y})})),a.on("panmove",(function(e){if(!o){var n=i.getBoundingClientRect(),a=n.left-r.left,s=n.top-r.top,c=t.correctPosition({x:t.startPoint.x+e.deltaX-a,y:t.startPoint.y+e.deltaY-s});return t.currentPoint=c,t.adjust(t.currentFakeAnnot,t.startPoint,c)}})),a.on("panend",(function(e){if(c(),!o){var n=i.getBoundingClientRect(),a=n.left-r.left,s=n.top-r.top,l=t.correctPosition({x:t.startPoint.x+e.deltaX-a,y:t.startPoint.y+e.deltaY-s});t.currentPoint=l,t.end(t.currentFakeAnnot,t.startPoint,l),r=null}})),a.on("pancancel",(function(e){if(c(),!o)return r=null,t.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:t.pageRender.index}),t.end(t.currentFakeAnnot,t.startPoint,t.currentPoint)})),this.removeZoomToSuccessEvent=this.pdfViewer.addEventListener(In.zoomToSuccess,(function(e){!o&&t.currentFakeAnnot&&(t.currentFakeAnnot.zoomTo(e),t.currentFakeAnnot.draw())}))}},{key:"correctPosition",value:function(e){var t=this.pageRender.getShowWidth(),n=this.pageRender.getShowHeight();return{x:Math.max(0,Math.min(t,e.x)),y:Math.max(0,Math.min(n,e.y))}}},{key:"getSubject",value:function(){switch(this.type){case"circle":return this.pdfViewer.i18n.t("viewer_:annotSubjects.Oval");case"square":return this.pdfViewer.i18n.t("viewer_:annotSubjects.Rectangle")}return""}},{key:"start",value:function(e){var t=e.left,n=e.top,i={flags:4,subject:this.getSubject()};switch(this.type){case"circle":this.currentFakeAnnot=new Pn({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:i});break;case"square":this.currentFakeAnnot=new fn({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:i});break;case"square-crop":this.currentFakeAnnot=new fn({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:{flags:4,subject:this.getSubject(),borderInfo:{width:1},color:255}});break;default:throw new Error("Will never happen")}this.currentFakeAnnot.setRect({left:t,top:n,right:t+10,bottom:n-10})}},{key:"adjust",value:function(e,t,n){var i,a,r=t.x,o=t.y,s=n.x,c=n.y,l=Math.abs(r-s),u=Math.abs(o-c);Vn.isShift?(l=u=Math.min(l,u),i=s<r?r-l:r,a=c<o?o-u:o):(i=Math.min(r,s),a=Math.min(o,c)),l=Math.max(l,1),u=Math.max(u,1),e.setRect({left:i,top:a,right:i+l,bottom:a+u}),e.draw()}},{key:"end",value:function(e,t,n){var i=this;this.currentFakeAnnot.apply().then((function(e){if(i.pdfViewer.config.showCommentList){var t=e[0];i.pageRender.annotsRender.getAnnotRender(t.getId()).component.showReplyDialog()}})),this.currentFakeAnnot=null}},{key:"cancel",value:function(){this.currentFakeAnnot&&(this.currentFakeAnnot.destroy(),this.currentFakeAnnot=null),this.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:this.pageRender.index})}},{key:"currentPointDirection",value:function(){var e=this.startPoint.x,t=this.startPoint.y,n=this.currentPoint.x,i=this.currentPoint.y;return n<=e?i<t?"north-west":"south-west":i<t?"north-east":"south-east"}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.offCancelEvent&&this.offCancelEvent(),this.removeZoomToSuccessEvent&&this.removeZoomToSuccessEvent()}},{key:"out",value:function(){this.destroyPageHandler()}}]),a}(Dn),Fn=S.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_SQUARE,jn=function(e){l(a,e);var n=g(a);function a(e){return t(this,a),n.call(this,e,"square")}return i(a,null,[{key:"getStateName",value:function(){return Fn}}]),a}(On),Bn=S.stateHandler.StateHandlerConsts.STATE_HANDLER_CREATE_CIRCLE,Un=function(e){l(a,e);var n=g(a);function a(e){return t(this,a),n.call(this,e,"circle")}return i(a,null,[{key:"getStateName",value:function(){return Bn}}]),a}(On),Xn=S.vendors.EventEmitter,Yn=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this)).pdfViewer=e,i.eventEmitter=new Xn,i.addDestroyHook((function(){i.eventEmitter.removeAllListeners()})),i.isLocked=!1,i.isStarted=!1,i}return i(a,[{key:"init",value:function(){}},{key:"start",value:function(){this.isStarted=!0}},{key:"cancel",value:function(){this.isStarted=!1}},{key:"emit",value:function(e,t){this.isLocked||this.eventEmitter.emit(e,t)}},{key:"on",value:function(e,t){var n=this;return this.eventEmitter.on(e,t),function(){n.eventEmitter.off(e,t)}}},{key:"lock",value:function(){this.isLocked=!0}},{key:"unlock",value:function(){this.isLocked=!1}}]),a}(Ae.Disposable),$n=function(e){l(a,e);var n=g(a);function a(e,i,r){var o;return t(this,a),(o=n.call(this,e)).target=i,o.hammer=new Hammer.Manager(i),o.hammer.add(new Hammer.Pan(r)),o.addDestroyHook((function(){o.hammer.destroy()})),o}return i(a,[{key:"init",value:function(){var e,t,n=this,i=0,a=0,r=function(r){return function(o){if("start"===r){var s=(t=o.target).getBoundingClientRect();e={left:s.left,top:s.top}}n.eventEmitter.emit(r,{deltaX:o.deltaX-i,deltaY:o.deltaY-a,srcEvent:o.srcEvent}),"end"!==r&&"cancel"!==r||(t=null,i=0,a=0)}};this.hammer.on("panstart",r("start")),this.hammer.on("panmove",r("move")),this.hammer.on("panend",r("end")),this.hammer.on("pancancel",r("cancel"));var o=function(n){if(t){var r=t.getBoundingClientRect();i=r.left-e.left,a=r.top-e.top}};window.addEventListener("scroll",o,!0),this.addDestroyHook((function(){window.removeEventListener("scroll",o,!0)}));var s=function(e){var t=n.target.getBoundingClientRect(),i=e.clientX-t.left,a=e.clientY-t.top;n.eventEmitter.emit("mousemove",{x:i,y:a})};this.target.addEventListener("mousemove",s,!0),this.addDestroyHook((function(){n.target.removeEventListener("mousemove",s,!0)}))}}]),a}(Yn);function zn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var Gn,qn=4.396,Wn=function(){function e(n){t(this,e),this.component=n}return i(e,[{key:"numberToRGBAString",value:function(e){if("string"==typeof e)return e;var t=(0,Ae.convertFromNumberToRGBA)(e);return"rgba(".concat(t.r,", ").concat(t.g,", ").concat(t.b,", ").concat(t.a,")")}},{key:"renderLineEnd",value:function(e,t,n,i,a,r){if(0!==i){var o=n.renderingData,s=o.fillColor;"line"===o.annotInfo.type&&(s=o.annotInfo.styleFillColor);var c=n.scale,l=Math.atan2(r.y-a.y,r.x-a.x);switch(e.save(),e.lineJoin="miter",e.beginPath(),i){case Ot.Square:this.renderSquareEnding(e,r,l,c,t);break;case Ot.Circle:this.renderCircleEnding(e,r,l,c,t);break;case Ot.Diamond:this.renderDiamondEnding(e,r,l,c,t);break;case Ot.OpenArrow:r=r.move(t/2,a),this.renderOpenArrowEnding(e,r,l,c,t);break;case Ot.ClosedArrow:r=r.move(t/2,a),this.renderClosedArrowEnding(e,r,l,c,t);break;case Ot.Butt:this.renderButtEnding(e,r,l,c,t);break;case Ot.ROpenArrow:this.renderROpenArrowEnding(e,r,l,c,t);break;case Ot.RClosedArrow:this.renderRClosedArrowEnding(e,r,l,c,t);break;case Ot.Slash:this.renderSlashEnding(e,r,l,c,t)}switch(i){case Ot.ClosedArrow:case Ot.RClosedArrow:case Ot.Diamond:case Ot.Square:case Ot.Circle:s&&(e.fillStyle=this.numberToRGBAString(s),e.fill())}e.stroke(),e.restore()}}},{key:"renderSquareEnding",value:function(e,t,n,i,a){var r=qn*i+3.1*a,o=r/2;e.translate(t.x,t.y),e.rotate(n),e.moveTo(-o,-o),e.rect(-o,-o,r,r)}},{key:"renderCircleEnding",value:function(e,t,n,i,a){var r=1.75862*i+2*a;e.translate(t.x,t.y),e.rotate(n),e.moveTo(r,0),e.arc(0,0,r,0,2*Math.PI)}},{key:"renderDiamondEnding",value:function(e,t,n,i,a){var r=qn*i+3.1*a,o=r/2;e.translate(t.x,t.y),e.rotate(n+Math.PI/4),e.moveTo(-o,-o),e.rect(-o,-o,r,r)}},{key:"renderOpenArrowEnding",value:function(e,t,n,i,a){var r=30/180*Math.PI;this.renderArrow(e,t,n,i,a,r,!1)}},{key:"renderClosedArrowEnding",value:function(e,t,n,i,a){var r=30/180*Math.PI;this.renderArrow(e,t,n,i,a,r,!0)}},{key:"renderButtEnding",value:function(e,t,n,i,a){var r=Math.PI/2,o=qn*i+3.1*a,s=new Bt(t.x+o/2,t.y).rotate(Math.PI-n+r,t),c=s.rotate(Math.PI,t);e.moveTo(s.x,s.y),e.lineTo(c.x,c.y)}},{key:"renderROpenArrowEnding",value:function(e,t,n,i,a){var r=150/180*Math.PI;this.renderArrow(e,t,n,i,a,r,!1)}},{key:"renderRClosedArrowEnding",value:function(e,t,n,i,a){var r=150/180*Math.PI;this.renderArrow(e,t,n,i,a,r,!0)}},{key:"renderArrow",value:function(e,t,n,i,a,r){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=qn*i+3.1*a,c=new Bt(t.x+s,t.y),l=c.rotate(Math.PI-n+r,t),u=c.rotate(Math.PI-n-r,t);e.moveTo(l.x,l.y),e.lineTo(t.x,t.y),e.lineTo(u.x,u.y),o&&e.closePath()}},{key:"renderSlashEnding",value:function(e,t,n,i,a){var r=60/180*Math.PI,o=qn*i+3.1*a,s=new Bt(t.x+o/2,t.y).rotate(Math.PI-n+r,t),c=s.rotate(Math.PI,t);e.moveTo(s.x,s.y),e.lineTo(c.x,c.y)}}]),e}(),Jn=Math.log(2),Kn=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).helper=new Wn(e),i}return i(a,[{key:"doRender",value:function(e){var t=this,n=e.renderingData,i=n.page,a=n.annotInfo,r=a.borderInfo||{},o=e.scale,s=e.rotate,c=this.convertPointToPixel(r.width,o);if(0!=c||-1!=a.borderColor||a.fillColor){var l=this.canvas.getContext("2d");if(l.clearRect(0,0,this.canvas.width,this.canvas.height),l.save(),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent()){e.lineWidth=c,l.globalAlpha=a.opacity,l.lineWidth=c,0===c||!1===a.hasBorderColor?l.strokeStyle="transparent":l.strokeStyle=this.numberToRGBAString(a.color);var u=e.outerRect,d=this.convertToPathPoint(n.startPoint,o,u,i,s),h=this.convertToPathPoint(n.endPoint,o,u,i,s),f=n.leaderLinePoints,p=this.convertToPathPoint(f.start,o,u,i,s),v=this.convertToPathPoint(f.end,o,u,i,s);if(n.leaderLineOffset>0){var g=n.annotInfo.leaderLineLength>0?1:-1,m=this.convertPointToPixel(n.leaderLineOffset,o),y=d.move(m,h).rotate(g*Math.PI/2,d);h=h.move(m,d).rotate(g*-Math.PI/2,h),d=y,y=p.move(m,v).rotate(g*Math.PI/2,p),v=v.move(m,p).rotate(g*-Math.PI/2,v),p=y}var w=n.captionOffset,S=new Bt(this.convertPointToPixel(w.x,o),-this.convertPointToPixel(w.y,o)),A=this.convertPointToPixel(n.leaderLineExtend,o);try{if(r.style===It){var b=r.dashes||[],k=r.dashPhase||0;l.setLineDash&&l.setLineDash(b.map((function(e){return t.convertPointToPixel(e,o)}))),l.lineDashOffset=this.convertPointToPixel(k,o)}l.beginPath(),this.renderLine(l,d,h,p,v,A),l.closePath(),l.stroke(),this.helper.renderLineEnd(l,c,e,n.startStyle,v,p),this.helper.renderLineEnd(l,c,e,n.endingStyle,p,v),this.renderLineCaption(l,e,c,p,v,S)}finally{l.restore()}}}}},{key:"convertToPathPoint",value:function(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=w(i.getDevicePoint([e.x,e.y],t,a),2),o=r[0],s=r[1];return new Bt(o-n.left,s-n.top)}},{key:"renderLine",value:function(e,t,n,i,a,r){if(e.moveTo(i.x,i.y),e.lineTo(a.x,a.y),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y),r>0){var o=i.move(-r,t),s=a.move(-r,n);e.moveTo(i.x,i.y),e.lineTo(o.x,o.y),e.moveTo(a.x,a.y),e.lineTo(s.x,s.y),e.moveTo(s.x,s.y)}}},{key:"renderLineCaption",value:function(e,t,n,i,a,r){var o=t.renderingData,s=t.scale,c=o.annotInfo,l=c.content;if("string"==typeof l&&!((l=l.trim()).length<1)){if(a.x<i.x){var u=i;i=a,a=u}var d,h,f=Math.atan2(a.y-i.y,a.x-i.x),p=i.distanceTo(a),v=i.move(.5*p,a),g=16*(d=s+1,Math.log(d)/Jn),m=16777215-(16777215&c.borderColor^10855845);e.save(),e.fillStyle=this.numberToRGBAString(m),e.font=g+"px bold Arial",e.textBaseline="middle",e.textAlign="center";var y=e.measureText(l),w=y.actualBoundingBoxAscent+y.actualBoundingBoxDescent,S=v.move(r.y,i).rotate(Math.PI/2,v),A=Math.PI/2;switch(A=r.y>0?-Math.PI/2:Math.PI/2,o.captionPos){case Ft:if(0!=r.y&&0!=r.x){h=S.move(r.x,v).rotate(A,S);break}h=S;break;case jt:var b=v.move(.5*(n+w)-r.y,a).rotate(Math.PI/2,v);h=0!=r.x?b.move(r.x,v).rotate(A,S):b}if(o.hasCaption&&(e.translate(h.x,h.y),e.rotate(f),e.fillText(l,0,0),e.restore()),e.beginPath(),!(Math.abs(r.x)<p/2+y.width/2&&Math.abs(r.y)<w)){var k=r.x>0?-1:1,R=r.x+k*y.width/2;if(Math.abs(r.x)<=y.width/2){R=0;var x=w/2+4,E=r.y>0?1:-1,T=0;Math.abs(r.y)>w&&(T=r.y-E*x),S=v.move(T,i).rotate(Math.PI/2,v)}var C=S.move(R,v).rotate(A,S),P=C.move(Math.abs(R)+n/2,S);e.moveTo(v.x,v.y),e.lineTo(S.x,S.y),e.moveTo(P.x,P.y),e.lineTo(C.x,C.y),e.moveTo(C.x,C.y),e.closePath(),e.stroke()}}}},{key:"setMarkUp",value:function(e,t){var n=Tn(this.component,e,t),i=n.renderingData,a=n.outerRect;e=n.scale,t=n.rotate;var r=i.page,o=i.annotInfo,s=o.borderInfo||{},c=this.convertPointToPixel(s.width,e),l=this.canvas.getContext("2d");l.clearRect(0,0,this.canvas.width,this.canvas.height),l.save(),l.lineWidth=c,l.strokeStyle=this.numberToRGBAString(o.color);var u=this.convertToPathPoint(i.startPoint,e,a,r,t),d=this.convertToPathPoint(i.endPoint,e,a,r,t),h=i.leaderLinePoints,f=this.convertToPathPoint(h.start,e,a,r,t),p=this.convertToPathPoint(h.end,e,a,r,t);if(i.leaderLineOffset>0){var v=i.annotInfo.leaderLineLength>0?1:-1,g=this.convertPointToPixel(i.leaderLineOffset,e),m=u.move(g,d).rotate(v*Math.PI/2,u);d=d.move(g,u).rotate(v*-Math.PI/2,d),u=m,m=f.move(g,p).rotate(v*Math.PI/2,f),p=p.move(g,f).rotate(v*-Math.PI/2,p),f=m}var y=this.convertPointToPixel(i.leaderLineExtend,e);l.beginPath(),this.renderLine(l,u,d,f,p,y),l.closePath(),Cn(l,u),Cn(l,d)}}]),a}(Pt),Zn=Ot,Qn=function(e){l(o,e);var n=g(o);function o(e){var i;t(this,o);var a=(i=n.call(this,e)).annotationInfo;switch(i.annotationInfo.endStyle&&(a.endingStyle=i.annotationInfo.endStyle),a.intent){case Lt:a.endingStyle===Zn.None&&(a.endingStyle=Zn.OpenArrow);break;case Ht:a.startStyle===Zn.None&&(a.startStyle=Zn.OpenArrow),a.endingStyle===Zn.None&&(a.endingStyle=Zn.OpenArrow)}return a.hasCaption=a.enableCaption,a.leaderLinePoints.start=a.startPoint,i}return i(o,[{key:"setRect",value:function(e){this.deviceRect=e;var t=Math.abs(e.right-e.left),n=Math.abs(e.bottom-e.top);t=Math.abs(e.right-e.left),n=Math.abs(e.bottom-e.top);var i=this.pageRender.rotate;this.pdfRect=this.page.reverseDeviceRect(e,this.scale,i),this.eContainer.style.cssText+="\n            width: ".concat(t,"px;\n            height: ").concat(n,"px;\n        ")}},{key:"generateApRenderer",value:function(){return new Kn(this)}},{key:"getType",value:function(){return"line"}},{key:"getStartPoint",value:function(){return this.annotationInfo.startPoint}},{key:"getEndPoint",value:function(){return this.annotationInfo.endPoint}},{key:"setEndPoint",value:function(e){var t=w(this.page.reverseDevicePoint([e.x,e.y],this.scale,this.rotate),2),n=t[0],i=t[1];this.annotationInfo.endPoint={x:n,y:i},this.annotationInfo.leaderLinePoints.end=this.annotationInfo.endPoint;var a=this.annotationInfo.startPoint,r=a.x,o=a.y,s=w(this.page.getDevicePoint([r,o],this.scale,this.rotate),2),c=s[0],l=s[1];this.setRect({left:c,top:l,right:e.x,bottom:e.y}),this.annotationInfo.intent==Ht&&this.calculateLeaderLinePoints()}},{key:"calculateLeaderLinePoints",value:function(){var e=this.getStartPoint(),t=this.getEndPoint(),n=t.y-e.y,i=t.x-e.x,a=-1/(n/i),r=Math.atan(a),o=1,s=(this.page.getRotationAngle()+this.rotate)%360;if(t.x<e.x&&t.y<e.y||t.x>e.x&&t.y>e.y)switch(s){case 180:case 270:o=-1;break;default:o=1}else switch(s){case 90:case 180:o=1;break;default:o=-1}var c=this.annotationInfo.leaderLineLength,l=o*Math.cos(r)*c,u=o*Math.sin(r)*c,d={x:e.x+l,y:e.y+u},h=t,f=this.pdfRect;f.left<d.x&&d.x<f.right&&f.bottom<d.y&&d.y<f.top?h={x:t.x+l,y:t.y+u}:(d={x:e.x-l,y:e.y-u},h={x:t.x-l,y:t.y-u}),this.annotationInfo.leaderLinePoints.start=d,this.annotationInfo.leaderLinePoints.end=h}},{key:"getRenderingData",value:function(){return vn({},r(a(o.prototype),"getRenderingData",this).call(this),this.annotationInfo)}},{key:"getOuterDeviceRect",value:function(e,t){var n=this.annotationInfo.leaderLinePoints.start,i=this.annotationInfo.startPoint,a=this.annotationInfo.leaderLineExtend,r=this.annotationInfo.borderInfo.width,o=yt.convertTo(r,Et)*this.scale,s=Math.max(Math.abs(n.x-i.x),Math.abs(n.y-i.y))+a,c=yt.convertTo(s,Et)*this.scale;return en.on(this.getDeviceRect(e,t)).expand(c+o).extract()}},{key:"getDefaultAnnotInfo",value:function(){var e={x:0,y:0},t={x:0,y:0};return zn(vn({},r(a(o.prototype),"getDefaultAnnotInfo",this).call(this)),{startPoint:e,endPoint:t,leaderLineLength:15,leaderLineExtend:5,captionOffset:{x:0,y:0},enableCaption:!1,leaderLinePoints:{start:e,end:t},leaderLineOffset:0,captionPos:Ft,content:"",startStyle:ke,endingStyle:ke})}},{key:"apply",value:function(){var e=this;return r(a(o.prototype),"apply",this).call(this).then((function(t){return"LineDimension"===e.annotationInfo.intent?e.page.getMeasureScaleRatio().then((function(n){if(n&&n.scale){var i=e.pdfViewer.getStore().getCurrentValue("measurementData"),a=Rn(e.pdfViewer),r=Ct(i.displayUnit.name)?e.pdfViewer.i18n.t("measurement.units.".concat(i.displayUnit.name)):i.displayUnit.name;return t[0].setContent(a+parseFloat(i.distance).toFixed(2)+" "+r).then((function(e){return t}))}return t})):t}))}}]),o}(hn);!function(e){e.EndPoint="end-point",e.MidPoint="mid-point",e.IntersectionPoint="intersection-point",e.NearestPoint="nearest-point"}(Gn||(Gn={}));var ei=function(){function e(){t(this,e)}return i(e,[{key:"render",value:function(e){var t=e.canvas,n=t.width;t.height=t.height,e.clearRect(0,0,n,n),e.strokeStyle="red",e.arc(n/2,n/2,2*Math.PI,0,360),e.stroke()}}]),e}(),ti=function(){function e(){t(this,e)}return i(e,[{key:"render",value:function(e){var t=e.canvas,n=t.width;t.height=t.height,e.clearRect(0,0,n,n),e.strokeStyle="red",e.moveTo(n/2,0),e.lineTo(0,n),e.lineTo(n,n),e.closePath(),e.stroke()}}]),e}(),ni=function(){function e(){t(this,e)}return i(e,[{key:"render",value:function(e){var t=e.canvas,n=t.width;t.height=t.height,e.clearRect(0,0,n,n),e.strokeStyle="red",e.rect(0,0,n,n),e.stroke()}}]),e}(),ii=function(){function e(){t(this,e)}return i(e,[{key:"render",value:function(e){var t=e.canvas,n=t.width;t.height=t.height,e.clearRect(0,0,n,n),e.strokeStyle="red",e.moveTo(0,0),e.lineTo(n,n),e.moveTo(0,n),e.lineTo(n,0),e.stroke()}}]),e}(),ai=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),Ue(p(i=n.call(this)),"container",void 0),Ue(p(i),"canvas",void 0),Ue(p(i),"size",void 0),Ue(p(i),"renderer",void 0),i.container=e,i.size=16,i.renderer=new ei,i.canvas=document.createElement("canvas"),i.canvas.classList.add("fv__viewer-snapped-point"),i.addDestroyHook((function(){i.canvas.parentElement===i.container&&i.container.removeChild(i.canvas)})),i.canvas.width=i.size,i.canvas.height=i.size,i}return i(a,[{key:"setRenderer",value:function(e){this.renderer=new e,this.redraw()}},{key:"setSize",value:function(e){this.size=e,this.canvas.width=e,this.canvas.height=e,this.redraw()}},{key:"setPosition",value:function(e,t){(0,Ae.cssText)(this.canvas,{left:e+"px",top:t+"px",margin:"".concat(.5*-this.size,"px ").concat(.5*-this.size,"px")})}},{key:"show",value:function(e){switch(this.container.appendChild(this.canvas),e){case Gn.MidPoint:this.setRenderer(ti);break;case Gn.IntersectionPoint:this.setRenderer(ii);break;case Gn.NearestPoint:this.setRenderer(ni);break;default:this.setRenderer(ei)}}},{key:"hide",value:function(){this.canvas.parentElement===this.container&&this.container.removeChild(this.canvas)}},{key:"redraw",value:function(){if(this.renderer){var e=this.canvas.getContext("2d");e&&this.renderer.render(e)}}}]),a}(Ae.Disposable),ri=S.stateHandler,oi=S.ViewerEvents,si=ri.IStateHandler,ci=S.shared,li=(ci.DebouncePromiseQueue,ci.keyboardStatus),ui=ci.ThrottleAsyncTaskExecutor,di=(S.Consts.LineEndingStyle,ri.StateHandlerConsts.STATE_HANDLER_CREATE_LINE),hi=ri.StateHandlerUtils.getDevicePagePoint,fi=S.commons.isSamePoint,pi=S.keyboard,vi=pi.BuiltinCommand,gi=pi.BuiltinShortcutContext,mi=function(e){l(a,e);var n=g(a);function a(e,i,r){var o;return t(this,a),(o=n.call(this,e)).startStyle=i,o.endStyle=r,o.cursorStyle="fv__cursor-crosshair",o.executor=new ui(20),o}return i(a,[{key:"createInteractionTool",value:function(e,t){return new $n(this.pdfViewer,e,t)}},{key:"pageHandler",value:function(e){var t=this;this.pageRender=e;var n=e.$handler;n.addClass(this.cursorStyle);var i=n.get(0);this.snappedPointAssistant=new ai(i);var a,r=this.interaction=this.createInteractionTool(i,{direction:Hammer.DIRECTION_ALL});r.init();var o,s=function(){return r.on("mousemove",(function(e){t.executor.exec((function(){return t.getSnappedPoint(e).then((function(n){fi(e,n)?(t.snappedPointAssistant.hide(),a=null):(t.snappedPointAssistant.show(n.type),t.snappedPointAssistant.setPosition(n.x,n.y),a=n)}))}))}))};this.offMouseMoveEvent=s();var c,l=!1,u=this.pdfViewer.getKeyboard(),d=function(){};u.withContext(gi.CREATING_ANNOTATION,(function(e){t.offCancelEvent=e.keyup(vi.CANCEL_CREATING_ANNOTATION_OPERATION,(function(){d(),t.cancel(),t.interaction.cancel(),l=!0}),{interceptors:[function(e,t){l||t(e)}]})})),r.on("start",(function(e){var n;t.offMouseMoveEvent(),d=u.activeContext(gi.CREATING_ANNOTATION),l=!1;var r=[0,0],s=hi(i,e);a?(n=[a.x,a.y],r=[s.x-a.x,s.y-a.y]):n=[s.x,s.y],o=t.pageRender.page.reverseDevicePoint(n,t.pageRender.scale,t.pageRender.getRotation()),c=t.pageRender.page.reverseDevicePoint(r,t.pageRender.scale,t.pageRender.getRotation()),t.start(o[0],o[1])})),r.on("move",(function(e){if(!l){var n=w(function(e,t){if(li.isShift){var n=Math.sqrt(e*e+t*t),i=Math.atan2(t,e),a=.25*Math.PI,r=Math.round(i/a)*a;e=n*Math.cos(r),t=n*Math.sin(r)}return[e,t]}(e.deltaX,e.deltaY),2),i=n[0],a=n[1],r=t.pageRender.page.getDevicePoint(o,t.pageRender.scale,t.pageRender.getRotation()),s=t.pageRender.page.getDevicePoint(c,t.pageRender.scale,t.pageRender.getRotation()),u=[r[0]+i+s[0],r[1]+a+s[1]];t.adjust(t.fakeAnnotation,{x:u[0],y:u[1]}),t.pageRender.page.reverseDevicePoint(u,t.pageRender.scale,t.pageRender.getRotation());var d=t.fakeAnnotation.pdfRect,h=t.fakeAnnotation.annotationInfo,f=h.startPoint,p=h.endPoint;t.pdfViewer.eventEmitter.emit("collab-creating-op",{type:t.type,page:t.pageRender.page.getIndex(),rect:d,points:[f,p]})}})),r.on("end",(function(e){if(!l)return d(),t.offMouseMoveEvent=s(),t.end()})),r.on("cancel",(function(e){l||(t.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:t.pageRender.index}),d(),t.cancel(),t.offMouseMoveEvent=s())})),this.__removeZoomToSuccessEventListener=this.pdfViewer.addEventListener(oi.zoomToSuccess,(function(){if(!l&&t.fakeAnnotation){var e=t.pageRender.scale;t.fakeAnnotation.zoomTo(e),t.fakeAnnotation.draw()}}))}},{key:"correctCoord",value:function(e,t){var n=this.pageRender.getScale(),i=e.getPxWidth()*n,a=e.getPxHeight()*n;return[Math.max(0,Math.min(i,t[0])),Math.max(0,Math.min(a,t[1]))]}},{key:"start",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Line",a=!0,r="";if(n=this.pdfViewer.customs.getMeasuringConfig){var o=n();o.hasOwnProperty("defaultLeader")&&(a=o.defaultLeader),"custom"==o.labelType&&(r=o.label)}var s=this.pdfViewer.getIoC().getInstanceByClass(kn).getMeasurementInfo();return s.showCustomLabel&&(r=s.caption),this.fakeAnnotation=new Qn({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:this.createAnnotJson({flags:4,label:r,startPoint:{x:e,y:t},endPoint:{x:e+1,y:t+1},startStyle:this.startStyle,endingStyle:this.endStyle,leaderLineLength:a?15:0,leaderLineExtend:a?5:0,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects."+i)})})}},{key:"createAnnotJson",value:function(e){return Object.assign(e,this.pdfViewer.getDefaultAnnotConfig()("line")),e}},{key:"getSnappedPoint",value:function(e){var t=this;return this.pageRender.getPDFPage().then((function(n){if(!n)return e;var i=t.pdfViewer.getSnapMode(t.constructor.getStateName());if(i&&i.length>0){var a=w(n.reverseDevicePoint([e.x,e.y],t.pageRender.scale,t.pageRender.rotate),2),r=a[0],o=a[1];return n.getSnappedPoint({x:r,y:o},i).then((function(e){var i=w(n.getDevicePoint([e.x,e.y],t.pageRender.scale,t.pageRender.rotate),2);return{x:i[0],y:i[1],type:e.type}}))}return e}))}},{key:"adjust",value:function(e,t){var n=this;this.executor.exec((function(){return n.getSnappedPoint(t).then((function(i){fi(t,i)?n.snappedPointAssistant.hide():(n.snappedPointAssistant.setPosition(i.x,i.y),n.snappedPointAssistant.show(i.type)),e.setEndPoint(i),e.draw()}))}))}},{key:"end",value:function(){var e=this;this.fakeAnnotation&&this.executor.waitForLastTask().then((function(){e.snappedPointAssistant.hide();var t=e.fakeAnnotation.apply().then((function(t){if(e.pdfViewer.config.showCommentList){var n=t[t.length-2];e.pageRender.annotsRender.getAnnotRender(n.getId()).component.showReplyDialog()}}));return e.fakeAnnotation=null,t}))}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit("collab-creating-op",{cancle:1,page:this.pageRender.index}),this.snappedPointAssistant.hide(),this.executor.cancel(),this.pdfViewer.eventEmitter.emit(oi.cancelAddAnnot),this.fakeAnnotation.destroy(),this.fakeAnnotation=null)}},{key:"destroyPageHandler",value:function(){this.offMouseMoveEvent(),this.snappedPointAssistant.destroy(),this.executor.cancel(),this.interaction&&this.interaction.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.offCancelEvent&&this.offCancelEvent(),this.__removeZoomToSuccessEventListener&&this.__removeZoomToSuccessEventListener()}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return di}}]),a}(si),yi=S.stateHandler,wi=(S.ViewerEvents,yi.StateHandlerConsts.STATE_HANDLER_CREATE_ARROW),Si=S.Consts.LineEndingStyle,Ai=function(e){l(a,e);var n=g(a);function a(e){return t(this,a),n.call(this,e,Si.None,Si.OpenArrow)}return i(a,[{key:"createAnnotJson",value:function(e){return e.intent="LineArrow",e.subject=this.pdfViewer.i18n.t("viewer_:annotSubjects.Arrow"),Object.assign(e,this.pdfViewer.getDefaultAnnotConfig()("line","LineArrow")),e}}],[{key:"getStateName",value:function(){return wi}}]),a}(mi);function bi(e){if("clientX"in e)return e.clientX;switch(e.type){case"touchstart":case"touchmove":return e.touches[0].clientX;case"touchend":case"touchcancel":return e.changedTouches[0].clientX}}function ki(e){if("clientY"in e)return e.clientY;switch(e.type){case"touchstart":case"touchmove":return e.touches[0].clientY;case"touchend":case"touchcancel":return e.changedTouches[0].clientY}}const Ri="idle",xi="construct",Ei="creating";var Ti,Ci;!function(e){e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e[e.MOVE=2]="MOVE"}(Ti||(Ti={}));var Pi,_i,Ii,Di,Mi=(Ue(Ci={},0,["MSPointerDown"]),Ue(Ci,2,["MSPointerMove"]),Ue(Ci,1,["MSPointerUp"]),Ci),Vi=(Ue(Pi={},0,["pointerdown"]),Ue(Pi,2,["pointermove"]),Ue(Pi,1,["pointerup"]),Pi),Li=(Ue(_i={},0,["pointerdown","mousedown"]),Ue(_i,2,["pointermove","mousemove"]),Ue(_i,1,["pointerup","mouseup"]),_i),Hi=(Ue(Ii={},0,["pointerdown","touchstart"]),Ue(Ii,2,["pointermove","touchmove"]),Ue(Ii,1,["pointerup","touchend"]),Ii),Ni=(Ue(Di={},0,["mousedown","touchstart"]),Ue(Di,2,["mousemove","touchmove"]),Ue(Di,1,["mouseup","touchend"]),Di),Oi={};function Fi(t,n,i,a){var r,o=0,s=Oi[n].map((function(n){var c,l=function(n){r!==n.type&&Date.now()-o<160?c():(r=n.type,a&&a.once&&c(),i.call(t,function(t){var n={native:t,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,target:t.target,preventDefault:function(){return t.preventDefault()},stopPropagation:function(){return t.stopPropagation()}};if(window.TouchEvent&&e(t,window.TouchEvent)){var i="touchend"===t.type||"touchcancel"===t.type?t.changedTouches[0]:t.touches[0];n.clientX=i.clientX,n.clientY=i.clientY,n.pageX=i.pageX,n.pageY=i.pageY,n.screenX=i.screenX,n.screenY=i.screenY,n.x=i.clientX,n.y=i.clientY,n.bubbles=t.bubbles,n.relatedTarget=i.target}else(e(t,MouseEvent)||e(t,PointerEvent))&&(n.clientX=t.clientX,n.clientY=t.clientY,n.pageX=t.pageX,n.pageY=t.pageY,n.screenX=t.screenX,n.screenY=t.screenY,n.x=t.x||t.clientX,n.y=t.y||t.clientY,n.relatedTarget=t.relatedTarget,n.button=t.button,n.buttons=t.buttons,n.bubbles=t.bubbles);return n}(n)),o=Date.now())};return c=function(){var e=s.indexOf(c);-1!==e&&(t.removeEventListener(n,l,a),s.splice(e,1))},t.addEventListener(n,l,a),c}));return function(){s.forEach((function(e){return e()}))}}function ji(e){if(Ae.isIE){if(!Ae.isIEAtLeast11)return Mi[e]}else{if(Ae.isSafari)return Li[e];if(Ae.isAndroid)return Ae.isTouchDevice?Hi[e]:Ni[e]}return Vi[e]}Ae.Lazy.property(Oi,0,(function(){return ji(0)})),Ae.Lazy.property(Oi,2,(function(){return ji(2)})),Ae.Lazy.property(Oi,1,(function(){return ji(1)}));var Bi=function(e){l(a,e);var n=g(a);function a(e,i,r){var o;return t(this,a),(o=n.call(this,e)).actionName=r,o.targetElement=i,o.status=Ri,o.lastMoveData={},o}return i(a,[{key:"startCreating",value:function(){this.status=Ei}},{key:"cancel",value:function(){this.status=Ri}},{key:"_addEventListener",value:function(e,t,n,i){return e.addEventListener(t,n,i),function(){e.removeEventListener(t,n,i)}}},{key:"init",value:function(){var e=this,t=new Hammer.Manager(this.targetElement);t.add(new Hammer.Tap({event:"doubletap",taps:2,posThreshold:100,time:296}),new Hammer.Pan({direction:Hammer.DIRECTION_ALL}));var n=!0,i=null,a=wn,r=Fi(this.targetElement,Ti.DOWN,(function(t){if(0===t.button){var r=t.clientX,o=t.clientY;if(i={x:t.clientX,y:t.clientY},e.status===Ri){a();var s=setTimeout((function(){e.status=xi,e.emit("start",{clientX:r,clientY:o,srcEvent:t.native})}),300);a=function(){clearTimeout(s)}}else if(e.status===Ei){a(),n=!1;var c=setTimeout((function(){e.emit("add-point",{clientX:r,clientY:o,srcEvent:t.native}),n=!0}),300);a=function(){clearTimeout(c)}}}})),o=wn;Ae.isTouchDevice&&(o=this._addEventListener(this.targetElement,"touchstart",(function(e){e.touches.length>1&&a(),Ae.isIOSChrome&&e.preventDefault()})));var s=Fi(this.targetElement,Ti.MOVE,(function(t){if(Ae.isTouchDevice&&i&&(Math.abs(t.clientX-i.x)>25||Math.abs(t.clientY-i.y)>25)&&a(),!e.isLocked&&n){if(e.status===Ri){var r=e.targetElement.getBoundingClientRect(),o=t.clientX-r.left,s=t.clientY-r.top;e.emit("mousemove",{x:o,y:s})}if(e.status===Ei&&!Ae.isTouchDevice){var c=t.clientX,l=t.clientY;e.emit("move",e.lastMoveData={clientX:c,clientY:l,srcEvent:t.native})}}}));t.on("doubletap",(function(t){n=!0;var i=t.srcEvent;a(),e.lastMoveData={clientX:bi(i),clientY:ki(i),srcEvent:t},c()}));var c=function(){e.status===Ei&&(e.status=Ri,e.unlock(),e.emit("end",e.lastMoveData),e.lastMoveData=null)},l=this.pdfViewer.getStore().subscribe(this.actionName,(function(t){switch(t){case"complete":c();break;case"cancel":e.status===Ei&&(e.status=Ri,e.unlock(),e.emit("cancel"));break;case"continue":e.startCreating()}}));this.addDestroyHook((function(){o(),t.destroy(),l(),r(),s()}))}}]),a}(Yn),Ui=function(){function e(){t(this,e),Ue(this,"isCreating",!1),Ue(this,"handlingPage",-1)}return i(e,[{key:"setCreating",value:function(e){this.isCreating=!0,this.handlingPage=e}},{key:"creatingEnd",value:function(){this.isCreating=!1,this.handlingPage=-1}}]),e}(),Xi=S.stateHandler,Yi=S.Log,$i=S.ViewerEvents,zi=Xi.IStateHandler,Gi=Yi.LoggerFactory,qi=S.shared,Wi=qi.DebouncePromiseQueue,Ji=(qi.getClientX,qi.getClientY,qi.keyboardStatus),Ki=qi.ThrottleAsyncTaskExecutor,Zi=S.DeviceInfo.isTouchDevice,Qi=S.commons.isSamePoint,ea=S.keyboard,ta=ea.BuiltinCommand,na=ea.BuiltinShortcutContext,ia=(Gi.getLogger("creation/complexshape/state"),function(e){l(a,e);var n=g(a);function a(e,i){var r;return t(this,a),(r=n.call(this,e)).type=i,r.cursorStyle="fv__cursor-crosshair",r.executor=new Ki(20,!0),r}return i(a,[{key:"createInteractionTool",value:function(e){return new Bi(this.pdfViewer,e,"create-complex-shape")}},{key:"syncAddingAnnot",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t)e={cancle:t,page:this.pageRender.index};else{var n=this.fakeAnnotation||{},i=n.pdfRect,a=n.vertexes,r=n.lastPoint;e={type:this.type,page:this.pageRender.page.getIndex(),rect:i,points:f(a).concat([r]),closePath:"polygon"==this.type}}this.pdfViewer.eventEmitter.emit("collab-creating-op",e)}},{key:"pageHandler",value:function(e){var t=this;this.pageRender=e,this.destroyPageHooks=[];var n=e.$handler;n.addClass(this.cursorStyle);var i=n.get(0);this.snappedPointAssistant=new ai(i),this.interaction=this.createInteractionTool(i),this.interaction.init();var a=new Wi,r=this.pdfViewer.getKeyboard(),o=this.pdfViewer.getIoC().getInstanceByClass(Ui),s=function(){},c=function(){s=r.activeContext(na.CREATING_ANNOTATION)};function l(e,t,n){if(Ji.isShift){var i=e.getDeviceVertexes();if(i.length>=1){var a=i[i.length-1],r=t-a.x,o=n-a.y,s=Math.sqrt(r*r+o*o),c=Math.atan2(o,r),l=.25*Math.PI,u=Math.round(c/l)*l;return r=s*Math.cos(u),o=s*Math.sin(u),{deviceX:a.x+r,deviceY:a.y+o}}}return{deviceX:t,deviceY:n}}r.withContext(na.CREATING_ANNOTATION,(function(e){e.keyup(ta.CANCEL_CREATING_ANNOTATION_OPERATION,(function(){s(),t.interaction.unlock(),t.interaction.cancel(),t.cancel()}))})),"polygon"==this.type||"polyline"==this.type||this.pdfViewer.eventEmitter.addListener($i.toolbarTabsClicked,(function(){t.out()})),this.interaction.on("start",(function(e){var n=e.clientX,a=e.clientY;if(o.isCreating)t.interaction.cancel();else{o.setCreating(t.pageRender.index),t.pageRender.annotsRender.unActiveAnnot();var r=i.getBoundingClientRect(),l=n-r.left,u=a-r.top;s(),c(),t.getSnappedPoint(l,u).then((function(e){t.fakeAnnotation=t.create(e.deviceX,e.deviceY),t.interaction.startCreating()}))}})),this.interaction.on("add-point",(function(e){var n=e.clientX,a=e.clientY,r=i.getBoundingClientRect(),o=n-r.left,s=a-r.top,c=l(t.fakeAnnotation,o,s);t.getSnappedPoint(c.deviceX,c.deviceY).then((function(e){t.addPoint(t.fakeAnnotation,e)}))})),this.interaction.on("move",(function(e){var n=e.clientX,a=e.clientY,r=i.getBoundingClientRect(),o=n-r.left,s=a-r.top;t.executor.exec((function(){var e=l(t.fakeAnnotation,o,s);return t.getSnappedPoint(e.deviceX,e.deviceY).then((function(n){Qi({x:e.deviceX,y:e.deviceY},{x:n.deviceX,y:n.deviceY})?t.snappedPointAssistant.hide():(t.snappedPointAssistant.show(n.type),t.snappedPointAssistant.setPosition(n.deviceX,n.deviceY)),t.adjust(t.fakeAnnotation,n),t.syncAddingAnnot()}))}))})),this.interaction.on("mousemove",(function(e){t.mousemove(e)})),this.interaction.on("end",(function(e){if(t.canBeCompleted(t.fakeAnnotation)){o.creatingEnd(),s();var n=i.getBoundingClientRect(),a=l(t.fakeAnnotation,e.clientX-n.left,e.clientY-n.top);t.executor.waitForLastTask().finally((function(){t.getSnappedPoint(a.deviceX,a.deviceY).then((function(e){-1==t.end(t.fakeAnnotation,e)&&(c(),t.interaction.startCreating())}))}))}else t.interaction.startCreating()})),this.interaction.on("cancel",(function(){o.creatingEnd(),s(),t.cancel(),t.syncAddingAnnot(!0)}));var u=function(e){t.fakeAnnotation&&(t.fakeAnnotation.zoomTo(e),t.fakeAnnotation.draw())};this.destroyPageHooks.push((function(){return a.end()}),this.pdfViewer.addEventListener($i.zoomToSuccess,(function(){u(t.pageRender.scale)})),this.pdfViewer.addEventListener($i.changeViewModeSuccess,(function(e,n){u(t.pageRender.scale)})),this.pdfViewer.addEventListener($i.fitWidthResizeViewport,(function(){u(t.pageRender.scale)})))}},{key:"getSnappedPoint",value:function(e,t){var n=this;return this.pageRender.getPDFPage().then((function(i){var a=n.pdfViewer.getSnapMode(n.constructor.getStateName());if(a&&a.length>0){var r=w(i.reverseDevicePoint([e,t],n.pageRender.scale,n.pageRender.rotate),2),o=r[0],s=r[1];return i.getSnappedPoint({x:o,y:s},a).then((function(e){var t=w(i.getDevicePoint([e.x,e.y],n.pageRender.scale,n.pageRender.rotate),2);return{deviceX:t[0],deviceY:t[1],type:e.type}}))}return{deviceX:e,deviceY:t}}))}},{key:"create",value:function(e,t){throw new Error("not implemented!")}},{key:"addPoint",value:function(e,t){var n=t.deviceX,i=t.deviceY;e.addPoint(n,i),e.draw()}},{key:"mousemove",value:function(e){var t=this;this.executor.exec((function(){return t.getSnappedPoint(e.x,e.y).then((function(n){var i=n.deviceX,a=n.deviceY,r=n.type;Qi(e,{x:i,y:a})?t.snappedPointAssistant.hide():(t.snappedPointAssistant.setPosition(i,a),t.snappedPointAssistant.show(r))}))}))}},{key:"adjust",value:function(e,t){var n=t.deviceX,i=t.deviceY;e.setLastPoint(n,i),e.draw()}},{key:"end",value:function(e,t){var n=this;this.creatingState=0,t&&!Zi&&(e.addPoint(t.deviceX,t.deviceY),e.draw()),e.apply().then((function(e){if(n.pdfViewer.config.showCommentList){var t=e[e.length-2];n.pageRender.annotsRender.getAnnotRender(t.getId()).component.showReplyDialog()}})),this.fakeAnnotation=null}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.getIoC().getInstanceByClass(Ui).creatingEnd(),this.syncAddingAnnot(!0),this.executor.cancel(),this.interaction.cancel(),this.fakeAnnotation.destroy(),this.fakeAnnotation=null)}},{key:"canBeCompleted",value:function(){return!0}},{key:"createAnnotJson",value:function(e,t){return e}},{key:"docHandler",value:function(e){Zi?e.enableDragToScroll():e.disableDragToScroll()}},{key:"destroyPageHandler",value:function(){(this.snappedPointAssistant.destroy(),this.destroyPageHooks&&this.destroyPageHooks.forEach((function(e){return e()})),this.pageRender.$handler.removeClass(this.cursorStyle),this.fakeAnnotation)&&(this.interaction.status!==Ri&&this.pdfViewer.eventEmitter.emit($i.cancelAddAnnot),this.fakeAnnotation.destroy(),this.fakeAnnotation=null,this.pdfViewer.getIoC().getInstanceByClass(Ui).creatingEnd());this.interaction.destroy(),this.offCancelEvent&&this.offCancelEvent()}},{key:"out",value:function(){this.destroyPageHandler()}}]),a}(zi));function aa(e){return m(e)||d(e)||h(e)||y()}var ra=function(e){l(a,e);var n=g(a);function a(e){var i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t(this,a),(i=n.call(this)).closing=r,e.length>1&&e.reduce((function(e,t,n){return i.addSegment(new oa(e,t,1===n)),t})),i}return i(a,[{key:"render",value:function(e){e.beginPath(),this.segments.forEach((function(t){t.render(e)})),this.closing&&e.closePath()}}]),a}(Ut),oa=function(e){l(a,e);var n=g(a);function a(e,i){var r,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t(this,a),(r=n.call(this,e,i)).atTheStart=o,r}return i(a,[{key:"render",value:function(e){this.atTheStart&&e.moveTo(this.from.x,this.from.y),e.lineTo(this.to.x,this.to.y)}}]),a}(Xt);function sa(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;e.fillStyle="#fff",t.forEach((function(t){e.beginPath(),e.arc(t.x,t.y,n,0,360),e.stroke(),e.fill()}))}var ca,la,ua=function(e){l(o,e);var n=g(o);function o(e){var i;return t(this,o),(i=n.call(this,e)).helper=new Wn(e),i}return i(o,[{key:"doPrepare",value:function(){r(a(o.prototype),"doPrepare",this).call(this),this.canvas.classList.add("fv__viewer-render-polyline")}},{key:"doRender",value:function(e){var t=e.renderingData,n=t.annotInfo,i=n.borderInfo||{},a=e.scale,r=e.rotate,o=this.canvas.getContext("2d"),s=this.convertPointToPixel(0==i.width?.5:i.width,a);if((0!=s||-1!=n.borderColor||n.fillColor)&&(o.clearRect(0,0,this.canvas.width,this.canvas.height),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent())){var c=t.page,l=e.innerRect,u=t.vertexes.map((function(e){var t=w(c.getDevicePoint([e.x,e.y],a,r),2),n=t[0],i=t[1];return new Bt(n-l.left,i-l.top)}));e.vertexes=u,o.save(),e.lineWidth=s,o.globalAlpha=n.opacity,o.lineWidth=s,0===s||!1===n.hasBorderColor?o.strokeStyle="transparent":o.strokeStyle=this.numberToRGBAString(n.color);try{switch(i.style){case It:case _t:this.renderSolid(o,n,e)}var d=u[u.length-1],h=u[u.length-2],f=u[0],p=u[1];this.helper.renderLineEnd(o,s,e,t.startStyle,p,f),this.helper.renderLineEnd(o,s,e,t.endingStyle,h,d),this.setContents(o,n.contents,u)}finally{o.restore()}}}},{key:"renderSolid",value:function(e,t,n){var i=this,a=n.scale,r=t.borderInfo,o=r.dashes||[],s=r.dashPhase||0;r.style===It&&(e.setLineDash&&e.setLineDash(o.map((function(e){return i.convertPointToPixel(e,a)}))),e.lineDashOffset=this.convertPointToPixel(s,a)),new ra(n.vertexes,!1,5).render(e),e.stroke();try{if(!Ae.isTouchDevice)return;void 0===n.renderingData.annotInfo.id&&sa(e,n.vertexes)}catch(e){}}},{key:"setMarkUp",value:function(e,t){var n=Tn(this.component,e,t),i=n.renderingData,a=n.innerRect;e=n.scale,t=n.rotate;var r=i.annotInfo,o=this.canvas.getContext("2d"),s=i.page;o.strokeStyle=this.numberToRGBAString(r.color),i.vertexes.map((function(n){var i=w(s.getDevicePoint([n.x,n.y],e,t),2),r=i[0],o=i[1];return new Bt(r-a.left,o-a.top)})).forEach((function(e){return Cn(o,e)})),o.restore()}},{key:"setContents",value:function(e,t,n){var i,a;if(void 0!==t&&n&&!(n.length<3)){var r=n[n.length-1],o=e;o.beginPath(),o.font="14px Verdana",o.textAlign="left",o.textBaseline="top",o.direction="ltr";var s=o.measureText(t).width;o.fillStyle="#AF6B6B";var c=n.map((function(e){return e.x})),l=(i=Math).min.apply(i,f(c));(a=Math).max.apply(a,f(c));Math.abs(r.x-l)>=s&&r.x>l?o.fillText(t,r.x-s,r.y,s):o.fillText(t,r.x,r.y,s),o.closePath()}}}]),o}(Pt),da=function(e){l(o,e);var n=g(o);function o(e){var i,a;(t(this,o),Ue(p(i=n.call(this,e)),"vertexes",[]),Ue(p(i),"deviceVertexes",[]),Ue(p(i),"lastPoint",{x:0,y:0}),i.annotationInfo.vertexes)&&(a=i.vertexes).push.apply(a,f(i.annotationInfo.vertexes));return i.annotationInfo.vertexes=i.vertexes,i}return i(o,[{key:"getVertexes",value:function(){return this.vertexes}},{key:"getDeviceVertexes",value:function(){return this.deviceVertexes}},{key:"addPoint",value:function(e,t){var n=w(this.page.reverseDevicePoint([e,t],this.scale,this.rotate),2),i=n[0],a=n[1];this.vertexes.push({x:i,y:a}),this.lastPoint={x:i,y:a},this.deviceVertexes.push({x:e,y:t}),this.updateRect()}},{key:"setLastPoint",value:function(e,t){var n=this.deviceVertexes[this.deviceVertexes.length-1],i="number"==typeof e?e:n.x,a="number"==typeof t?t:n.y,r=w(this.page.reverseDevicePoint([i,a],this.scale,this.rotate),2),o=r[0],s=r[1];this.lastPoint={x:o,y:s},this.updateRect()}},{key:"getLastPoint",value:function(){return this.lastPoint}},{key:"zoomTo",value:function(e){var t=this;this.scale!==e&&(r(a(o.prototype),"zoomTo",this).call(this,e),this.deviceVertexes=this.vertexes.map((function(n){var i=w(t.page.getDevicePoint([n.x,n.y],e,t.rotate),2);return{x:i[0],y:i[1]}})),this.updateRect())}},{key:"removeLastPoint",value:function(){}},{key:"getRenderingData",value:function(e,t){var n=r(a(o.prototype),"getRenderingData",this).call(this,e,t),i=aa(this.vertexes).slice(0);return i.push(this.lastPoint),zn(vn({},n),{vertexes:i})}},{key:"generateApRenderer",value:function(){return new ua(this)}},{key:"getType",value:function(){return"polyline"}},{key:"getOuterDeviceRect",value:function(e,t){return r(a(o.prototype),"getDeviceRect",this).call(this,e,t)}},{key:"updateRect",value:function(){if(0!==this.deviceVertexes.length){var e=w(this.page.getDevicePoint([this.lastPoint.x,this.lastPoint.y],this.scale,this.rotate),2),t={x:e[0],y:e[1]},n=t.x,i=t.y,a=t.x,r=t.y;this.deviceVertexes.forEach((function(e){n=Math.min(n,e.x),a=Math.max(a,e.x),i=Math.min(i,e.y),r=Math.max(r,e.y)}));var o=un(this.annotationInfo.borderInfo.width)*this.scale*2+20;n-=o/2,i-=o/2,a+=o/2,r+=o/2,this.setRect({left:n,top:i,right:a,bottom:r})}}},{key:"apply",value:function(){var e=this;return r(a(o.prototype),"apply",this).call(this).then((function(t){var n=e.annotationInfo.intent;return"PolygonDimension"===n||"PolyLineDimension"===n?e.page.getMeasureScaleRatio().then((function(i){if(i&&i.scale){var a=e.pdfViewer.getStore().getCurrentValue("measurementData"),r=Rn(e.pdfViewer),o=Ct(a.displayUnit.name)?e.pdfViewer.i18n.t("measurement.units.".concat(a.displayUnit.name)):a.displayUnit.name;return t[0].setContent(r+parseFloat("PolyLineDimension"===n?a.perimeter:a.area).toFixed(2)+" "+o).then((function(e){return t}))}return t})):t}))}}]),o}(hn),ha=function(e){l(o,e);var n=g(o);function o(e){var i,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t(this,o),(i=n.call(this,e)).closing=a,i.showText=!0,i}return i(o,[{key:"setFlag",value:function(e,t){this.closing=e,this.showText=t}},{key:"doPrepare",value:function(){r(a(o.prototype),"doPrepare",this).call(this),this.canvas.classList.add("fv__viewer-render-polygon")}},{key:"doRender",value:function(e){var t=e.renderingData,n=t.annotInfo,i=n.borderInfo||{},a=e.scale,r=e.rotate,o=this.convertPointToPixel(0==i.width?.5:i.width,a);if(0!=o||-1!=n.borderColor||n.fillColor){var s=this.canvas.getContext("2d");if(s.clearRect(0,0,this.canvas.width,this.canvas.height),!this.component.needToggleView||!this.component.needToggleView()||this.component.shouldRenderByMouseEvent()){var c=t.page,l=e.innerRect,u=e.outerRect,d=t.vertexes.map((function(e){var t=w(c.getDevicePoint([e.x,e.y],a,r),2),n=t[0],i=t[1];return new Bt(n-l.left,i-l.top)})),h=t.vertexes.map((function(e){var t=w(c.getDevicePoint([e.x,e.y],a,r),2),n=t[0],i=t[1];return new Bt(n-u.left,i-u.top)}));e.vertexes=d,s.save(),e.lineWidth=o,s.globalAlpha=n.opacity,0===o||!1===n.hasBorderColor?s.strokeStyle="transparent":s.strokeStyle=this.numberToRGBAString(n.color),s.lineWidth=o;try{switch(i.style){case It:case _t:case Dt:case Mt:this.renderSolid(s,n,e),this.setContents(s,n.contents,d);break;case Vt:0==o?this.renderSolid(s,n,e):this.renderCloud(s,n,e),this.setContents(s,n.contents,h)}}finally{s.restore()}}}}},{key:"renderCloud",value:function(e,t,n){var i=t.fillColor,a=t.borderInfo.cloudIntensity,r=n.innerRect,o=n.outerRect,s=new Kt(n.vertexes,r,o),c=n.renderingData.vertexes,l=c.length;(l=l*=2==a?8:16,c.length>=2)&&(l=function(e,t){var n=2,i=Math.abs(e.right-e.left),a=Math.abs(e.bottom-e.top);n=1===t?parseInt((i+a)/4):parseInt((i+a)/6);return n<2&&(n=2),n%2!=0&&(n+=1),n}(this.calculateRect(c),a));s.generate(16/a,e,l).render(e),i&&(e.fillStyle=this.numberToRGBAString(i),e.fill()),e.stroke();try{if(!Ae.isTouchDevice)return;var u=r.left-o.left,d=r.top-o.top,h=n.vertexes.map((function(e){return{x:e.x+u,y:e.y+d}}));void 0===n.renderingData.annotInfo.id&&sa(e,h)}catch(e){}}},{key:"renderSolid",value:function(e,t,n){var i=this,a=n.scale,r=t.borderInfo,o=r.dashes||[],s=r.dashPhase||0,c=t.fillColor;r.style===It&&(e.setLineDash&&e.setLineDash(o.map((function(e){return i.convertPointToPixel(e,a)}))),e.lineDashOffset=this.convertPointToPixel(s,a)),new ra(n.vertexes,this.closing).render(e),c&&(e.fillStyle=this.numberToRGBAString(c),e.fill()),e.stroke();try{if(!Ae.isTouchDevice)return;void 0===n.renderingData.annotInfo.id&&sa(e,n.vertexes)}catch(e){}}},{key:"setMarkUp",value:function(e,t){var n=Tn(this.component,e,t),i=n.renderingData,a=n.innerRect;e=n.scale,t=n.rotate;var r=i.annotInfo,o=r.borderInfo||{},s=this.convertPointToPixel(o.width,e),c=this.canvas.getContext("2d");c.clearRect(0,0,this.canvas.width,this.canvas.height);var l=i.page,u=i.vertexes.map((function(n){var i=w(l.getDevicePoint([n.x,n.y],e,t),2),r=i[0],o=i[1];return new Bt(r-a.left,o-a.top)}));c.save(),c.strokeStyle=this.numberToRGBAString(r.color),c.lineWidth=s;var d=this.closing;this.closing=!0,this.renderSolid(c,r,{vertexes:u}),c.beginPath(),u.forEach((function(e){return Cn(c,e)})),this.closing=d}},{key:"setContents",value:function(e,t,n){var i;if(void 0!==t&&n&&!(n.length<3)&&this.showText){var a=n[n.length-1],r=e;r.beginPath(),r.font="14px Verdana",r.textAlign="left",r.textBaseline="top",r.direction="ltr";var o=r.measureText(t).width;r.fillStyle="#AF6B6B";var s=n.map((function(e){return e.x})),c=(i=Math).min.apply(i,f(s));Math.abs(a.x-c)>=o&&a.x>c?r.fillText(t,a.x-o,a.y,o):r.fillText(t,a.x,a.y,o),r.closePath()}}},{key:"calculateRect",value:function(e){var t={},n={x:0,y:0};t.left=t.right=e[0].x,t.bottom=t.top=e[0].y;for(var i=e.length,a=1;a<=i;a++)n=e[a%i],t.left>n.x&&(t.left=n.x),t.bottom>n.y&&(t.bottom=n.y),t.right<n.x&&(t.right=n.x),t.top<n.y&&(t.top=n.y);return t}}]),o}(Pt),fa=function(e){l(o,e);var n=g(o);function o(e){var i;t(this,o),Ue(p(i=n.call(this,e)),"isCloudy",!1);var a=i.annotationInfo;if(a.borderStyle)switch(a.borderInfo.style=a.borderStyle,a.borderStyle){case Vt:i.annotationInfo.borderInfo.cloudIntensity=a.borderStyleParam,i.isCloudy=!0;break;case It:i.annotationInfo.borderInfo.dashes=a.borderStyleParam}return a.borderInfo.style===Vt?i.isCloudy=!0:i.isCloudy=!1,i}return i(o,[{key:"setFlag",value:function(e,t){this.renderer.setFlag(e,t)}},{key:"generateApRenderer",value:function(){var e=this.isCloudy;return new ha(this,e)}},{key:"getOuterDeviceRect",value:function(e,t){return this.isCloudy?en.on(this.getDeviceRect(e,t)).expand(100*e).extract():r(a(o.prototype),"getDeviceRect",this).call(this,e,t)}},{key:"getType",value:function(){return"polygon"}}]),o}(da),pa=function(e){l(i,e);var n=g(i);function i(e,a){var r;return t(this,i),Ue(p(r=n.call(this,e,a,"create-drawing-status")),"target",void 0),r.target=a,r}return i}(Bi),va=S.stateHandler,ga=S.Log,ma=S.DeviceInfo,ya=S.ViewerEvents,wa=S.Consts.CREATING_DRAWING_CONTEXTMENU,Sa=ga.LoggerFactory,Aa=va.StateHandlerConsts.STATE_HANDLER_CREATE_POLYGON,ba=Sa.getLogger("CreatePolygonStateHandler"),ka=function(e){l(o,e);var n=g(o);function o(e){return t(this,o),n.call(this,e,"polygon")}return i(o,[{key:"createInteractionTool",value:function(e){return new pa(this.pdfViewer,e)}},{key:"isCurrentStateHandler",value:function(){return this.pdfViewer.getStateHandlerManager().currentStateHandler.getStateName()===o.getStateName()}},{key:"create",value:function(e,t){var n=new fa({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:this.createAnnotJson({type:"polygon",flags:4,date:new Date,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Polygon"),rotation:((90*this.pageRender.page.getRotation()+this.pageRender.getRotation())%360+360)%360})});return n.addPoint(e,t),ma&&ma.isTouchDevice&&n.draw(),this.pdfViewer.eventEmitter.emit(ya.perimeterAnnotCreationStart,n),n}},{key:"canBeCompleted",value:function(e){var t=e.getVertexes().length;return t<2&&ba.debug("polygon has only ".concat(t," points")),t>=2}},{key:"pageHandler",value:function(e){var t,n=this;(r(a(o.prototype),"pageHandler",this).call(this,e),this.isCurrentStateHandler())&&(this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(wa,e.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.complete"),callback:function(){n.interaction.unlock(),n.interaction.emit("end",t)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.cancel"),callback:function(){n.interaction.unlock(),n.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu,this.interaction.on("start",(function(){n.contextmenu.enable(),n.completeMenuItem.disable(),n.pdfViewer.eventEmitter.emit(ya.drawingAnnotCreationStart,n.fakeAnnotation)})),this.interaction.on("end",(function(){})),this.interaction.on("cancel",(function(){n.contextmenu.disable(),n.cancel()})),this.interaction.on("move",(function(e){t=e})),this.contextmenu.onHidden((function(){if(!n.fakeAnnotation)return n.contextmenu.disable();n.interaction.unlock()})),this.contextmenu.onShown((function(){if(!n.fakeAnnotation)return n.contextmenu.disable();n.interaction.lock(),n.fakeAnnotation.getVertexes().length>=3?n.completeMenuItem.enable():n.completeMenuItem.disable()})))}},{key:"end",value:function(e,t){if(!this.isCurrentStateHandler())return r(a(o.prototype),"end",this).call(this,e,t);this.fakeAnnotation&&(this.contextmenu.disable(),this.pdfViewer.eventEmitter.emit(ya.drawingAnnotCreationEnd,this.fakeAnnotation),r(a(o.prototype),"end",this).call(this,e,t))}},{key:"cancel",value:function(){if(!this.isCurrentStateHandler())return r(a(o.prototype),"cancel",this).call(this);this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(ya.drawingAnnotCreationCancel,this.fakeAnnotation),r(a(o.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}}],[{key:"getStateName",value:function(){return Aa}}]),o}(ia),Ra=S.stateHandler,xa=S.Log,Ea=S.DeviceInfo,Ta=S.ViewerEvents,Ca=S.Consts.CREATING_DRAWING_CONTEXTMENU,Pa=xa.LoggerFactory,_a=Ra.StateHandlerConsts.STATE_HANDLER_CREATE_POLYLINE,Ia=(Pa.getLogger("creation/polyline/state"),function(e){l(o,e);var n=g(o);function o(e){return t(this,o),n.call(this,e,"polyline")}return i(o,[{key:"createInteractionTool",value:function(e){return new pa(this.pdfViewer,e)}},{key:"isCurrentStateHandler",value:function(){return this.pdfViewer.getStateHandlerManager().currentStateHandler.getStateName()===o.getStateName()}},{key:"pageHandler",value:function(e){var t,n=this;(r(a(o.prototype),"pageHandler",this).call(this,e),this.isCurrentStateHandler())&&(this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(Ca,e.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.complete"),callback:function(){n.interaction.unlock(),n.interaction.emit("end",t)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.cancel"),callback:function(){n.interaction.unlock(),n.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu,this.interaction.on("start",(function(){n.contextmenu.enable(),n.completeMenuItem.disable(),n.pdfViewer.eventEmitter.emit(Ta.drawingAnnotCreationStart,n.fakeAnnotation)})),this.interaction.on("end",(function(){})),this.interaction.on("cancel",(function(){n.contextmenu.disable(),n.cancel()})),this.interaction.on("move",(function(e){t=e})),this.contextmenu.onHidden((function(){if(!n.fakeAnnotation)return n.contextmenu.disable();n.interaction.unlock()})),this.contextmenu.onShown((function(){if(!n.fakeAnnotation)return n.contextmenu.disable();n.interaction.lock(),n.fakeAnnotation.getVertexes().length>=3?n.completeMenuItem.enable():n.completeMenuItem.disable()})))}},{key:"create",value:function(e,t){var n=this.pdfViewer.getDefaultAnnotConfig()("polyline"),i=new da(Object.assign({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:this.createAnnotJson({type:"polyline",flags:4,date:new Date,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Polyline")})},n));return i.addPoint(e,t),Ea&&Ea.isTouchDevice&&i.draw(),i}},{key:"end",value:function(e,t){if(!this.isCurrentStateHandler())return r(a(o.prototype),"end",this).call(this,e,t);this.fakeAnnotation&&(this.contextmenu.disable(),this.pdfViewer.eventEmitter.emit(Ta.drawingAnnotCreationEnd,this.fakeAnnotation),r(a(o.prototype),"end",this).call(this,e,t))}},{key:"cancel",value:function(){if(!this.isCurrentStateHandler())return r(a(o.prototype),"cancel",this).call(this);this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(Ta.drawingAnnotCreationCancel,this.fakeAnnotation),r(a(o.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}}],[{key:"getStateName",value:function(){return _a}}]),o}(ia)),Da=S.stateHandler,Ma=S.Log,Va=S.DeviceInfo,La=S.ViewerEvents,Ha=S.Consts.CREATING_DRAWING_CONTEXTMENU,Na=S.Consts.BORDER_STYLE,Oa=Ma.LoggerFactory,Fa=Da.StateHandlerConsts.STATE_HANDLER_CREATE_POLYGON_CLOUD,ja=Object.values(Na),Ba=Oa.getLogger("CreatePolygonCloudStateHandler"),Ua=function(e){l(o,e);var n=g(o);function o(e){return t(this,o),n.call(this,e,"polygon")}return i(o,[{key:"createInteractionTool",value:function(e){return new pa(this.pdfViewer,e)}},{key:"isCurrentStateHandler",value:function(){return this.pdfViewer.getStateHandlerManager().currentStateHandler.getStateName()===o.getStateName()}},{key:"create",value:function(e,t){var n,i=this.pdfViewer.getDefaultAnnotConfig()("polygon","PolygonCloud"),a=Object.assign({type:"polygon",flags:4,date:new Date,borderStyle:Na.CLOUDY,borderStyleParam:2,intent:"PolygonCloud",subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Cloud")},i);if(n=i.borderInfo){ja.indexOf(n.style)>-1&&(a.borderStyle=n.style);var r=n.dashes;Array.isArray(r)&&r.length>0?a.borderStyleParam=r:"number"==typeof n.cloudIntensity&&(a.borderStyleParam=n.cloudIntensity)}var o=new fa({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:a});return o.addPoint(e,t),Va&&Va.isTouchDevice&&o.draw(),o}},{key:"canBeCompleted",value:function(e){var t=e.getVertexes().length;return t<2&&Ba.debug("polygon has only ".concat(t," points")),t>=2}},{key:"pageHandler",value:function(e){var t,n=this;(r(a(o.prototype),"pageHandler",this).call(this,e),this.isCurrentStateHandler())&&(this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(Ha,e.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.complete"),callback:function(){n.interaction.unlock(),n.interaction.emit("end",t)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.annot.cancel"),callback:function(){n.interaction.unlock(),n.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu,this.interaction.on("start",(function(){n.contextmenu.enable(),n.completeMenuItem.disable(),n.pdfViewer.eventEmitter.emit(La.drawingAnnotCreationStart,n.fakeAnnotation)})),this.interaction.on("end",(function(){})),this.interaction.on("cancel",(function(){n.contextmenu.disable(),n.cancel()})),this.interaction.on("move",(function(e){t=e})),this.contextmenu.onHidden((function(){if(!n.fakeAnnotation)return n.contextmenu.disable();n.interaction.unlock()})),this.contextmenu.onShown((function(){if(!n.fakeAnnotation)return n.contextmenu.disable();n.interaction.lock(),n.fakeAnnotation.getVertexes().length>=3?n.completeMenuItem.enable():n.completeMenuItem.disable()})))}},{key:"end",value:function(e,t){this.fakeAnnotation&&(this.contextmenu.disable(),this.pdfViewer.eventEmitter.emit(La.drawingAnnotCreationEnd,this.fakeAnnotation),r(a(o.prototype),"end",this).call(this,e,t))}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(La.drawingAnnotCreationCancel,this.fakeAnnotation),r(a(o.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}}],[{key:"getStateName",value:function(){return Fa}}]),o}(ia),Xa=function(e){l(a,e);var n=g(a);function a(){return t(this,a),n.apply(this,arguments)}return i(a,[{key:"convertToCanvasBasedPoint",value:function(e,t,n,i,a,r){var o=w(a.getDevicePoint([e,t],i,r),2),s=o[0],c=o[1];return{x:s-n.left,y:c-n.top}}},{key:"doRender",value:function(e){var t=this,n=e.scale,i=e.renderingData,a=e.rotate,r=i.page,o=i.annotInfo,s=o.startCharInfo,c=o.endCharInfo,l=i.quadPoints,u=i.outerDeviceRect;if(!s){var d=l[0];s={left:d[0].x,top:d[0].y,right:d[1].x,bottom:d[2].y}}if(!c){var h=l[l.length-1];c={left:h[0].x,top:h[0].y,right:h[1].x,bottom:h[2].y}}var p=l.map((function(e,i){var o,s,c,l,d=e.map((function(e){return t.convertToCanvasBasedPoint(e.x,e.y,u,n,r,a)})),h=d.map((function(e){return e.x})),p=d.map((function(e){return e.y})),v=(o=Math).min.apply(o,f(h)),g=(s=Math).max.apply(s,f(h)),m=(c=Math).max.apply(c,f(p)),y=(l=Math).min.apply(l,f(p));return{left:v,right:g,bottom:m,top:y,width:g-v,height:m-y,textBlockHeight:m-y}}));e.quadRects=p}}]),a}(Pt),Ya=function(e){l(o,e);var n=g(o);function o(e){var i;return t(this,o),(i=n.call(this,e)).lastX=0,i.lastY=0,i}return i(o,[{key:"prepare",value:function(){r(a(o.prototype),"prepare",this).call(this),Ae.isChrome||Ae.isFirefox||Ae.isSafari||Ae.isChromiumEdge||(this.canvas.style.cssText+='\n            -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";\n            -ms-filter: alpha(opacity=50);\n            filter: alpha(opacity=50);\n            -moz-opacity: 0.5;\n            -khtml-opacity: 0.5;\n            opacity: 0.5;\n        ')}},{key:"doRender",value:function(e){e.smartScale,e.scale,this.component;var t=e.renderingData,n=t.annotInfo;if(this.component.needToggleView&&this.component.needToggleView()&&!this.component.shouldRenderByMouseEvent()){var i=this.canvas.getContext("2d");return i.clearRect(0,0,this.canvas.width,this.canvas.height),void i.save()}if(0!=n.hasBorderColor){var s=this.canvas.getContext("2d"),c=t.outerDeviceRect,l=c.right-c.left,u=c.bottom-c.top;if(this.container.style.cssText+="\n                left: ".concat(c.left,"px;\n                top: ").concat(c.top,"px;\n            "),this.canvas.style.cssText+="width: ".concat(l,"px;height: ").concat(u,"px;"),s.save(),s.fillStyle=this.numberToRGBAString(n.color),s.globalAlpha=t.opacity,t.isArea)s.fillRect(0,0,this.canvas.width,this.canvas.height);else r(a(o.prototype),"doRender",this).call(this,e),e.quadRects.forEach((function(e){s.fillRect(e.left,e.top,e.width,e.textBlockHeight)}));s.restore()}}}]),o}(Xa),$a=function(e){l(o,e);var n=g(o);function o(e){var i;t(this,o);return(i=n.call(this,e)).annotationInfo.dicts=Object.assign({AreaHi:"AreaHi"},i.annotationInfo.dicts||{}),i.eContainer.classList.add("fv__viewer-fake-highlight-area-annot"),i}return i(o,[{key:"setRect",value:function(e){r(a(o.prototype),"setRect",this).call(this,e),this.annotationInfo.coords=[this.pdfRect],this.annotationInfo.quadPoints=[{x:this.pdfRect.left,y:this.pdfRect.top},{x:this.pdfRect.right,y:this.pdfRect.top},{x:this.pdfRect.right,y:this.pdfRect.bottom},{x:this.pdfRect.left,y:this.pdfRect.bottom}]}},{key:"getDefaultAnnotInfo",value:function(){var e=r(a(o.prototype),"getDefaultAnnotInfo",this).call(this);return e.color=16776960,e}},{key:"getDefaultAnnotConfig",value:function(){var e=this.pdfViewer.getDefaultAnnotConfig();return"function"==typeof e?e(this.getType(),"Area"):{}}},{key:"generateApRenderer",value:function(){return new Ya(this)}},{key:"getType",value:function(){return"highlight"}},{key:"getCreationJSON",value:function(){return zn(vn({},r(a(o.prototype),"getCreationJSON",this).call(this)),{color:this.annotationInfo.color})}},{key:"getRenderingData",value:function(e,t){var n=r(a(o.prototype),"getRenderingData",this).call(this,e,t);return zn(vn({},n),{coords:[n.outerDeviceRect],isArea:!0})}}]),o}(hn),za=S.stateHandler,Ga=za.IStateHandler,qa=za.StateHandlerUtils.getDevicePagePoint,Wa=za.StateHandlerConsts.STATE_HANDLER_CREATE_CREATE_AREA_HIGHLIGHT,Ja=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-crosshair",i}return i(a,[{key:"pageHandler",value:function(e){var t=this;this.pageRender=e,this.pageDestroyHooks=[];var n=e.$handler.get(0);e.$handler.addClass(this.cursorStyle);var i=this.hammer=new Hammer.Manager(n);i.add(new Hammer.Pan),i.on("panstart",(function(e){t.startPoint=qa(n,e),t.start(t.startPoint)})),i.on("panmove",(function(e){return t.currentPoint={x:t.startPoint.x+e.deltaX,y:t.startPoint.y+e.deltaY},t.adjust(t.fakeAnnotation,t.startPoint,t.currentPoint)})),i.on("panend",(function(e){t.end(t.fakeAnnotation)})),i.on("pancancel",(function(e){return t.end(t.fakeAnnotation)})),this.pageDestroyHooks.push((function(){return i.destroy()}))}},{key:"start",value:function(e){var t=e.x,n=e.y;return this.fakeAnnotation=new $a({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:{flags:4,subject:this.pdfViewer.i18n.t("viewer_:annotSubjects.Highlight")}}),this.fakeAnnotation.setRect({left:t,right:t+1,top:n,bottom:n+1}),this.fakeAnnotation}},{key:"adjust",value:function(e,t,n){var i=t.x,a=t.y,r=n.x,o=n.y,s=Math.min(i,r),c=Math.min(a,o),l=Math.max(i,r),u=Math.max(a,o);e.setRect({left:s,top:c,right:l,bottom:u}),e.draw()}},{key:"end",value:function(e){var t=this;e.apply().then((function(e){if(t.pdfViewer.config.showCommentList){var n=e[e.length-2];t.pageRender.annotsRender.getAnnotRender(n.getId()).component.showReplyDialog()}})).then((function(){0}))}},{key:"destroyPageHandler",value:function(){this.fakeAnnotation&&this.fakeAnnotation.destroy(),this.pageDestroyHooks&&this.pageDestroyHooks.forEach((function(e){return e()})),this.pageRender.$handler.removeClass(this.cursorStyle)}}],[{key:"getStateName",value:function(){return Wa}}]),a}(Ga),Ka=S.stateHandler,Za=S.ViewerEvents,Qa=S.shared,er=S.DeviceInfo,tr=S.vendors,nr=tr.jQuery,ir=tr.EventEmitter,ar=Ka.IStateHandler,rr=Ka.StateHandlerConsts.STATE_HANDLER_CREATE_PENCIL,or=S.shared,sr=or.getClientX,cr=or.getClientY,lr=or.colorConvertor,ur=Qa.browser.dpr,dr=function(){function e(){t(this,e),this.isZoom=!1,this.eventEmitter=new ir}return i(e,[{key:"allInjected",value:function(){var e=this,t=new Hammer.Manager(this.pdfViewer.element,{recognizers:[[Hammer.Pinch]]});t.on("pinchstart",(function(t){e.isZoom=!0,e.eventEmitter.emit("pinchstart",t)})),t.on("pinchend",(function(t){Promise.resolve().then((function(){e.isZoom=!1})),e.eventEmitter.emit("pinchend",t)})),t.on("pinchmove",(function(t){e.eventEmitter.emit("pinchmove",t)}))}},{key:"onPinchstart",value:function(e){var t=this;return this.eventEmitter.on("pinchstart",e),function(){t.eventEmitter.off("pinchstart",e)}}},{key:"onPinchmove",value:function(e){var t=this;return this.eventEmitter.on("pinchmove",e),function(){t.eventEmitter.off("pinchmove",e)}}},{key:"onPinchend",value:function(e){var t=this;return this.eventEmitter.on("pinchend",e),function(){t.eventEmitter.off("pinchend",e)}}}],[{key:"inject",value:function(){return{pdfViewer:S.PDFViewer}}}]),e}(),hr=function(e){l(a,e);var n=g(a);function a(){var e;return t(this,a),(e=n.call.apply(n,[this].concat(Array.prototype.slice.call(arguments)))).cursorStyle="fv__cursor-pencil",e.isMovingPencil=!1,e.destroyHooks=[],e}return i(a,[{key:"initTimeout",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.timeout;clearTimeout(i),n&&(this.timeout=setTimeout((function(){if(t.isMovingPencil)return t.isMovingPencil=!1,t.initTimeout(e,n);t.addAnnot().then((function(e){t.isMovingPencil=!1}))}),e))}},{key:"pageHandler",value:function(e){var t=this,n=this,i=this;this.pageRender=e;var a=this.pdfViewer,r=a.getIoC().getInstanceByClass(dr),o=e.viewerRender,s=o.scrollWrap,c=e.$handler;c.addClass(this.cursorStyle);var l=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(n.pdfPointList&&!(n.pdfPointList.length<1)){if(t&&n.$canvas)return A(),void function(t,n){if(!t||t.length<1)return;var i={left:1e4,right:0,top:0,bottom:1e4},a=e.scale;Ae.isTouchDevice&&(a=e.scale*n);var r=function(e,t,n,i,a,r){return a.forEach((function(a){var o=w(e.getDevicePoint([a.x,a.y],t,n),2),s=o[0],c=o[1];s>r.right?r.right=s:s<r.left&&(r.left=s),c>r.top?r.top=c:c<r.bottom&&(r.bottom=c),i.push({x:s,y:c,type:a.type})})),i}(e.page,a,e.rotate,[],t,i),o=u[0].getBoundingClientRect(),s=f.getBoundingClientRect();r.slice(0).map((function(e){return zn(vn({},e),{x:e.x-(o.left-s.left),y:e.y-(o.top-s.top)})})).forEach((function(e){1==e.type?h.moveTo(e.x*ur,e.y*ur):h.lineTo(e.x*ur,e.y*ur)})),h.stroke()}(n.pdfPointList,i);clearTimeout(n.timeout),n.addAnnot()}};this.destroyHooks.push((0,Ae.observeResize)(e.viewerRender.scrollWrap.getScrollHost(),(function(){t.isPaintingPencil||b()})));var u=this.$canvas=nr('<canvas style="position: fixed;pointer-events: none;z-index: 1024;">');b(),c.append(this.$canvas.get(0));var d,h=this.$canvas[0].getContext("2d"),f=c[0],p=this.hammer=new Hammer.Manager(f,{recognizers:[[Hammer.Tap]]});if(this.pencilLists=[],this.isMovingPencil=!1,this.pdfPointList=[],this.isPaintingPencil=!1,this.startScale=e.scale,Ae.isTouchDevice){var v=a.addEventListener(Za.zoomToSuccess,(function(){t.transferPencilListsToPDFPointsLists(),l(!0,1)}));this.destroyHooks.push(v)}var g=!1;p.on("tap",(function(n){if(t.isPaintingPencil=!0,0==t.pdfPointList.length&&(t.startScale=e.scale,A()),!(n.pointers.length>1||r.isZoom)){h.closePath();var i=fr(f,n,u[0]);h.beginPath(),h.moveTo(i.x*ur,i.y*ur),h.arc(i.x*ur,i.y*ur,t.lineWidth,0,2*Math.PI),h.fillStyle=t.lineColor,h.fill(),h.closePath(),t.pencilLists.push([{x:i.x,y:i.y,type:3}]),t.isMovingPencil=!0,t.startAddAnnot()}}));var m=!1;function y(e){var t=a.element.parentElement.getBoundingClientRect(),n=c[0].getBoundingClientRect(),i=n.x-t.x,r=n.y-t.y;u.css({position:"absolute",left:-i/e,top:-r/e})}function S(){var e=a.element.parentElement;if(!e)return 1;var t=e.style.transform,n=w(/scale\((\d+(\.\d+)?)\)/.exec(t)||[],2)[1];return void 0===n?1:parseFloat(n)}function A(){var t=Object.assign({borderInfo:{width:2},color:16711680},i.pdfViewer.getDefaultAnnotConfig()("ink"));t.color=16777215&t.color,b(),i.$canvas.css("opacity",Number(t.opacity)),i.lineWidth=t.borderInfo.width*e.getScale()*ur,h.lineWidth=t.borderInfo.width*e.getScale()*ur,i.lineColor=lr(t.color,"HTML"),h.strokeStyle=lr(t.color,"HTML"),h.lineJoin="round",h.lineCap="round"}function b(){var t=e.viewerRender.getViewBoxRect(),n=t.right-t.left,i=t.bottom-t.top;u[0].width=n*ur,u[0].height=i*ur,u.css({width:n,height:i,position:"fixed",left:t.left,top:t.top})}if(p.on("hammer.input",(function(n){n.pointers.length>1?g=!0:g?"pointerup"==n.srcEvent.type&&(g=!1):"pointermove"==n.srcEvent.type?(m||(!function(n){if(o.setAllowScrollOnMouseWheel(!1),0==t.pdfPointList.length&&(t.startScale=e.scale,A()),!r.isZoom){t.isPaintingPencil=!0;var i=t.pencilLists;d=[],i.push(d);var a=fr(f,n,u[0]);h.closePath(),h.beginPath(),h.moveTo(a.x*ur,a.y*ur),d.push({x:a.x,y:a.y,type:1})}}(n),m=!0),function(e){if(!r.isZoom){t.isMovingPencil=!0;var n=fr(f,e,u[0]);d.push({x:n.x,y:n.y,type:2}),h.lineTo(n.x*ur,n.y*ur),h.strokeStyle=t.lineColor,h.stroke(),h.closePath(),h.beginPath(),h.moveTo(n.x*ur,n.y*ur),t.pageRender.page}}(n)):"pointerup"==n.srcEvent.type&&(!function(e){o.setAllowScrollOnMouseWheel(!0);var n=t.pencilLists;if(t.isPaintingPencil&&n&&!(n.length<1)&&t.isMovingPencil&&!r.isZoom){t.isMovingPencil=!1;var i=fr(f,e,u[0]);h.lineTo(i.x*ur,i.y*ur),h.stroke(),t.startAddAnnot()}}(n),m=!1)})),r.onPinchstart((function(e){y(S())})),r.onPinchmove((function(e){y(S())})),r.onPinchend((function(t){var n;n=e.viewerRender.getViewBoxRect(),u.css({position:"fixed",left:n.left,top:n.top}),Promise.resolve().then((function(){l(!1,t.scale)}))})),er.isTouchDevice){var k=function(e){e.preventDefault()};c.on("touchstart",k),this.__off_touch_event=function(){c.off("touchstart",k)}}else this.__off_touch_event=function(){};var R=s.getScrollHost(),x=function(e){if(t.isPaintingPencil&&!t.isMovingPencil){var n=!1;(e.ctrlKey||Ae.isMac&&e.metaKey)&&(n=!0),l(n)}};R.addEventListener("wheel",x);var E=function(e){t.isPaintingPencil&&!t.isMovingPencil&&l()};e.$element.on("blur",E),this.destroyHooks.push((function(){e.$element.off("blur",E),R.removeEventListener("wheel",x)}))}},{key:"changeToPageDevicePoints",value:function(e,t){var n,i=[];(n=i).push.apply(n,f(e.reduce((function(e,t){return e.concat(t)}),[])));var a=this.$canvas[0].getBoundingClientRect(),r=t.getBoundingClientRect();return i.slice(0).map((function(e){return zn(vn({},e),{x:e.x+a.left-r.left,y:e.y+a.top-r.top})}))}},{key:"transferPencilListsToPDFPointsLists",value:function(){var e,t=this.pencilLists;if(t&&!(t.length<1)){var n=this.pageRender,i=n.$handler[0],a=n.page,r=this.changeToPageDevicePoints(t,i),o=function(e,t,n,i,a,r){return a.forEach((function(a){var o=w(e.reverseDevicePoint([a.x,a.y],t,n),2),s=o[0],c=o[1];s>r.right?r.right=s:s<r.left&&(r.left=s),c>r.top?r.top=c:c<r.bottom&&(r.bottom=c),i.push({x:s,y:c,type:a.type})})),i}(a,n.scale,n.rotate,[],r,{left:1e4,right:0,top:0,bottom:1e4});(e=this.pdfPointList).push.apply(e,f(o)),this.pencilLists=[]}}},{key:"startAddAnnot",value:function(){var e=this.pencilLists;if(!e||e.length<1)return Promise.resolve();var t=this.pageRender;if(this.transferPencilListsToPDFPointsLists(),!t.pdfViewer.continuousAddPencil){var n=t.pdfViewer.getStateHandlerManager().getStateHandlerConfig(this.constructor.getStateHandlerName()),i=n?n.pencilTimeout:null;return i=null!=i?i:3e3,this.initTimeout(i)}this.addAnnot()}},{key:"addAnnot",value:function(){var e=this;if(!this.pdfPointList||this.pdfPointList.length<1)return Promise.resolve();var t=this.pdfPointList.slice(0);this.pdfPointList=[];var n=this.pageRender;return n.getPDFPage().then((function(i){var a=n.index,r=function(t){t.index===a&&(e.$canvas[0]&&(e.$canvas[0].width=0),t.pdfViewer.eventEmitter.off("renderAnnotSuccess",r),e.isPaintingPencil=!1)};return i.addAnnot({type:"ink",flags:4,rect:{left:1e4,right:0,top:0,bottom:1e4},inkList:t,subject:e.pdfViewer.i18n.t("viewer_:annotSubjects.Pencil")}).then((function(t){return n.pdfViewer.eventEmitter.emit(Za.addAnnotSuccess,t[0]),n.pdfViewer.eventEmitter.on("renderAnnotSuccess",r),e.pencilLists=[],t})).then((function(t){if(e.pdfViewer.config.showCommentList){var n=t[t.length-2];e.pageRender.annotsRender.getAnnotRender(n.getId()).component.showReplyDialog()}}))}))}},{key:"destroyPageHandler",value:function(){var e=this;this.__off_touch_event(),this.initTimeout(0,!1),this.pageRender.docRender.formRender.addTask((function(t){return e.addAnnot().then((function(t){e.$canvas.remove(),e.hammer&&e.hammer.destroy(),e.pageRender.$handler.removeClass(e.cursorStyle),e.pencilLists=null}))}),!0),this.destroyHooks.forEach((function(e){return e()}))}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return rr}},{key:"getStateHandlerName",value:function(){return"pencilStateHandler"}}]),a}(ar);function fr(e,t,n){var i=e.getBoundingClientRect(),a=t.srcEvent,r=sr(a),o=cr(a),s=n.getBoundingClientRect();return{x:Math.max(i.left,Math.min(i.right,r))-s.left,y:Math.max(i.top,Math.min(i.bottom,o))-s.top}}!function(e){e.CREATE_ANNOT="create-annots",e.REMOVE_ANNOT="remove-annots",e.UPDATE_ANNOT="update-annots",e.ADD_REPLY="add-reply",e.REMOVE_REPLY="remove-reply",e.ADD_REVIEW_STATE="add-review-state",e.ADD_MARKED_STATE="add-marked-state",e.UPDATE_ANNOT_CONTENT="update-comment-content",e.PPO_REMOVE_PAGE="ppo-remove-page",e.PPO_REMOVE_PAGES="ppo-remove-pages",e.PPO_INSERT_PAGE="ppo-insert-page",e.PPO_ROTATE_PAGE="ppo-rotate-page",e.PPO_MOVE_PAGE="ppo-move-page",e.MOVE_ANNOTS_BETWEEN_PAGES="move-annotations-between-pages",e.IMPORT_ANNOTATIONS_FILE="import-annotations-file"}(ca||(ca={})),function(e){e.fully="fully",e.playable="playable",e.adjustable="adjustable",e.deletable="deletable",e.modifiable="modifiable",e.attachmentDownloadable="attachmentDownloadable",e.replyable="replyable",e.editable="editable"}(la||(la={}));var pr=o(47),vr=o.n(pr),gr=(o(263),function(){function e(n,i){t(this,e),this.pageRender=n,this.circle=document.createElement("div"),this.circle.classList.add("eraserCircle"),this.circle.style="position:absolute; border:1px solid #000000;display:block;border-radius:50%;",this.wrapCircle=i,this.$eraserCircle=null,this.clientY,this.clientX,this.$pdfViewerElement=vr()(this.pageRender.pdfViewer.element)}return i(e,[{key:"init",value:function(){var e=this;this.$pdfViewerElement.on("scroll",(function(t){e.$eraserCircle&&e.eraserMove(t)})),this.wrapCircle.on("mouseenter",(function(){e.wrapCircle.append(e.circle),e.$eraserCircle=vr()(e.circle),e.$eraserCircle.css("display","block")})),this.wrapCircle.on("mousemove",(function(t){e.eraserMove(t)})),this.wrapCircle.on("mouseleave",(function(t){e.$eraserCircle&&e.$eraserCircle.remove()}))}},{key:"eraserMove",value:function(e){var t=e||window.event,n=this.pageRender.pdfViewer.getStateHandlerManager().getStateHandlerConfig("eraserStateHandler"),i=n?n.width:8,a=this.$eraserCircle?this.$eraserCircle:vr()(this.circle);t.clientY&&(this.clientY=t.clientY),t.clientX&&(this.clientX=t.clientX);var r=a[0].getBoundingClientRect();a.width(i),a.height(i);var o=vr()(this.wrapCircle).offset().top,s=vr()(this.wrapCircle).offset().left,c=vr()("html").scrollLeft(),l=this.clientY-r.height/2-o,u=this.clientX-r.width/2-s+c;a.css({top:l,left:u})}},{key:"destroy",value:function(){this.$eraserCircle&&this.$eraserCircle.remove(),this.wrapCircle.off(),this.$pdfViewerElement.off("scroll")}}]),e}()),mr=S.stateHandler,yr=S.Log,wr=S.ViewerEvents,Sr=S.shared,Ar=S.DeviceInfo.isDesktop,br=Sr.eraser,kr=br.Eraser,Rr=br.Point,xr=mr.IStateHandler,Er=S.Consts.POINT_TYPE,Tr=mr.StateHandlerUtils.getDevicePagePoint,Cr=yr.LoggerFactory.getLogger("EraserStateHandler"),Pr=Ar?8:20,_r=function(e){l(a,e);var n=g(a);function a(){var e;return t(this,a),(e=n.call.apply(n,[this].concat(Array.prototype.slice.call(arguments)))).cursorStyle="fv__cursor-eraser fv__cursor-none",e.eraserCircle=null,e}return i(a,[{key:"pageHandler",value:function(e){var t=this;return Be((function(){var n,i,a,r,o,s;return Xe(this,(function(c){return t.pageRender=e,n=e.$handler,(i=new gr(e,n)).init(),t.eraserCircle=i,t.allInkList={},t.eraseInkList={},n.addClass(t.cursorStyle),a=n[0],r=t.hammer=new Hammer.Manager(a,{recognizers:[[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]}),o=e.docRender.formRender.addTask((function(t){return e.page.getAnnots().then((function(e){return e.filter((function(e){return"ink"===e.getType()}))}))}),!0),e.getPDFPage().then((function(n){r.on("panstart",(function(e){t.startPoint=Tr(a,e),s=o.then((function(e){e.forEach((function(e){t.allInkList[e.getId()]={annot:e,inkList:e.getInkList()}}))}))})),r.on("panmove",(function(i){t.lastPoint=t.currentPoint||t.startPoint,t.currentPoint={x:t.startPoint.x+i.deltaX,y:t.startPoint.y+i.deltaY},s=s.then((function(i){return o.then((function(i){if(0!==i.length||t.currentPoint){var a=e.pdfViewer.getStateHandlerManager().getStateHandlerConfig(t.constructor.getStateHandlerName()),r=a?a.width:Pr;return t.erase(n,i,t.currentPoint,r)}}))}))})),r.on("panend",(function(n){var i=document.getElementById("eraser");i&&i.remove(),s.then((function(n){var i=[],a=[];for(var r in t.eraseInkList){var o=t.allInkList[r],s=t.eraseInkList[r];o.isRemove=s.isRemove,i.push(o),a.push(s)}e.pdfViewer.eventEmitter.emit(wr.eraserSuccess,i,a);var c=Object.keys(t.eraseInkList).map((function(e){return t.eraseInkList[e]})).filter((function(e){return!e.isRemove})).map((function(e){return e.annot.exportToJSON()}));t.pdfViewer.collaborate(ca.UPDATE_ANNOT,{annots:c})}))}))})),[2]}))}))()}},{key:"erase",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Pr,a=this;return Be((function(){var r,o,s,c,l,u,d,h,f,p,v;return Xe(this,(function(g){switch(g.label){case 0:return r=a.pdfViewer,o=a.pageRender,s=o.getScale(),c=o.getRotation(),l=w(e.reverseDevicePoint([n.x,n.y],s,c),2),u=l[0],d=l[1],h={x:u,y:d},m=Be((function(e,t){var n;return Xe(this,(function(i){switch(i.label){case 0:return[4,Promise.all(e.map(t))];case 1:return n=i.sent(),[2,e.filter((function(e,t){return n[t]}))]}}))})),f=function(e,t){return m.apply(this,arguments)},[4,f(t,function(){var e=Be((function(e){var t;return Xe(this,(function(n){switch(n.label){case 0:return t=e.getRect(),[4,a.pdfViewer.getAnnotAuthorityManager()];case 1:return[4,n.sent().getPermission(e)];case 2:return n.sent().isModifiable()?[2,(i=t,r=h,o=r.x>=i.left&&r.x<=i.right,s=r.y>=i.bottom&&r.y<=i.top,o&&s)]:[2,null]}var i,r,o,s}))}));return function(t){return e.apply(this,arguments)}}())];case 1:return p=g.sent(),v=p.map((function(e){var t=function(){var t,n=e.getInkList(),a=new kr(i/2).erase(n.map((function(e){return new Rr(e.x,e.y,e.type)})),new Rr(u,d)).reduceRight((function(e,t){var n=e[0];return n&&n.type===Er.MOVE_TO&&n.type===t.type||e.unshift(t),e}),[]),s=(t=a,t.reduce((function(e,t){return t.type===Er.MOVE_TO&&e.push([]),e[e.length-1].push(t),e}),[])).filter((function(e){if(e.length<1)return!1;var t=e[0],n=0;return e.forEach((function(e){n+=e.distanceTo(t),t=e})),n>.01}));if(0!==s.length){var c=s.reduce((function(e,t){return e.concat(t)}),[]);return e.setInkList(c)}var l=o.getAnnotRender(e.getId());if(l){var h=l.component.annot;return h.getPDFPage().removeAnnot(h).then((function(){r.collaborate(ca.REMOVE_ANNOT,[{annotId:h.getUniqueID(),pageIndex:o.index}])}))}Cr.debug("annotRender === undefined",l,s,a)};return e.$$lastErasePromise=(e.$$lastErasePromise||Promise.resolve()).then(t,t).then((function(t){var n=o.getAnnotRender(e.getId());return a.eraseInkList[e.getId()]={annot:e,inkList:e.getInkList(),isRemove:!n},t}))})),[2,Promise.all(v)]}var m}))}))()}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.eraserCircle.destroy()}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return"eraser"}},{key:"getStateHandlerName",value:function(){return"eraserStateHandler"}}]),a}(xr);const Ir=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US";e.endsWith("/")||(e+="/"),t=t.replace(/(\w*?)-(\w*)/,(function(e,t,n){return t+"-"+n.toUpperCase()}));return function(n,i,a){var r;return Ue(r={},a,{Approved:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Approved.pdf"),fileType:"pdf"},Revised:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Revised.pdf"),fileType:"pdf"},Reviewed:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Reviewed.pdf"),fileType:"pdf"},Received:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Received.pdf"),fileType:"pdf"},Confidential:{url:"".concat(e,"stamps/").concat(t,"/DynamicStamps/Confidential.pdf"),fileType:"pdf"}}),Ue(r,i,{Accepted:{url:"".concat(e,"stamps/").concat(t,"/SignHere/Accepted.pdf"),fileType:"pdf"},Witness:{url:"".concat(e,"stamps/").concat(t,"/SignHere/Witness.pdf"),fileType:"pdf"},SignHere:{url:"".concat(e,"stamps/").concat(t,"/SignHere/SignHere.pdf"),fileType:"pdf"},Rejected:{url:"".concat(e,"stamps/").concat(t,"/SignHere/Rejected.pdf"),fileType:"pdf"},Initial:{url:"".concat(e,"stamps/").concat(t,"/SignHere/Initial.pdf"),fileType:"pdf"}}),Ue(r,n,{Approved:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Approved.pdf"),fileType:"pdf"},Void:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Void.pdf"),fileType:"pdf"},Verified:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Verified.pdf"),fileType:"pdf"},Revised:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Revised.pdf"),fileType:"pdf"},Reviewed:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Reviewed.pdf"),fileType:"pdf"},Received:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Received.pdf"),fileType:"pdf"},Final:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Final.pdf"),fileType:"pdf"},Expired:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Expired.pdf"),fileType:"pdf"},Emergency:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Emergency.pdf"),fileType:"pdf"},Draft:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Draft.pdf"),fileType:"pdf"},Confidential:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Confidential.pdf"),fileType:"pdf"},Completed:{url:"".concat(e,"stamps/").concat(t,"/StandardStamps/Completed.pdf"),fileType:"pdf"}}),r}.apply(undefined,f(["Static","SignHere","Dynamic"]))};var Dr,Mr=S.DeviceInfo,Vr=S.PDFViewer,Lr=S.shared.Store;function Hr(){return(Math.random()+"").substring(2)+Date.now()}!function(e){e.CUSTOM_STAMP_LIST_ADDED="custom-stamps-added",e.CUSTOM_STAMP_LIST_REMOVED="custom-stamps-removed",e.CUSTOM_STAMP_LIST_UPDATED="custom-stamps-updated",e.DEFAULT_STAMP_LIST_UPDATED="default-stamps-updated",e.DEFAULT_STAMP_LIST_REMOVED="default-stamps-removed",e.SWITCH_STAMP_ICON="switch-stamp-icon"}(Dr||(Dr={}));var Nr,Or=function(){function e(){t(this,e),Ue(this,"pdfViewer",void 0),Ue(this,"currentStamp",void 0),Ue(this,"currentPreviewerImg",void 0),Ue(this,"customStamps",{}),Ue(this,"defaultStamps",{}),Ue(this,"store",new Lr),Ue(this,"lastKey",void 0),Ue(this,"defaultStampRewrited",!1);var n=document.createElement("img");n.draggable=!1,n.style.cssText="position: absolute;opacity:0.5;pointer-events:none;",this.currentPreviewerImg=n}return i(e,[{key:"setCurrentStamp",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:45,s=this.currentStamp,c=this.currentStamp=this.getStampIcon(e,t,i,a,r,o);if(!c)throw new Error("Stamp not found: category: ".concat(e,", name: ").concat(t));this.currentPreviewerImg.src=c.showUrl||"",Promise.resolve().then((function(){n.store.dispatch("switch-stamp-icon",{current:n.currentStamp,last:s})}))}},{key:"onSwitchStamp",value:function(e){return this.store.subscribe("switch-stamp-icon",(function(t){e(t.current,t.last)}))}},{key:"getCurrentStampConfig",value:function(){return this.currentStamp}},{key:"getPreviewerImage",value:function(){return this.currentPreviewerImg}},{key:"setDefaultStamps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.defaultStamps=e,this.defaultStampRewrited=!0,this.store.dispatch("default-stamps-updated",e)}},{key:"setCustomStamps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.customStamps=e,this.store.dispatch("custom-stamps-updated",e)}},{key:"updateDefaultStamps",value:function(e,t){if(!this.defaultStampRewrited){var n=this.pdfViewer.libPath,i=this.pdfViewer.getCurrentLanguage(),a=n+i;if(this.lastKey!==a){this.lastKey=a;var r=Ir(n,i);if(e){var o=e.category,s=e.name;r[o]=r[o]||{},r[o][s]=e}if(t){var c=t.category,l=t.name;r[c]&&(delete r[c][l],0===Object.keys(r[c]).length&&delete r[c])}this.defaultStamps=r,this.store.dispatch("default-stamps-updated",r)}}}},{key:"getDefaultStamps",value:function(){return this.defaultStamps}},{key:"getCustomStamps",value:function(){return this.customStamps}},{key:"getFavoriteStamps",value:function(){var e=function(e){var n,r,s=t[e].split("."),c=s[0],l=s[1],u=s[2],d=s[s.length-1],h=!1;if(d.includes("__sPage__")){h=!0;var f=d.split("__");c=f[0],l=f[1],u=d}var p={},v=void 0;if(null==i||null===(r=i[c])||void 0===r||null===(n=r[l])||void 0===n?void 0:n.url)v=i[c][l].url,o[c+"-"+l]=vn({fileType:"pdf",url:v},p);else{var g,m=null==a||null===(g=a[c])||void 0===g?void 0:g[l];if(m||a[c]&&"length"in a[c]&&(m=a[c].find((function(e){var t=e.index.split("__"),n=t[t.length-1],i=u.split("__");return n===i[i.length-1]&&t[0]===i[0]}))),!m)return"continue";if(Array.isArray(m)){var y=m.find((function(e){return e.index==u}));v=y.url,p.width=y.width,p.height=y.height,p.fileType=y.fileType,h&&(p.isImportPDFStamp=y.isImportPDFStamp,p.blob=y.blob,p.pageIndex=y.index)}else v=m.url,p.width=m.width,p.height=m.height,p.fileType=m.fileType,h&&(p.isImportPDFStamp=m.isImportPDFStamp,p.blob=m.blob,p.pageIndex=m.pageIndex);if(!v)return"continue";o[c+"-"+l+"-"+u]=vn({fileType:"pdf",url:v},p)}};this.updateDefaultStamps();var t=this.pdfViewer.getDeprecatedStorage().getItem("FAVORITE-STAMPS-LIST"),n=this.pdfViewer.viewerUI.rootComponent.pdfUI;n.customs&&n.customs.stampManager&&(t=n.customs.stampManager.getFavoriteStamps());var i=this.getDefaultStamps(),a=this.getCustomStamps(),r=Object.assign({},i);if(!t)return r;if(0===t.length)return r;for(var o={},s=0;s<t.length;s++)e(s);return r.Favorite=o,r}},{key:"getStampIcon",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:45,o=this.defaultStamps[e]&&this.defaultStamps[e][t],s=this.customStamps[e];if(!o&&s){var c=s[t];o=Array.isArray(c)?c.find((function(e){return e.index==n})):c}if(!o){var l=this.getFavoriteStamps()[e];if(l){var u=l[t];o=Array.isArray(u)?u.find((function(e){return e.index==n})):u}}if(o=o||i){var d=o.width||a,h=o.height||r,f=o.showUrl||o.url;if(!Mr.isTouchDevice&&["pdf","tif","tiff"].includes(o.fileType)){f=f.replace(/\.(pdf|tif|tiff)$/,".svg");var p=new XMLHttpRequest;p.open("get",f),p.send()}return!("index"in o)&&"pageIndex"in o&&(o.index=o.pageIndex),Object.assign({},o,{width:d,height:h,showUrl:f,category:e,name:t})}}},{key:"clearCustomStamps",value:function(){this.customStamps={}}},{key:"addAnnotationIcon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.category,i=e.name;n in this.customStamps||(this.customStamps[n]={leaf:1});var a=this.customStamps[n][i],r=!1;if(!a&&"length"in this.customStamps[n]&&(r=!0,!(a=this.customStamps[n].find((function(t){return t.index===e.index})))&&e.index.includes("__sPage__")&&this.customStamps[n].forEach((function(t){var n=t.index.split("__"),i=n.length-1,r=e.index.split("__"),o=r.length-1;n[0]===r[0]&&n[i]===r[o]&&(t.index=e.index,t.categoryId=null==e?void 0:e.categoryId,a=t)}))),!t){if(!a)if(r){if(window&&window.hasDelStamp)return;a=e,this.customStamps[n].push(e)}else a=this.customStamps[n][i]=[];if(Array.isArray(a))e.index||(e.index=Hr()),a.some((function(t){return t.index===e.index}))||a.push(e);else a.index||(a.index=Hr()),e.index||(e.index=Hr()),r?this.customStamps[n].forEach((function(t){t.index===e.index&&(t=e)})):this.customStamps[n][i]=[a,e]}this.store.dispatch("custom-stamps-added",this.customStamps,e)}},{key:"removeAnnotationIcon",value:function(e){this.removeIcon(this.customStamps,e)?this.store.dispatch("custom-stamps-removed",this.customStamps,e):this.removeIcon(this.defaultStamps,e)&&this.store.dispatch("default-stamps-removed",this.defaultStamps,e)}},{key:"onCustomStampRemoved",value:function(e){return this.store.subscribe("custom-stamps-removed",e)}},{key:"onCustomStampAdded",value:function(e){return this.store.subscribe("custom-stamps-added",e)}},{key:"onDefaultStampRemoved",value:function(e){return this.store.subscribe("default-stamps-removed",e)}},{key:"onDefaultStampUpdated",value:function(e){return this.store.subscribe("default-stamps-updated",e)}},{key:"removeIcon",value:function(e,t){var n,i=function(){var t=e[s];for(var i in t){var c=t[i];if(r){if(a==s&&i==r){if(Array.isArray(c)){if(void 0===o){delete t[i];continue}t[i]=c.reduce((function(e,t,n){return o.length>1&&o==t.index||n+""==o||e.push(t),e}),[]);var l=t[i];Array.isArray(l)&&(l.length||delete t[i])}else delete t[i];n=!0}}else a?s==a&&(delete t[i],n=!0):delete t[i]}Object.values(t).some((function(e){return Array.isArray(e)||"[object Object]"===Object.prototype.toString.call(e)}))||delete e[s]},a=t.category,r=t.name,o=t.index;for(var s in e)i();return n}}],[{key:"inject",value:function(){return{pdfViewer:Vr}}}]),e}(),Fr=S.stateHandler,jr=S.ViewerEvents,Br=S.vendors,Ur=(Br.jQuery,Br.Hammer),Xr=Fr.IStateHandler,Yr=Fr.StateHandlerConsts.STATE_HANDLER_CREATE_STAMP,$r=S.shared,zr=$r.getClientX,Gr=$r.getClientY,qr=S.DeviceInfo.isTouchDevice,Wr=function(e){l(a,e);var n=g(a);function a(e){return t(this,a),n.call(this,e)}return i(a,[{key:"pageHandler",value:function(e){this.pageRender=e;var t=e.$handler,n=e.pdfViewer;t.addClass("fv__create-stamp-state-handler");var i=!1,a=t[0],r=this.hammer=new Ur.Manager(a,{recognizers:[[Ur.Tap]]}),o=n.getIoC().getInstanceByClass(Or),s=o.getPreviewerImage();function c(n){var i=o.getCurrentStampConfig(),r=a.getBoundingClientRect(),c=n.clientX-r.left,l=n.clientY-r.top;qr||(s.style.cssText+="\n                    transform: scale(".concat(e.getScale(),");\n                    top: ").concat(l-2*i.height/3,"px;\n                    left: ").concat(c-2*i.width/3,"px;\n                "),s.style.display="",t.append(s))}this.previewStampImg=s,n.getStore().subscribe("switchStampEvent",(function(e){c(e)})),this.addEvent(t,"mousemove",(function(e){i||c(e)})),r.on("tap",(function(t){if(!i){var r=a.getBoundingClientRect(),c=t.srcEvent,l="",u=zr(c),d=Gr(c),h=[u-r.left,d-r.top],f=h[0],p=h[1];i=!0;var v=o.getCurrentStampConfig(),g=v.width,m=v.height,y=v.category,w=v.name,S=v.fileType,A=v.url,b=v.field,k=v.blob,R=v.index,x=v.isImportPDFStamp;return e.getPDFPage().then((function(t){var n=2*g/3*e.scale,i=2*m/3*e.scale,a={left:f-n,right:f+n,top:p-i,bottom:p+i};a=t.reverseDeviceRect(a,e.scale,e.getRotation());var r={rotation:(90*t.getRotation()+e.getRotation())%360,type:"stamp",flags:4,rect:a,subject:e.pdfViewer.i18n.t("viewer_:annotSubjects.Stamp"),iconInfo:{category:y,name:w,fileType:S,url:A,field:b,stampPdfBlob:k,isImportPDFStamp:x,pageIndex:R}};return Object.assign(r,e.pdfViewer.getDefaultAnnotConfig()("stamp")||{}),t.addAnnot(r)})).then((function(t){var n=e.annotsRender.getAnnotRender(t[0].objectNumber).component;return l=n,e.pdfViewer.eventEmitter.emit(jr.addAnnotSuccess,n.annot),n})).then((function(t){return e.pdfViewer.getStateHandlerManager().switchTo(),t.getRenderPromise().finally((function(){setTimeout((function(){s.style.cssText+="\n                                    display: none;\n                                    opacity: 0.5;\n                                "}),500),s.style.opacity=1})),i=!1,n.activeElement(t),n.config.showCommentList?(l.showReplyDialog(),t):t})).catch((function(){i=!1,s.style.cssText+="\n                        display: none;\n                        opacity: 0.5;\n                    "}))}}))}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass("fv__create-stamp-state-handler");var e=this.previewStampImg;e.parentElement&&e.parentElement.removeChild(e),this.destroyList.map((function(e){var t=w(e,3),n=t[0],i=t[1],a=t[2];n.off(i,a)}))}},{key:"out",value:function(){this.destroyPageHandler()}},{key:"addEvent",value:function(e,t,n){this.destroyList=this.destroyList||[],e.on(t,n),this.destroyList.push([e,t,n])}}],[{key:"getStateName",value:function(){return Yr}},{key:"setParams",value:function(e,t){var n=e.category,i=e.name,a=e.index,r=t.getIoC().getInstanceByClass(Or);try{e.url&&e.fileType?r.setCurrentStamp(n,i,a,e):r.setCurrentStamp(n,i,a,void 0)}catch(e){return console.error(e),void Promise.resolve().then((function(){t.getStateHandlerManager().switchTo()}))}var o=r.getPreviewerImage(),s=r.getCurrentStampConfig(),c=s.width,l=s.height,u=s.showUrl;qr||(o.style.cssText+="\n                width: ".concat(4*c/3,"px;\n                height: ").concat(4*l/3,"px;\n            "),o.src=u,"pdf"==s.fileType&&setTimeout((function(){t.previewIconDoc(s).then((function(e){o.parentElement&&(o.src=URL.createObjectURL(e))}))}),100))}}]),a}(Xr),Jr=S.stateHandler,Kr=S.ViewerEvents,Zr=Jr.IStateHandler,Qr=Jr.HandStateHandler,eo=S.vendors,to=eo.Hammer,no=eo.jQuery,io=S.shared,ao=(io.DebouncePromiseQueue,io.getClientX),ro=io.getClientY,oo=Jr.StateHandlerUtils,so=(oo.getDevicePagePoint,oo.deltaDeviceRect,oo.appendSelectMark,oo.removeSelectMark,Jr.StateHandlerConsts.STATE_HANDLER_CREATE_FILE_ATTACHMENT),co=function(e){l(a,e);var n=g(a);function a(e){var i;return t(this,a),(i=n.call(this,e)).cursorStyle="fv__cursor-file",i}return i(a,[{key:"pageHandler",value:function(e){this.pageRender=e;var t=e.$handler;t.addClass(this.cursorStyle);var n=no('<input id="fileAttachment" type="file" style="display: none;"/>');this.$fileAttachment=n,t.append(n);var i=t[0];(this.hammer=new to.Manager(i,{recognizers:[[to.Tap]]})).on("tap",(function(t){var a=i.getBoundingClientRect(),r=t.srcEvent,o=ao(r),s=ro(r),c=[o-a.left,s-a.top],l=c[0],u=c[1],d=e.pdfViewer;n.off("change").on("change",(function(t){var n=t.target.files[0];if(n&&!(d.customs&&d.customs.isAttachFileOverSize&&d.customs.isAttachFileOverSize(n)))if(n.size>268435456)d.viewerUI.confirm({message:"sidebar.attachment.addAttachmentSizeLimit",level:"warning"});else{if(!(["exe"].indexOf(n.name.split(".")[1])>=0))return e.getPDFPage().then((function(t){var i=new FileReader,a=w(t.reverseDevicePoint([l,u],e.scale,e.getRotation()),2),r=a[0],o=a[1];i.readAsArrayBuffer(n),i.onload=function(){var a=new Uint8Array(i.result);t.addAnnot({flags:28,type:"fileattachment",rect:{left:r,right:r+20,top:o,bottom:o-24},buffer:a,fileName:n.name,file:n,subject:d.i18n.t("viewer_:annotSubjects.File")}).then((function(t){var n=t[0],i=e.annotsRender.getAnnotRender(n.getId()).component;d.eventEmitter.emit(Kr.addAnnotSuccess,i.annot),d.getStateHandlerManager().switchTo(Qr.getStateName()),e.annotsRender.activeAnnot(n.getId())}))}}));d.viewerUI.confirm({message:"sidebar.attachment.addAttachmentFileFormat",level:"warning"})}})),n.click()}))}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.$fileAttachment.remove()}},{key:"out",value:function(){this.destroyPageHandler()}}],[{key:"getStateName",value:function(){return so}}]),a}(Zr);!function(e){e.STATE_HANDLER_HAND="hand",e.STATE_HANDLER_CHECK_THE_SEARCH="checkTheSearch",e.STATE_HANDLER_CREATE_CARET="createCaret",e.STATE_HANDLER_CREATE_ARROW="createArrow",e.STATE_HANDLER_CREATE_AREA_HIGHLIGHT="createAreaHighlight",e.STATE_HANDLER_CREATE_CREATE_AREA_HIGHLIGHT="createAreaHighlight",e.STATE_HANDLER_CREATE_CIRCLE="createCircle",e.STATE_HANDLER_CREATE_FILE_ATTACHMENT="createFileAttachment",e.STATE_HANDLER_CREATE_HIGHLIGHT="createHighlight",e.STATE_HANDLER_CREATE_IMAGE="createImage",e.STATE_HANDLER_CREATE_LINK="createLink",e.STATE_HANDLER_CREATE_LINE="createLine",e.STATE_HANDLER_CREATE_DISTANCE="createDistance",e.STATE_HANDLER_CREATE_PERIMETER="createPerimeter",e.STATE_HANDLER_CREATE_AREA="createArea",e.STATE_HANDLER_CREATE_CIRCLE_AREA="createCircleArea",e.STATE_HANDLER_CREATE_PENCIL="createPencil",e.STATE_HANDLER_CREATE_POLYGON_CLOUD="createPolygonCloud",e.STATE_HANDLER_CREATE_POLYGON="createPolygon",e.STATE_HANDLER_CREATE_POLYLINE="createPolyline",e.STATE_HANDLER_CREATE_REPLACE="createReplace",e.STATE_HANDLER_CREATE_SQUARE="createSquare",e.STATE_HANDLER_CREATE_SQUIGGLY="createSquiggly",e.STATE_HANDLER_CREATE_STAMP="createStamp",e.STATE_HANDLER_CREATE_STRIKE_OUT="createStrikeOut",e.STATE_HANDLER_CREATE_TEXT="createText",e.STATE_HANDLER_CREATE_UNDERLINE="createUnderline",e.STATE_HANDLER_MARQUEE="marquee",e.STATE_HANDLER_ERASER="eraser",e.STATE_HANDLER_LOUPE="loupe",e.STATE_HANDLER_SELECT_TEXT_ANNOTATION="select-text-annotation",e.STATE_HANDLER_SELECT_TEXT_IMAGE="select-text-image",e.STATE_HANDLER_SELECT_ANNOTATION="select-annotation",e.STATE_HANDLER_CREATE_FREETEXT_BOX="createFreeTextBox",e.STATE_HANDLER_CREATE_FREETEXT_CALLOUT="createFreeTextCallout",e.STATE_HANDLER_CREATE_FREETEXT_TYPEWRITER="createFreeTextTypewriter",e.STATE_HANDLER_CREATE_FIELD_TEXT="CreateTextStateHandler",e.STATE_HANDLER_CREATE_FIELD_SIGNATURE="CreateSignStateHandler",e.STATE_HANDLER_CREATE_FIELD_PUSH_BUTTON="CreatePushButtonStateHandler",e.STATE_HANDLER_CREATE_FIELD_CHECK_BOX="CreateCheckBoxStateHandler",e.STATE_HANDLER_CREATE_RADIO_BUTTON="CreateRadioButtonStateHandler",e.STATE_HANDLER_CREATE_FIELD_COMBO_BOX="CreateComboBoxStateHandler",e.STATE_HANDLER_CREATE_FIELD_LIST_BOX="CreateListBoxStateHandler",e.STATE_HANDLER_CREATE_FIELD_DATE="CreateDateStateHandler",e.STATE_HANDLER_CREATE_FIELD_IMAGE="CreateImageStateHandler",e.STATE_HANDLER_SNAPSHOT_TOOL="snapshot-tool",e.STATE_HANDLER_CREATE_DOCUMENT_ATTACHMENT="createDocumentAttachment"}(Nr||(Nr={}));var lo,uo="userSpaceUnit",ho="userSpaceScaleValue",fo="realUnit",po="realScaleValue",vo=(Ue(lo={},Nr.STATE_HANDLER_CREATE_PERIMETER,"perimeter"),Ue(lo,Nr.STATE_HANDLER_CREATE_DISTANCE,"distance"),Ue(lo,Nr.STATE_HANDLER_CREATE_AREA,"area"),Ue(lo,Nr.STATE_HANDLER_CREATE_CIRCLE_AREA,"area"),function(e){l(a,e);var n=g(a);function a(e,i){var r;return t(this,a),(r=n.call(this,e)).target=i,r}return i(a,[{key:"init",value:function(){var e,t,n,i,a=this,r=function(n){if(0===n.button)if(a.isStarted){if(a.isStarted){i=null,a.isStarted=!1;var r=n.clientX-e,o=n.clientY-t;a.emit("end",{deltaX:r,deltaY:o,srcEvent:n})}}else i=a.target.getBoundingClientRect(),a.isStarted=!0,e=n.clientX,t=n.clientY,a.emit("start",{deltaX:0,deltaY:0,srcEvent:n})},o=function(i){if(!a.isLocked)if(a.isStarted){var r=i.clientX-e,o=i.clientY-t;a.emit("move",n={deltaX:r,deltaY:o,srcEvent:i})}else{var s=a.target.getBoundingClientRect(),c=i.clientX-s.left,l=i.clientY-s.top;a.emit("mousemove",{x:c,y:l})}},s=function(n){if(a.isStarted&&!a.isDestroyed&&!a.isLocked&&i){var r=a.target.getBoundingClientRect(),o=e-i.left,s=t-i.top,c=r.width/i.width;e=r.left+o*c,t=r.top+s*c,i=r}};window.addEventListener("scroll",s,!0),this.target.addEventListener("mousedown",r),document.addEventListener("mousemove",o,!0);var c=this.pdfViewer.getStore().subscribe("create-measurement-status",(function(e){switch(e){case"complete":a.isStarted&&(i=null,a.isStarted=!1,a.unlock(),a.emit("end",n));break;case"cancel":a.isStarted&&(i=null,a.isStarted=!1,a.unlock(),a.emit("cancel"))}}));this.addDestroyHook((function(){a.target.removeEventListener("mousedown",r),document.removeEventListener("mousemove",o),c(),window.removeEventListener("scroll",s,!0)}))}}]),a}(Yn)),go=S.stateHandler.CreateMeasurementService,mo=[],yo=S.ViewerEvents,wo=S.DeviceInfo.isTouchDevice,So=S.Consts,Ao=So.LineEndingStyle,bo=So.Intents,ko=So.CREATING_MEASUREMENT_CONTEXTMENU,Ro=S.shared.ThrottleAsyncTaskExecutor,xo=S.commons.isSamePoint,Eo=function(e){l(o,e);var n=g(o);function o(e){var i;return t(this,o),(i=n.call(this,e,Ao.OpenArrow,Ao.OpenArrow)).isEnd=!0,i.executor=new Ro(20,!0),i}return i(o,[{key:"createInteractionTool",value:function(e,t){return wo?r(a(o.prototype),"createInteractionTool",this).call(this,e,t):new vo(this.pdfViewer,e)}},{key:"getMeasurementInfo",value:function(){var e=this.pdfViewer.getIoC().getInstanceByClass(go).getMeasurementInfo();return{unit:e[fo].name,ratio:{userSpaceValue:e[ho],userSpaceUnit:e[uo].name,realValue:e[po],realUnit:e[fo].name}}}},{key:"createAnnotJson",value:function(e){return e.intent=bo.LINE_DIMENSION,e.enableCaption=!0,e.measure=this.getMeasurementInfo(),this.pageRender&&(e.rotation=((90*this.pageRender.page.getRotation()+this.pageRender.getRotation())%360+360)%360),Object.assign(e,this.pdfViewer.getDefaultAnnotConfig()("line","LineDimension")),e}},{key:"pageHandler",value:function(e){var t,n=this;r(a(o.prototype),"pageHandler",this).call(this,e),this.destroyPageHooks=[];var i=this.pdfViewer.viewerUI.createContextMenu(ko,e.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.complete"),callback:function(){n.interaction.unlock(),n.interaction.emit("end",t)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.cancel"),callback:function(){n.interaction.unlock(),n.interaction.emit("cancel")}}}}),s=this.pdfViewer.getIoC().getInstanceByClass(Ui),c=i.getItem("complete");i.disable(),this.creatingContextmenu=i,this.interaction.on("start",(function(){s.isCreating?n.interaction.cancel():(s.setCreating(n.pageRender.index),n.isEnd=!1,i.enable())})),this.interaction.on("end",(function(){s.creatingEnd(),n.isEnd=!0,i.disable()})),this.interaction.on("cancel",(function(){s.creatingEnd(),i.disable()})),this.interaction.on("move",(function(e){t=e})),i.onHidden((function(){n.interaction.unlock()})),i.onShown((function(){n.interaction.lock(),c.enable()})),this.destroyPageHooks.push(this.pdfViewer.addEventListener(yo.zoomToSuccess,(function(e){En(mo)})),this.pdfViewer.addEventListener(yo.changeViewModeSuccess,(function(e,t){En(mo)})),this.pdfViewer.addEventListener(yo.fitWidthResizeViewport,(function(){En(mo)})))}},{key:"start",value:function(e,t){var n=this;En(mo);var i=r(a(o.prototype),"start",this).call(this,e,t,"Distance");return this.pdfViewer.eventEmitter.emit(yo.distanceAnnotCreationStart,i),this.unsubscribeMeasurementData=this.pdfViewer.getStore().subscribe("measurementData",(function(e){var t=Rn(n.pdfViewer),a=Ct(e.displayUnit.name)?n.pdfViewer.i18n.t("measurement.units.".concat(e.displayUnit.name)):e.displayUnit.name;i.setContent(t+Math.round(100*e.distance)/100+" "+a),i.draw()})),i}},{key:"adjust",value:function(e,t){var n=this;this.executor.exec((function(){return n.getSnappedPoint(t).then((function(i){xo(t,i)?n.snappedPointAssistant.hide():(n.snappedPointAssistant.setPosition(i.x,i.y),n.snappedPointAssistant.show(i.type)),n.pdfViewer.eventEmitter.emit(yo.updateDistanceAnnot,e),e.setEndPoint(i),e.draw()}))}))}},{key:"end",value:function(){var e=this;this.fakeAnnotation&&this.fakeAnnotation.annotationInfo.content&&(this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData(),this.executor.waitForLastTask().then((function(){xn(e.pdfViewer).markup?(e.fakeAnnotation.annotationInfo.measure=e.getMeasurementInfo(),e.pdfViewer.eventEmitter.emit(yo.distanceAnnotCreationEnd,e.fakeAnnotation),r(a(o.prototype),"end",e).call(e)):(e.fakeAnnotation.renderer.setMarkUp(e.pageRender.scale,e.pageRender.rotate),mo.push(e.fakeAnnotation));return Promise.resolve()})))}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.getIoC().getInstanceByClass(Ui).creatingEnd(),this.executor.cancel(),this.pdfViewer.eventEmitter.emit(yo.distanceAnnotCreationCancel,this.fakeAnnotation),r(a(o.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}},{key:"destroyPageHandler",value:function(){this.isEnd||this.cancel(),this.creatingContextmenu&&this.creatingContextmenu.destroy(),this.destroyPageHooks&&this.destroyPageHooks.forEach((function(e){return e()})),En(mo),r(a(o.prototype),"destroyPageHandler",this).call(this)}}],[{key:"getStateName",value:function(){return"createDistance"}}]),o}(mi),To=function(e){l(i,e);var n=g(i);function i(e,a){var r;return t(this,i),(r=n.call(this,e,a,"create-measurement-status")).target=a,r}return i}(Bi),Co=S.stateHandler.CreateMeasurementService,Po=[],_o=S.ViewerEvents,Io=(S.DeviceInfo.isTouchDevice,S.Consts),Do=Io.LineEndingStyle,Mo=Io.Intents,Vo=Io.CREATING_MEASUREMENT_CONTEXTMENU,Lo=(S.shared.ThrottleAsyncTaskExecutor,function(e){l(o,e);var n=g(o);function o(e){var i;return t(this,o),(i=n.call(this,e)).isEnd=!0,i}return i(o,[{key:"createInteractionTool",value:function(e){return new To(this.pdfViewer,e)}},{key:"getMeasurementInfo",value:function(){var e=this.pdfViewer.getIoC().getInstanceByClass(Co).getMeasurementInfo();return{unit:e[fo].name,ratio:{userSpaceValue:e[ho],userSpaceUnit:e[uo].name,realValue:e[po],realUnit:e[fo].name}}}},{key:"createAnnotJson",value:function(e){var t=this.pdfViewer.getDefaultAnnotConfig()("polyline",Mo.POLYLINE_DIMENSION);return e.intent=Mo.POLYLINE_DIMENSION,e.startStyle=Do.OpenArrow,e.endStyle=Do.OpenArrow,e.enableCaption=!0,e.measure=this.getMeasurementInfo(),e.subject=this.pdfViewer.i18n.t("viewer_:annotSubjects.Perimeter"),this.pageRender&&(e.rotation=((90*this.pageRender.page.getRotation()+this.pageRender.getRotation())%360+360)%360),Object.assign(e,t)}},{key:"pageHandler",value:function(e){var t,n=this;r(a(o.prototype),"pageHandler",this).call(this,e),this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(Vo,e.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.complete"),callback:function(){n.interaction.unlock(),n.interaction.emit("end",t)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.cancel"),callback:function(){n.interaction.unlock(),n.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu,this.interaction.on("start",(function(){n.isEnd=!1,n.contextmenu.enable(),n.completeMenuItem.disable(),En(Po),n.pdfViewer.eventEmitter.emit(_o.perimeterAnnotCreationStart,n.fakeAnnotation)})),this.interaction.on("end",(function(){})),this.interaction.on("cancel",(function(){n.contextmenu.disable()})),this.interaction.on("move",(function(e){t=e})),this.contextmenu.onHidden((function(){n.interaction.unlock()})),this.contextmenu.onShown((function(){n.interaction.lock(),n.fakeAnnotation.getVertexes().length>=3?n.completeMenuItem.enable():n.completeMenuItem.disable()})),this.destroyPageHooks.push(this.pdfViewer.addEventListener(_o.zoomToSuccess,(function(e){En(Po)})),this.pdfViewer.addEventListener(_o.changeViewModeSuccess,(function(e,t){En(Po)})),this.pdfViewer.addEventListener(_o.fitWidthResizeViewport,(function(){En(Po)})))}},{key:"create",value:function(e,t){var n=this,i=r(a(o.prototype),"create",this).call(this,e,t);return this.unsubscribeMeasurementData=this.pdfViewer.getStore().subscribe("measurementData",(function(e){var t=Rn(n.pdfViewer),a=Ct(e.displayUnit.name)?n.pdfViewer.i18n.t("measurement.units.".concat(e.displayUnit.name)):e.displayUnit.name;i.setContent(t+Math.round(100*e.perimeter)/100+" "+a),i.draw()})),i}},{key:"adjust",value:function(e,t){t=this.autoAdsorbToStartPoint(e,t)[1],e.setLastPoint(t.deviceX,t.deviceY),this.pdfViewer.eventEmitter.emit(_o.updateDistanceAnnot,e),e.draw()}},{key:"canBeCompleted",value:function(e){if(!e)return!1;var t=e.getVertexes();if(0==t.length)return!1;var n=e.getLastPoint();return!(1==t.length&&n&&Math.abs(t[0].x-n.x)<Number.EPSILON&&Math.abs(t[0].y-n.y)<Number.EPSILON)}},{key:"end",value:function(e,t){if(this.fakeAnnotation){if(this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData(),this.fakeAnnotation.getVertexes().length<2)return-1;if(t=this.autoAdsorbToStartPoint(e,t)[1],this.isEnd=!0,this.contextmenu.disable(),xn(this.pdfViewer).markup)this.fakeAnnotation.annotationInfo.measure=this.getMeasurementInfo(),this.pdfViewer.eventEmitter.emit(_o.distanceAnnotCreationEnd,this.fakeAnnotation),e.annotationInfo.measure=this.fakeAnnotation.annotationInfo.measure,r(a(o.prototype),"end",this).call(this,e,t);else this.fakeAnnotation.renderer.setMarkUp(this.pageRender.scale,this.pageRender.rotate),Po.push(this.fakeAnnotation)}}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(_o.distanceAnnotCreationCancel,this.fakeAnnotation),r(a(o.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}},{key:"destroyPageHandler",value:function(){this.isEnd||this.cancel(),En(Po),r(a(o.prototype),"destroyPageHandler",this).call(this)}},{key:"autoAdsorbToStartPoint",value:function(e,t){var n=!1,i=e.deviceVertexes;if(i.length>2){var a=i[0],r=Math.abs(t.deviceX-a.x),o=Math.abs(t.deviceY-a.y),s=Math.max(r,o);s*s<200&&(n=!0,t={deviceX:a.x,deviceY:a.y})}return[n,t]}},{key:"addPoint",value:function(e,t){var n=this.autoAdsorbToStartPoint(e,t);if(n[0])return this.interaction.cancel(),this.interaction.unlock(),this.interaction.lastMoveData=null,void this.end(e,n[1]);r(a(o.prototype),"addPoint",this).call(this,e,t)}}],[{key:"getStateName",value:function(){return"createPerimeter"}}]),o}(Ia)),Ho=function(e){l(i,e);var n=g(i);function i(e,a){var r;return t(this,i),(r=n.call(this,e,a,"create-measurement-status")).target=a,r}return i}(Bi),No=S.stateHandler.CreateMeasurementService,Oo=[],Fo=S.ViewerEvents,jo=S.Consts,Bo=jo.Intents,Uo=jo.CREATING_MEASUREMENT_CONTEXTMENU,Xo=jo.DISTANCE_TOLERANCE,Yo=jo.POINT_TOLERANCE;function $o(e,t){return e.x===t.x&&e.y===t.y}function zo(e,t){return e.x*t.y-e.y*t.x}function Go(e,t,n,i){var a=zo({x:i.x-n.x,y:i.y-n.y},{x:e.x-n.x,y:e.y-n.y}),r=zo({x:i.x-n.x,y:i.y-n.y},{x:t.x-n.x,y:t.y-n.y}),o=zo({x:t.x-e.x,y:t.y-e.y},{x:n.x-e.x,y:n.y-e.y}),s=zo({x:t.x-e.x,y:t.y-e.y},{x:i.x-e.x,y:i.y-e.y});return(a>0&&r<0||a<0&&r>0)&&(o>0&&s<0||o<0&&s>0)||!!(0===a&&$o(e,n)||0===r&&$o(e,i)||0===o&&$o(t,n)||0===s&&$o(t,i))}var qo=function(e){l(o,e);var n=g(o);function o(e){var i;return t(this,o),(i=n.call(this,e)).isEnd=!0,i}return i(o,[{key:"createInteractionTool",value:function(e){return new Ho(this.pdfViewer,e)}},{key:"getMeasurementInfo",value:function(){var e=this.pdfViewer.getIoC().getInstanceByClass(No).getMeasurementInfo();return{unit:e[fo].name,ratio:{userSpaceValue:e[ho],userSpaceUnit:e[uo].name,realValue:e[po],realUnit:e[fo].name}}}},{key:"createAnnotJson",value:function(e){var t=this.pdfViewer.getDefaultAnnotConfig()("polygon",Bo.POLYGON_DIMENSION);return e.enableCaption=!0,e.intent=Bo.POLYGON_DIMENSION,e.measure=this.getMeasurementInfo(),e.subject=this.pdfViewer.i18n.t("viewer_:annotSubjects.Area"),Object.assign(e,t)}},{key:"pageHandler",value:function(e){var t,n=this;r(a(o.prototype),"pageHandler",this).call(this,e),this.destroyPageHooks=[],this.contextmenu=this.pdfViewer.viewerUI.createContextMenu(Uo,e.$handler.get(0),{selector:".fv__pdf-page-handler-container",items:{complete:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.complete"),callback:function(){n.interaction.unlock(),n.interaction.emit("end",t)}},cancel:{name:this.pdfViewer.i18n.t("viewer_:contextmenu.measurement.cancel"),callback:function(){n.interaction.unlock(),n.interaction.emit("cancel")}}}}),this.contextmenu.disable(),this.completeMenuItem=this.contextmenu.getItem("complete"),this.completeMenuItem.disable(),this.creatingContextmenu=this.contextmenu,this.interaction.on("start",(function(){n.isEnd=!1,n.contextmenu.enable(),n.completeMenuItem.disable(),En(Oo)})),this.interaction.on("end",(function(){})),this.interaction.on("cancel",(function(){n.contextmenu.disable()})),this.interaction.on("move",(function(e){t=e,n.fakeAnnotation&&n.fakeAnnotation.renderer&&(n.fakeAnnotation.renderer.closing=!0)})),this.contextmenu.onHidden((function(){n.interaction.unlock()})),this.contextmenu.onShown((function(){n.interaction.lock(),n.fakeAnnotation.getVertexes().length>=2?n.completeMenuItem.enable():n.completeMenuItem.disable()})),this.destroyPageHooks.push(this.pdfViewer.addEventListener(Fo.zoomToSuccess,(function(e){En(Oo)})),this.pdfViewer.addEventListener(Fo.changeViewModeSuccess,(function(e,t){En(Oo)})),this.pdfViewer.addEventListener(Fo.fitWidthResizeViewport,(function(){En(Oo)})))}},{key:"create",value:function(e,t){var n=this,i=r(a(o.prototype),"create",this).call(this,e,t);return this.unsubscribeMeasurementData=this.pdfViewer.getStore().subscribe("measurementData",(function(e){var t=Rn(n.pdfViewer),a=n.pdfViewer.i18n.t("measurement.units.".concat(e.displayUnit.name));i.setContent(t+Math.round(100*e.area)/100+" sq "+a),i.draw()})),i}},{key:"isPointClosely",value:function(e,t,n){return Math.abs(e.x-t.x)<n&&Math.abs(e.y-t.y)<n}},{key:"pointDistance",value:function(e,t){var n=t.x-e.x,i=t.y-e.y,a=Math.abs(n),r=Math.abs(i);return Math.sqrt(a*a+r*r)}},{key:"isPointOnLine",value:function(e,t,n){if(this.isPointClosely(e,t,Number.EPSILON)||this.isPointClosely(e,n,Number.EPSILON))return!0;var i=this.pointDistance(e,t),a=this.pointDistance(e,n),r=this.pointDistance(t,n);return Math.abs(i+a-r)<Yo}},{key:"checkLineCrossed",value:function(e,t,n,i){var a,r;if(a=Math.abs(t.x-e.x)<1e-4?Number.POSITIVE_INFINITY:(t.y-e.y)/(t.x-e.x),r=Math.abs(i.x-n.x)<1e-4?Number.POSITIVE_INFINITY:(i.y-n.y)/(i.x-n.x),Number.isFinite(a)&&Number.isFinite(r)&&Math.abs(a-r)<.01||!Number.isFinite(a)&&!Number.isFinite(r))return!(!this.isPointOnLine(e,n,i)&&!this.isPointOnLine(t,n,i));var o,s,c=e.x>t.x?t.x:e.x,l=e.x>t.x?e.x:t.x,u=n.x>i.x?i.x:n.x,d=n.x>i.x?n.x:i.x;if(Number.isFinite(a)){if(Number.isFinite(r))return!((o=(a*e.x-e.y-r*n.x+n.y)/(a-r))<c-Yo||o>l+Yo)&&(!(o<u-Yo||o>d+Yo)&&(s=a*(o-e.x)+e.y,!0));s=a*((o=u)-e.x)+e.y;var h=n.y<i.y?n.y:i.y,f=n.y<i.y?i.y:n.y;return h-Yo<=s&&s<=f+Yo&&c-Yo<=o&&o<=l+Yo}s=r*((o=c)-n.x)+n.y;var p=e.y<t.y?e.y:t.y,v=e.y<t.y?t.y:e.y;return p-Yo<=s&&s<=v+Yo&&u-Yo<=o&&o<=d+Yo}},{key:"checkIfPointAllowAdded",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.length<1&&!n)return!0;if(2==e.length&&!n)return!this.isPointOnLine(t,e[0],e[1]);var i=function(e,t){for(var n=0;n<e.length-2;n++)if(Go(e[n],e[(n+1)%e.length],t,e[e.length-1]))return"disableAdd";for(var i=1;i<e.length-1;i++)if(Go(e[i],e[(i+1)%e.length],t,e[0]))return"noClosing";return"success"}(e,t);return"success"==i?(this.fakeAnnotation.setFlag(!0,!0),!0):"noClosing"==i&&!n&&(this.fakeAnnotation.setFlag(!1,!1),!0)}},{key:"addPoint",value:function(e,t){var n=t.deviceX,i=t.deviceY,a=w(e.page.reverseDevicePoint([n,i],e.scale,e.rotate),2),r=a[0],o=a[1],s=this.pageRender.$handler;if(this.checkIfPointAllowAdded(e.getVertexes(),{x:r,y:o})){s.removeClass("fv__cursor-disable");var c=e.getVertexes();if(c.length>2&&this.isPointClosely(c[0],{x:r,y:o},Xo)){var l=c[c.length-1],u=w(e.page.getDevicePoint([l.x,l.y],e.scale,e.rotate),2),d=u[0],h=u[1],f=e.pageRender.$handler[0].getBoundingClientRect();return this.interaction.lastMoveData={clientX:d+f.left,clientY:h+f.top},void this.pdfViewer.getStore().dispatch("create-measurement-status","complete")}e.addPoint(n,i),e.draw()}else s.addClass("fv__cursor-disable")}},{key:"adjust",value:function(e,t){var n=w(e.page.reverseDevicePoint([t.deviceX,t.deviceY],e.scale,e.rotate),2),i=n[0],a=n[1],r=this.pageRender.$handler;this.checkIfPointAllowAdded(e.getVertexes(),{x:i,y:a})?(r.removeClass("fv__cursor-disable"),e.setLastPoint(t.deviceX,t.deviceY),e.draw(),this.pdfViewer.eventEmitter.emit(Fo.updateDistanceAnnot,e)):r.addClass("fv__cursor-disable")}},{key:"end",value:function(e,t){if(this.fakeAnnotation){this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData();var n=aa(e.getVertexes()).slice(0);if(0!=n.length){if(null!=t){var i=w(e.page.reverseDevicePoint([t.deviceX,t.deviceY],e.scale,e.rotate),2),s=i[0],c=i[1],l=this.pageRender.$handler;if(!this.checkIfPointAllowAdded(n,{x:s,y:c},!0))return l.addClass("fv__cursor-disable"),-1;l.removeClass("fv__cursor-disable"),this.isPointClosely(n[n.length-1],{x:s,y:c},Xo)?t=null:n.push({x:s,y:c})}if(this.isEnd=!0,this.contextmenu.disable(),xn(this.pdfViewer).markup){this.fakeAnnotation.annotationInfo.measure=this.getMeasurementInfo(),this.pdfViewer.eventEmitter.emit(Fo.distanceAnnotCreationEnd,this.fakeAnnotation);var u=this.pdfViewer.getStore().getCurrentValue("measurementData");if(u){var d=Rn(this.pdfViewer),h=this.pdfViewer.i18n.t("measurement.units.".concat(u.displayUnit.name));e.setContent(d+Math.round(100*u.area)/100+" sq "+h)}e.annotationInfo.measure=this.fakeAnnotation.annotationInfo.measure,r(a(o.prototype),"end",this).call(this,e,t)}else{this.fakeAnnotation.renderer.setMarkUp(this.pageRender.scale,this.pageRender.rotate),Oo.push(this.fakeAnnotation)}}}}},{key:"cancel",value:function(){this.fakeAnnotation&&(this.pdfViewer.eventEmitter.emit(Fo.distanceAnnotCreationCancel,this.fakeAnnotation),r(a(o.prototype),"cancel",this).call(this),this.creatingContextmenu&&this.creatingContextmenu.disable())}},{key:"destroyPageHandler",value:function(){this.isEnd||this.cancel(),En(Oo),r(a(o.prototype),"destroyPageHandler",this).call(this)}}],[{key:"getStateName",value:function(){return"createArea"}}]),o}(ka),Wo=S.stateHandler.CreateMeasurementService,Jo=[],Ko=S.ViewerEvents,Zo=S.Consts.Intents,Qo=function(e){l(o,e);var n=g(o);function o(e){var i;return t(this,o),(i=n.call(this,e)).isEnd=!0,i}return i(o,[{key:"start",value:function(e){var t=this,n={flags:4,subject:this.getSubject()};this.currentFakeAnnot=new Pn({pdfViewer:this.pdfViewer,pageRender:this.pageRender,info:this.createAnnotJson(n)});var i=e.left,a=e.top;this.currentFakeAnnot.setRect({left:i,top:a,right:i+10,bottom:a-10}),this.pdfViewer.eventEmitter.emit(Ko.distanceAnnotCreationStart,this.currentFakeAnnot),this.unsubscribeMeasurementData=this.pdfViewer.getStore().subscribe("measurementData",(function(e){var n=Rn(t.pdfViewer),i=Ct(e.displayUnit.name)?t.pdfViewer.i18n.t("measurement.units.".concat(e.displayUnit.name)):e.displayUnit.name;e.area&&t.currentFakeAnnot.setContent(n+e.area.toFixed(2)+" sq "+i),t.currentFakeAnnot.draw()})),En(Jo)}},{key:"adjust",value:function(e,t,n){r(a(o.prototype),"adjust",this).call(this,e,t,n),this.pdfViewer.eventEmitter.emit(Ko.updateDistanceAnnot,e)}},{key:"end",value:function(e,t,n){this.unsubscribeMeasurementData&&this.unsubscribeMeasurementData(),xn(this.pdfViewer).markup?(e.annotationInfo.measure=this.getMeasurementInfo(),this.pdfViewer.eventEmitter.emit(Ko.distanceAnnotCreationEnd,e),r(a(o.prototype),"end",this).call(this,e,t,n)):Jo.push(e)}},{key:"getMeasurementInfo",value:function(){var e=this.pdfViewer.getIoC().getInstanceByClass(Wo).getMeasurementInfo();return{unit:e[fo].name,ratio:{userSpaceValue:e[ho],userSpaceUnit:e[uo].name,realValue:e[po],realUnit:e[fo].name}}}},{key:"createAnnotJson",value:function(e){var t=this.pdfViewer.getDefaultAnnotConfig()("circle",Zo.CIRCLE_DIMENSION);return e.enableCaption=!0,e.intent=Zo.CIRCLE_DIMENSION,e.measure=this.getMeasurementInfo(),this.pageRender&&(e.rotation=((90*this.pageRender.page.getRotation()+this.pageRender.getRotation())%360+360)%360),Object.assign(e,t)}},{key:"pageHandler",value:function(e){r(a(o.prototype),"pageHandler",this).call(this,e),this.destroyPageHooks=[],this.destroyPageHooks.push(this.pdfViewer.addEventListener(Ko.zoomToSuccess,(function(e){En(Jo)})),this.pdfViewer.addEventListener(Ko.changeViewModeSuccess,(function(e,t){En(Jo)})),this.pdfViewer.addEventListener(Ko.fitWidthResizeViewport,(function(){En(Jo)})))}},{key:"destroyPageHandler",value:function(){r(a(o.prototype),"destroyPageHandler",this).call(this),En(Jo)}}],[{key:"getStateName",value:function(){return"createCircleArea"}}]),o}(Un),es=function(){function e(){t(this,e),Ue(this,"pdfViewer",void 0)}return i(e,[{key:"getInternalStampService",value:function(){var e;return null===(e=this.pdfViewer)||void 0===e?void 0:e.getIoC().getInstanceByClass(Or)}},{key:"getCurrentStampInfo",value:function(){if(this.pdfViewer.getStateHandlerManager().getCurrentStates()===Wr){var e=this.getInternalStampService().getCurrentStampConfig();return e?{category:e.category,iconName:e.name,width:e.width,height:e.height,url:e.url,fileType:e.fileType}:void 0}}},{key:"onSelectStampInfo",value:function(e){var t=this;return this.getInternalStampService().onSwitchStamp((function(){e(t.getCurrentStampInfo())}))}}],[{key:"inject",value:function(){return{pdfViewer:S.PDFViewer}}}]),e}(),ts=function(){function e(n){t(this,e),this.pdfViewer=n}return i(e,[{key:"getStampService",value:function(){return this.pdfViewer.getIoC().getInstanceByClass(es)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.showReplyDialog,n=e.hideReplyDialog,i=e.showPopup,a=e.hidePopup,r=e.showPropertiesDialog,o=e.hidePropertiesDialog,s=e.contextMenuIsEnable,c=this.pdfViewer.getStateHandlerManager();c.register(_),c.register($),c.register(G),c.register(W),c.register(K),c.register(te),c.register(me),c.register(Fe),c.register(et),c.register(st),c.register(jn),c.register(Un),c.register(mi),c.register(Ai),c.register(ka),c.register(Ia),c.register(Ua),c.register(Ja),c.register(hr),c.register(_r),c.register(Wr),c.register(co),c.register(Eo),c.register(Lo),c.register(qo),c.register(Qo),(t||n||i||a||r||o||s)&&this._overwriteAnnot(t,n,i,a,r,o,s)}},{key:"_overwriteAnnot",value:function(e,n,o,s,c,u,d){this.pdfViewer.getAnnotManager().registerMatchRule((function(h,p){return h.isMarkup()?function(h){l(v,h);var p=g(v);function v(){return t(this,v),p.apply(this,arguments)}return i(v,[{key:"showReplyDialog",value:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var o;return e?e.bind(this).apply(this,f(n)):(o=r(a(v.prototype),"showReplyDialog",this)).call.apply(o,[this].concat(f(n)))}},{key:"hideReplyDialog",value:function(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];if(!n){var s;if(e)return;return(s=r(a(v.prototype),"hideReplyDialog",this)).call.apply(s,[this].concat(f(i)))}return n.bind(this).apply(this,f(i))}},{key:"showPopup",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i;return o?o.bind(this).apply(this,f(t)):(i=r(a(v.prototype),"showPopup",this)).call.apply(i,[this].concat(f(t)))}},{key:"hidePopup",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!s){var i;if(o)return;return(i=r(a(v.prototype),"hidePopup",this)).call.apply(i,[this].concat(f(t)))}return s.bind(this).apply(this,f(t))}},{key:"showPropertiesDialog",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i;return c?c.bind(this).apply(this,f(t)):(i=r(a(v.prototype),"showPropertiesDialog",this)).call.apply(i,[this].concat(f(t)))}},{key:"hidePropertiesDialog",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(!u){var i;if(c)return;return(i=r(a(v.prototype),"hidePropertiesDialog",this)).call.apply(i,[this].concat(f(t)))}return u.bind(this).apply(this,f(t))}},{key:"contextMenuIsEnable",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i;return d?d.bind(this).apply(this,f(t)):(i=r(a(v.prototype),"contextMenuIsEnable",this)).call.apply(i,[this].concat(f(t)))}}]),v}(p):p}))}}]),e}()})(),s})()));