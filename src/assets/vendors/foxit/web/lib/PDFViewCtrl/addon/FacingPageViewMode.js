!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("PDFViewCtrl"),require("PDFViewCtrl").commons):"function"==typeof define&&define.amd?define(["PDFViewCtrl",["PDFViewCtrl","commons"]],t):"object"==typeof exports?exports.FacingPageViewMode=t(require("PDFViewCtrl"),require("PDFViewCtrl").commons):e.FacingPageViewMode=t(e.PDFViewCtrl,e.PDFViewCtrl.commons)}(self,((e,t)=>(()=>{"use strict";var r={778:t=>{t.exports=e},457:e=>{e.exports=t}},i={};function n(e){var t=i[e];if(void 0!==t)return t.exports;var o=i[e]={exports:{}};return r[e](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o={};return(()=>{function e(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function t(e,r){return null!=r&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](e):t(e,r)}function r(e,r){if(!t(e,r))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function a(e,t,r){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r||e):n.value}},a(e,t,r||e)}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function u(t,r){return!r||"object"!=((i=r)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof r?e(t):r;var i}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=s(e);if(t){var n=s(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return u(this,r)}}n.d(o,{default:()=>b});var h=n(457),g=n(778),f=function(e){l(i,e);var t=d(i);function i(){return r(this,i),t.apply(this,arguments)}return i}(g.viewMode.UsualViewModeShortcutHandler),p=g.ViewerEvents,v=g.vendors,m=g.shared,w=g.viewMode,y=v.jQuery,P=m.keyboardStatus,R=2,x=10,b=function(t){l(g,t);var n,o,c,u=d(g);function g(t){var i;r(this,g),i=u.call(this,t);var n=t.pdfViewer.store;return i.multipage=n.getCurrentValue("multipage-"+i.constructor.getName(),R),i.pageSpacing=n.getCurrentValue("pageSpacing-"+i.constructor.getName(),x),i.isMouseDown=!1,i.isScroll=!1,i.isWheel=!1,i.isMoveToBottom=!1,i.isMoveToTop=!1,i.wheel=i.wheel.bind(e(i)),i.mouseDown=i.mouseDown.bind(e(i)),i.mouseUp=i.mouseUp.bind(e(i)),i.adjust=i.adjust.bind(e(i)),i.keyup=i.keyup.bind(e(i)),i.isJump=!1,i.scrollCurrentPageIntoView_debounced=S(20,(function(){i.scrollCurrentPageIntoView()})),i}return n=g,c=[{key:"getName",value:function(){return"facing-page-view-mode"}},{key:"setMultipage",value:function(e){R=e}},{key:"getMultipage",value:function(){return R}},{key:"setPageSpacing",value:function(e){x=e}},{key:"getPageSpacing",value:function(){return x}}],(o=[{key:"getJQItems",value:function(){return y(this.getItems())}},{key:"scrollCurrentPageIntoView",value:function(){if(this.docRender){var e=this.docRender.getCurrentPageIndex(),t=this.docRender.getPDFPageRender(e);t&&!t.pageAreaIsVisible&&t.$ui.get(0).scrollIntoViewIfNeeded(!0)}}},{key:"into",value:function(e,t){var r=this;a(s(g.prototype),"into",this).call(this,e,t);var i=this.constructor.getName(),n=["<style>","."+i+" {","overflow:hidden;","margin:0 auto;","display: flex;","flex-wrap: wrap;","}","."+i+".facing-cover-continuous-view-mode::before {",'content: "";',"width: calc("+100/this.multipage+"%);","}","."+i+"::after {",'content: "";',"width: -webkit-fill-available;","}","."+i+" .fv__pdf-view-mode-item {","display: -webkit-box;","display: -ms-flexbox;","display: -webkit-flex;","display: flex;","-ms-flex-pack: center;","-ms-flex-align: center;","-ms-justify-content: flex-end;","-webkit-justify-content: flex-end;","justify-content: flex-end;","align-items: center;","margin-left: 0;","}","."+i+" .fv__pdf-view-mode-item {","margin-right: "+this.pageSpacing+"px;","}","."+i+" .fv__pdf-page-layout {","width: 100%;","}","\n            .".concat(i," .fv__pdf-view-mode-item:nth-child(2n+1)>.fv__pdf-page-layout{\n                margin-left: auto;\n                margin-right: 0;\n            }\n            .").concat(i," .fv__pdf-view-mode-item:nth-child(2n)>.fv__pdf-page-layout{\n                margin-left: 0;\n                margin-right: auto;\n            }\n            "),"</style>"].join("");this.$style=y(n),this.docRender.$container.after(this.$style),this.docRender.$container.addClass(this.constructor.getName());var o=this.docRender.viewerRender.scrollWrap;this.scrollHost=o.getScrollHost(),this.currentScrollTop=o.getScrollTop(),this.initPageLayout(),this.bindScrollEvent(),this.wheelHandler=S(200,this.wheel),this.scrollHost.addEventListener("wheel",this.wheelHandler),this.scrollHost.addEventListener("mousedown",this.mouseDown),window.addEventListener("mouseup",this.mouseUp),window.addEventListener("keyup",this.keyup),this.docRender.pdfViewer.eventEmitter.on(p.zoomToSuccess,this.adjust);var c=this.docRender.getCurrentPageIndex();this.onPageNumberChange=function(e){try{if(c===e)return;r.scrollCurrentPageIntoView_debounced()}finally{c=e}},this.docRender.pdfViewer.eventEmitter.on(p.pageNumberChange,this.onPageNumberChange);var l=this.hammer=new Hammer.Manager(this.scrollHost,{recognizers:[[Hammer.Pan,{direction:Hammer.DIRECTION_ALL}]]}),u=!1;l.on("panstart",(function(e){var t=e.srcEvent.target;u=!t.closest(".fv__pdf-page-annot-handler-container")&&!t.closest(".fv__pdf-form-designer-container")})),l.on("panend",(function(e){if(u&&"hand"===r.docRender.pdfViewer.getStateHandlerManager().getCurrentStates().getStateName())return e&&8===e.direction&&(r.isMoveToBottom=!0),e&&16===e.direction&&(r.isMoveToTop=!0),e&&1===e.direction&&(e.deltaY>0?r.isMoveToTop=!0:r.isMoveToBottom=!0),r.isNeedAdjust=!0,r.adjust(),!1}))}},{key:"bindScrollEvent",value:function(){var e=this;if(this._unwatchScrollEvent&&this._unwatchScrollEvent(),this.docRender){var t=this.docRender.viewerRender.scrollWrap,r=!1,i=S(150,(function(t){r||e.isMouseDown||e.isWheel||!e.isScroll||(e.scroll(t),e.isWheel=!1)})),n=t.addScrollEventListener((function(){P.isCtrlDown||(e.isScroll=!0,i(t.getScrollTop()-e.currentScrollTop),e.currentScrollTop=t.getScrollTop(),clearTimeout(e.scrollEventTimer),e.scrollEventTimer=setTimeout((function(){if(!r){e.isScroll=!1;var t=e.docRender;if(t){var i=e.docRender.pagesRender;i&&i.renderVisiblePages().then((function(){r||(e.getCurrentPageIndex(),t.isGoto?setTimeout((function(){t.isGoto=!1}),40):t.setCurrentPageIndex(e.getCurrentPageIndex()),e.isNeedAdjust&&!e.isJump&&e.adjust(),e.isJump=!1)})).catch((function(){}))}}}),100))}));this._unwatchScrollEvent=function(){e._unwatchScrollEvent=function(){},r=!0,n()}}}},{key:"initPageLayout",value:function(){for(var e=this.getJQItems(),t=this.multipage,r=0;r<e.length;r++)e.eq(r).css({width:"calc("+100/t+"% - var(--facing-margin))"})}},{key:"keyup",value:function(e){var t=this;this.reset();var r=e.keyCode;r!==h.KeyCodes.PageDown&&r!==h.KeyCodes.DownArrow||(this.isMoveToBottom=!0),r!==h.KeyCodes.UpArrow&&r!==h.KeyCodes.PageUp||(this.isMoveToTop=!0),r===h.KeyCodes.PageUp||r===h.KeyCodes.PageDown?setTimeout((function(){t.isNeedAdjust=!0}),50):r!==h.KeyCodes.UpArrow&&r!==h.KeyCodes.DownArrow||(this.isNeedAdjust=!0)}},{key:"wheel",value:function(e){if(!P.isCtrlDown&&this.docRender&&!P.isShiftDown){this.isWheel=!0;var t=this.docRender.viewerRender.scrollWrap;if(this.currentPageIndex=this.getCurrentPageIndex(),t.getHeight(),t.getScrollLeft(),this.getJQItems().eq(this.currentPageIndex).children(".fv__pdf-page-layout").height(),this.getVisibleIndexes().length>2)if(e.deltaY>0){var r=this.docRender.doc.getPageCount(),i=this.currentPageIndex+this.multipage;this.goToPage(Math.min(i,r-1))}else{var n=this.currentPageIndex-this.multipage;n<=0&&(n=0),this.goToPage(n)}}}},{key:"mouseDown",value:function(e){this.isMouseDown=!0,this.startPointY=e.screenY;var t=this.docRender.viewerRender.scrollWrap.getScrollHost(),r=y(t).offset(),i=r.top,n=r.left,o=n+t.clientWidth,s=i+t.clientHeight;this.dragging=!0;var a=e.clientX,c=e.clientY;this.scrollType=n<=a&&a<=o&&i<=c&&c<=s?0:o<a&&i<c?1:2}},{key:"mouseUp",value:function(e){this.isMouseDown=!1,this.isNeedAdjust=!0}},{key:"goToPage",value:function(e,t){this.reset();var r=this.getJQItems(),i=r.get(e),n=r.eq(e),o=i.offsetHeight,s=(i.offsetWidth,parseInt(n.css("margin-top"))),a=this.docRender.viewerRender.scrollWrap,c=a.getHeight(),l=a.getScrollOffsetLeft(),u=i.offsetTop;u=t?n.position().top+o-c+s+s/2:n.position().top+s/2,a.scrollTo(l,u),a.disabled||this.scrollCurrentPageIntoView_debounced()}},{key:"adjust",value:function(){if(this.isWheel||this.isScroll||2===this.scrollType)return this.isWheel=!1;var e=this.getVisibleIndexes(),t=this.docRender.viewerRender.scrollWrap,r=(t.getScrollTop(),t.getScrollLeft(),this.scrollHost.clientHeight,this.getCurrentPageIndex());if(e.length>2)return this.isMoveToBottom&&(r=e[2]),this.isMoveToTop&&(r=e[0]),this.goToPage(r);this.reset()}},{key:"reset",value:function(){this.isMoveToBottom=!1,this.isMoveToTop=!1,this.isNeedAdjust=!1}},{key:"scroll",value:function(e){this.docRender.doc.getPageCount();var t=this.docRender.viewerRender.scrollWrap,r=(t.getScrollTop(),this.lastScrollTop,t.getScrollLeft(),this.scrollHost.clientHeight,this.currentPageIndex,this.getJQItems(),this.getVisibleIndexes());if(r.length>2){if(e>0){var i=r[2]||r[0];this.goToPage(i)}if(e<0){var n=r[0]||0;this.goToPage(n)}}}},{key:"fixMargin",value:function(e,t){var r=this.docRender.viewerRender.scrollWrap.getHeight(),i=this.multipage;this.docRender.pagesRender.$ui.css({width:"calc(".concat(e*i,"px + ").concat(i," * var(--facing-margin))")});var n=this.getJQItems();t<r?y(n).css({width:"calc("+100/i+"% - var(--facing-margin))",height:"calc("+r+"px - 1rem)"}):y(n).css({width:"calc("+100/i+"% - var(--facing-margin))",height:t})}},{key:"renderViewMode",value:function(e,t,r,i,n){var o=this;if(this.docRender){var s=e.index,a=this.getMaxPageWidth(),c=this.multipage;this.docRender.pagesRender.$ui.css({width:"calc(".concat(a*c*e.scale,"px + ").concat(c," * var(--facing-margin))")});for(var l=Math.floor(s/c),u=0,d=this.docRender.doc.getPageCount(),h=this.docRender.viewerRender.scrollWrap.getHeight(),g=[],f=this.docRender.getRotation(),p=0;p<c;p++){var v=l*c+p;v<d&&g.push(this.docRender.getPDFDoc().getPageByIndex(v).then((function(e){var t;t=90===f||270===f?e.getPxWidth():e.getPxHeight(),u=Math.max(t,u)})))}return Promise.all(g).then((function(){var e=o.getJQItems(),r=u*t;r<h?y(e[s]).css({width:"calc("+100/c+"% - var(--facing-margin))",height:"calc("+h+"px - 1rem)"}):y(e[s]).css({width:"calc("+100/c+"% - var(--facing-margin))",height:r})})).catch((function(e){}))}}},{key:"getMaxPageWidth",value:function(){var e=0,t=this.docRender.doc,r=this.docRender.getRotation(),i="width";90!==r&&270!==r||(i="height");var n=t.getPageSizesSync();for(var o in n){var s=4*n[o][i]/3;s>e&&(e=s)}return e}},{key:"jumpToPage",value:function(e,t){var r=this,i=t.x,n=void 0===i?0:i,o=t.y,s=void 0===o?0:o;this.isJump=!0,this.isWheel=!0;var a=this.getJQItems();e>=a.length?e=a.length-1:e<0&&(e=0);var c=a.eq(e),l=c.position().left+n,u=this.docRender.viewerRender.scrollWrap,d=u.getHeight(),h=a.get(e).offsetHeight,g=h/2;s>g&&(s=g);var f=c.position().top+s,p=parseInt(c.css("margin-top"));h<d&&(f=c.position().top+p/2),this._unwatchScrollEvent&&this._unwatchScrollEvent(),this.docRender.viewerRender.scrollWrap.scrollTo(l,f),this.currentJumpPageIndex=e,this.docRender.setCurrentPageIndex(e),u.disabled||this.scrollCurrentPageIntoView_debounced(),setTimeout((function(){r.bindScrollEvent()}))}},{key:"getFitHeight",value:function(e){var t=this.docRender.viewerRender.scrollWrap;return t.getHeight()-t.getScrollOffsetTop()}},{key:"getFitWidth",value:function(e){var t=this.getMaxPageWidth(),r=this.docRender.getRotation(),i="width";90!==r&&270!==r||(i="height");var n=this.docRender.viewerRender.scrollWrap,o=this.multipage,s=(n.getWidth()-16-o*this.pageSpacing)/o,a=this.docRender.doc.getPageSize(e);if(a)return s*a[i]*4/(3*t)}},{key:"out",value:function(){this.docRender.$container.removeClass(this.constructor.getName()),this.docRender.pagesRender.$ui.removeAttr("style"),this.$style&&this.$style.remove(),this._unwatchScrollEvent&&this._unwatchScrollEvent();for(var e=this.getJQItems(),t=0;t<e.length;t++)y(e[t]).css({width:"",height:""});this.scrollHost&&this.scrollHost.removeEventListener("wheel",this.wheelHandler),this.scrollHost&&this.scrollHost.removeEventListener("mousedown",this.mouseDown),window.removeEventListener("mouseup",this.mouseUp),window.removeEventListener("keyup",this.keyup),this.docRender.pdfViewer.eventEmitter.off(p.zoomToSuccess,this.adjust),this.docRender.pdfViewer.eventEmitter.off(p.pageNumberChange,this.onPageNumberChange),this.hammer.destroy(),a(s(g.prototype),"out",this).call(this)}},{key:"getCurrentPageIndex",value:function(){if(this.isJump)return this.currentJumpPageIndex;for(var e=this.getJQItems(),t=this.docRender.viewerRender.scrollWrap,r=t.getScrollTop(),i=r+t.getHeight(),n=t.getScrollLeft(),o=n+t.getWidth(),s=this.currentPageIndex,a=[],c=0;c<e.length;c++){var l=e[c],u=y(l).width(),d=y(l).height(),h=l.offsetTop,g=h+d,f=l.offsetLeft,p=f+u;if(f<=o&&p>=n&&g>=r&&h<=i){var v=Math.max(n,f),m=Math.min(o,p),w=Math.max(r,h),P=(m-v)*(Math.min(i,g)-w);a.push({index:c,areaSize:P})}}if(0===a.length)return s;var R=0;return a.forEach((function(e,t){e.areaSize>a[R].areaSize&&(R=t)})),a[R].index}},{key:"getNextPageIndex",value:function(){var e=this.docRender.doc.getPageCount(),t=this.getCurrentPageIndex();if(t<e-1){var r=this.docRender.viewerRender.scrollWrap,i=this.docRender.pagesRender.$ui.width(),n=r.getWidth()-16,o=this.multipage;n>=i?t=Math.ceil((t+1)/o)*o:t++}return t>e-1&&(t=e-1),t}},{key:"getPrevPageIndex",value:function(){var e=this.getCurrentPageIndex();if(e>0){var t=this.docRender.viewerRender.scrollWrap,r=this.docRender.pagesRender.$ui.width(),i=t.getWidth()-16,n=this.multipage;i>=r?e=(Math.ceil((e+1)/n)-2)*n:e--}return e<0&&(e=0),e}},{key:"generateShortcutEventHandler",value:function(){return new f(this)}}])&&i(n.prototype,o),c&&i(n,c),g}(w.IViewMode),S=function(e,t){var r;return function(){var i=this,n=arguments;clearTimeout(r),r=setTimeout((function(){t.apply(i,n)}),e)}}})(),o=o.default})()));