!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],e):"object"==typeof exports?exports.CustomDynamicStamp=e(require("UIExtension")):t.CustomDynamicStamp=e(t.UIExtension)}(self,(t=>(()=>{var e={642:(t,e,n)=>{n(779);t.exports=function(t){"use strict";t=t||{};return'<layer class="fv__ui-custom-dynamic-stamp-dialog" append-to="body" backdrop @var.self="$component" @controller="custom-dynamic-stamp:CreateCustomDynamicStampDialogController as cdsc" @isolate>\n<layer-header @draggable="{type: \'parent\'}" title="custom-dynamic-stamp:dialog.header"></layer-header>\n<layer-view class="fv__ui-custom-dynamic-stamp-dialog-body">\n<div class="fv__ui-custom-dynamic-stamp-preview d_f jc_c ai_c">\n<div class="fv__ui-custom-dynamic-stamp-preview-wrap d_f jc_c ai_c">\n<img class="fv__ui-custom-dynamic-stamp-preview-template" id="backgroundImage"/>\n<custom-dynamic-stamp:custom-dynamic-stamp-text name="dynamic-text"></custom-dynamic-stamp:custom-dynamic-stamp-text>\n</div>\n</div>\n<fieldset class="fv__ui-custom-dynamic-stamp-dialog-fieldset">\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<input name="templateType" type="radio" value="backgroundColor" @aria:labelledby="::nextSiblings()::first()" @on.native.change="self.selectType(\'backgroundColor\')"/>\n<label class="d_f ai_c f_1">\n<span class="w_128" data-i18n="custom-dynamic-stamp:dialog.backgroundColor"></span>\n<div class="color-picker" role="button" tabindex="0" name="backgroundColor" @aria:labelledby="::previousSiblings()" @on.native.click="self.selectColor($event)" @on.native.keydown="self.keydownColor($event)">\n<div>\n<div class="label">?</div>\n<div class="mask"></div>\n</div>\n</div>\n</label>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<input name="templateType" type="radio" value="template" @aria:labelledby="::nextSiblings()::first()" @on.native.change="self.selectType(\'template\')"/>\n<label class="d_f ai_c f_1">\n<label class="w_128" data-i18n="custom-dynamic-stamp:dialog.template"></label>\n<dropdown editable name="stamp-templates" class="f_1">\n<dropdown-button @foreach="item in cdsc.templateList" @sync.text="item.name" @on.click="cdsc.selectTemplate(item)"></dropdown-button>\n</dropdown>\n<div class="fv__ui-custom-dynamic-stamp-browseWrap">\n<input type="file" id="stamp-local-path" accept="image/jpg,image/jpeg,image/bmp,image/png" class="p_a" @on.native.change="self.inputFile($event)"/>\n<div class="fv__ui-dialog-ok-button fv__ui-button" id="browse" >custom-dynamic-stamp:dialog.browse</div>\n</div>\n</label>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.category"></label>\n<dropdown editable name="stamp-category" class="f_1">\n<dropdown-button @foreach="name in cdsc.categoryList" @sync.text="name" @on.click="cdsc.selectCategory(name)"></dropdown-button>\n</dropdown>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.name"></label>\n<input name="name" class="f_1 fv__ui-custom-dynamic-stamp-name" type="text" @model="cdsc.data.name"/>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.font"></label>\n<dropdown editable name="stamp-fontFamilies" id="fv__ui-fontFamilies" class="f_1">\n<dropdown-button @foreach="item in cdsc.fontFamilies" @sync.text="item.name" @on.click="cdsc.selectFontFamily(item)"></dropdown-button>\n</dropdown>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.stampText"></label>\n<dropdown editable name="stamp-text-type" class="f_1">\n<dropdown-button @foreach="item in cdsc.textType" @sync.text="item.type" @on.click="cdsc.selectTextType(item)"></dropdown-button>\n</dropdown>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field fv__ui-field-transforms d_f ai_c jc_sb">\n<div class="fv__ui-custom-dynamic-stamp-dialog-field-item d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.fontSize"></label>\n<dropdown editable name="fontSizeSelect" selected="0" selectable="false">\n<dropdown-button @foreach="size in cdsc.fontSizes" @sync.text="size" @on.click="cdsc.selectFontSize(size)"></dropdown-button>\n</dropdown>\n</dropdown>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-field-item fv__ui-color-pick d_f ai_c">\n<label class=" d_ib" data-i18n="custom-dynamic-stamp:dialog.color"></label>\n<div class="color-picker" role="button" tabindex="0" name="color" @aria:labelledby="::previousSiblings()"  @on.native.click="self.selectColor($event)" @on.native.keydown="self.keydownColor($event)">\n<div>\n<div class="label">?</div>\n<div class="mask"></div>\n</div>\n</div>\n</div>\n</div>\n\n</fieldset>\n</layer-view>\n<layer-toolbar class="fv__ui-custom-dynamic-stamp-dialog-footer d_f ai_c jc_fe">\n<xbutton class="fv__ui-dialog-ok-button" @on.native.click="cdsc.ok()">common-dialogs.ok</xbutton>\n<xbutton class="fv__ui-dialog-cancel-button" @on.click="self.cancel()">common-dialogs.cancel</xbutton>\n</layer-toolbar>\n</layer>','<layer class="fv__ui-custom-dynamic-stamp-dialog" append-to="body" backdrop @var.self="$component" @controller="custom-dynamic-stamp:CreateCustomDynamicStampDialogController as cdsc" @isolate>\n<layer-header @draggable="{type: \'parent\'}" title="custom-dynamic-stamp:dialog.header"></layer-header>\n<layer-view class="fv__ui-custom-dynamic-stamp-dialog-body">\n<div class="fv__ui-custom-dynamic-stamp-preview d_f jc_c ai_c">\n<div class="fv__ui-custom-dynamic-stamp-preview-wrap d_f jc_c ai_c">\n<img class="fv__ui-custom-dynamic-stamp-preview-template" id="backgroundImage"/>\n<custom-dynamic-stamp:custom-dynamic-stamp-text name="dynamic-text"></custom-dynamic-stamp:custom-dynamic-stamp-text>\n</div>\n</div>\n<fieldset class="fv__ui-custom-dynamic-stamp-dialog-fieldset">\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<input name="templateType" type="radio" value="backgroundColor" @aria:labelledby="::nextSiblings()::first()" @on.native.change="self.selectType(\'backgroundColor\')"/>\n<label class="d_f ai_c f_1">\n<span class="w_128" data-i18n="custom-dynamic-stamp:dialog.backgroundColor"></span>\n<div class="color-picker" role="button" tabindex="0" name="backgroundColor" @aria:labelledby="::previousSiblings()" @on.native.click="self.selectColor($event)" @on.native.keydown="self.keydownColor($event)">\n<div>\n<div class="label">?</div>\n<div class="mask"></div>\n</div>\n</div>\n</label>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<input name="templateType" type="radio" value="template" @aria:labelledby="::nextSiblings()::first()" @on.native.change="self.selectType(\'template\')"/>\n<label class="d_f ai_c f_1">\n<label class="w_128" data-i18n="custom-dynamic-stamp:dialog.template"></label>\n<dropdown editable name="stamp-templates" class="f_1">\n<dropdown-button @foreach="item in cdsc.templateList" @sync.text="item.name" @on.click="cdsc.selectTemplate(item)"></dropdown-button>\n</dropdown>\n<div class="fv__ui-custom-dynamic-stamp-browseWrap">\n<input type="file" id="stamp-local-path" accept="image/jpg,image/jpeg,image/bmp,image/png" class="p_a" @on.native.change="self.inputFile($event)"/>\n<div class="fv__ui-dialog-ok-button fv__ui-button" id="browse" >custom-dynamic-stamp:dialog.browse</div>\n</div>\n</label>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.category"></label>\n<dropdown editable name="stamp-category" class="f_1">\n<dropdown-button @foreach="name in cdsc.categoryList" @sync.text="name" @on.click="cdsc.selectCategory(name)"></dropdown-button>\n</dropdown>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.name"></label>\n<input name="name" class="f_1 fv__ui-custom-dynamic-stamp-name" type="text" @model="cdsc.data.name"/>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.font"></label>\n<dropdown editable name="stamp-fontFamilies" id="fv__ui-fontFamilies" class="f_1">\n<dropdown-button @foreach="item in cdsc.fontFamilies" @sync.text="item.name" @on.click="cdsc.selectFontFamily(item)"></dropdown-button>\n</dropdown>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.stampText"></label>\n<dropdown editable name="stamp-text-type" class="f_1">\n<dropdown-button @foreach="item in cdsc.textType" @sync.text="item.type" @on.click="cdsc.selectTextType(item)"></dropdown-button>\n</dropdown>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-fieldset-field fv__ui-field-transforms d_f ai_c jc_sb">\n<div class="fv__ui-custom-dynamic-stamp-dialog-field-item d_f ai_c">\n<label class=" d_ib ml_23 w_128" data-i18n="custom-dynamic-stamp:dialog.fontSize"></label>\n<dropdown editable name="fontSizeSelect" selected="0" selectable="false">\n<dropdown-button @foreach="size in cdsc.fontSizes" @sync.text="size" @on.click="cdsc.selectFontSize(size)"></dropdown-button>\n</dropdown>\n</dropdown>\n</div>\n<div class="fv__ui-custom-dynamic-stamp-dialog-field-item fv__ui-color-pick d_f ai_c">\n<label class=" d_ib" data-i18n="custom-dynamic-stamp:dialog.color"></label>\n<div class="color-picker" role="button" tabindex="0" name="color" @aria:labelledby="::previousSiblings()"  @on.native.click="self.selectColor($event)" @on.native.keydown="self.keydownColor($event)">\n<div>\n<div class="label">?</div>\n<div class="mask"></div>\n</div>\n</div>\n</div>\n</div>\n\n</fieldset>\n</layer-view>\n<layer-toolbar class="fv__ui-custom-dynamic-stamp-dialog-footer d_f ai_c jc_fe">\n<xbutton class="fv__ui-dialog-ok-button" @on.native.click="cdsc.ok()">common-dialogs.ok</xbutton>\n<xbutton class="fv__ui-dialog-cancel-button" @on.click="self.cancel()">common-dialogs.cancel</xbutton>\n</layer-toolbar>\n</layer>'}},80:t=>{t.exports=null},585:(t,e,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var a="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},o=Object.create(a),i=/["&'<>]/;function r(t){return"string"!=typeof t&&(t=null==t?"":"function"==typeof t?r(t.call(t)):JSON.stringify(t)),t}o.$escape=function(t){return function(t){var e=""+t,n=i.exec(e);if(!n)return t;var a="",o=void 0,r=void 0,s=void 0;for(o=n.index,r=0;o<e.length;o++){switch(e.charCodeAt(o)){case 34:s="&#34;";break;case 38:s="&#38;";break;case 39:s="&#39;";break;case 60:s="&#60;";break;case 62:s="&#62;";break;default:continue}r!==o&&(a+=e.substring(r,o)),r=o+1,a+=s}return r!==o?a+e.substring(r,o):a}(r(t))},o.$each=function(t,e){if(Array.isArray(t))for(var n=0,a=t.length;n<a;n++)e(t[n],n);else for(var o in t)e(t[o],o)},t.exports=o},779:(t,e,n)=>{"use strict";t.exports=n(585)},616:e=>{"use strict";e.exports=t}},n={};function a(t){var o=n[t];if(void 0!==o)return o.exports;var i=n[t]={exports:{}};return e[t](i,i.exports,a),i.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var o={};return(()=>{"use strict";function t(e,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](e):t(e,n)}function e(e,n){if(!t(e,n))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function i(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}function r(t,e){return r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(t,e)}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t,e){return!e||"object"!=((n=e)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof e?l(t):e;var n}function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=c(t);if(e){var o=c(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return m(this,n)}}a.d(o,{default:()=>vt});var d=a(616),p=d.vendors,f=(d.PDFUI,d.UIXAddon),h=d.SeniorComponentFactory,v=d.modular,y=d.Controller,g=p.jQuery,b=p.Hammer,_=d.services.StampStorageService,w=d.PDFViewCtrl,x=w.storage.StorageFeature,S=w.shared,k=w.PDF,T=w._internal,C=w.PDFViewer,I=S.extendOptions,D=S.colorConvertor,P=w.commons.createDeferred,E=w.FontUtil.FontFamilies,A=w.Consts.CUSTOM_STAMPS_LOCALKEY,$=k.constant.STAMP_TEXT_TYPE,U=T.consts.ADD_FONT_MAP_LIST,F=w.DeviceInfo.isDesktop,z=w.keyboard.KeyboardUtils,O=z.isMatch,j=z.matchers.Enter,L="custom-dynamic-stamp",M="backgroundColor",N="template",R=["auto","6","8","10","12","14","16","18","20","22","24","26","28","30","32"],B="CUSTOM_DYNAMIC_STAMP_TEMPLATE",V=a(80),q=a.n(V),H=v.module("custom-dynamic-stamp",[]);function W(t,e,n,a,o,i,r){try{var s=t[i](r),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(a,o)}function X(t){return function(){var e=this,n=arguments;return new Promise((function(a,o){var i=t.apply(e,n);function r(t){W(i,a,o,r,s,"next",t)}function s(t){W(i,a,o,r,s,"throw",t)}r(void 0)}))}}function Y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function K(t,e){var n,a,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(r=0)),r;)try{if(n=1,a&&(o=2&s[0]?a.return:s[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,s[1])).done)return o;switch(a=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,a=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(t){s=[6,t],a=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;function G(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),a.forEach((function(e){Y(t,e,n[e])}))}return t}function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function Q(t){return function(t){if(Array.isArray(t))return J(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return J(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(t){return tt.apply(this,arguments)}function tt(){return(tt=X((function(t){var e;return K(this,(function(n){return e=new FileReader,[2,new Promise((function(n){e.onload=function(t){var e;n(null==t||null===(e=t.target)||void 0===e?void 0:e.result)},e.readAsDataURL(t)}))]}))}))).apply(this,arguments)}function et(t){var e,n=t.wrapWidth,a=void 0===n?290:n,o=t.wrapHeight,i=void 0===o?150:o,r=t.text,s=void 0===r?"":r,c=t.fontSize,l=void 0===c?"":c,m=t.pLeft,u=void 0===m?void 0:m,d=t.pTop,p=void 0===d?void 0:d,f=document.createElement("span");f.style.opacity="0",document.body.appendChild(f),f.innerText=s;var h=a/i,v=(e=f.getBoundingClientRect()).width/e.height;if(!v)return{width:0,height:0,left:0,right:a,top:i,bottom:0};var y,g,b,_,w=i,x=a;return parseFloat(l)?(f.style.fontSize="".concat(l,"px"),e=f.getBoundingClientRect(),g=(y=void 0!==u?u:(a-e.width)/2)+e.width,_=(b=void 0!==p?p:(i-e.height)/2+e.height)-e.height,document.body.removeChild(f),{width:e.width,height:e.height,left:y,right:g,top:b,bottom:_}):(v>h?(y=void 0!==u?u:0,g=a,w=a/v,_=(b=void 0!==p?p:(i-w)/2+w)-w):(_=(b=void 0!==p?p:i)-i,g=(x=i*v)+(y=void 0!==u?u:(a-x)/2)),document.body.removeChild(f),{left:y,right:g,top:b,bottom:_,width:x,height:w})}function nt(e){var n=e.url;return t(n,Blob)?Z(n).then((function(t){return at(t)})):at(n)}function at(t){return F?new Promise((function(e,n){var a=new Image;a.setAttribute("crossOrigin","Anonymous"),a.onload=function(){var n=a.width/a.height,o=a.width,i=a.height;n>1.9333333333333333?i=(o=290)/n:o=(i=150)*n,e({url:t,width:o,height:i,imgRatio:a.width/o})},a.src=t})):function(t){return new Promise((function(e,n){var a=document.createElement("canvas"),o=a.getContext("2d");a.width=290,a.height=150;var i=new Image;i.setAttribute("crossOrigin","Anonymous"),i.onload=function(){var t=290/150,n=i.width/i.height,r=i.width,s=i.height;n>t?s=(r=290)/n:r=(s=150)*n,a.width=r,a.height=s,o?(o.drawImage(i,0,0,r,s),e({url:a.toDataURL("image/png"),width:r,height:s,imgRatio:1})):e({url:a.toDataURL("image/png"),width:r,height:s,imgRatio:1})},i.src=t}))}(t)}var ot=function(){function t(){e(this,t),Y(this,"viewer",void 0),Y(this,"stampStorageService",void 0),Y(this,"stampsArr",[]),Y(this,"customTemplateArr",[]),Y(this,"preparePromise",void 0)}return i(t,[{key:"allInjected",value:function(){var t=this;return X((function(){var e;return K(this,(function(n){switch(n.label){case 0:return e=P(),t.preparePromise=e.promise,[4,t.getTemplatesInLocal()];case 1:return t.customTemplateArr=n.sent(),[4,t.getDynamicStamps()];case 2:return t.stampsArr=n.sent(),e.resolve(),[2]}}))}))()}},{key:"prepare",value:function(){return this.preparePromise}},{key:"setStampTemplates",value:function(t){for(var e,n=function(e){var n=t[e];o.includes(n.name)?a.forEach((function(t){t.name==n.name&&(t.url=n.url)})):(o.push(n.name),a.push(n))},a=[],o=this.customTemplateArr.map((function(t){return t.name})),i=0;i<t.length;i++)n(i);(e=this.customTemplateArr).unshift.apply(e,Q(a)),this.storeTemplatesInLocal(this.customTemplateArr)}},{key:"removeStampTemplates",value:function(t){for(var e=Q(this.customTemplateArr),n=0;n<t.length;n++)for(var a=0;a<e.length;a++)t[n]==e[a].name&&e.splice(a,1);this.customTemplateArr=e,this.storeTemplatesInLocal(this.customTemplateArr)}},{key:"getStampTemplates",value:function(){return this.customTemplateArr}},{key:"getTemplatesInLocal",value:function(){var t=this;return X((function(){return K(this,(function(e){switch(e.label){case 0:return[4,t.viewer.getStorage().get(x.STAMP,B)];case 1:return[2,e.sent()||[]]}}))}))()}},{key:"storeTemplatesInLocal",value:function(t){return this.viewer.getStorage().set(x.STAMP,B,t)}},{key:"setDynamicStamp",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.formatData(t,n).then((function(t){var n;return(n=e.stampsArr).push.apply(n,Q(t)),e.getCustomStampIcons(t).then((function(n){e.stampStorageService.triggerCustomStampChange({});var a=[];return t.forEach((function(t,o){t.showUrl=n[o].showUrl,a.push(e.viewer.addAnnotationIcon(t))})),Promise.all(a).then((function(t){e.storeStampInLocal(n)}))}))}))}},{key:"removeDynamicStamp",value:function(t){var e=this;return X((function(){var n,a,o,i,r,s;return K(this,(function(c){switch(c.label){case 0:for(n=Q(e.stampsArr),a=[],o=0;o<t.length;o++)for(i=0;i<n.length;i++)t[o].category===n[i].category&&t[o].names.includes(n[i].name)&&(s=n.splice(i,1),(r=a).push.apply(r,Q(s)),e.viewer.removeAnnotationIcon("stamp",s[0].category,s[0].name),i--);return e.stampsArr=n,[4,e.removeStampInLocal(a)];case 1:return c.sent(),e.stampStorageService.triggerCustomStampChange({}),[2]}}))}))()}},{key:"getDynamicStamp",value:function(){var t=this;return X((function(){var e,n,a;return K(this,(function(o){switch(o.label){case 0:return[4,t.getDynamicStamps()];case 1:return e=o.sent(),n=Q(e),a=["annotType","showUrl","fileType","url"],n.forEach((function(t){a.forEach((function(e){return delete t[e]}))})),[2,n]}}))}))()}},{key:"getCustomStampsFromLocal",value:function(){var t=this;return X((function(){return K(this,(function(e){switch(e.label){case 0:return[3,1];case 1:return[4,t.viewer.getStorage().get(x.STAMP,A)];case 2:return[2,e.sent()||[]];case 3:return[2]}}))}))()}},{key:"getDynamicStamps",value:function(){var t=this;return X((function(){var e,n,a,o,i;return K(this,(function(r){switch(r.label){case 0:return[4,t.getCustomStampsFromLocal()];case 1:if(e=r.sent(),n=[],e)for(var s in e)o=e[s],i=o.filter((function(t){return!!(null==t?void 0:t.field)})),(a=n).push.apply(a,Q(i));return[2,n]}}))}))()}},{key:"storeStampInLocal",value:function(t){var e=this;return X((function(){var n,a,o,i,r,s,c,l,m,u,d,p;return K(this,(function(f){switch(f.label){case 0:return[4,e.getCustomStampsFromLocal()];case 1:if(n=f.sent(),a={},t.length&&t.forEach((function(t){var e=a[t.category]||[];e.push(t),a[t.category]=e})),n)for(var h in n){o=a[h]||[],i=Q(n[h]).concat(Q(o)),r=new Map,s=!0,c=!1,l=void 0;try{for(m=i[Symbol.iterator]();!(s=(u=m.next()).done);s=!0)d=u.value,r.set(h+d.name,d)}catch(t){c=!0,l=t}finally{try{s||null==m.return||m.return()}finally{if(c)throw l}}n[h]=Q(r.values())}for(var v in a)n[v]||(n[v]=a[v]);return[3,2];case 2:return[4,(p=e.viewer.getStorage()).removeAll(x.STAMP,A)];case 3:return f.sent(),[4,p.set(x.STAMP,A,n)];case 4:f.sent(),f.label=5;case 5:return[2]}}))}))()}},{key:"removeStampInLocal",value:function(t){var e=this;return X((function(){var n,a,o,i;return K(this,(function(r){switch(r.label){case 0:return[4,e.getCustomStampsFromLocal()];case 1:if(n=r.sent(),a={},t.forEach((function(t){var e=a[t.category]||[];e.push(t),a[t.category]=e})),!n)return[3,5];for(var s in o=function(t){var e=a[t];if(e){var o=n[t];e.forEach((function(t){var e=o.findIndex((function(e){return e.name===t.name}));e>-1&&o.splice(e,1)})),o.length||delete n[t]}},n)o(s);return[3,2];case 2:return[4,(i=e.viewer.getStorage()).removeAll(x.STAMP,A)];case 3:return r.sent(),[4,i.set(x.STAMP,A,n)];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))()}},{key:"formatData",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[];return t.map((function(t){var a=/[~!@#'\.\$%\^&\*\(\)\=;\[\]\{\}]/;if(!String(t.category)||!String(t.name))return Promise.reject(new Error("Category and name parameter cannot be empty."));if(a.test(t.category))throw new Error("[Illegal Argument] Invalid category: Special characters is invalid.");if(a.test(t.name))throw new Error("[Illegal Argument] Invalid name: Special characters is invalid.");n.push(nt({url:t.fileData}).then((function(n){var a,o,i=n.url,r=n.width,s=n.height;if((null===(o=t.field)||void 0===o||null===(a=o.font)||void 0===a?void 0:a.size)&&e){var c=t.field,l=c.font,m=c.value,u=c.rect,d=u?u.left:void 0,p=u?u.top:void 0;t.field.rect=et({wrapWidth:r,wrapHeight:s,text:m,fontSize:l.size,pLeft:d,pTop:p})}return I({},{width:r,height:s},t,{url:i,fileType:"png",annotType:"stamp",type:L,index:(Math.random()+"").substring(2)+Date.now()})})))})),Promise.all(n)}},{key:"getCustomStampIcons",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.stampsArr;return Promise.all(e.map((function(e){return t.getStampIcon(G({annotType:"stamp"},e))})))}},{key:"getStampIcon",value:function(t){return this.viewer.previewIconDoc(t).then((function(e){return Z(e).then((function(e){return G({showUrl:e},t)}))})).catch((function(t){}))}}],[{key:"inject",value:function(){return{viewer:C,stampStorageService:_}}}]),t}(),it=function(t){s(a,t);var n=u(a);function a(){var t;return e(this,a),Y(l(t=n.apply(this,arguments)),"dynamicStampsService",void 0),t}return i(a,[{key:"handle",value:function(){var t=this;return X((function(){var e;return K(this,(function(n){switch(n.label){case 0:if(0===(e=t.component.getRoot().querySelectorAll("@custom-dynamic-stamp:create-custom-dynamic-stamp-dialog")).length)throw new Error("The `<custom-dynamic-stamp:create-custom-dynamic-stamp-dialog> ` should be added into your layout template");if(e.length>1)throw new Error("Found more than one of `<custom-dynamic-stamp:create-custom-dynamic-stamp-dialog>`. Please check if the component has been added repeatedly");return[4,t.dynamicStampsService.prepare()];case 1:return n.sent(),setTimeout((function(){var t=e[0];t.open(document.body),t.element.focus()})),t.component.parent.deactive(),[2]}}))}))()}}],[{key:"getName",value:function(){return"CreateDynamicStampButtonController"}},{key:"inject",value:function(){return{dynamicStampsService:ot}}}]),a}(y);function rt(t,e,n){return rt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(a){var o=Object.getOwnPropertyDescriptor(a,e);return o.get?o.get.call(n||t):o.value}},rt(t,e,n||t)}H.registerController(it),H.registerFragment("create-dynamic-stamp-button",{template:'\n        <xbutton class="fv__ui-create-dynamic-stamp-button"\n            name="create-dynamic-stamp-button"\n            @controller="custom-dynamic-stamp:CreateDynamicStampButtonController"\n            icon-class="fx-icon-sm fv__icon-create-custom-dynamic-stamp-icon">custom-dynamic-stamp:toolbar.createDynamicStampTextBtnText\n        </xbutton>\n    '});var st=a(642),ct=a.n(st),lt=function(t){s(a,t);var n=u(a);function a(){for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];var r;return e(this,a),(r=n.call.apply(n,[this].concat(Q(o)))).insertText="",r.fontSize="",r}return i(a,[{key:"mounted",value:function(){var t=this;rt(c(a.prototype),"mounted",this).call(this),this.$wrap=g(this.element),this.$text=g(this.element.querySelector(".fv__ui-dynamic-stamp-insert-text")),this.$img=g(this.element.querySelector(".fv__ui-dynamic-stamp-insert-text-img")),this.$shape=g(this.element.querySelector(".fv__ui-dynamic-stamp-insert-text-shape"));var e=this.hammer=new b.Manager(this.$text[0],{recognizers:[[b.Pan,{direction:b.DIRECTION_ALL}]]});this.addDestroyHook((function(){t.hammer.destroy(),t.hammer=null}));var n=this.getClosestComponentByName("fv--custom-dynamic-stamp-dialog"),o={left:0,top:0};this.element.addEventListener("touchstart",(function(t){n.element.style.overflow="hidden"})),this.element.addEventListener("touchend",(function(t){n.element.style.overflow="auto"})),e.on("panstart",(function(e){o=t.$text.position(),t.$shape.css({display:"inline-block",width:"".concat(t.$text.width(),"px"),height:"".concat(t.$text.height(),"px"),top:"".concat(o.top,"px"),left:"".concat(o.left,"px")})})),e.on("panmove",(function(e){t.$shape.css({top:"".concat(o.top+e.deltaY,"px"),left:"".concat(o.left+e.deltaX,"px")})})),e.on("panend",(function(e){t.$text.css({top:"".concat(o.top+e.deltaY,"px"),left:"".concat(o.left+e.deltaX,"px")}),t.$shape.css({display:"none"});var n=t.$text.position(),a=t.$text.width(),i=t.$text.height(),r=t.$wrap.height();t.pdfUI.eventEmitter.emit("updateRect",{left:n.left,right:n.left+a,bottom:r-n.top-i,top:r-n.top,width:a,height:i})}))}},{key:"initData",value:function(t){this.insertText=t.text,this.$text.text(t.text),this.fontSize=t.size,this.color=t.color,this.$text.css({fontSize:"".concat(t.size,"px"),width:"auto",height:"auto",color:t.color}),this.$img.css({width:"auto",height:"auto"})}},{key:"setSize",value:function(t){if(this.fontSize=t,this.$text.css({fontSize:"".concat(t,"px"),width:"auto",height:"auto"}),this.insertText){var e=this.$text.position();this.updateUI({text:this.insertText,fontSize:t,pLeft:e.left,pTop:this.$wrap.height()-e.top})}}},{key:"setText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.insertText=t,this.$text.text(t),this.$text.css({fontSize:"".concat(this.fontSize,"px"),width:"auto",height:"auto"}),this.updateUI({text:t,fontSize:this.fontSize})}},{key:"setImg",value:function(t){if(this.$img.attr("src",t),t){var e=this.$text.position();this.$img.css({width:"".concat(this.$text.width(),"px"),height:"".concat(this.$text.height(),"px"),top:"".concat(e.top,"px"),left:"".concat(e.left,"px"),opacity:1})}}},{key:"setColor",value:function(t){this.$text.css({color:t}),this.$shape.css({borderColor:t})}},{key:"updateUI",value:function(t){var e=this.$wrap.height(),n=this.$wrap.width(),a=et(t=Object.assign({},{wrapWidth:n,wrapHeight:e},t)),o=a.width,i=a.height,r=a.left,s=a.top;this.pdfUI.eventEmitter.emit("updateRect",a),this.$shape.css({width:"".concat(o,"px"),height:"".concat(i,"px"),top:"".concat(e-s,"px"),left:"".concat(r,"px")}),this.$text.css({display:this.insertText?"block":"none",width:"".concat(o,"px"),height:"".concat(i,"px"),top:"".concat(e-s,"px"),left:"".concat(r,"px")})}},{key:"updateWrapUI",value:function(t,e){this.$wrap.css({width:"".concat(t,"px"),height:"".concat(e,"px")}),this.$shape.css({width:"auto",height:"auto",top:"".concat(0,"px"),left:"".concat(0,"px")}),this.$img.css({width:"auto",height:"auto",top:"".concat(0,"px"),left:"".concat(0,"px")}),this.$text.css({display:"none",width:"auto",height:"auto",top:"".concat(0,"px"),left:"".concat(0,"px")})}}],[{key:"getName",value:function(){return"custom-dynamic-stamp-text"}}]),a}(h.createSuperClass({template:'<div class="fv__ui-dynamic-stamp-insert-text-wrap" @var.self="$component">\n            <div class="fv__ui-dynamic-stamp-insert-text"></div>\n            <img class="fv__ui-dynamic-stamp-insert-text-img"/>\n            <div class="fv__ui-dynamic-stamp-insert-text-shape"></div>\n    </div>'}));H.registerComponent(lt);var mt=function(t){s(a,t);var n=u(a);function a(){return e(this,a),n.apply(this,arguments)}return i(a,[{key:"mounted",value:function(){rt(c(a.prototype),"mounted",this).call(this);var t=g(this.element);this.$templateType=t.find('[name="templateType"]'),this.$backgroundImage=t.find("#backgroundImage"),this.$backgroundColor=t.find("#backgroundColor"),this.textComponent=this.getComponentByName("dynamic-text")}},{key:"show",value:function(){var t=this,e=this;return X((function(){return K(this,(function(n){switch(n.label){case 0:return[4,e.controller.resetData()];case 1:return n.sent(),e.syncUI(),rt(c(a.prototype),"show",t).call(e),[2]}}))}))()}},{key:"syncUI",value:function(){var t=this.controller.data;this.$backgroundImage.attr("src",t.url);var e=g(this.element.querySelector('[name="backgroundColor"] > div'));e.css("border-color",t.backgroundColor),e.find(".label").toggle(!t.backgroundColor);var n=g(this.element.querySelector('[name="color"] > div'));n.css("border-color",t.color),n.find(".label").toggle(!t.color),this.$templateType[0].checked=!0,this.selectType(t.type),this.textComponent.initData({text:t.stampText,color:t.color,size:t.fontSize})}},{key:"keydownColor",value:function(t){O(t,j)&&this.selectColor(t)}},{key:"selectColor",value:function(t){var e=this,n=this.controller.data,a=this.pdfUI.colorSpectrum,o=t.target,i=g(t.target),r="";if(i.hasClass("color-picker")?(r=i.attr("name"),i=i.find(".mask")):r=i.parent().parent().attr("name"),r!==M||n.type===M){a.setDefaultColor(D(n[r],"#")),a.show(o,(function(t){!function(t){var n=D(t,"#"),a=i.parent();switch(n?a.css("border-color",D(t,"HTML")):a.css("border-top-color","blue").css("border-right-color","green"),a.find(".label").toggle(!t),r){case"backgroundColor":e.handlerBackgroundColor(t),e.controller.setData(r,t),e.controller.getIconUrl();break;case"color":e.getComponentByName("dynamic-text").setColor(n),e.controller.setData(r,n),e.controller.data.stampText&&e.controller.getIconUrl()}}(t)}))}}},{key:"selectType",value:function(t){var e=g(this.element),n=N,a=this.getComponentByName("stamp-templates");if(this.resetStampText(),t===n){e.find("#stamp-local-path").removeAttr("disabled"),e.find("#browse").removeAttr("disabled"),a.enable();var o=a.getEditValue();a.trigger("change",o),this.updatePreviewImg("")}else e.find("#stamp-local-path").attr("disabled","disabled"),e.find("#browse").attr("disabled","disabled"),a.disable(),this.controller.setData("backgroundColor",this.controller.data.backgroundColor),this.handlerBackgroundColor(this.controller.data.backgroundColor),this.controller.setData("imgRatio",1),this.controller.getIconUrl();this.controller.setData("type",t)}},{key:"handlerBackgroundColor",value:function(t){var e=function(t){var e=t.bgColor,n=t.round,a=void 0===n?20:n,o=t.x,i=void 0===o?0:o,r=t.y,s=void 0===r?0:r,c=t.width,l=void 0===c?290:c,m=t.height,u=void 0===m?93:m,d=document.createElement("canvas"),p=d.getContext("2d");return p?(d.width=l,d.height=u,p.beginPath(),p.moveTo(i+a,s),p.lineTo(i+l-a,s),p.arc(i+l-a,s+a,a,1.5*Math.PI,2*Math.PI),p.lineTo(i+l,s+u-a),p.arc(i+l-a,s+u-a,a,0,.5*Math.PI),p.lineTo(i+a,s+u),p.arc(i+a,s+u-a,a,.5*Math.PI,Math.PI),p.lineTo(i,s+a),p.arc(i+a,s+a,a,Math.PI,1.5*Math.PI),p.fillStyle=e,p.strokeStyle=e,p.fill(),p.stroke(),p.closePath(),{url:d.toDataURL("image/png"),width:l,height:u}):{url:d.toDataURL("image/png"),width:l,height:u}}({bgColor:t}),n=e.url,a=e.width,o=e.height;this.textComponent.updateWrapUI(a,o),this.controller.setData("url",n)}},{key:"inputFile",value:function(t){var e=this;t.target.files.length<1||(this.loading=this.pdfUI.loading(this.element.querySelector(".fv__ui-layer-inner"),"",!0),this.$backgroundImage.attr("src",""),this.resetStampText(),Z(t.target.files[0]).then((function(n){nt({url:n}).then((function(n){var a=n.url,o=n.width,i=n.height,r=n.imgRatio;e.controller.currentTemplate={url:a,width:o,height:i,imgRatio:r},e.textComponent.updateWrapUI(o,i),e.controller.setData("url",a),e.controller.setData("imgRatio",r),t.target.value="",e.controller.getIconUrl()}))})))}},{key:"resetStampText",value:function(){this.controller.setDropdownValue(this.controller.textTypeComponent,"stampTextType",this.controller.textType[0].type),this.controller.setData("stampText","")}},{key:"updatePreviewImg",value:function(t){this.$backgroundImage.attr("src",t),this.loading&&this.loading.then((function(t){return t.close()}))}}],[{key:"getName",value:function(){return"create-custom-dynamic-stamp-dialog"}}]),a}(h.createSuperClass({template:ct()()}));H.registerComponent(mt);var ut={CUSTOM_TEXT:"customText",NAME:"name",NAME_DATE_TIME:"nameDateTime",DATE_TIME:"dateTime",DATE:"date"},dt="background",pt="field",ft=function(t){s(a,t);var n=u(a);function a(t){var o;return e(this,a),Y(l(o=n.call(this,t)),"viewer",void 0),Y(l(o),"dynamicStampService",void 0),o.fontSizes=R,o.fontFamilies=E,o.initData={type:M,backgroundColor:"#47BE9B",url:"",templateName:"",category:"",name:"New Stamp",font:o.fontFamilies[0].name,stampTextType:"",stampText:"",fontSize:"auto",color:"#FFFFFF",rect:null,imgRatio:1},o.templateList=[],o.category=[],o.categoryList=[],o.textType=[],o.dynamicBackgroundImg="",o.currentTemplate={},o}return i(a,[{key:"mounted",value:function(){var t=this;rt(c(a.prototype),"mounted",this).call(this),this.templatesComponent=this.component.getComponentByName("stamp-templates"),this.categoryComponent=this.component.getComponentByName("stamp-category"),this.sizeComponent=this.component.getComponentByName("fontSizeSelect"),this.textTypeComponent=this.component.getComponentByName("stamp-text-type"),this.fontComponent=this.component.getComponentByName("stamp-fontFamilies"),this.textComponent=this.component.getComponentByName("dynamic-text"),g(this.fontComponent.element).find("input").attr("readonly","true"),this.addDestroyHook(this.textTypeComponent.on("change",(function(e){"string"==typeof e&&(e={type:e,key:t.textType[0].key}),t.setData("stampTextType",$[e.key]),t.setData("stampText",e.type),t.textComponent.setText(t.data.stampText),t.getIconUrl()})),this.categoryComponent.on("change",(function(e){t.setData("category",e)})),this.sizeComponent.on("change",(function(e){t.setData("fontSize",e),t.getIconUrl()})),this.fontComponent.on("change",(function(e){t.setData("font",e),t.getIconUrl()})),this.templatesComponent.on("change",(function(e){var n=t.templateList.find((function(t){return t.name===e}));n&&t.selectTemplate(n),t.templateList[0].name===e&&(e=""),t.setData("templateName",e)}))),this.pdfUI.eventEmitter.on("updateRect",(function(e){t.data.rect=e,t.getIconUrl()})),this.pdfUI.addViewerEventListener("change-language-success",(function(){t.resetData()})),this.pdfUI.getStore().then((function(e){var n=e.subscribe(U,(function(e){var n,a=e.new,o=[];a.slice(0).forEach((function(t){o.push({name:t.name,value:t.name})})),(n=t.fontFamilies).push.apply(n,Q(o))}));t.viewer.addDestroyHook((function(){n()}))}))}},{key:"customTemplateHandle",value:function(t){var e=this.templatesComponent.$container.children().find((function(e){var n=e.attrs,a=n.name,o=n.url;return a&&o&&a===t}));return e&&e.attrs}},{key:"resetData",value:function(){var t=this;return X((function(){var e,n,a,o,i;return K(this,(function(r){switch(r.label){case 0:return t.data=G({},t.initData),e=t.pdfUI.i18n.t("custom-dynamic-stamp:dialog.categoryPlaceholder"),a=(n=[e]).concat,[4,t.getCustomStamps()];case 1:return t.categoryList=a.apply(n,[Q.apply(void 0,[r.sent()])]),o=t.pdfUI.i18n.t("custom-dynamic-stamp:dialog.templatePlaceholder"),(i=[{url:"",backgroundImg:"",name:o,width:0,height:0,imgRatio:1}].concat(Q(t.dynamicStampService.getStampTemplates()))).length>6&&(i.length=6),t.templateList=i,t.textType=Object.keys($).map((function(e){return{key:e,type:t.pdfUI.i18n.t("custom-dynamic-stamp:dialog.stampTextType.".concat(ut[e]))}})),t.setDropdownValue(t.textTypeComponent,"stampTextType",t.textType[0].type),t.selectCategory(t.categoryList[0]),t.setDropdownValue(t.templatesComponent,"templateName",t.templateList[0].name),t.setDropdownValue(t.sizeComponent,"fontSize",t.fontSizes[0]),t.setDropdownValue(t.fontComponent,"font",t.fontFamilies[0].name),t.digest(!0),[2]}}))}))()}},{key:"getCustomStamps",value:function(){var t=this;return X((function(){var e,n;return K(this,(function(a){switch(a.label){case 0:return[4,t.pdfUI.getStorage()];case 1:return e=a.sent(),[3,2];case 2:return[4,e.get(x.STAMP,A)];case 3:n=a.sent(),a.label=4;case 4:return n?[2,Object.keys(n)]:[2,[]]}}))}))()}},{key:"ok",value:function(){var t=this;return X((function(){var e,n,a,o,i,r,s,c,l,m,u,d,p,f,h,v,y,g,b,_,w,x,S,k;return K(this,(function(T){switch(T.label){case 0:return e=t.data,n=e.category,a=e.stampText,o=e.templateName,i=e.type,r=e.name,s=e.url,c=e.font,l=e.fontSize,m=e.color,u=e.rect,d=e.imgRatio,p=t.isValidateParam(),f=p.type,h=p.text,v=t.getPDFUI().i18n,f?(y=v.t("custom-dynamic-stamp:alert.".concat(f)),h&&(g=v.t("custom-dynamic-stamp:alert.".concat(h)),y=y.replace("${1}",g)),t.pdfUI.alert({message:y,level:"warning"}),[3,4]):[3,1];case 1:return b=t.pdfUI.loading(),i!==N?[3,3]:(_=t.component.$backgroundImage.attr("src"),t.currentTemplate=Object.assign({},t.currentTemplate,{name:o,url:s,backgroundImg:_}),[4,t.dynamicStampService.setStampTemplates([t.currentTemplate])]);case 2:T.sent(),T.label=3;case 3:w=u.left,x=u.right,S=u.top,k=u.bottom,t.dynamicStampService.setDynamicStamp([{category:n,name:r,fileData:s,field:{textType:a,value:a,font:{name:c,color:D(m,"int"),size:Number.parseFloat(l)},rect:{left:w*d,right:x*d,top:S*d,bottom:k*d}}}],!0).then((function(e){t.component.cancel()})).catch((function(e){t.pdfUI.alert({message:e.message,level:"warning"})})).finally((function(){b.then((function(t){return t.close()}))})),T.label=4;case 4:return[2]}}))}))()}},{key:"isValidateParam",value:function(){var t=this.data,e=t.category,n=t.stampText,a=t.templateName,o=t.type,i=t.name,r=t.url,s="",c="";if(o===N){if(!a||a===this.templateList[0].name)return{type:s="templateError",text:c="templateText"};if(!r)return{type:s="fileError",text:c};var l=this.templateList.find((function(t){return t.name==a}));if(l&&r!==l.url)return{type:s="templateNameError",text:c}}if(!i)return{type:s="nameError",text:c};if(!e||e===this.categoryList[0])return{type:s="categoryError",text:c="categoryText"};if(!n||e===this.textType[0])return{type:s="textError",text:c="typeText"};var m=/[~!@#'\.\$%\^&\*\(\)\=;\[\]\{\}]/;return m.test(e)||m.test(i)?{type:s="specialError",text:c}:{type:s,text:c}}},{key:"setData",value:function(t,e){this.data.hasOwnProperty(t)&&(this.data[t]=e)}},{key:"selectFontSize",value:function(t){this.setDropdownValue(this.sizeComponent,"fontSize",t),this.textComponent.setSize(this.data.fontSize)}},{key:"selectFontFamily",value:function(t){var e=t.name;this.setDropdownValue(this.fontComponent,"font",e),this.getIconUrl()}},{key:"selectTextType",value:function(t){var e=this,n=t.type,a=t.key;if(this.setDropdownValue(this.textTypeComponent,"stampTextType",this.textType.find((function(t){return t.key==a})).type)){var o=Promise.resolve();switch($[a]){case $.NAME:o=this.viewer.getUserName();break;case $.NAME_DATE_TIME:o=this.viewer.getUserName().then((function(t){return e.viewer.getFormatOfDynamicStamp().then((function(e){var n=t;return e.timeFormat.length>0&&(n.length>0&&(n+=e.seperator),n+=e.timeFormat),n}))}));break;case $.DATE_TIME:o=this.viewer.getFormatOfDynamicStamp().then((function(t){var e="";return t.timeFormat.length>0&&(e.length>0&&(e+=t.seperator),e+=t.timeFormat),e}));break;case $.DATE:o=this.viewer.getFormatOfDynamicStamp().then((function(t){var e="";return t.timeFormat.length>0&&(e=t.timeFormat.split(t.seperator)[0]),e}));break;case $.CUSTOM_TEXT:o=Promise.resolve(void 0);break;default:o=Promise.resolve(n)}o.then((function(t){e.setData("stampText",void 0!==t?$[a]:t),e.textComponent.setText(t)}))}}},{key:"selectCategory",value:function(t){this.setDropdownValue(this.categoryComponent,"category",t)}},{key:"selectTemplate",value:function(t){if(this.setDropdownValue(this.templatesComponent,"templateName",t.name),this.setData("url",t.url),this.setDropdownValue(this.textTypeComponent,"stampTextType",this.pdfUI.i18n.t("custom-dynamic-stamp:dialog.stampTextType.".concat(ut.CUSTOM_TEXT))),this.setData("stampText",""),!t.url)return this.component.updatePreviewImg(""),void this.textComponent.setImg("");var e=t.width,n=t.height,a=t.imgRatio;this.textComponent.updateWrapUI(e,n),this.setData("imgRatio",a),this.component.updatePreviewImg(t.backgroundImg),this.textComponent.setImg("")}},{key:"setDropdownValue",value:function(t,e,n){return t.getEditValue()!=n&&(t.setEditValue(n),this.setData(e,n),!0)}},{key:"getIconUrl",value:function(){var t=this,e=this.data,n=e.url,a=e.font,o=e.stampText,i=e.fontSize,r=e.color,s=e.rect,c=e.imgRatio,l=Promise.resolve(),m=dt;if(n){var u={category:"fv__template_category",name:"fv__template_name",url:n,fileType:"png",annotType:"stamp",type:L,stampType:"custom-dynamic",imgType:m};if(o){var d={textType:o,value:o,font:{name:a,color:D(r,"int"),size:Number.parseFloat(i)}};if(s){var p=s.left,f=s.right,h=s.top,v=s.bottom;d.rect={left:p*c,right:f*c,top:h*c,bottom:v*c}}u.imgType=pt,u.field=d,m=u.imgType}l=this.dynamicStampService.getStampIcon(u)}return l.then((function(e){var n=e?e.showUrl:"";return m===dt?(t.component.updatePreviewImg(n),t.textComponent.setImg("")):t.textComponent.setImg(n),n}))}}],[{key:"getName",value:function(){return"CreateCustomDynamicStampDialogController"}},{key:"inject",value:function(){return{viewer:C,dynamicStampService:ot}}}]),a}(y);H.registerController(ft);var ht=function(t){s(a,t);var n=u(a);function a(){return e(this,a),n.apply(this,arguments)}return i(a,[{key:"init",value:function(t){this.pdfUI=t}},{key:"setDynamicStamp",value:function(t){return this.pdfUI.getServiceInstance(ot).setDynamicStamp(t)}},{key:"removeDynamicStamp",value:function(t){return this.pdfUI.getServiceInstance(ot).removeDynamicStamp(t)}},{key:"getDynamicStamp",value:function(){return this.pdfUI.getServiceInstance(ot).getDynamicStamp()}}],[{key:"getName",value:function(){return L}},{key:"getLoader",value:function(){return q()}}]),a}(f);const vt=ht})(),o=o.default})()));