!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],e):"object"==typeof exports?exports.DocAttachmentUIXAddon=e(require("UIExtension")):t.DocAttachmentUIXAddon=e(t.UIExtension)}(self,(t=>(()=>{var e={597:(t,e,n)=>{n(779);t.exports=function(t){"use strict";t=t||{};return'<layer name="doc-attachment-dialog" @controller="doc-attachment:DocAttachmentDialogController" class="fv__ui-doc-attachment-layer center websdk-modal" append-to="body" @draggable backdrop>\n<layer-header title="doc-attachment:dialog.title"></layer-header>\n<div class="c_a" @stop-drag>\n<div class="fv__ui-dialog-button w_160" name="addFilesBtn" tabindex="0" @aria:labelledby="::parent()::previousSiblings()::childAt(0)">doc-attachment:dialog.addFiles</div>\n<input type="file" multiple name="fileInput" class="d_n"/>\n<div class="mt_10" data-i18n="doc-attachment:dialog.addTip"></div>\n<div class="mt_5 mb_10" data-i18n="doc-attachment:dialog.okTip"></div>\n<div class="fv__table-fixed-head" name="attachment-table">\n<div class="thead">\n<div class="tr">\n<div class="td w_40z" data-i18n="doc-attachment:dialog.fileName"></div>\n<div class="td w_30z" data-i18n="doc-attachment:dialog.fileSize"></div>\n<div class="td w_30z" data-i18n="doc-attachment:dialog.fileType"></div>\n</div>\n</div>\n<div class="tbody" name="fileTable"></div>\n</div>\n<div class="d_f jc_fe mt_20 footer">\n<button class="fv__ui-dialog-ok-button fv__button-ok ml_10" name="okBtn">doc-attachment:dialog.ok</button>\n<button class="fv__ui-dialog-cancel-button fv__button-cancel ml_10" name="cancelBtn">doc-attachment:dialog.cancel</button>\n</div>\n</div>\n</layer>','<layer name="doc-attachment-dialog" @controller="doc-attachment:DocAttachmentDialogController" class="fv__ui-doc-attachment-layer center websdk-modal" append-to="body" @draggable backdrop>\n<layer-header title="doc-attachment:dialog.title"></layer-header>\n<div class="c_a" @stop-drag>\n<div class="fv__ui-dialog-button w_160" name="addFilesBtn" tabindex="0" @aria:labelledby="::parent()::previousSiblings()::childAt(0)">doc-attachment:dialog.addFiles</div>\n<input type="file" multiple name="fileInput" class="d_n"/>\n<div class="mt_10" data-i18n="doc-attachment:dialog.addTip"></div>\n<div class="mt_5 mb_10" data-i18n="doc-attachment:dialog.okTip"></div>\n<div class="fv__table-fixed-head" name="attachment-table">\n<div class="thead">\n<div class="tr">\n<div class="td w_40z" data-i18n="doc-attachment:dialog.fileName"></div>\n<div class="td w_30z" data-i18n="doc-attachment:dialog.fileSize"></div>\n<div class="td w_30z" data-i18n="doc-attachment:dialog.fileType"></div>\n</div>\n</div>\n<div class="tbody" name="fileTable"></div>\n</div>\n<div class="d_f jc_fe mt_20 footer">\n<button class="fv__ui-dialog-ok-button fv__button-ok ml_10" name="okBtn">doc-attachment:dialog.ok</button>\n<button class="fv__ui-dialog-cancel-button fv__button-cancel ml_10" name="cancelBtn">doc-attachment:dialog.cancel</button>\n</div>\n</div>\n</layer>'}},912:(t,e,n)=>{n(779);t.exports=function(t){"use strict";t=t||{};return'<layer name="same-file-name-confirm" @controller="doc-attachment:SameFileNameConfirmController" class="fv__ui-same-file-name-layer center" append-to="body" @draggable backdrop>\n<div class="d_f ai_c jc_sb fs_16 h_30 mb_20">\n<div data-i18n="doc-attachment:dialog.title" class="fs_16"></div>\n<div class="c_p pb_5 c_666 fs_24 w_30 h_30 lh_30 d_f jc_c ai_c" name="closeBtn">×</div>\n</div>\n<div class="c_a" @stop-drag>\n<div name="content"></div>\n<div class="d_f jc_sb mt_20 fw_w">\n<label class="d_f ai_c h_30">\n<input type="checkbox" name="applyToAllFiles"/>\n<div class="fs_0" data-i18n="doc-attachment:same-file-name-confirm.applyToAllFiles"></div>\n</label>\n<div class="fs_0 footer">\n<button class="fv__ui-dialog-cancel-button fv__button-cancel" name="replaceBtn">doc-attachment:same-file-name-confirm.replace</button>\n<button class="fv__ui-dialog-cancel-button fv__button-cancel ml_10" name="renameBtn">doc-attachment:same-file-name-confirm.renameAndAttached</button>\n<button class="fv__ui-dialog-cancel-button fv__button-cancel ml_10" name="skipBtn">doc-attachment:same-file-name-confirm.skip</button>\n</div>\n</div>\n</div>\n</layer>','<layer name="same-file-name-confirm" @controller="doc-attachment:SameFileNameConfirmController" class="fv__ui-same-file-name-layer center" append-to="body" @draggable backdrop>\n<div class="d_f ai_c jc_sb fs_16 h_30 mb_20">\n<div data-i18n="doc-attachment:dialog.title" class="fs_16"></div>\n<div class="c_p pb_5 c_666 fs_24 w_30 h_30 lh_30 d_f jc_c ai_c" name="closeBtn">×</div>\n</div>\n<div class="c_a" @stop-drag>\n<div name="content"></div>\n<div class="d_f jc_sb mt_20 fw_w">\n<label class="d_f ai_c h_30">\n<input type="checkbox" name="applyToAllFiles"/>\n<div class="fs_0" data-i18n="doc-attachment:same-file-name-confirm.applyToAllFiles"></div>\n</label>\n<div class="fs_0 footer">\n<button class="fv__ui-dialog-cancel-button fv__button-cancel" name="replaceBtn">doc-attachment:same-file-name-confirm.replace</button>\n<button class="fv__ui-dialog-cancel-button fv__button-cancel ml_10" name="renameBtn">doc-attachment:same-file-name-confirm.renameAndAttached</button>\n<button class="fv__ui-dialog-cancel-button fv__button-cancel ml_10" name="skipBtn">doc-attachment:same-file-name-confirm.skip</button>\n</div>\n</div>\n</div>\n</layer>'}},207:t=>{t.exports=null},585:(t,e,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var a="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},i=Object.create(a),o=/["&'<>]/;function l(t){return"string"!=typeof t&&(t=null==t?"":"function"==typeof t?l(t.call(t)):JSON.stringify(t)),t}i.$escape=function(t){return function(t){var e=""+t,n=o.exec(e);if(!n)return t;var a="",i=void 0,l=void 0,c=void 0;for(i=n.index,l=0;i<e.length;i++){switch(e.charCodeAt(i)){case 34:c="&#34;";break;case 38:c="&#38;";break;case 39:c="&#39;";break;case 60:c="&#60;";break;case 62:c="&#62;";break;default:continue}l!==i&&(a+=e.substring(l,i)),l=i+1,a+=c}return l!==i?a+e.substring(l,i):a}(l(t))},i.$each=function(t,e){if(Array.isArray(t))for(var n=0,a=t.length;n<a;n++)e(t[n],n);else for(var i in t)e(t[i],i)},t.exports=i},779:(t,e,n)=>{"use strict";t.exports=n(585)},616:e=>{"use strict";e.exports=t}},n={};function a(t){var i=n[t];if(void 0!==i)return i.exports;var o=n[t]={exports:{}};return e[t](o,o.exports,a),o.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var i={};return(()=>{"use strict";function t(e,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](e):t(e,n)}function e(e,n){if(!t(e,n))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function o(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function r(t){return r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(t)}function d(t,e){return!e||"object"!=((n=e)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e;var n}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=r(t);if(e){var i=r(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return d(this,n)}}a.d(i,{default:()=>O});var f=a(616),u=a(207),m=a.n(u);function h(t,e,n){return h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}(t,e);if(a){var i=Object.getOwnPropertyDescriptor(a,e);return i.get?i.get.call(n||t):i.value}},h(t,e,n||t)}f.PDFViewCtrl.PDF.constant.NameTreeType;var p=f.PDFViewCtrl.Deps.jQuery,v=f.UIConsts.COMPONENT_EVENTS,b=function(t){c(a,t);var n=s(a);function a(){return e(this,a),n.apply(this,arguments)}return o(a,[{key:"mounted",value:function(){h(r(a.prototype),"mounted",this).call(this),this.$dialog=p(this.component.element),this.$closeBtn=p("[name=closeBtn]",this.$dialog),this.$content=p("[name=content]",this.$dialog),this.$applyToAllFiles=p("[name=applyToAllFiles]",this.$dialog),this.$replaceBtn=p("[name=replaceBtn]",this.$dialog),this.$renameBtn=p("[name=renameBtn]",this.$dialog),this.$skipBtn=p("[name=skipBtn]",this.$dialog),this._bindEvent()}},{key:"_bindEvent",value:function(){var t=this;this.getPDFUI();this.component.on(v.HIDDEN,(function(){t.$applyToAllFiles.prop("checked",!1).hide()})),this.$closeBtn.on("click",(function(e){t.component.hide()})),this.$replaceBtn.on("click",(function(e){t.replaceCallback&&t.replaceCallback(t.$applyToAllFiles.prop("checked")),t.component.hide()})),this.$renameBtn.on("click",(function(e){t.renameCallback&&t.renameCallback(t.$applyToAllFiles.prop("checked")),t.component.hide()})),this.$skipBtn.on("click",(function(e){t.skipCallback&&t.skipCallback(t.$applyToAllFiles.prop("checked")),t.component.hide()}))}},{key:"_setContent",value:function(t){this.$content.html(t)}},{key:"_setApplyToAllFilesVisible",value:function(t){this.$applyToAllFiles[t?"show":"hide"]()}},{key:"_setReplaceCallback",value:function(t){this.replaceCallback=t}},{key:"_setRenameCallback",value:function(t){this.renameCallback=t}},{key:"_setSkipCallback",value:function(t){this.skipCallback=t}}],[{key:"getName",value:function(){return"SameFileNameConfirmController"}}]),a}(f.Controller);function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function g(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var a,i,o=[],l=!0,c=!1;try{for(n=n.call(t);!(l=(a=n.next()).done)&&(o.push(a.value),!e||o.length!==e);l=!0);}catch(t){c=!0,i=t}finally{try{l||null==n.return||n.return()}finally{if(c)throw i}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var y=f.PDFViewCtrl.shared.fileUtils.formatFileSize,k=f.PDFViewCtrl.PDF.constant.NameTreeType,w=f.PDFViewCtrl.Deps.jQuery,A=f.UIConsts.COMPONENT_EVENTS,T=function(t){c(a,t);var n=s(a);function a(t){return e(this,a),n.call(this,t)}return o(a,[{key:"mounted",value:function(){h(r(a.prototype),"mounted",this).call(this),this.$dialog=w(this.component.element),this.$cancelBtn=w("[name=cancelBtn]",this.$dialog),this.$okBtn=w("[name=okBtn]",this.$dialog),this.$addFilesBtn=w("[name=addFilesBtn]",this.$dialog),this.$fileInput=w("[name=fileInput]",this.$dialog),this.$fileTable=w("[name=fileTable]",this.$dialog),this.$headTr=w(".fv__table-fixed-head > .thead > .tr",this.$dialog),this._bindEvent()}},{key:"_bindEvent",value:function(){var t=this,e=this.getPDFUI(),n=e.i18n,a=function(){t.$fileTable.empty(),t.$fileInput.val(""),t.files=[],t.$headTr.css("paddingRight","")};this.component.on(A.SHOWN,a),this.component.on(A.HIDDEN,a),this.$cancelBtn.on("click",(function(e){t.component.hide()})),this.$okBtn.on("click",(function(a){t.files.length?e.getPDFViewer().then((function(a){var i=a.currentPDFDoc;i.getNameTree(k.EmbeddedFiles).then((function(a){var o=Object.keys(a),l=[],c=function(){if(l.length===t.files.length){var c=e.addonInstanceMap.UndoRedoAddon.addon,r=(c.controller,c.attachmentModule),d=t.files.map((function(t,e){var c=l[e];return"rename"===c&&(t.fileName=N(o,t.fileName,n.t("doc-attachment:dialog.nameTail"))),i.addFileSpec(t.fileName,t.fileBuffer,t.modifiedDateTime).then((function(e){if("normal"===c)return r&&r.pushUndoStack("add",{fileName:t.fileName,objNum:e,fileBuffer:t.fileBuffer}),i.addEmbeddedFileByAttachments(t.fileName,e);if("replace"===c){var n=a[t.fileName];return r&&r.pushUndoStack("replace",{oldFile:n,objNum:e}),i.setEmbeddedFileByAttachments(t.fileName,e)}if("rename"===c){var o=t.fileName;return r&&r.pushUndoStack("add",{fileName:o,objNum:e,fileBuffer:t.fileBuffer}),i.addEmbeddedFileByAttachments(o,e)}return"skip"===c||void 0}))}));Promise.all(d).then((function(e){e.reduce((function(t,e){return t+Number(e)}),0)===e.length&&t.component.hide()}))}},r=function(e,n,a){n?(l=t.files.map((function(t){return o.indexOf(t.fileName)>=0?e:"normal"})),c()):(l.push(e),t.files[a+1]?setTimeout((function(){d(a+1)}),100):c())},d=function(e){var a=t.files[e];if(o.indexOf(a.fileName)>=0){var i=N(o,a.fileName,n.t("doc-attachment:dialog.nameTail")),l=n.t("doc-attachment:same-file-name-confirm.tip1",{oldFileName:a.fileName}),c=n.t("doc-attachment:same-file-name-confirm.tip2",{newFileName:i}),d=t.getComponentByName("same-file-name-confirm");d.controller._setContent("".concat(l,"<br>").concat(c)),d.controller._setApplyToAllFilesVisible(!0),d.controller._setReplaceCallback((function(t){return r("replace",t,e)})),d.controller._setRenameCallback((function(t){return r("rename",t,e)})),d.controller._setSkipCallback((function(t){return r("skip",t,e)})),d.show()}else r("normal",!1,e)};d(0)}))})):e.alert("doc-attachment:dialog.noFileWarning")})),this.$addFilesBtn.on("click",(function(e){t.$fileInput.trigger("click")})),this.$fileInput.on("change",(function(n){for(var a=function(a){var i=n.target.files[a];if(t.files.find((function(t){return t.fileName===i.name})))return"continue";if(i.size>268435456)return e.confirm({message:"sidebar.attachment.addAttachmentSizeLimit",level:"warning"}),"continue";if(/(\.exe)$/i.test(i.name))return e.confirm({message:"sidebar.attachment.addAttachmentFileFormat",level:"warning"}),"continue";var o=new FileReader;o.onload=function(){t.$fileTable.append(C(i.name,y(i.size),i.type)),t.files.push({fileName:i.name,fileBuffer:new Uint8Array(o.result),modifiedDateTime:i.lastModifiedDate||i.lastModified||(new Date).getTime()}),a===n.target.files.length-1&&t.$fileInput.val("")},o.readAsArrayBuffer(i)},i=0;i<n.target.files.length;i++)a(i)})),this.$fileTable.on("DOMNodeInserted",(function(e){var n=t.$fileTable.get(0),a=n.offsetWidth-n.clientWidth;t.$headTr.css("paddingRight",a>0?"".concat(a,"px"):"")}))}}],[{key:"getName",value:function(){return"DocAttachmentDialogController"}}]),a}(f.Controller),C=function(t,e,n){return'\n        <div class="tr '.concat(arguments.length>3&&void 0!==arguments[3]&&arguments[3]?"selected":"",'">\n            <div class="td w_40z">').concat(t,'</div>\n            <div class="td w_30z">').concat(e,'</div>\n            <div class="td w_30z">').concat(n,"</div>\n        </div>\n    ")},N=function(t,e,n){var a=e,i=function(e){if(t.indexOf(e)>=0){var o=g(e.split("."),2),l=o[0],c=o[1];a="".concat(l).concat(n,".").concat(c),i(a)}};return i(a),a},F=a(597),$=a.n(F),B=a(912),D=a.n(B),S=f.shared.replaceRibbonButton2XButton,I=f.UIConsts.COMPONENT_EVENTS,E=f.PDFViewCtrl.constants.STATE_HANDLER_NAMES.STATE_HANDLER_CREATE_DOCUMENT_ATTACHMENT,P=function(t){c(a,PDFViewCtrl.IStateHandler);var n=s(a);function a(t){return e(this,a),n.call(this,t)}return o(a,null,[{key:"getStateName",value:function(){return E}}]),a}(),O=function(t){c(a,t);var n=s(a);function a(){return e(this,a),n.apply(this,arguments)}return o(a,[{key:"fragments",value:function(){return[]}},{key:"init",value:function(t){this.pdfUI=t,this.pdfUI.getPDFViewer().then((function(t){t.getStateHandlerManager().register(P)}))}},{key:"receiveAction",value:function(t,e){var n=this.pdfUI;if("showDialog"===t){var a=n.getComponentByName("template-container");this.inited||(a=a.then((function(t){t.append($()()),t.append(D()())})),this.inited=!0),a.then((function(t){n.getComponentByName("doc-attachment-dialog").then((function(t){t&&t.show(),t.on(I.HIDDEN,(function(){n.getStateHandlerManager().then((function(t){t.switchTo()}))})),t.on(I.CANCEL,(function(){n.getStateHandlerManager().then((function(t){t.switchTo()}))}))}))}))}}}],[{key:"getName",value:function(){return"docAttachment"}},{key:"getLoader",value:function(){return m()}},{key:"initOnLoad",value:function(){var t=f.modular.module("doc-attachment",[]),n={template:'<ribbon-button text="doc-attachment:button-tooltip.title" @tooltip name="doc-attachment-button" icon-class="fv__icon-toolbar-doc-attachment">doc-attachment:button-tooltip.title</ribbon-button>',config:[{target:"doc-attachment-button",tooltip:{title:"doc-attachment:button-tooltip.title"},callback:function(t){c(a,t);var n=s(a);function a(t){return e(this,a),n.call(this,t,P)}return o(a,[{key:"changePermission",value:function(t){var e=this;this.getPDFUI().getPDFDocRender().then((function(t){8&t.getUserPermission().getValue()?e.component.unlock&&e.component.unlock():e.component.lock&&e.component.lock()}))}},{key:"handle",value:function(){this.pdfUI.getStateHandlerManager().then((function(t){t.switchTo(E)})),this.pdfUI.callAddonAPI("DocAttachmentUIXAddon","showDialog")}}],[{key:"getName",value:function(){return"DocAttachmentController"}},{key:"permission",get:function(){return f.PDFViewCtrl.Consts.PDFDocPermission.AnnotForm}}]),a}(f.StatefulController)}]};t.registerPreConfiguredComponent("doc-attachment-ribbon-button",n),t.registerPreConfiguredComponent("doc-attachment-button",Object.assign({},n,{template:S(n.template)})),t.registerController(T),t.registerController(b)}}]),a}(f.UIXAddon)})(),i=i.default})()));