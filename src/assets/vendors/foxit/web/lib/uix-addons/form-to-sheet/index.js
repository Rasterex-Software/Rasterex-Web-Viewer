!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],t):"object"==typeof exports?exports.FormToSheetUIXAddon=t(require("UIExtension")):e.FormToSheetUIXAddon=t(e.UIExtension)}(self,(e=>(()=>{var t={737:e=>{e.exports=null},616:t=>{"use strict";t.exports=e}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,o),i.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";function e(t,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](t):e(t,n)}function t(t,n){if(!e(t,n))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function u(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=a(e);if(t){var r=a(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return u(this,n)}}o.d(r,{default:()=>V});var f=o(616),h=o(737),p=o.n(h);function d(e,t,n){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n||e):r.value}},d(e,t,n||e)}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function g(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i=[],l=!0,c=!1;try{for(n=n.call(e);!(l=(o=n.next()).done)&&(i.push(o.value),!t||i.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{l||null==n.return||n.return()}finally{if(c)throw r}}return i}}(e,t)||g(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var y=f.PDFViewCtrl.Events,b=f.PDFViewCtrl.Consts.PDFDocPermission,P=function(e){c(o,e);var n=s(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,[{key:"changePermission",value:function(e){var t=this,n=this.getPDFUI().getPDFDocRender().then((function(e){return e.getUserPermission().getValue()}));Promise.all([e.hasForm(),n]).then((function(e){var n=v(e,2);n[0];n[1]&t.constructor.permission?t.component.lock&&t.component.unlock():t.component.lock&&t.component.lock()}))}},{key:"mounted",value:function(){var e=this;d(a(o.prototype),"mounted",this).call(this),this.addDestroyHook(this.getPDFUI().addViewerEventListener(y.recognitionForm,(function(t){e.changePermission(t)})),this.getPDFUI().addViewerEventListener(y.annotationAdd,(function(t){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))}))),this.addDestroyHook(this.getPDFUI().addViewerEventListener(y.annotationRemoved,(function(t){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))})))}}],[{key:"getName",value:function(){return"FormToSheetController"}},{key:"permission",get:function(){return b.Extract}}]),o}(f.Controller);function D(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var F=/^\s|\s$|,|"|\n/;function w(e){var t;return t=e,"[object String]"===Object.prototype.toString.apply(t)?(e=e.replace(/"/g,'""'),F.test(e)?e='"'+e+'"':""===e&&(e='""')):e=null==e?"":e.toString(),e}function k(e){return"\n"===e||"\r"===e}function x(e){if(!e)return[];for(var t,n="",o=!1,r=!1,i="",l=[],c=[],a=function(e){var t=new RegExp('"([^]*?)"',"gm"),n=(e=e.substring(0,1048576).replace(t,"")).split("\r"),o=e.split("\n"),r=o.length>1&&o[0].length<n[0].length;if(1===n.length||r)return console.log("n"),"\n";for(var i=0,l=0;l<n.length;l++)"\n"===n[l][0]&&i++;return i>=n.length/2?console.log("r n"):console.log("r"),i>=n.length/2?"\r\n":"\r"}(e="\n"!==(t=e).charAt(t.length-1)?t:"\r"!==t.charAt(t.length-2)?t.substring(0,t.length-1):t.substring(0,t.length-2)),u=0;u<e.length;u+=1)n=e.charAt(u),!1!==o||","!==n&&!k(n)?'"'!==n?i+=n:o?'"'===e.charAt(u+1)?(i+='"',u+=1):o=!1:(o=!0,r=!0):(""!==i||r||(i=null),l.push(i),k(n)&&(c.push(l),l=[]),"\r"===n&&"\r\n"===a&&(u+=1),i="",r=!1);return l.push(i),c.push(l),c}var S=PDFViewCtrl.KeyboardUtils,I=S.isMatch,U=S.matchers,_=f.PDFViewCtrl.shared.download,C=f.PDFViewCtrl.Events,A=function(e){c(o,e);var n=s(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,[{key:"changePermission",value:function(e){var t=this,n=this.getPDFUI().getPDFDocRender().then((function(e){return e&&e.getUserPermission()}));Promise.all([e&&!e.isDestroyed&&e.hasForm(),n]).then((function(e){var n=v(e,2),o=n[0],r=n[1],i=r&&r.checkModify(),l=r&&r.checkAnnotForm();o&&i&&l?t.component.lock&&t.component.unlock():t.component.lock&&t.component.lock()}))}},{key:"handle",value:function(e){var t=new Promise((function(t,n){var o=new FileReader;o.onloadend=function(e){t(e.target.result)},o.readAsText(e)})),n=this.getPDFUI().getCurrentPDFDoc().then((function(e){var t=[null],n=[e.getFileName()||null];return e.getPDFForm().enumFields([],0,(function(e,o,r){t.push(o),n.push(r)})),[t,n]}));Promise.all([t,n]).then((function(t){var n=v(t,2),o=n[0],r=n[1],i=function(e){var t,n,o,r,i="";for(o=0;o<e.length;o+=1){for(n=e[o],r=0;r<n.length;r+=1)t=w(t=n[r]),i+=r<n.length-1?t+",":t;i+="\r\n"}return i}(function(e,t){if(!e||!e.length)return t;if(!t||!t.length)return e;var n=e[0],o=t[0],r=D(n),i=[],l=[];for(var c in o){var a=o[c],u=r.indexOf(a);u<0?i[r.push(a)-1]=c:i[u]=c}l.push(r);for(var s=r.length,f=e.length,h=1;h<f;h++){for(var p=e[h],d=[],m=0;m<s;m++)d.push(p[m]);l.push(d)}for(var g=t.length,v=1;v<g;v++){var y=t[v],b=[],P=!0,F=!1,w=void 0;try{for(var k,x=i[Symbol.iterator]();!(P=(k=x.next()).done);P=!0){var S=k.value;b.push(y[S])}}catch(e){F=!0,w=e}finally{try{P||null==x.return||x.return()}finally{if(F)throw w}}l.push(b)}return l}(x(o),r)),l=new Blob(["\ufeff"+i],{type:"text/csv,charset=UTF-8"});_(l,e.name,"application/csv")}))}},{key:"mounted",value:function(){var e=this;d(a(o.prototype),"mounted",this).call(this);var t=this.component.element;t.classList.remove("fv__ui-button"),t.querySelector(".fv__ui-button-text").classList.remove("fv__ui-button-text"),this.addDestroyHook(this.getPDFUI().addViewerEventListener(C.recognitionForm,(function(t){e.changePermission(t)})),this.getPDFUI().addViewerEventListener(C.annotationRemoved,(function(t){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))})),this.getPDFUI().addViewerEventListener(C.annotationAdd,(function(t){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))}))),this.component.element.addEventListener("keydown",(function(t){var n=U.or,o=U.Enter,r=U.Space;I(t,n(o,r))&&e.component.parent.deactive()}))}}],[{key:"getName",value:function(){return"AppendSheetController"}}]),o}(f.Controller),E=f.PDFViewCtrl.Events,O=function(e){c(o,e);var n=s(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,[{key:"changePermission",value:function(e){var t=this,n=this.getPDFUI().getPDFDocRender().then((function(e){return e&&e.getUserPermission()}));Promise.all([e&&!e.isDestroyed&&e.hasForm(),n]).then((function(e){var n=v(e,2),o=n[0],r=n[1],i=r&&r.checkModify(),l=r&&r.checkAnnotForm();o&&i&&l?t.component.lock&&t.component.unlock():t.component.lock&&t.component.lock()}))}},{key:"mounted",value:function(){var e=this;d(a(o.prototype),"mounted",this).call(this),this.addDestroyHook(this.getPDFUI().addViewerEventListener(E.recognitionForm,(function(t){e.changePermission(t)})),this.getPDFUI().addViewerEventListener(E.annotationAdd,(function(t){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))}))),this.addDestroyHook(this.getPDFUI().addViewerEventListener(E.annotationRemoved,(function(t){e.getPDFUI().getPDFDocRender().then((function(t){e.changePermission(t.getPDFDoc())}))})))}}],[{key:"getName",value:function(){return"FormToSheetDropdownController"}}]),o}(f.Controller),R=function(e){c(o,e);var n=s(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,null,[{key:"getName",value:function(){return"form-to-sheet-ribbon-dropdown"}}]),o}(f.SeniorComponentFactory.createSuperClass({template:'\n    <ribbon-button @tooltip tooltip-title="form-to-sheet:button-tooltip.title" @controller="form-to-sheet-module:FormToSheetDropdownController" name="form-to-sheet" @var.self="$component"  not-immediately="true">\n        <dropdown icon-class="fv__icon-toolbar-form-to-sheet" separate="false" selected="0" @on.selected="self.select($args[0])" @cannotBeDisabled>\n            <file-selector ribbon-text="form-to-sheet:ribbon.text" ribbon-icon="fx-icon-ribbon_form_append_to_an_existing_sheet-32" @controller="form-to-sheet-module:AppendSheetController" name="append-to-sheet" icon-class="fx-icon-sm fv__icon-toolbar-append-to-sheet"  accept=".csv" >\n                form-to-sheet:export.existing\n            </file-selector>\n        </dropdown>\n    </ribbon-button>\n    '})),j=function(e){c(o,e);var n=s(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,null,[{key:"getName",value:function(){return"form-to-sheet-dropdown"}}]),o}(f.SeniorComponentFactory.createSuperClass({template:'\n        <dropdown @tooltip @controller="form-to-sheet-module:FormToSheetController" name="form-to-sheet"  icon-class="fv__icon-toolbar-form-to-sheet" tooltip-title="form-to-sheet:button-tooltip.title" separate="false" selectable="false">\n            <file-selector @controller="form-to-sheet-module:AppendSheetController" name="append-to-sheet" icon-class="fv__icon-toolbar-append-to-sheet"  accept=".csv" @cannotBeDisabled>\n                form-to-sheet:export.existing\n            </file-selector>\n        </dropdown>\n    '})),V=function(e){c(o,e);var n=s(o);function o(){return t(this,o),n.apply(this,arguments)}return i(o,[{key:"fragments",value:function(){return[]}}],[{key:"getName",value:function(){return"formToSheet"}},{key:"getLoader",value:function(){return p()}},{key:"initOnLoad",value:function(){var e=f.modular.module("form-to-sheet-module",[]);e.registerComponent(j),e.registerComponent(R),e.registerController(P),e.registerController(A),e.registerController(O)}}]),o}(f.UIXAddon)})(),r=r.default})()));