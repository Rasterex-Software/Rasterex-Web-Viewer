!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],e):"object"==typeof exports?exports.ImportFormUIXAddon=e(require("UIExtension")):t.ImportFormUIXAddon=e(t.UIExtension)}(self,(t=>(()=>{var e={359:t=>{t.exports=null},616:e=>{"use strict";e.exports=t}},o={};function n(t){var r=o[t];if(void 0!==r)return r.exports;var i=o[t]={exports:{}};return e[t](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var r={};return(()=>{"use strict";function t(e,o){return null!=o&&"undefined"!=typeof Symbol&&o[Symbol.hasInstance]?!!o[Symbol.hasInstance](e):t(e,o)}function e(e,o){if(!t(e,o))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function u(t,e,o){return u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,o){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(o||t):r.value}},u(t,e,o||t)}function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var n,r,i=[],c=!0,u=!1;try{for(o=o.call(t);!(c=(n=o.next()).done)&&(i.push(n.value),!e||i.length!==e);c=!0);}catch(t){u=!0,r=t}finally{try{c||null==o.return||o.return()}finally{if(u)throw r}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(o):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?f(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){return!e||"object"!=((o=e)&&"undefined"!=typeof Symbol&&o.constructor===Symbol?"symbol":typeof o)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e;var o}function m(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var o,n=c(t);if(e){var r=c(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return p(this,o)}}n.d(r,{default:()=>h});var d=n(616),y=n(359),b=n.n(y),v=d.PDFViewCtrl.Events,h=function(t){a(n,t);var o=m(n);function n(){return e(this,n),o.apply(this,arguments)}return i(n,[{key:"fragments",value:function(){return[]}}],[{key:"getName",value:function(){return"importForm"}},{key:"getLoader",value:function(){return b()}},{key:"initOnLoad",value:function(){var t=d.modular.module("import-form-module",[]),o={template:'<ribbon-button @tooltip name="import-form-tool"  @var.self="$component" class="fx-ribbon-hidden-dropdown" text="import:ribbon.text" not-dropdown="true">\n        <dropdown @on.selected="self.select($args[0])" selected="0">\n                <file-selector ribbon-icon="fx-icon-ribbon_form_import-32" text="import:ribbon.text" @tooltip name="import-form-tool" accept=".xml,.fdf,.xfdf,.csv,.txt" icon-class="fx-icon-md fv__icon-toolbar-import-form" ></file-selector>\n        </dropdown>\n        </ribbon-button>\n                ',config:{target:"import-form-tool",tooltip:{title:"import:button-tooltip.title"},callback:function(t){a(n,t);var o=m(n);function n(){return e(this,n),o.apply(this,arguments)}return i(n,[{key:"changePermission",value:function(t){var e=this,o=this.getPDFUI().getPDFDocRender().then((function(t){return t&&t.getUserPermission().getValue()}));Promise.all([t&&!t.isDestroyed&&t.hasForm(),o]).then((function(o){var n=s(o,2),r=n[0];n[1]&e.constructor.permission&&r&&!t.isStaticXFA()&&!t.isDynamicXFA()?e.component.lock&&e.component.unlock():e.component.lock&&e.component.lock()}))}},{key:"mounted",value:function(){var t=this;u(c(n.prototype),"mounted",this).call(this),this.addDestroyHook(this.getPDFUI().addViewerEventListener(v.recognitionForm,(function(e){t.changePermission(e)})),this.getPDFUI().addViewerEventListener(v.annotationAdd,(function(e){t.getPDFUI().getPDFDocRender().then((function(e){t.changePermission(e.getPDFDoc())}))}))),this.addDestroyHook(this.getPDFUI().addViewerEventListener(v.annotationRemoved,(function(e){t.getPDFUI().getPDFDocRender().then((function(e){t.changePermission(e.getPDFDoc())}))})))}},{key:"handle",value:function(t){this.getPDFUI().getPDFDocRender().then((function(e){var o=e.getPDFDoc(),n=t.name,r=n.substr(n.length-3),i=0,c=Promise.resolve();switch(r){case"fdf":case"xfdf":break;case"xml":i=2;break;case"csv":i=3,c=g(t);break;case"txt":i=4,c=g(t)}c.then((function(e){e||3!==i||(e="GBK"),o.importFormFromFile(t,i,e)}))}))}}],[{key:"permission",get:function(){return d.PDFViewCtrl.Consts.PDFDocPermission.AnnotForm+d.PDFViewCtrl.Consts.PDFDocPermission.FillForm}}]),n}(d.Controller)}};t.registerPreConfiguredComponent("import-form-ribbon-button",o),t.registerPreConfiguredComponent("import-form-button",Object.assign({},o,{template:'<file-selector @tooltip tooltip-title="import:button-tooltip.title" text="import:button-tooltip.title" name="import-form-tool" accept=".xml,.fdf,.xfdf,.csv,.txt" icon-class="fv__icon-toolbar-import-form" ></file-selector>'}))}}]),n}(d.UIXAddon),g=function(t){return new Promise((function(e,o){var n=new FileReader;n.onloadend=function(){var t=new Uint8Array(n.result);return 254==t[0]&&255==t[1]||255==t[0]&&254==t[1]?e("UTF-16"):239==t[0]&&187==t[1]&&191==t[2]?e("UTF-8"):0==t[0]&&0==t[1]&&254==t[2]&&255==t[3]?e("UTF-32"):void e()},n.readAsArrayBuffer(t)}))}})(),r=r.default})()));