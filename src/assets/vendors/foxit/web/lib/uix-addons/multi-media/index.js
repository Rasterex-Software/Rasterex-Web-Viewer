!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],t):"object"==typeof exports?exports.MultiMediaAddon=t(require("UIExtension")):e.MultiMediaAddon=t(e.UIExtension)}(self,(e=>(()=>{var t={73:(e,t,i)=>{i(779);e.exports=function(e){"use strict";e=e||{};return'<div class="fv__multi-file-div fv__dialog-body">\n<div class="fv__multi-item fv__activated">\n<div class="fv__multi-label">\n<input type="radio" name="file-type" class="file-type-radio" value="1" checked/>\n<span class="fv__multi-file-label" data-i18n="multi-media:dialog.rec-file-label"></span>\n</div>\n<div class="fv__choose-file-btn">\n<div data-i18n="multi-media:dialog.chooseFile"></div>\n<input type="file" class="fv__multi-file" accept="audio/wav, audio/mpeg, audio/mp4, video/mp4, video/quicktime" data-i18n="[title]multi-media:dialog.chooseFile"/>\n</div>\n</div>\n<div class="fv__multi-item">\n<div  class="fv__multi-label">\n<input type="radio" name="file-type" class="file-type-radio" value="2" />\n<span class="fv__multi-file-label" data-i18n="multi-media:dialog.rec-recorder-label"></span>\n</div>\n<button class="fv__record-record" tabindex="-1"></button>\n<span class="fv__record_recording-tips" data-i18n="multi-media:dialog.rec-recording-tip"></span>\n<audio class="fv__record-audio fv__record-hide" controls controlslist="nodownload" controlslist="nofullscreen"></audio>\n</div>\n\n<div class="fv__record-error"></div>\n<div class="fv__multi-item">\n<label class="fv__multi-file-label fv__poster-file-label" data-i18n="multi-media:dialog.rec-poster-file-label"></label>\n<div class="fv__choose-file-btn">\n<div data-i18n="multi-media:dialog.chooseFile"></div>\n<input type="file" class="fv__poster-file" accept="image/gif, image/jpeg, image/png" data-i18n="[title]multi-media:dialog.chooseFile"/>\n</div>\n</div>\n<div class="error-message"></div>\n</div>\n<div class="fv__multi-file-div fv__multi-file-btn footer">\n<button type="button" class="fv__multi-media-btn fv__button-ok fv__ui-dialog-ok-button" disabled data-i18n="multi-media:dialog.ok"></button>\n<button type="button" class="fv__multi-media-cancel fv__button-cancle fv__ui-dialog-cancel-button" data-i18n="multi-media:dialog.cancel"></button>\n</div>','<div class="fv__multi-file-div fv__dialog-body">\n<div class="fv__multi-item fv__activated">\n<div class="fv__multi-label">\n<input type="radio" name="file-type" class="file-type-radio" value="1" checked/>\n<span class="fv__multi-file-label" data-i18n="multi-media:dialog.rec-file-label"></span>\n</div>\n<div class="fv__choose-file-btn">\n<div data-i18n="multi-media:dialog.chooseFile"></div>\n<input type="file" class="fv__multi-file" accept="audio/wav, audio/mpeg, audio/mp4, video/mp4, video/quicktime" data-i18n="[title]multi-media:dialog.chooseFile"/>\n</div>\n</div>\n<div class="fv__multi-item">\n<div  class="fv__multi-label">\n<input type="radio" name="file-type" class="file-type-radio" value="2" />\n<span class="fv__multi-file-label" data-i18n="multi-media:dialog.rec-recorder-label"></span>\n</div>\n<button class="fv__record-record" tabindex="-1"></button>\n<span class="fv__record_recording-tips" data-i18n="multi-media:dialog.rec-recording-tip"></span>\n<audio class="fv__record-audio fv__record-hide" controls controlslist="nodownload" controlslist="nofullscreen"></audio>\n</div>\n\n<div class="fv__record-error"></div>\n<div class="fv__multi-item">\n<label class="fv__multi-file-label fv__poster-file-label" data-i18n="multi-media:dialog.rec-poster-file-label"></label>\n<div class="fv__choose-file-btn">\n<div data-i18n="multi-media:dialog.chooseFile"></div>\n<input type="file" class="fv__poster-file" accept="image/gif, image/jpeg, image/png" data-i18n="[title]multi-media:dialog.chooseFile"/>\n</div>\n</div>\n<div class="error-message"></div>\n</div>\n<div class="fv__multi-file-div fv__multi-file-btn footer">\n<button type="button" class="fv__multi-media-btn fv__button-ok fv__ui-dialog-ok-button" disabled data-i18n="multi-media:dialog.ok"></button>\n<button type="button" class="fv__multi-media-cancel fv__button-cancle fv__ui-dialog-cancel-button" data-i18n="multi-media:dialog.cancel"></button>\n</div>'}},502:(e,t,i)=>{var r=i(779);e.exports=function(e){"use strict";e=e||{};var t="",i=r.$escape,n=e.buttonType;return t+='<div name="multi-media">\n<',t+=i(n),t+=' text="multi-media:buttons.title" name="multi-media-btn" icon-class="fv__icon-multi-media" @tooltip>multi-media:buttons.title</',t+=i(n),t+=">\n</div>"}},423:e=>{e.exports=null},585:(e,t,i)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var r="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i.g?i.g:{},n=Object.create(r),o=/["&'<>]/;function a(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?a(e.call(e)):JSON.stringify(e)),e}n.$escape=function(e){return function(e){var t=""+e,i=o.exec(t);if(!i)return e;var r="",n=void 0,a=void 0,s=void 0;for(n=i.index,a=0;n<t.length;n++){switch(t.charCodeAt(n)){case 34:s="&#34;";break;case 38:s="&#38;";break;case 39:s="&#39;";break;case 60:s="&#60;";break;case 62:s="&#62;";break;default:continue}a!==n&&(r+=t.substring(a,n)),a=n+1,r+=s}return a!==n?r+t.substring(a,n):r}(a(e))},n.$each=function(e,t){if(Array.isArray(e))for(var i=0,r=e.length;i<r;i++)t(e[i],i);else for(var n in e)t(e[n],n)},e.exports=n},779:(e,t,i)=>{"use strict";e.exports=i(585)},893:e=>{e.exports="data:image/svg+xml;charset=utf-8;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJtMjEgMTQuNWgtMTRjLTAuODI4NDMgMC0xLjUgMC42NzE2LTEuNSAxLjV2OGMwIDAuODI4NCAwLjY3MTU3IDEuNSAxLjUgMS41aDE0YzAuODI4NCAwIDEuNS0wLjY3MTYgMS41LTEuNXYtOGMwLTAuODI4NC0wLjY3MTYtMS41LTEuNS0xLjV6IiBzdHJva2U9IiMzMzMiLz48cGF0aCBkPSJtOSAxNC41YzEuOTMzIDAgMy41LTEuNTY3IDMuNS0zLjVzLTEuNTY3LTMuNS0zLjUtMy41LTMuNSAxLjU2Ny0zLjUgMy41IDEuNTY3IDMuNSAzLjUgMy41eiIgc3Ryb2tlPSIjMzMzIi8+PHBhdGggZD0ibTE4IDE0LjVjMi40ODUzIDAgNC41LTIuMDE0NyA0LjUtNC41IDAtMi40ODUzLTIuMDE0Ny00LjUtNC41LTQuNXMtNC41IDIuMDE0Ny00LjUgNC41YzAgMi40ODUzIDIuMDE0NyA0LjUgNC41IDQuNXoiIHN0cm9rZT0iIzMzMyIvPjxwYXRoIGQ9Im0yNy4yOTUgMTUuMDQ0LTQuMjk1MiAzLjQzNjF2My4wMzg4bDQuMjk1MiAzLjQzNjFjMC40MDc4LTAuMTI2MiAwLjcwNDgtMC41MDY4IDAuNzA0OC0wLjk1NTV2LThjMC0wLjQ0ODctMC4yOTctMC44MjkzLTAuNzA0OC0wLjk1NTV6bS0wLjI5NTItMS4wNDQ1YzEuMTA0NiAwIDIgMC44OTU0IDIgMnY4YzAgMS4xMDQ2LTAuODk1NCAyLTIgMmwtNS00di00bDUtNHoiIGZpbGw9IiMzMzMiLz48L3N2Zz4K"},317:(e,t,i)=>{var r=i(645),n=i(667),o=i(893);t=r(!1);var a=n(o);t.push([e.id,".fv__icon-multi-media {\n    /*background-image: url(../assets/Ribbon_edit_Audio&Video_32.svg);*/\n    background-repeat: no-repeat;\n    background-position: center;\n    background-image: var(--fv-icon-toolbar-multi-media, url("+a+"));\n} \n.fv__cursor-cross{\n    cursor: crosshair;\n}\n\n.fv__ui-mobile .fv__icon-multi-media {\n    /*background-image: url(../assets/Ribbon_edit_Audio&Video_32.svg);*/\n    background-image: var(--fv-icon-toolbar-multi-media-mobile, url("+a+"));\n}",""]),e.exports=t},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",r=e[3];if(!r)return i;if(t&&"function"==typeof btoa){var n=(a=r,s=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(l," */")),o=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(e," */")}));return[i].concat(o).concat([n]).join("\n")}var a,s,l;return[i].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,r){"string"==typeof e&&(e=[[null,e,""]]);var n={};if(r)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(n[a]=!0)}for(var s=0;s<e.length;s++){var l=[].concat(e[s]);r&&n[l[0]]||(i&&(l[2]?l[2]="".concat(i," and ").concat(l[2]):l[2]=i),t.push(l))}},t}},667:e=>{"use strict";e.exports=function(e,t){return t||(t={}),"string"!=typeof(e=e&&e.__esModule?e.default:e)?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},998:(e,t,i)=>{var r=i(317);"string"==typeof r&&(r=[[e.id,r,""]]);var n={hmr:!0,transform:undefined,insertInto:void 0};i(723)(r,n);r.locals&&(e.exports=r.locals)},723:(e,t,i)=>{var r,n,o={},a=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===n&&(n=r.apply(this,arguments)),n}),s=function(e){return document.querySelector(e)},l=function(e){var t={};return function(e){if("function"==typeof e)return e();if(void 0===t[e]){var i=s.call(this,e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}}(),u=null,c=0,d=[],f=i(947);function v(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=o[r.id];if(n){n.refs++;for(var a=0;a<n.parts.length;a++)n.parts[a](r.parts[a]);for(;a<r.parts.length;a++)n.parts.push(y(r.parts[a],t))}else{var s=[];for(a=0;a<r.parts.length;a++)s.push(y(r.parts[a],t));o[r.id]={id:r.id,refs:1,parts:s}}}}function p(e,t){for(var i=[],r={},n=0;n<e.length;n++){var o=e[n],a=t.base?o[0]+t.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};r[a]?r[a].parts.push(s):i.push(r[a]={id:a,parts:[s]})}return i}function m(e,t){var i=l(e.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=d[d.length-1];if("top"===e.insertAt)r?r.nextSibling?i.insertBefore(t,r.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),d.push(t);else if("bottom"===e.insertAt)i.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var n=l(e.insertInto+" "+e.insertAt.before);i.insertBefore(t,n)}}function h(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function g(e){var t=document.createElement("style");return void 0===e.attrs.type&&(e.attrs.type="text/css"),b(t,e.attrs),m(e,t),t}function b(e,t){Object.keys(t).forEach((function(i){e.setAttribute(i,t[i])}))}function y(e,t){var i,r,n,o;if(t.transform&&e.css){if(!(o=t.transform(e.css)))return function(){};e.css=o}if(t.singleton){var a=c++;i=u||(u=g(t)),r=M.bind(null,i,a,!1),n=M.bind(null,i,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",b(t,e.attrs),m(e,t),t}(t),r=L.bind(null,i,t),n=function(){h(i),i.href&&URL.revokeObjectURL(i.href)}):(i=g(t),r=S.bind(null,i),n=function(){h(i)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else n()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var i=p(e,t);return v(i,t),function(e){for(var r=[],n=0;n<i.length;n++){var a=i[n];(s=o[a.id]).refs--,r.push(s)}e&&v(p(e,t),t);for(n=0;n<r.length;n++){var s;if(0===(s=r[n]).refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete o[s.id]}}}};var _,w=(_=[],function(e,t){return _[e]=t,_.filter(Boolean).join("\n")});function M(e,t,i,r){var n=i?"":r.css;if(e.styleSheet)e.styleSheet.cssText=w(t,n);else{var o=document.createTextNode(n),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}function S(e,t){var i=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}function L(e,t,i){var r=i.css,n=i.sourceMap,o=void 0===t.convertToAbsoluteUrls&&n;(t.convertToAbsoluteUrls||o)&&(r=f(r)),n&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var a=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}},947:e=>{e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var i=t.protocol+"//"+t.host,r=i+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var n,o=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?e:(n=0===o.indexOf("//")?o:0===o.indexOf("/")?i+o:r+o.replace(/^\.\//,""),"url("+JSON.stringify(n)+")")}))}},616:t=>{"use strict";t.exports=e}},i={};function r(e){var n=i[e];if(void 0!==n)return n.exports;var o=i[e]={id:e,exports:{}};return t[e](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};return(()=>{"use strict";function e(t,i){return null!=i&&"undefined"!=typeof Symbol&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](t):e(t,i)}function t(t,i){if(!e(t,i))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function u(e,t){return!t||"object"!=((i=t)&&"undefined"!=typeof Symbol&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var i}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,r=l(e);if(t){var n=l(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return u(this,i)}}r.d(n,{default:()=>N});var d=r(616);function f(e,t,i){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(i||e):n.value}},f(e,t,i||e)}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function p(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?v(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var m=r(73),h=r.n(m);window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var g,b=window.AudioContext||window.webkitAudioContext||function(){},y=function(){function e(i,r){t(this,e);var n={numChannels:2};n.sampleBits=n.sampleBits||8,n.sampleRate=n.sampleRate||44100,this.context=g,this.stream=i,this.audioInput=g.createMediaStreamSource(i),this.config=Object.assign({},n);var o=n.numChannels;this.recorder=g.createScriptProcessor(4096,o,o),this.audioInput.connect(this.recorder),this.recorder.connect(this.context.destination);var a=this;this.audioData={size:0,buffer:[],inputSampleRate:g.sampleRate,inputSampleBits:16,outputSampleRate:n.sampleRate,outputSampleBits:n.sampleBits,init:function(){this.size=0,this.buffer=[],this.initBuffers()},initBuffers:function(){for(var e=0;e<o;e++)this.buffer[e]=[]},input:function(e){for(var t=0;t<o;t++)this.buffer[t].push(e[t]);this.size+=e[0].length},mergeBuffers:function(e,t){for(var i=new Float32Array(t),r=0,n=0;n<e.length;n++)i.set(e[n],r),r+=e[n].length;return i},interleave:function(e,t){for(var i=e.length+t.length,r=new Float32Array(i),n=0,o=0;n<i;)r[n++]=e[o],r[n++]=t[o],o++;return r},getBuffer:function(){for(var e=[],t=0;t<o;t++)e.push(this.mergeBuffers(this.buffer[t],this.size));return e},compress:function(e){for(var t=Math.max(parseInt(this.inputSampleRate/this.outputSampleRate),1),i=e.length/t,r=new Float32Array(i),n=0,o=0;n<i;)r[n]=e[o],o+=t,n++;return r},floatTo16BitPCM:function(e,t,i){for(var r=0;r<i.length;r++,t+=2){var n=Math.max(-1,Math.min(1,i[r]));e.setInt16(t,n<0?32768*n:32767*n,!0)}},writeString:function(e,t,i){for(var r=0;r<i.length;r++)e.setUint8(t+r,i.charCodeAt(r))},encodeWAV:function(){for(var e,t=[],i=0;i<o;i++)t.push(this.mergeBuffers(this.buffer[i],this.size));e=2===o?this.interleave(t[0],t[1]):t[0];var r=this.compress(e),n=Math.min(this.inputSampleRate,this.outputSampleRate),a=new ArrayBuffer(44+2*r.length),s=new DataView(a);return this.writeString(s,0,"RIFF"),s.setUint32(4,36+2*r.length,!0),this.writeString(s,8,"WAVE"),this.writeString(s,12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,o,!0),s.setUint32(24,n,!0),s.setUint32(28,4*n,!0),s.setUint16(32,2*o,!0),s.setUint16(34,16,!0),this.writeString(s,36,"data"),s.setUint32(40,2*r.length,!0),this.floatTo16BitPCM(s,44,r),new Blob([s],{type:"audio/wav"})}};this.recorder.onaudioprocess=function(e){for(var t=[],i=0;i<a.config.numChannels;i++)t.push(new Float32Array(e.inputBuffer.getChannelData(i)));a.audioData.input(t),r(e)},this.audioData.init()}return o(e,[{key:"start",value:function(){this.audioInput.connect(this.recorder),this.recorder.connect(this.context.destination),this.recording=!0}},{key:"stop",value:function(){this.audioInput.disconnect(this.recorder),this.recorder.disconnect(this.context.destination),this.stream.getAudioTracks().forEach((function(e){e.stop()})),this.stream=null,this.recording=!1}},{key:"getBlob",value:function(){return this.audioData.encodeWAV()}},{key:"play",value:function(e){e.src=window.URL.createObjectURL(this.getBlob())}},{key:"clear",value:function(){return this.audioData.init()}}],[{key:"get",value:function(t,i,r){!1===function(){if(!window.AudioContext&&!window.webkitAudioContext)return!1;var e=navigator.mediaDevices;if(e){if(!e.getUserMedia&&!navigator.getUserMedia)return!1}else if(!navigator.getUserMedia)return!1;return!0}()&&r(new Error("BrowserNotSupported")),g||(g=new b),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then((function(r){var n=new e(r,i);t(n)})).catch((function(e){r(e)})):navigator.getUserMedia?navigator.getUserMedia({audio:!0},(function(r){var n=new e(r,i);t(n)}),r):r(new Error("BrowserNotSupported"))}}]),e}(),_=PDFViewCtrl.DeviceInfo.isMobile,w=PDFViewCtrl.BrowserInfo.isSafari,M=function(e){s(r,e);var i=c(r);function r(){return t(this,r),i.apply(this,arguments)}return o(r,[{key:"render",value:function(){f(l(r.prototype),"render",this).call(this),this.element.classList.add("multi-media-popup")}},{key:"rendered",value:function(){}},{key:"setSubmitCallback",value:function(e){this.callback=e}},{key:"show",value:function(){if(!this.dialog){this.isRecording=!1;var e={};w&&_&&(this.element.classList.add("mobile-safari"),e.isMobileSafari=!0),this.element.querySelector(".fv__ui-layer-panel").innerHTML=h()(e),this.recordErrorDiv=this.element.querySelector(".fv__record-error"),this.localize(),this.bindEvent(),this.dialog=1}f(l(r.prototype),"show",this).call(this),this.reset()}},{key:"reset",value:function(){var e=this.element.querySelector(".fv__multi-file");e.value="",e.previousElementSibling.innerText=this.localizer.translateSync("multi-media:dialog.chooseFile"),e.removeAttribute("disabled");var t=this.element.querySelector(".fv__poster-file");t.value="",t.previousElementSibling.innerText=this.localizer.translateSync("multi-media:dialog.chooseFile"),this.audio&&(this.audio.removeAttribute("src"),this.audio.classList.add("fv__record-hide")),this.recorder&&this.recorder.clear(),this.lastAudioUrl="";var i=this.element.querySelector(".file-type-radio");i.checked=!0,this.element.querySelector(".fv__activated").classList.remove("fv__activated"),i.parentNode.parentNode.classList.add("fv__activated"),this.element.querySelector(".error-message").innerHTML="",this.submitBtn=this.element.querySelector(".fv__multi-media-btn"),this.submitBtn.setAttribute("disabled",""),this.hideRecordError()}},{key:"getValidatedFileDatas",value:function(){var e,t=this.element.querySelector(".file-type-radio"),i=this.element.querySelector(".error-message");if(i.innerHTML="",t.checked){var r=this.element.querySelector(".fv__multi-file");if(e=r.files[0],r.previousElementSibling.innerText=e?e.name:this.localizer.translateSync("multi-media:dialog.chooseFile"),e){var n=e.name.substr(e.name.lastIndexOf(".")).toLowerCase();if(-1===[".mp4",".mp3",".m4a",".wav",".mov"].indexOf(n))return this.submitBtn.setAttribute("disabled",""),i.innerHTML=this.localizer.translateSync("dialog.error.fileFormatError"),!1}}else if(this.recorder){if(!this.element.querySelector(".fv__record-record").classList.contains("fv__recording")){var o=this.recorder.getBlob();o&&(e=navigator.msSaveBlob?new Blob([o],{type:"audio/wav"}):new File([o],"record.wav",{type:"audio/wav"}))}}var a=this.element.querySelector(".fv__poster-file"),s=a.files[0];if(a.previousElementSibling.innerText=s?s.name:this.localizer.translateSync("multi-media:dialog.chooseFile"),s){var l=s.name.substr(s.name.lastIndexOf(".")).toLowerCase();if(-1===[".png",".jpg",".jpeg",".gif"].indexOf(l))return this.submitBtn.setAttribute("disabled",""),i.innerHTML=this.localizer.translateSync("dialog.error.fileFormatError"),!1}return e?(this.submitBtn.removeAttribute("disabled"),[e,s]):(this.submitBtn.setAttribute("disabled",""),!1)}},{key:"bindEvent",value:function(){var e=this,t=(this.recordBtn=this.element.querySelector(".fv__record-record"),this.audio=this.element.querySelector(".fv__record-audio"));this.element.querySelector(".fv__multi-file").addEventListener("change",(function(t){e.getValidatedFileDatas()})),this.element.querySelector(".fv__poster-file").addEventListener("change",(function(t){e.getValidatedFileDatas()})),this.element.querySelector(".fv__multi-media-btn").addEventListener("click",(function(t){var i=e.getValidatedFileDatas();!1!==i&&(e.callback&&e.callback.apply(e,p(i)),e.hide())})),this.element.querySelector(".fv__multi-media-cancel").addEventListener("click",(function(t){e.hide()})),this.element.querySelectorAll(".file-type-radio").forEach((function(t){t.addEventListener("change",(function(t){e.getValidatedFileDatas(),e.recordErrorDiv.innerHTML="",e.recordErrorDiv.classList.remove("fv__record-error-show"),e.element.querySelector(".fv__activated").classList.remove("fv__activated"),t.target.parentNode.parentNode.classList.add("fv__activated"),1==t.target.value?(e.audio.src&&(e.lastAudioUrl=e.audio.src),e.audio.removeAttribute("src"),e.audio.classList.add("fv__record-hide"),e.element.querySelector(".fv__multi-file").removeAttribute("disabled")):(e.stop(),e.lastAudioUrl?e.audio.src=e.lastAudioUrl:e.audio.removeAttribute("src"),e.lastAudioUrl&&e.audio.classList.remove("fv__record-hide"),e.element.querySelector(".fv__multi-file").setAttribute("disabled",""))}))})),this.element.querySelector(".fv__record-record").addEventListener("click",(function(i){if(!e.element.querySelector(".file-type-radio").checked)if(e.hideRecordError(),i.target.classList.contains("fv__recording"))i.target.classList.remove("fv__recording"),e.audio.classList.remove("fv__record-audio-disable-click"),e.recorder.stop(),e.recorder.play(t),e.audio.classList.remove("fv__record-hide"),e.getValidatedFileDatas();else{var r=0;e.audio.classList.add("fv__record-hide"),y.get((function(t){i.target.classList.add("fv__recording"),e.audio.classList.add("fv__record-audio-disable-click"),e.getValidatedFileDatas(),e.recorder=t,e.recorder.start()}),(function(e){var t=parseInt(e.playbackTime);t>r&&(r=t)}),(function(t){e.showRecordError(t)}))}}))}},{key:"stop",value:function(){var e=this.element.querySelector(".fv__record-record");e.classList.contains("fv__recording")&&(e.classList.remove("fv__recording"),this.recorder.stop(),audio&&this.recorder.play(audio),this.audio.classList.remove("fv__record-hide"),this.getValidatedFileDatas())}},{key:"hideRecordError",value:function(){this.recordErrorDiv.innerHTML="",this.recordErrorDiv.classList.remove("fv__record-error-show")}},{key:"showRecordError",value:function(e){var t,i=e.name||e.message;t="http:"==location.protocol?"RequireHTTPS":"NotFoundError"==i||"DeviceNotFoundError"==i?"DeviceNotFoundError":"NotReadableError"==i||"TrackStartError"==i?"TrackStartError":"NotAllowedError"==i||"PermissionDeniedError"==i?"PermissionDeniedError":i;this.getPDFUI();var r="multi-media:dialog."+t;this.recordErrorDiv.setAttribute("data-i18n",r),this.pdfUI.localizer.localizeRecursive(this.recordErrorDiv),this.recordErrorDiv.classList.add("fv__record-error-show")}}],[{key:"getName",value:function(){return"multi-media-popup"}}]),r}(d.widgets.LayerComponent);r(998);const S="add-square-area";var L=d.PDFViewCtrl,A=d.getDevicePagePoint,I=d.vendors.Hammer,D=function(e){s(r,e);var i=c(r);function r(e){var n;return t(this,r),(n=i.call(this,e,"square")).pdfViewer=e,n.cursorStyle="fv__cursor-cross",n.destroyHooks=[],n}return o(r,[{key:"correctPosition",value:function(e){var t=this.pageRender.getShowWidth(),i=this.pageRender.getShowHeight();return{x:Math.max(0,Math.min(t,e.x)),y:Math.max(0,Math.min(i,e.y))}}},{key:"start",value:function(e,t){var i=t.left,r=t.top;this.shapeControl||(this.shapeControl=new L.ShapeControl({resizable:!1,enableDiagonally:!0}),this.shapeControl.active(e.$handler,e.$handler,{left:i,top:r,width:0,height:0}))}},{key:"adjust",value:function(e,t,i){var r,n,o=t.x,a=t.y,s=i.x,l=i.y,u=Math.abs(o-s),c=Math.abs(a-l),d={left:r=Math.min(o,s),top:n=Math.min(a,l),width:u=Math.max(u,1),height:c=Math.max(c,1)},f={left:r,top:n,right:r+u,bottom:n+c};e._applyAnnotBoundary(d),e.shape.boundary=f,e.shape.shape=d,e._updatePreviewer()}},{key:"pageHandler",value:function(e){var t=this;this.pageRender=e;var i=e.$handler.get(0);e.$handler.addClass(this.cursorStyle);var r=this.hammer=new I.Manager(i);e.$handler;r.add(new I.Pan({direction:I.DIRECTION_ALL})),r.on("panstart",(function(r){t.startPoint=A(i,r);var n=t.startPoint.x,o=t.startPoint.y;t.start(e,{left:n,top:o})})),r.on("panmove",(function(e){var i=t.correctPosition({x:t.startPoint.x+e.deltaX,y:t.startPoint.y+e.deltaY});return t.currentPoint=i,t.adjust(t.shapeControl,t.startPoint,t.currentPoint)})),r.on("panend",(function(i){var r=t.correctPosition({x:t.startPoint.x+i.deltaX,y:t.startPoint.y+i.deltaY});t.currentPoint=r,t.adjust(t.shapeControl,t.startPoint,t.currentPoint),t.pdfViewer.eventEmitter.emit(S,e,t.shapeControl.shape.boundary),t.shapeControl.destroy(),t.shapeControl=null})),r.on("pancancel",(function(e){t.shapeControl.destroy(),t.shapeControl=null}))}},{key:"destroyPageHandler",value:function(){this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.destroyHooks.forEach((function(e){return e()}))}}],[{key:"getStateName",value:function(){return"create-multi-media-state"}}]),r}(L.IStateHandler),k=function(e){s(r,e);var i=c(r);function r(e){return t(this,r),i.call(this,e,D)}return o(r,[{key:"readerFile",value:function(e){return new Promise((function(t,i){var r=new FileReader;r.readAsArrayBuffer(e),r.onload=function(){var e=new Uint8Array(r.result);t(e)},r.onerror=i}))}},{key:"initPopup",value:function(){var e=this;if(!this.popup){var t,i=this.getPDFUI();this.popup=this.component.getRoot().append('<multi-media:multi-media-popup name="multi-media-popup" append-to="body" class="center" modal backdrop>\n        <layer-header title="multi-media:buttons.title" @draggable="{type:\'parent\'}"></layer-header>\n        <layer-view>\n        </layer-view>\n    </multi-media:multi-media-popup>'),this.popup.rendered(),i.i18n.on("languageChanged",t=function(){e.popup.localize()}),this.addDestroyHook((function(){i.i18n.off("languageChanged",t)}))}}},{key:"mounted",value:function(){var e=this;f(l(r.prototype),"mounted",this).call(this);var t=this.getPDFUI();this.addDestroyHook(t.addViewerEventListener(S,(function(t,i){e.initPopup(),e.popup.show(),e.popup.setSubmitCallback((function(r,n){var o=[];o.push(t.getPDFPage()),o.push(e.readerFile(r)),n&&o.push(e.readerFile(n)),Promise.all(o).then((function(n){var o,a=n[0],s=a.reverseDeviceRect(i,t.scale,t.getRotation()),l=n[1];n[2]&&(o=n[2]);var u=(-(a.getRotationAngle()+t.getRotation())%360+360)%360,c=e.pdfUI.pdfViewer.getDefaultAnnotConfig()("screen"),f={type:"screen",rect:s,rotation:u,multiBuffer:l,buffer:o,fileName:r.name||"demo.wav",contentType:r.type,borderInfo:c.borderInfo||{width:1,style:0}};a.addAnnot(f).then((function(e){var i=e[0];e[0].info.annotScreenDetailType="screen_video";var r=t.annotsRender.getAnnotRender(i.getId()).component;t.pdfViewer.eventEmitter.emit(d.UIEvents.addAnnotSuccess,r.annot,f),t.annotsRender.activeAnnot(i.getId())}),(function(e){console.warn(e)}))}))}))})))}}],[{key:"permission",get:function(){return 32}}]),r}(d.StatefulController),x=r(502),U=r.n(x),E=r(423),j=r.n(E),C=U()({buttonType:"xbutton"}),T=U()({buttonType:"ribbon-button"}),N=function(e){s(r,e);var i=c(r);function r(){return t(this,r),i.apply(this,arguments)}return o(r,null,[{key:"getName",value:function(){return"multi-media"}},{key:"getLoader",value:function(){return j()}},{key:"initOnLoad",value:function(){var e=d.modular.module("multi-media",[]),t=e.getRegistry();this.module=e,t.registerComponent(M);var i={template:C,config:[{target:"multi-media-btn",tooltip:{title:"multi-media:buttons.title"},callback:k}]};e.registerPreConfiguredComponent("multi-media-button",i),e.registerPreConfiguredComponent("multi-media-ribbon-button",Object.assign({},i,{template:T}))}}]),r}(d.UIXAddon)})(),n=n.default})()));