!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],t):"object"==typeof exports?exports.PasswordProtectAddon=t(require("UIExtension")):e.PasswordProtectAddon=t(e.UIExtension)}(self,(e=>(()=>{var t={759:(e,t,r)=>{r(779);e.exports=function(e){"use strict";e=e||{};return'<ribbon-button @tooltip tooltip-title="password-protect:toolbar.protect.secureDocument" text="password-protect:toolbar.protect.secureDocument" icon-class="fx-icon-ribbon_protect_security_document-32" not-immediately="true" name="password-protect-controllers">\n<dropdown separate="false">\n<password-protect:password-protect-button></password-protect:password-protect-button>\n<password-protect:remove-protect-button></password-protect:remove-protect-button>\n</dropdown>\n</ribbon-button>','<ribbon-button @tooltip tooltip-title="password-protect:toolbar.protect.secureDocument" text="password-protect:toolbar.protect.secureDocument" icon-class="fx-icon-ribbon_protect_security_document-32" not-immediately="true" name="password-protect-controllers">\n<dropdown separate="false">\n<password-protect:password-protect-button></password-protect:password-protect-button>\n<password-protect:remove-protect-button></password-protect:remove-protect-button>\n</dropdown>\n</ribbon-button>'}},637:(e,t,r)=>{r(779);e.exports=function(e){"use strict";var t="";return t+='<div class="fv__ui-password-protect-permissionPopup-body">\n<label class="check-box-wrapper">\n<input type="checkbox" class="fv__owner-permission-setting-checkbox checkbox-input" ',(e=e||{}).isAllowed&&(t+="checked"),t+=' />\n<span class="checkbox-inner"></span>\n<span data-i18n="password-protect:dialog.add-document-setting" class="fv__owner-lable"></span>\n</label>\n<div class="fv__password-caption" data-i18n="password-protect:dialog.permission-caption"></div>\n<div class="fv__password-permissions fv__password-container online-password-permissions">\n<div class="print-change-wrapper">\n\x3c!-- 打印 --\x3e\n<div class="print-wrapper">\n<span class="fv__permission-label online-label" data-i18n="password-protect:dialog.printing-label"></span>\n<select class="fv__permission-print online-print-select" ',e.isAllowed||(t+="disabled"),t+='>\n<option value="0" ',0==e.print&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.printing-none"></option>\n<option value="1" ',1==e.print&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.printing-low"></option>\n<option value="2" ',2==e.print&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.printing-high"></option>\n</select>\n</div>\n\x3c!-- 打印 --\x3e\n\n\x3c!-- 更改 --\x3e\n<div class="change-wrapper">\n<span class="fv__permission-label online-label" data-i18n="password-protect:dialog.perm-change-label"></span>\n<select class="fv__permission-change online-change-select" ',e.isAllowed||(t+="disabled"),t+='>\n<option value="0" ',0==e.change&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.perm-changes-none"></option>\n<option value="1" ',1==e.change&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.perm-changes-1"></option>\n<option value="2" ',2==e.change&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.perm-changes-2"></option>\n<option value="3" ',3==e.change&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.perm-changes-3"></option>\n<option value="4" ',4==e.change&&(t+=" selected"),t+=' data-i18n="password-protect:dialog.perm-changes-4"></option>\n</select>\n</div>\n\x3c!-- 更改 --\x3e\n</div>\n\x3c!-- 复制权限 --\x3e\n<label class="check-box-wrapper bottom-label">\n<div>\n<input type="checkbox" class="fv__permission-copy checkbox-input" ',e.isAllowed||(t+="disabled"),t+=" ",e.copy&&(t+=" checked"),t+=' />\n<span class="checkbox-inner"></span>\n<span class="fv__permission-label" data-i18n="password-protect:dialog.perm-copy-label"></span>\n</div>\n</label>\n\x3c!-- 复制权限 --\x3e\n\x3c!-- 访问权限 --\x3e\n<label class="check-box-wrapper bottom-label">\n<div class="read-checkbox-wrapper">\n<input type="checkbox" class="fv__permission-accessibility checkbox-input" ',e.isAllowed&&!e.copy||(t+="disabled"),t+=" ",e.accessibility&&(t+=" checked"),t+=' />\n<span class="checkbox-inner"></span>\n<span class="fv__permission-label" data-i18n="password-protect:dialog.perm-access-label"></span>\n</div>\n</label>\n\x3c!-- 访问权限 --\x3e\n</div>\n</div>\n<div class="fv__button-container footer">\n<button type="button" class="fv__password-btn fv__ui-dialog-ok-button fv__ui-button" data-i18n="password-protect:dialog.ok"></button>\n<button type="button" class="fv__password-cancel fv__ui-dialog-cancel-button fv__ui-button" data-i18n="password-protect:dialog.cancel"></button>\n</div>'}},943:(e,t,r)=>{var n=r(779);e.exports=function(e){"use strict";e=e||{};var t="",r=n.$escape;e.hideSaveToPolicy;return t+='<div class="fv__ui-password-protect-popup-body">\n<div class="fv__password-protect-error fv__hide">\n<div class="fv__password-protect-error-header"></div>\n<div class="fv__password-protect-error-msg"></div>\n</div>\n<form onsubmit="return false">\n<fieldset class="fv__ui-password-protect-fieldset">\n<legend class="fv__password-caption" data-i18n="password-protect:dialog.doc-open-caption"></legend>\n<div class="fv__user-password-container fv__password-container">\n<label class="check-box-wrapper">\n<input type="checkbox" class="fv__user-password-checkbox checkbox-input" ',(e.userPassword||e.ownerPassword)&&(t+="checked"),t+=' />\n<span class="checkbox-inner"></span>\n<span data-i18n="password-protect:dialog.password-check-hint"  class="fv__user-lable"></span>\n</label>\n<div class="fv__user-password-input">\n<label class="fv__password-input">\n<span data-i18n="password-protect:dialog.password-label" class="fv__user-lable"></span>\n<div class="fv__password-input-wrap">\n<input type="password" class="fv__password fv__user-password1" value="',t+=r(e.userPassword),t+='" ',e.userPassword||e.ownerPassword||(t+="disabled"),t+=' onpaste="return false;" />\n<div class="fv__show-password fv__show-password-user1"></div>\n</div>\n</label>\n<label class="fv__password-input">\n<span data-i18n="password-protect:dialog.password-confirm-label" class="fv__user-lable"></span>\n<div class="fv__password-input-wrap">\n<input type="password" class="fv__password fv__user-password2" value="',t+=r(e.userPassword),t+='" ',e.userPassword||e.ownerPassword||(t+="disabled"),t+=' onpaste="return false;" />\n<div class="fv__show-password fv__show-password-user2"></div>\n</div>\n</label>\n<div style="clear:both"></div>\n</div>\n</div>\n</fieldset>\n<fieldset class="fv__ui-password-protect-fieldset">\n<legend class="fv__password-caption" data-i18n="password-protect:dialog.document-restriction-caption"> </legend>\n<div class="fv__owner-password-container fv__password-container document-permission-wrapper">\n<label class="check-box-wrapper">\n<input type="checkbox" class="fv__owner-password-checkbox checkbox-input" ',e.ownerPassword&&(t+="checked"),t+=' />\n<span class="checkbox-inner"></span>\n<span data-i18n="password-protect:dialog.add-document-restriction" class="fv__owner-lable"></span>\n</label>\n<div class="fv__owner-password-input">\n<label class="fv__password-input">\n<span data-i18n="password-protect:dialog.password-label" class="fv__owner-lable"></span>\n<div class="fv__password-input-wrap">\n<input type="password" class="fv__password fv__owner-password1" value="',t+=r(e.ownerPassword),t+='" ',e.ownerPassword||(t+="disabled"),t+=' onpaste="return false;" />\n<div class="fv__show-password fv__show-password-owner1"></div>\n</div>\n</label>\n<label class="fv__password-input">\n<span data-i18n="password-protect:dialog.password-confirm-label" class="fv__owner-lable"></span>\n<div class="fv__password-input-wrap">\n<input type="password" class="fv__password fv__owner-password2" value="',t+=r(e.ownerPassword),t+='" ',e.ownerPassword||(t+="disabled"),t+=' onpaste="return false;" />\n<div class="fv__show-password fv__show-password-owner2"></div>\n</div>\n</label>\n<div style="clear:both"></div>\n</div>\n</div>\n</fieldset>\n<fieldset class="fv__ui-password-protect-fieldset">\n<div class="fv__password-caption" data-i18n="password-protect:dialog.permission-specific-caption"></div>\n<div class="fv__owner-password-container document-permission-wrapper-inner">\n<div class="permission-detail-wrapper">\n<div class="permission-detail-label" data-i18n="password-protect:dialog.Printing"></div>\n',0===e.print?t+='\n<div class="permission-detail-value printing-value" data-i18n="password-protect:dialog.printing-none"></div>\n':1===e.print?t+='\n<div class="permission-detail-value printing-value" data-i18n="password-protect:dialog.printing-low"></div>\n':2===e.print&&(t+='\n<div class="permission-detail-value printing-value" data-i18n="password-protect:dialog.printing-high"></div>\n'),t+='\n</div>\n<div class="permission-detail-wrapper">\n<div class="permission-detail-label" data-i18n="password-protect:dialog.Accessiability"></div>\n<div class="permission-detail-value accessiability-value" ',e.accessibility&&(t+=' data-i18n="password-protect:dialog.Allowed"'),t+=" ",e.accessibility||(t+=' data-i18n="password-protect:dialog.NotAllowed"'),t+='></div>\n</div>\n<div class="permission-detail-wrapper">\n<div class="permission-detail-label" data-i18n="password-protect:dialog.Copying"></div>\n<div class="permission-detail-value copying-value" ',e.copy&&(t+=' data-i18n="password-protect:dialog.Allowed"'),t+=" ",e.copy||(t+=' data-i18n="password-protect:dialog.NotAllowed"'),t+='></div>\n</div>\n<div class="permission-detail-wrapper">\n<div class="permission-detail-label" data-i18n="password-protect:dialog.Changes"></div>\n',0===e.change?t+='\n<div class="permission-detail-value changes-value" data-i18n="password-protect:dialog.perm-changes-none"></div>\n':1===e.change?t+='\n<div class="permission-detail-value changes-value" data-i18n="password-protect:dialog.perm-changes-1"></div>\n':2===e.change?t+='\n<div class="permission-detail-value changes-value" data-i18n="password-protect:dialog.perm-changes-2"></div>\n':3===e.change?t+='\n<div class="permission-detail-value changes-value" data-i18n="password-protect:dialog.perm-changes-3"></div>\n':4===e.change&&(t+='\n<div class="permission-detail-value changes-value" data-i18n="password-protect:dialog.perm-changes-4"></div>\n'),t+='\n</div>\n<button type="button" class="permission-edit-btn fv__ui-button" ',e.ownerPassword||(t+="disabled"),t+=' data-i18n="password-protect:dialog.permission"></button>\n</div>\n</fieldset>\n<fieldset class="fv__ui-password-protect-fieldset encrypt-config-wrapper">\n<legend class="fv__password-caption" data-i18n="password-protect:dialog.encrypt-caption"></legend>\n<div class="fv__encrypt-setting-container fv__password-container">\n<div>\n<label class="check-box-wrapper">\n<input type="checkbox" class="fv__encrypt-not-metadata checkbox-input" ',e.isEncryptMetadata||(t+="checked"),t+=' />\n<span class="checkbox-inner"></span>\n<span data-i18n="password-protect:dialog.enc-no-metadata" class="fv__encrypt-lable"></span>\n</label>\n</div>\n<div class="fv__encrypt-settings-radiobox-container">\n<span data-i18n="password-protect:dialog.enc-alg-label" class="fv__encrypt-lable" style="margin-left:5px;"></span>\n<label class="fv__encrypt-settings-radiobox-label fv__encrypt-lable">\n<input name="algorithm" class="fv__algorithm-radio online-radio-input" type="radio" value="aes128" ',"aes128"==e.cipherType&&(t+="checked"),t+=' />\n<span class="online-radio-inner"></span>128-bit AES\n</label>\n<label class="fv__encrypt-settings-radiobox-label fv__encrypt-lable">\n<input name="algorithm" class="fv__algorithm-radio online-radio-input" type="radio" value="aes256" ',"aes256"==e.cipherType&&(t+="checked"),t+=' />\n<span class="online-radio-inner"></span>256-bit AES\n</label>\n<label class="fv__encrypt-settings-radiobox-label fv__encrypt-lable">\n<input name="algorithm" class="fv__algorithm-radio online-radio-input" type="radio" value="rc4" ',"rc4"==e.cipherType&&(t+="checked"),t+=' />\n<span class="online-radio-inner"></span>128-bit ARC-FOUR\n</label>\n</div>\n</div>\n</fieldset>\n</form>\n</div>\n<div class="fv__button-container footer password-protect-footer">\n',t+='\n<button type="button" class="fv__password-btn fv__ui-dialog-ok-button fv__ui-button" ',e.ownerPassword||e.userPassword||(t+="disabled"),t+=' data-i18n="password-protect:dialog.ok"></button>\n<button type="button" class="fv__password-cancel fv__ui-dialog-cancel-button fv__ui-button" data-i18n="password-protect:dialog.cancel"></button>\n</div>\n'}},480:(e,t,r)=>{r(779);e.exports=function(e){"use strict";e=e||{};return'<xbutton class="fv__ui-toolbar-show-text-button" name="remove-protect-btn" @tooltip tooltip-title="password-protect:buttons.removeTitle" icon-class="fx-icon-sm fx-icon-ribbon_protect_security_remove_protect-16" text="password-protect:buttons.removeTitle">password-protect:buttons.removeTitle</xbutton>','<xbutton class="fv__ui-toolbar-show-text-button" name="remove-protect-btn" @tooltip tooltip-title="password-protect:buttons.removeTitle" icon-class="fx-icon-sm fx-icon-ribbon_protect_security_remove_protect-16" text="password-protect:buttons.removeTitle">password-protect:buttons.removeTitle</xbutton>'}},841:(e,t,r)=>{r(779);e.exports=function(e){"use strict";e=e||{};return'<xbutton class="fv__ui-toolbar-show-text-button" name="password-protect-btn" @tooltip tooltip-title="password-protect:buttons.title" icon-class="fx-icon-sm fx-icon-ribbon_protect_security_password_protect-16" text="password-protect:buttons.title">password-protect:buttons.title</xbutton>','<xbutton class="fv__ui-toolbar-show-text-button" name="password-protect-btn" @tooltip tooltip-title="password-protect:buttons.title" icon-class="fx-icon-sm fx-icon-ribbon_protect_security_password_protect-16" text="password-protect:buttons.title">password-protect:buttons.title</xbutton>'}},64:e=>{e.exports=null},585:(e,t,r)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r.g?r.g:{},o=Object.create(n),s=/["&'<>]/;function a(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?a(e.call(e)):JSON.stringify(e)),e}o.$escape=function(e){return function(e){var t=""+e,r=s.exec(t);if(!r)return e;var n="",o=void 0,a=void 0,i=void 0;for(o=r.index,a=0;o<t.length;o++){switch(t.charCodeAt(o)){case 34:i="&#34;";break;case 38:i="&#38;";break;case 39:i="&#39;";break;case 60:i="&#60;";break;case 62:i="&#62;";break;default:continue}a!==o&&(n+=t.substring(a,o)),a=o+1,n+=i}return a!==o?n+t.substring(a,o):n}(a(e))},o.$each=function(e,t){if(Array.isArray(e))for(var r=0,n=e.length;r<n;r++)t(e[r],r);else for(var o in e)t(e[o],o)},e.exports=o},779:(e,t,r)=>{"use strict";e.exports=r(585)},616:t=>{"use strict";t.exports=e}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var s=r[e]={exports:{}};return t[e](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o={};return(()=>{"use strict";function e(t,r){return null!=r&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](t):e(t,r)}function t(t,r){if(!e(t,r))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function i(e,t,r){return i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r||e):o.value}},i(e,t,r||e)}function c(e,t){return c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},c(e,t)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){p(e,t,r[t])}))}return e}function u(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function f(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function w(e,t){if(e){if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,t):void 0}}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,s=[],a=!0,i=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(s.push(n.value),!t||s.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(i)throw o}}return s}}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){return!t||"object"!=((r=t)&&"undefined"!=typeof Symbol&&r.constructor===Symbol?"symbol":typeof r)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var r}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=a(e);if(t){var o=a(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return b(this,r)}}n.d(o,{default:()=>le});var y=n(616);function _(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var g,P=n(943),k=n.n(P),x=y.vendors.jQuery,D="password-input-tip",S=function(){x("."+D).remove()},E=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(S(),e){var n=x('<span class="'.concat(D,'"><span>')),o=x('<i class="password-input-tip-text" role="alert" aria-live="assertive" ><i>');if(o.text(e),n.empty().append(o),r)x(t).before(n),n.css({left:0,top:"calc(100% + 8px)"}).addClass("relative");else{var s=t.getBoundingClientRect();n.css({left:s.left-13+"px"}).appendTo("body"),n.css({top:s.top+35+"px"})}}},C=y.PDFViewCtrl.shared,O=C.cipherType,A=C.securityUtils,T=function(e){l(n,e);var r=m(n);function n(e,o,s){var a;return t(this,n),(a=r.call(this,e,o,s)).userPasswordChanged=!1,a.permissionData={},a.destroyDataHooks=[],g=s.i18next,a.addDestroyHook((function(){a.destroyDataHooks.forEach((function(e){return e()}))})),a}return s(n,[{key:"bindEvent",value:function(e,t,r){var n=this,o=this.element.querySelectorAll(e);0!=o.length&&o.forEach((function(e){e.addEventListener(t,r),n.destroyDataHooks.push((function(){e.removeEventListener(t,r)}))}))}},{key:"render",value:function(){i(a(n.prototype),"render",this).call(this),this.element.classList.add("fv__password-protect-popup")}},{key:"setSubmitCallback",value:function(e){this.permissionData={},this.submitCallback=e}},{key:"getFormDataAndCheckDataValid",value:function(){var e,t,r,n={userPassword:!1,ownerPassword:!1,algorithm:!1,encryptMetadata:!1};if(this.element.querySelectorAll('input[name="algorithm"]').forEach((function(t){t.checked&&(e=t.value)})),this.element.querySelector(".fv__user-password-checkbox").checked){t=this.element.querySelector(".fv__user-password1").value;var o=this.element.querySelector(".fv__user-password2").value;if(t.length>32){var s=g.t("password-protect:error.pwdLength");return E(s,this.element.querySelector(".fv__user-password1"),!0),this.element.querySelector(".fv__password-btn").setAttribute("disabled",""),!1}if(S(),t!==o){if(this.element.querySelector(".fv__password-btn").setAttribute("disabled",""),""!==t&&""!==o){var a=g.t("password-protect:error.open-pwd-not-match");E(a,this.element.querySelector(".fv__user-password2"),!0)}return!1}}else t=this.userPasswordChanged?"":e==O.AES256?-1:this.originData.userPassword;if(this.element.querySelector(".fv__owner-password-checkbox").checked){this.element.querySelector(".permission-edit-btn").removeAttribute("disabled"),r=this.element.querySelector(".fv__owner-password1").value;var i=this.element.querySelector(".fv__owner-password2").value;if(r.length>32){var c=g.t("password-protect:error.pwdLength");return E(c,this.element.querySelector(".fv__owner-password1"),!0),this.element.querySelector(".fv__password-btn").setAttribute("disabled",""),!1}if(S(),r!==i){if(this.element.querySelector(".fv__password-btn").setAttribute("disabled",""),""!==r&&""!==i){var l=g.t("password-protect:error.permission-pwd-not-match");E(l,this.element.querySelector(".fv__owner-password2"),!0)}return!1}}else r=this.element.querySelector(".fv__owner-password1").value=this.element.querySelector(".fv__owner-password2").value="",this.element.querySelector(".permission-edit-btn").setAttribute("disabled","");if(!(t&&-1!==t||r))return this.element.querySelector(".fv__password-btn").setAttribute("disabled",""),S(),!1;if(t===r){var p=g.t("password-protect:error.open-owner-pwd-cannot-same");return E(p,this.element.querySelector(".fv__owner-password1"),!0),this.element.querySelector(".fv__password-btn").setAttribute("disabled",""),!1}var d=!this.element.querySelector(".fv__encrypt-not-metadata").checked;S(),this.element.querySelector(".fv__password-btn").removeAttribute("disabled"),this.userPasswordChanged&&(n.userPassword=!0),r!==this.originData.ownerPassword&&(n.ownerPassword=!0),"{}"===JSON.stringify(this.permissionData)&&(this.permissionData=this.originData);var u=this.permissionData,f=u.print,v=u.accessibility,w=u.copy,h=u.change,b=u.isAllowed;return[t,r,{value:A.convertUIDataToPermission({print:Number(f),accessibility:Boolean(v),copy:Boolean(w),change:Number(h)}),isAllowed:b},e,d,n]}},{key:"updateData",value:function(e){var t=this,r=this;this.userPasswordChanged=!1,this.originData=e,this.destroyDataHooks.forEach((function(e){return e()})),this.element.querySelector(".fv__ui-layer-panel").innerHTML=k()(e),this.localize(),this.bindEvent(".fv__show-password","click",(function(e){var t=e.srcElement;t.classList.contains("fv__hide-password")?(t.classList.remove("fv__hide-password"),t.previousElementSibling.type="password"):(t.classList.add("fv__hide-password"),t.previousElementSibling.type="text")})),this.bindEvent(".fv__password","keyup",(function(e){e.srcElement.value=e.srcElement.value.replace(/[^\x00-\x80]/g,""),t.getFormDataAndCheckDataValid()})),this.bindEvent(".fv__password-btn","click",(function(e){t.submit()})),this.bindEvent(".fv__password-cancel","click",(function(e){var n=r._showParams||{};n.cancelAfter&&n.cancelAfter(),r._showParams={},t.hide(),S()})),this.bindEvent(".permission-edit-btn","click",(function(r){t.pdfUI.openDialog("password-protect-permissionPopup").then((function(r){r.show(),r.updateData(d({},e,t.permissionData)),r.setSubmitCallback((function(e){r.hide(),t.permissionData=e;var n=e.copy,o=e.accessibility,s=e.change,a=e.print,i=t.element.querySelector(".copying-value"),c=t.element.querySelector(".accessiability-value"),l=t.element.querySelector(".changes-value"),p=t.element.querySelector(".printing-value"),d="password-protect:dialog.Allowed",u="password-protect:dialog.NotAllowed";switch(i.innerHTML=n?g.t(d):g.t(u),c.innerHTML=o?g.t(d):g.t(u),a){case 0:default:p.innerHTML=g.t("password-protect:dialog.printing-none");break;case 1:p.innerHTML=g.t("password-protect:dialog.printing-low");break;case 2:p.innerHTML=g.t("password-protect:dialog.printing-high")}switch(s){case 0:default:l.innerHTML=g.t("password-protect:dialog.perm-changes-none");break;case 1:l.innerHTML=g.t("password-protect:dialog.perm-changes-1");break;case 2:l.innerHTML=g.t("password-protect:dialog.perm-changes-2");break;case 3:l.innerHTML=g.t("password-protect:dialog.perm-changes-3");break;case 4:l.innerHTML=g.t("password-protect:dialog.perm-changes-4")}}))}))})),this.bindEvent(".fv__icon-layer-close","click",(function(e){var t=r._showParams||{};t.cancelAfter&&t.cancelAfter(),r._showParams={},S()}));var n=this.element.querySelector(".fv__user-password-checkbox"),o=this.element.querySelectorAll(".fv__user-password-input input"),s=e.userPassword&&e.userPassword.length>0;n.checked=s,o.forEach((function(e){return e.disabled=!s})),this.bindEvent(".fv__user-password-checkbox","change",(function(e){t.element.querySelectorAll(".fv__user-password-container input").forEach((function(r){r!==e.target&&(r.disabled=!e.target.checked,r.disabled&&(r.value=""),t.userPasswordChanged=!0)})),t.getFormDataAndCheckDataValid()})),this.bindEvent(".fv__owner-password-checkbox","change",(function(e){t.element.querySelectorAll(".fv__owner-password-container input").forEach((function(t){t!==e.target&&(t.disabled=!e.target.checked,t.disabled&&(t.value=""))})),t.getFormDataAndCheckDataValid(),e.target.checked&&t.pdfUI.alert({message:"password-protect:warning.restriction-warn",level:"warning",again:!0,id:"password-restriction-warn"})}))}},{key:"submit",value:function(){var e=this._showParams||{};e.successAfter&&e.successAfter();var t=this.getFormDataAndCheckDataValid();if("boolean"!=typeof t||t)return this.submitCallback.apply(this,_(t))}},{key:"showError",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this.element.querySelector(".fv__password-protect-error .fv__password-protect-error-header").innerHTML=g.t("password-protect:dialog.warn"),this.element.querySelector(".fv__password-protect-error").classList.add("fv__warn")):(this.element.querySelector(".fv__password-protect-error .fv__password-protect-error-header").innerHTML=g.t("password-protect:dialog.error"),this.element.querySelector(".fv__password-protect-error").classList.remove("fv__warn")),this.element.querySelector(".fv__password-protect-error").classList.remove("fv__hide");var t=e;"string"!=typeof t&&e.message&&(t=e.message),this.element.querySelector(".fv__password-protect-error .fv__password-protect-error-msg").innerHTML=t}},{key:"hideError",value:function(){this.element.querySelector(".fv__password-protect-error").classList.add("fv__hide")}},{key:"isSaveToPolicy",value:function(){var e=this.element.querySelector("#password-protect-save-to-policy");return!!e&&e.checked}}],[{key:"getName",value:function(){return"password-protect-popup"}}]),n}(y.widgets.LayerComponent),q=n(637),I=n.n(q),U=function(e){l(n,e);var r=m(n);function n(e,o,s){var a;return t(this,n),(a=r.call(this,e,o,s)).destroyDataHooks=[],a.showaccessibilityTip=!0,a.addDestroyHook((function(){a.destroyDataHooks.forEach((function(e){return e()}))})),a}return s(n,[{key:"bindEvent",value:function(e,t,r){var n=this,o=this.element.querySelectorAll(e);0!=o.length&&o.forEach((function(e){e.addEventListener(t,r),n.destroyDataHooks.push((function(){e.removeEventListener(t,r)}))}))}},{key:"render",value:function(){i(a(n.prototype),"render",this).call(this),this.element.classList.add("fv__password-protect-permissionPopup")}},{key:"setSubmitCallback",value:function(e){this.submitCallback=e}},{key:"getFormData",value:function(){var e,t,r,n,o=this.element.querySelector(".fv__owner-permission-setting-checkbox").checked;return o?(e=this.element.querySelector(".fv__permission-print").value,t=this.element.querySelector(".fv__permission-accessibility").checked,r=this.element.querySelector(".fv__permission-copy").checked,n=this.element.querySelector(".fv__permission-change").value):(e=2,t=!0,r=!0,n=4),{isAllowed:o,print:Number(e),accessibility:Boolean(t),copy:Boolean(r),change:Number(n)}}},{key:"updateData",value:function(e){var t=this;this.showaccessibilityTip=!0,this.destroyDataHooks.forEach((function(e){return e()})),this.element.querySelector(".fv__ui-layer-panel").innerHTML=I()(e),this.localize(),this.bindEvent(".fv__owner-permission-setting-checkbox","change",(function(e){t.element.querySelectorAll(".fv__password-permissions input,.fv__password-permissions select").forEach((function(t){if(t!==e.target){t.disabled=!e.target.checked;(function(e){var t=function(e){return!!e&&e.classList.contains("check-box-wrapper")},r=e.parentElement;if(t(r))return r;t(r&&r.parentElement)&&r.parentElement})(t)}}));var r=t.element.querySelector(".fv__permission-copy"),n=t.element.querySelector(".fv__permission-accessibility");r.checked&&(n.disabled=!0),t.getFormData()})),this.bindEvent(".fv__permission-copy","change",(function(e){var r=t.element.querySelector(".fv__permission-accessibility");r.disabled=e.target.checked,e.target.checked&&(r.checked=!0)})),this.bindEvent(".fv__permission-accessibility","change",(function(e){!e.target.checked&&t.showaccessibilityTip&&(t.pdfUI.alert({message:"password-protect:warning.reader-warn",level:"warning",again:!0}),t.showaccessibilityTip=!1)})),this.bindEvent(".fv__password-cancel","click",(function(e){t.hide()})),this.bindEvent(".fv__password-btn","click",(function(e){t.submitCallback(t.getFormData())}))}},{key:"submit",value:function(){var e=this.getFormData();if("boolean"!=typeof e||e)return this.submitCallback.apply(this,_(e))}}],[{key:"getName",value:function(){return"password-protect-permissionPopup"}}]),n}(y.widgets.LayerComponent),L=n(64),j=n.n(L);function F(e,t,r,n,o,s,a){try{var i=e[s](a),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,o)}function H(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var s=e.apply(t,r);function a(e){F(s,n,o,a,i,"next",e)}function i(e){F(s,n,o,a,i,"throw",e)}a(void 0)}))}}function V(e,t){var r,n,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var M=y.PDFViewCtrl.shared.SecurityUtils.convertPermissionToUIData,N=y.PDFViewCtrl.Events,R=y.PDFViewCtrl.shared.securityEncryptType,B=y.PDFViewCtrl.shared.securityUtils,$=y.PDFViewCtrl.Consts.PDFDocPermission,z=function(e){l(n,e);var r=m(n);function n(e){return t(this,n),r.call(this,e)}return s(n,[{key:"changePermission",value:function(e){var t=this;e&&!e.isDestroyed?Promise.all([e.getUserPermissions(),e.isPdfaDoc(),e.pdfaEditable,e.getSecurityType()]).then((function(r){var n,o=h(r,4),s=(o[0],o[1]),a=o[2],i=o[3];!e||e.isDestroyed?n=!1:(i===R.Password?n=!0:(n=i===R.Certificate?e.isOwner():!s||s&&a,e.checkPermission($.ModifyDocument)||(n=!1)),e.hasSignature()&&(n=!1)),n?t.component.unlock&&t.component.unlock():t.component.lock&&t.component.lock()})):this.component.lock&&this.component.lock()}},{key:"mounted",value:function(){var e,t=this;i(a(n.prototype),"mounted",this).call(this),this.pdfUI.i18n.on("languageChanged",e=function(){var e=t.getComponentByName("password-protect-popup");e&&e.localize()}),this.addDestroyHook((function(){t.pdfUI.i18n.off("languageChanged",e)}),this.pdfUI.addViewerEventListener(N.willCloseDocument,(function(){B.setPwdPopupLatestUIData(null),B.setInputOwnerPwd()})),this.pdfUI.addViewerEventListener(N.openFileSuccess,(function(e){t.changePermission(e)})))}},{key:"handle",value:function(){var e=this;return H((function(){var t,r;return V(this,(function(n){return(t=e.pdfUI.pdfViewer.currentPDFDoc)?(e.component[t.hasSignature()?"disable":"enable"](),(r=B.getPwdPopupLatestUIData())?(e.showPopup(r),[2]):(Promise.all([t.getSecurityType(),t.getStdCipherOptions()]).then((function(r){var n=h(r,2),o=n[0],s=n[1],a=Object.assign(B.getPermissionDefaultUIData("password"),s,B.convertPermissionToUIData(s.permission));o===R.Password?t.hasOwnerPassword()&&!B.getInputOwnerPwd()?B.requestOwnerPassword(e.pdfUI,(function(r){a.ownerPassword=r,a.isAllowed=!0,t.getUserPassword(r).then((function(t){a.userPassword=t,e.showPopup(a),B.setPwdPopupLatestUIData(a)}))})):(a.ownerPassword=B.getInputOwnerPwd(),t.getUserPassword(a.ownerPassword).then((function(t){a.userPassword=t,e.showPopup(a)}))):o===R.Unknown||o===R.None?e.showPopup(a):e.pdfUI.confirm({message:"password-protect:warning.already-secured",level:"question"}).then((function(){e.showPopup(a)}),(function(){}))})),[2])):[2]}))}))()}},{key:"showPopup",value:function(e){var t=this;return H((function(){var r;return V(this,(function(n){switch(n.label){case 0:return[4,t.pdfUI.openDialog("password-protect-popup")];case 1:return(r=n.sent()).updateData(e),r.setSubmitCallback((o=H((function(e,n,o,s,a,i){var c,l,p,u,f,v,w,h,b;return V(this,(function(i){switch(i.label){case 0:return[4,t.getPDFUI()];case 1:return p=i.sent(),u=p.customs,f=u.startSDKSpan,v=u.otelService,f?[4,f("password-protect-submit")]:[3,3];case 2:w=i.sent(),h=w.end,b=w.span,c=h,l=b,i.label=3;case 3:return B.setPasswordAndPermission(t.pdfUI,{userPassword:e,ownerPassword:n,permissionData:o,cipherType:s,isEncryptMetadata:a}).then((function(i){if(i?r.hide():r.showError(),i&&r.saveToPolicy){var c=M(o.value);t.pdfUI.pdfViewer.customs.passwordProtectSaveSecurityPolicy(d({userPassword:e,ownerPassword:n,cipherType:s,isEncryptMetadata:a,isAllowed:o.isAllowed},c))}})).catch((function(e){throw r.showError(e),null==v||v.setSpanException(l,error),e})).finally((function(){null==c||c()})),[2]}}))})),function(e,t,r,n,s,a){return o.apply(this,arguments)})),r.show(),[2]}var o}))}))()}}]),n}(y.Controller);const J=z;var K=y.PDFViewCtrl.Events,G=y.PDFViewCtrl.shared.securityEncryptType,Q=y.PDFViewCtrl.shared.securityUtils,X=(y.PDFViewCtrl.PDF.constant.User_Permissions,y.services.PortfolioLayoutService);const W=function(e){l(n,e);var r=m(n);function n(e){return t(this,n),r.call(this,e)}return s(n,[{key:"handle",value:function(){var e=this;i(a(n.prototype),"handle",this).call(this);var t=this.pdfUI.pdfViewer.currentPDFDoc;t.getSecurityType().then((function(r){var n=function(){var n=e;e.pdfUI.confirm({message:"password-protect:dialog.remove.confirmation",level:"question"}).then(H((function(){var e,o,s,a,i,c,l,p,d;return V(this,(function(u){switch(u.label){case 0:return[4,n.getPDFUI()];case 1:return s=u.sent(),a=s.customs,i=a.startSDKSpan,c=a.otelService,i?[4,i("remove-protection")]:[3,3];case 2:l=u.sent(),p=l.end,d=l.span,e=p,o=d,u.label=3;case 3:return t.removeSecurity().then((function(e){e&&(n.component.disable(),r===G.Password&&(t.setPasswordType(1),t.setHasOwnerPassword(!1),Q.setPwdPopupLatestUIData(null)),n.pdfUI.eventEmitter.emit(K.securityTypeChanged))})).catch((function(e){throw null==c||c.setSpanException(o,e),e})).finally((function(){null==e||e()})),[2]}}))})),(function(){}))};switch(r){case G.Password:Q.getInputOwnerPwd()?n():t.hasOwnerPassword()?Q.requestOwnerPassword(e.pdfUI,(function(){n()})):n();break;case G.Certificate:n()}}))}},{key:"mounted",value:function(){var e=this,t=this.pdfUI;this.toggle(),this.addDestroyHook(t.getServiceInstance(X).onLayoutChange((function(){e.toggle()})),t.addViewerEventListener(K.openFileSuccess,(function(t){e.toggle()})),this.pdfUI.addViewerEventListener(K.securityTypeChanged,(function(){e.toggle()})))}},{key:"toggle",value:function(){var e=this;return H((function(){var t,r;return V(this,(function(n){switch(n.label){case 0:return[4,e.pdfUI.getCurrentPDFDoc()];case 1:return(t=n.sent())&&e.pdfUI.pdfViewer.currentPDFDoc?(r=function(t){return t?e.component.enable():e.component.disable()},Promise.all([t.getUserPermissions(),t.isPdfaDoc(),t.pdfaEditable,t.getSecurityType()]).then((function(e){var n=h(e,4),o=(n[0],n[1]),s=n[2];switch(n[3]){case G.Password:t.getPasswordType().then((function(e){r((!o||o&&s)&&(2===e||3===e))}));break;case G.Certificate:r(t.isOwner());break;default:r(!1)}})),[2]):[2]}}))}))()}}]),n}(y.Controller);var Y=n(841),Z=n.n(Y),ee=n(480),te=n.n(ee),re=n(759),ne=n.n(re),oe=y.PDFViewCtrl.shared,se=oe.securityUtils,ae=oe.securityEncryptType,ie=y.PDFViewCtrl.Events,ce=y.PDFViewCtrl.Consts.PDFDocPermission,le=function(e){l(n,e);var r=m(n);function n(){return t(this,n),r.apply(this,arguments)}return s(n,[{key:"fragments",value:function(){return[]}},{key:"init",value:function(e){var t=this;this.pdfUI=e;var r="password-protect-popup";e.registerDialog(r,(function(n,o){return t.passwordDialog?(t.passwordDialog.show(document.body,o),Promise.resolve(t.passwordDialog)):e.getComponentByName("template-container").then((function(e){e.append('\n                <password-protect:password-protect-popup name="password-protect-popup" append-to="body" class="center" modal backdrop>\n                    <layer-header title="password-protect:buttons.title" @draggable="{type:\'parent\'}"></layer-header>\n                    <layer-view></layer-view>\n                </password-protect:password-protect-popup>\n            ');var n=t.passwordDialog=e.getComponentByName(r);return n.open(document.body,o),n}))})),e.registerDialog("password-protect-permissionPopup",(function(r){return t.permDialog?Promise.resolve(t.permDialog):e.getComponentByName("template-container").then((function(e){return t.permDialog=e.append('\n                    <password-protect:password-protect-permissionPopup name="password-protect-permissionPopup" append-to="body" class="center" modal backdrop>\n                        <layer-header title="password-protect:buttons.PermissionTitle" @draggable="{type:\'parent\'}"></layer-header>\n                        <layer-view></layer-view>\n                    </password-protect:password-protect-permissionPopup>\n                ')}))}))}},{key:"receiveAction",value:function(e,t){var r=this.pdfUI;"showPasswordPopup"===e?r.openDialog("password-protect-popup").then((function(e){var r=t.data,n=t.callback;if(r&&n){var o=r.id,s=(r.modifyDate,r.method),a=r.name,i=r.desc,c=r.encrypted,l=f(r,["id","modifyDate","method","name","desc","encrypted"]);e.show(),e.updateData(l),e.setSubmitCallback((function(t,r,l,p,f,v){n(u(d({id:o,method:s,name:a,desc:i,encrypted:c,userPassword:t,ownerPassword:r,cipherType:p,isEncryptMetadata:f},se.convertPermissionToUIData(l.value)),{isAllowed:l.isAllowed})),e.hide()}))}})):"showPermissionPopup"===e&&this.pdfUI.openDialog("password-protect-permissionPopup").then((function(e){var r=t.data,n=t.callback;r&&n&&(e.show(),e.updateData(r),e.setSubmitCallback((function(t){n(t),e.hide()})))}))}}],[{key:"getName",value:function(){return"password-protect"}},{key:"getLoader",value:function(){return j()}},{key:"initOnLoad",value:function(){var e=y.modular.module("password-protect",[]),r=e.getRegistry();this.module=e,r.registerComponent(T),r.registerComponent(U),e.registerPreConfiguredComponent("password-protect-button",{template:Z()(),config:[{target:"password-protect-btn",tooltip:{title:"password-protect:buttons.title"},callback:J}]}),e.registerPreConfiguredComponent("remove-protect-button",{template:te()(),config:[{target:"remove-protect-btn",tooltip:{title:"password-protect:buttons.removeTitle"},callback:W}]});var n={template:ne()(),config:[{target:"password-protect-controllers",callback:function(e){l(n,e);var r=m(n);function n(){return t(this,n),r.apply(this,arguments)}return s(n,[{key:"mounted",value:function(){var e=this;i(a(n.prototype),"mounted",this).call(this),this.addDestroyHook(this.pdfUI.addViewerEventListener(ie.willCloseDocument,(function(){se.setPwdPopupLatestUIData(null),se.setInputOwnerPwd()})),this.pdfUI.addViewerEventListener(ie.openFileSuccess,(function(t){e.changePermission(t)})))}},{key:"changePermission",value:function(e){var t=this;e&&!e.isDestroyed?Promise.all([e.getUserPermissions(),e.isPdfaDoc(),e.pdfaEditable,e.getSecurityType()]).then((function(r){var n,o=h(r,4),s=(o[0],o[1]),a=o[2],i=o[3];!e||e.isDestroyed?n=!1:(i===ae.Password?n=!0:(n=i===ae.Certificate?e.isOwner():!s||s&&a,e.checkPermission(ce.ModifyDocument)||(n=!1)),e.hasSignature()&&(n=!1)),n?t.component.enable&&t.component.enable():t.component.disable&&t.component.disable()})):this.component.disable&&this.component.disable()}}]),n}(y.Controller)}]};e.registerPreConfiguredComponent("password-protect-ribbon-dropdown",n)}}]),n}(y.UIXAddon)})(),o=o.default})()));