!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],t):"object"==typeof exports?exports.Preview=t(require("UIExtension")):e.Preview=t(e.UIExtension)}(self,(e=>(()=>{var t={151:(e,t,n)=>{var r=n(779);e.exports=function(e){"use strict";e=e||{};var t="",i=r.$escape,o=e.index,a=e.isCrop;return t+='<div class="fv__preview-page" data-page-index="',t+=i(o-1),t+='">\n<div class="fv__thumb-page-container">\n<img class="fv__thumb-loading" ',t+='src="'+n(891)+'"',t+=" />\n",a&&(t+='\n<div class="fv__thumb-cover">\n<div class="fv__thumb-cover-crop"></div>\n<div class="fv__thumb-cover-art"></div>\n<div class="fv__thumb-cover-trim"></div>\n<div class="fv__thumb-cover-bleed"></div>\n<div class="fv__thumb-cover-resize" action-type="move">\n<div class="resize" action-type="resize"></div>\n<div class="resize" action-type="resize"></div>\n<div class="resize" action-type="resize"></div>\n<div class="resize" action-type="resize"></div>\n</div>\n</div>\n'),t+='\n<canvas class="fv__thumb-image fv__hide"></canvas>\n\n</div>\n</div>'}},530:(e,t,n)=>{n(779);e.exports=function(e){"use strict";var t="";return(e=e||{}).showTitle&&(t+='\n<div class="w_80 mb_10" data-i18n="preview:title" name="title"></div>\n'),t+='\n<div class="fv__ui-preview" name="preview-container">\n<div class="fv__preview-image-container-box">\n<div class="fv__preview-image-container">\n\n</div>\n<div style="clear:both;"></div>\n</div>\n</div>\n<div class="d_f jc_sb mt_5" name="page-show">\n<input class="w_50" type="number" min="1" value="1"  name="goto-input" />\n<div>\n<span class="ml_10 mr_10" data-i18n="preview:separator"></span>\n<span name="pageCount"></span>\n<span class="ml_10" data-i18n="preview:pages"></span>\n</div>\n</div>\n'}},837:e=>{e.exports=null},585:(e,t,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var r="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},i=Object.create(r),o=/["&'<>]/;function a(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?a(e.call(e)):JSON.stringify(e)),e}i.$escape=function(e){return function(e){var t=""+e,n=o.exec(t);if(!n)return e;var r="",i=void 0,a=void 0,u=void 0;for(i=n.index,a=0;i<t.length;i++){switch(t.charCodeAt(i)){case 34:u="&#34;";break;case 38:u="&#38;";break;case 39:u="&#39;";break;case 60:u="&#60;";break;case 62:u="&#62;";break;default:continue}a!==i&&(r+=t.substring(a,i)),a=i+1,r+=u}return a!==i?r+t.substring(a,i):r}(a(e))},i.$each=function(e,t){if(Array.isArray(e))for(var n=0,r=e.length;n<r;n++)t(e[n],n);else for(var i in e)t(e[i],i)},e.exports=i},779:(e,t,n)=>{"use strict";e.exports=n(585)},891:e=>{e.exports="data:image/svg+xml;charset=utf-8;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIGZpbGw9IiNkZGQiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyKSIgZD0ibTAgMTJ2OGg0di04eiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iZCIgYmVnaW49IjAiIGNhbGNNb2RlPSJzcGxpbmUiIGR1cj0iMS4ycyIga2V5U3BsaW5lcz0iMC4yIDAuMiAwLjQgMC44OzAuMiAwLjYgMC40IDAuODswLjIgMC44IDAuNCAwLjgiIGtleXRpbWVzPSIwOy4yOy41OzEiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiB2YWx1ZXM9Ik0wIDEyIFYyMCBINCBWMTJ6OyBNMCA0IFYyOCBINCBWNHo7IE0wIDEyIFYyMCBINCBWMTJ6OyBNMCAxMiBWMjAgSDQgVjEyeiIvPjwvcGF0aD48cGF0aCB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4KSIgZD0ibTAgMTJ2OGg0di04eiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iZCIgYmVnaW49IjAuMiIgY2FsY01vZGU9InNwbGluZSIgZHVyPSIxLjJzIiBrZXlTcGxpbmVzPSIwLjIgMC4yIDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44OzAuMiAwLjggMC40IDAuOCIga2V5dGltZXM9IjA7LjI7LjU7MSIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIHZhbHVlcz0iTTAgMTIgVjIwIEg0IFYxMno7IE0wIDQgVjI4IEg0IFY0ejsgTTAgMTIgVjIwIEg0IFYxMno7IE0wIDEyIFYyMCBINCBWMTJ6Ii8+PC9wYXRoPjxwYXRoIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE0KSIgZD0ibTAgMTJ2OGg0di04eiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iZCIgYmVnaW49IjAuNCIgY2FsY01vZGU9InNwbGluZSIgZHVyPSIxLjJzIiBrZXlTcGxpbmVzPSIwLjIgMC4yIDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44OzAuMiAwLjggMC40IDAuOCIga2V5dGltZXM9IjA7LjI7LjU7MSIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIHZhbHVlcz0iTTAgMTIgVjIwIEg0IFYxMno7IE0wIDQgVjI4IEg0IFY0ejsgTTAgMTIgVjIwIEg0IFYxMno7IE0wIDEyIFYyMCBINCBWMTJ6Ii8+PC9wYXRoPjxwYXRoIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIwKSIgZD0ibTAgMTJ2OGg0di04eiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iZCIgYmVnaW49IjAuNiIgY2FsY01vZGU9InNwbGluZSIgZHVyPSIxLjJzIiBrZXlTcGxpbmVzPSIwLjIgMC4yIDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44OzAuMiAwLjggMC40IDAuOCIga2V5dGltZXM9IjA7LjI7LjU7MSIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIHZhbHVlcz0iTTAgMTIgVjIwIEg0IFYxMno7IE0wIDQgVjI4IEg0IFY0ejsgTTAgMTIgVjIwIEg0IFYxMno7IE0wIDEyIFYyMCBINCBWMTJ6Ii8+PC9wYXRoPjxwYXRoIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2KSIgZD0ibTAgMTJ2OGg0di04eiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iZCIgYmVnaW49IjAuOCIgY2FsY01vZGU9InNwbGluZSIgZHVyPSIxLjJzIiBrZXlTcGxpbmVzPSIwLjIgMC4yIDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44OzAuMiAwLjggMC40IDAuOCIga2V5dGltZXM9IjA7LjI7LjU7MSIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIHZhbHVlcz0iTTAgMTIgVjIwIEg0IFYxMno7IE0wIDQgVjI4IEg0IFY0ejsgTTAgMTIgVjIwIEg0IFYxMno7IE0wIDEyIFYyMCBINCBWMTJ6Ii8+PC9wYXRoPjwvc3ZnPgo="},616:t=>{"use strict";t.exports=e}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i={};return(()=>{"use strict";function e(t,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](t):e(t,n)}function t(t,n){if(!e(t,n))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function c(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return c(this,n)}}r.d(i,{default:()=>Y});var h=r(616),g=r(837),f=r.n(g);function p(e,t,n,r,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,i)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){p(o,r,i,a,u,"next",e)}function u(e){p(o,r,i,a,u,"throw",e)}a(void 0)}))}}function d(e,t,n){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n||e):i.value}},d(e,t,n||e)}function m(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(s){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){a=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){a.label=u[1];break}if(6===u[0]&&a.label<i[1]){a.label=i[1],i=u;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(u);break}i[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(e){u=[6,e],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}}Object.create;Object.create;"function"==typeof SuppressedError&&SuppressedError;var I=r(530),w=r.n(I),y=r(151),b=r.n(y),P=h.vendors.jQuery,x=function(e){u(r,e);var n=l(r);function r(){return t(this,r),n.apply(this,arguments)}return o(r,[{key:"createDOMElement",value:function(){return document.createElement("div")}},{key:"getContainerElement",value:function(){return P(this.element).find(".fv__preview-image-container")[0]}},{key:"render",value:function(){d(s(r.prototype),"render",this).call(this)}},{key:"initUI",value:function(){var e=this;if(this.inited)return Promise.resolve();var t=P(this.element),n=t.width();if(!n)return new Promise((function(t){setTimeout((function(){e.initUI().then(t)}),50)}));this.inited=1;var r=!0;return"false"===t.attr("showTitle")&&(r=!1),t[0].innerHTML=w()({showTitle:r}),this.height=Math.ceil(n/.852),t.children("[name=preview-container]").height(this.height),this.$previewImageContainerBox=t.find(".fv__preview-image-container-box"),this.$previewImageContainer=t.find(".fv__preview-image-container"),this.$pageCount=P("[name=pageCount]",t),this.$input=P("[name=goto-input]",t),this.currNum=1,this.scrollTop=0,this.pageCaches=[],this.$previewImageContainerBox.on("wheel",(function(e){e.stopPropagation(),e.preventDefault()})),this.$previewImageContainerBox.scroll((function(t){var n=e.$previewImageContainerBox,r=n.scrollTop(),i=e.height,o=0;e.timer&&(clearTimeout(e.timer),e.timer=null),e.timer=setTimeout((function(){Math.abs(r-e.scrollTop)<2||((o=r>e.scrollTop?Math.ceil(r/i):Math.round(r/i))>=e.pageCount&&(o=e.pageCount-1),e.scrollTop!==Math.floor(i*o)&&(e.scrollTop=Math.floor(i*o),n.scrollTop(e.scrollTop)),e.currNum!==o+1&&o+1<=e.pageCount&&(e.currNum=o+1,e.$input.val(e.currNum),e.showPage(o))),e.timer=null}),300)})),this.$input.on("input propertychange",(function(t){var n=P(t.target),r=n.val().trim();""!==r&&(/^[1-9]\d*$/.test(r)?parseInt(r)>e.pageCount&&(r=e.pageCount):r=e.currNum,n.val(r),r!==e.currNum&&(e.currNum=parseInt(r),e.moveToPage(r-1)))})),this.$input.on("blur",(function(t){var n=P(t.target),r=n.val().trim();""===r&&(r=1),n.val(r),r!==e.currNum&&(e.currNum=parseInt(r),e.moveToPage(r-1))})),Promise.resolve()}},{key:"mounted",value:function(){d(s(r.prototype),"mounted",this).call(this),this.initUI()}},{key:"initPageItems",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};this.initUI().then((function(o){n.pageCaches=[];for(var a="",u=0;u<e;u++)a+=b()({isCrop:r,index:u+1});n.pageCount=e,n.$pageCount.text(e),n.$previewImageContainer.empty(),n.$previewImageContainer.append(a),n.$pages=n.$previewImageContainer.find(".fv__preview-page"),n.$pages.each((function(e,t){P(t).height(n.height)})),n.reset(t);for(var s=e>10?10:e,c=0;c<s;c++)n.showPage(c);i&&i()}))}},{key:"showPage",value:function(e){this.pageCaches[e]||this.controller.showPage(e)}},{key:"reset",value:function(e){var t=this;return v((function(){var n,r;return m(this,(function(i){switch(i.label){case 0:return[4,t.controller.getPDFUI().getPDFDocRender()];case 1:return n=i.sent(),r=(r=n.getCurrentPageIndex())?r+1:1,t.currNum=e||r,t.scrollTop=0,t.timer=null,t.$input.val(t.currNum),t.$previewImageContainerBox.animate({scrollTop:t.scrollTop},100),[2]}}))}))()}},{key:"moveToPage",value:function(e){this.$previewImageContainerBox.scrollTop(Math.floor(this.height*e)),this.showPage(e)}},{key:"displayThumbImg",value:function(e,t){this.pageCaches[e]=!0;var n=P(this.$pages[e]);n.height(this.height),n.find(".fv__thumb-loading").hide();var r=n.find(".fv__thumb-image")[0];if(r){r.removeClass("fv__hide"),r.width=t.width,r.height=t.height;var i=r.getContext("2d");if(t.buffer){var o=new(Uint8ClampedArray||Uint8Array)(t.buffer),a=i.createImageData(t.width,t.height);a.data.set(o),i.putImageData(a,0,0)}else if(t.image){var u=new Image;u.onload=function(){i.drawImage(u,0,0),URL.revokeObjectURL(u.src)},u.src=URL.createObjectURL(t.image)}}}}],[{key:"getName",value:function(){return"preview-panel"}}]),r}(h.components.ContainerComponent);function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=h.Controller,M=h.PDFViewCtrl.ViewerEvents,j=function(e){u(r,e);var n=l(r);function r(e){var i;return t(this,r),(i=n.call(this,e)).reload=!0,i}return o(r,[{key:"mounted",value:function(){var e,t=this,n=this.getPDFUI();this.addDestroyHook(n.addViewerEventListener((C(e={},M.pageRemoved,(function(){t.reload=!0})),C(e,M.pageAdded,(function(){t.reload=!0})),C(e,M.importPages,(function(){t.reload=!0})),C(e,M.pagesRemoved,(function(){t.reload=!0})),C(e,M.pageMoved,(function(){t.reload=!0})),C(e,M.pagesMoved,(function(){t.reload=!0})),C(e,M.willCloseDocument,(function(){t.reload=!0})),C(e,M.pageRotationChange,(function(e){t.reload=!0})),e)))}},{key:"showPreview",value:function(e){var t=this;return v((function(){var n,r;return m(this,(function(i){switch(i.label){case 0:return t.reload||e?[4,t.getPDFUI().getCurrentPDFDoc()]:(t.component.reset(),[2]);case 1:return(n=t.currentPDFDoc=i.sent())?((r=n.getPageCount())<1||(t.component.initPageItems(r),t.reload=!1),[2]):[2]}}))}))()}},{key:"showPage",value:function(e){var t=this;if(!(e<0)){var n=this.currentPDFDoc;n&&n.getPageByIndex(e).then((function(e){return e.getThumb(0)})).then((function(n){t.component.displayThumbImg(e,n)}))}}}],[{key:"getName",value:function(){return"PreviewPanelController"}}]),r}(T);const _=j;var B=UIExtension.PDFViewCtrl.ViewerEvents,D=function(e){u(r,e);var n=l(r);function r(e){return t(this,r),n.call(this,e)}return o(r,[{key:"mounted",value:function(){var e=this;d(s(r.prototype),"mounted",this).call(this);var t=this.getPDFUI();this.addDestroyHook(t.addViewerEventListener(C({},B.pagesBoxChange,(function(t){e.reload=!0}))))}},{key:"showPreview",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;d(s(r.prototype),"showPreview",this).call(this),this.component.restUI(e)}},{key:"showPage",value:function(e,t,n){var r=this,i=this.currentPDFDoc;i&&i.getPageByIndex(e).then((function(e){return e.getMediaBoxBitmap(t,n)})).then((function(t){r.component.displayThumbImg(e,t)}))}},{key:"getMediaBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.currentPDFDoc;return n?n.getPageByIndex(e).then((function(e){return e.getPageBox(t)})):Promise.reject()}}],[{key:"getName",value:function(){return"CropPreviewPanelController"}}]),r}(_);const A=D;function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){C(e,t,n[t])}))}return e}var R=h.vendors.jQuery,F={cropBox:"black",artBox:"red",trimBox:"greenyellow",bleedBox:"blue"},k=function(e){u(r,e);var n=l(r);function r(){return t(this,r),n.apply(this,arguments)}return o(r,[{key:"mounted",value:function(){d(s(r.prototype),"mounted",this).call(this);var e=R(this.element);R("[name=title]",e).hide(),R("[name=page-show]",e).css("marginTop","60px"),this.$input.css({width:"100px",marginRight:"20px"}),this.$input.parent().removeClass("jc_sb").addClass("jc_c"),this.width=e.width(),this.height=Math.ceil(this.width/.852),e.children().eq(1).height(this.height),this.restUI();var t=this;Object.defineProperty(t,"currNum",{configurable:!0,set:function(e){this.value=e,t.callback&&t.callback(e)},get:function(){return this.value}})}},{key:"restUI",value:function(e){this.callback=e,this.currPageSize=[0,0,0,0],this.currPages=[],this.currPageBoxes={},this.currShowBoxes="all",this.isMoveWhite=!1,this.currPageRotate=0}},{key:"setCurrentPageRotation",value:function(e){this.currPageRotate=e}},{key:"changePageSize",value:function(e,t,n,r,i,o,a,u,s,c){this.currPageSize=[t,n,r,i],this.currPages=e,this.currPageBoxes=o,this.currShowBoxes=u,this.currSelectBoxes=s,this.pageType=c,this.isMoveWhite=a,this.callback&&this.callback(this.currNum),this.showPage(this.currNum-1)}},{key:"showPage",value:function(e){var t=this;return v((function(){return m(this,(function(n){switch(n.label){case 0:return[4,t.showZoomPage(e)];case 1:return n.sent(),t.pageCaches[e]?[2]:(t.controller.showPage(e,t.width,t.height),[2])}}))}))()}},{key:"showZoomPage",value:function(e){var t=this;return v((function(){var n,r,i,o,a,u,s,c,l,h,g,f;return m(this,(function(p){switch(p.label){case 0:return n=t.width,r=t.height,i=R(t.$pages[e]),o=i.find(".fv__thumb-image")[0],a=i.find(".fv__thumb-cover")[0],o.boxWidth&&o.boxHeight?(u=o.boxWidth,s=o.boxHeight,[3,3]):[3,1];case 1:return[4,t.controller.getMediaBox(e)];case 2:c=p.sent(),u=c.right-c.left,s=c.top-c.bottom,o.boxWidth=u,o.boxHeight=s,a.boxWidth=u,a.boxHeight=s,p.label=3;case 3:return t.currPages&&t.currPages.includes(e+1)&&t.currPageSize&&0!==t.currPageSize[0]&&0!==t.currPageSize[1]?(l=n*u/t.currPageSize[0],h=r*s/t.currPageSize[1],l>=n||h>=r?(t.displayZoomThumb(o,a,n,r,0,0),t.displayZoomBox(a,e),[2]):(g=t.currPageSize[2]*n/t.currPageSize[0],f=r-h-t.currPageSize[3]*r/t.currPageSize[1],t.displayZoomThumb(o,a,l,h,g,f),t.displayZoomBox(a,e),[2])):(t.displayZoomThumb(o,a,n,r,0,0),t.displayZoomBox(a,e),[2])}}))}))()}},{key:"displayZoomThumb",value:function(e,t,n,r,i,o){if(e.showHeight!==r||e.showWidth!==n||e.showLeft!==i||e.showTop!==o){e.showWidth=n,e.showHeight=r,e.showLeft=i,e.showTop=o;var a=R(e);a.css("width",n+"px"),a.css("height",r+"px"),a.css("left",i+"px"),a.css("top",o+"px"),a.css("transform","translate(0, 0)");var u=R(t);u.css("left",i+"px"),u.css("top",o+"px")}}},{key:"zoomBoxToPDFRect",value:function(e,t){if(e){var n=R(this.$pages[t]).find(".fv__thumb-cover")[0];if(!n)return null;var r,i,o,a,u=n.boxWidth,s=n.boxHeight,c=R(n).width(),l=R(n).height();return 1==this.currPageRotate?(o=e.bottom*u/l,r=e.top*u/l,i=e.left*s/c,a=e.right*s/c):2==this.currPageRotate?(o=(1-e.left/c)*u,r=(1-e.right/c)*u,i=e.bottom*s/l,a=e.top*s/l):3==this.currPageRotate?(o=(1-e.top/l)*u,r=(1-e.bottom/l)*u,i=(1-e.right/c)*s,a=(1-e.left/c)*s):(o=e.right*u/c,r=e.left*u/c,i=(1-e.bottom/l)*s,a=(1-e.top/l)*s),{left:r,bottom:i,right:o,top:a}}return null}},{key:"displayZoomBox",value:function(e,t){var n=e.boxWidth,r=e.boxHeight,i=R(e).width(),o=R(e).height(),a=["cropBox","artBox","trimBox","bleedBox","calcBox"],u="all"===this.currShowBoxes;if(this.cropDialogComponent){var s=R(this.cropDialogComponent.element.querySelector('[name="showAllBoxes"]'));s.length&&(u=s.prop("checked"))}var c,l="None"===this.pageType,h=this;R(e).children().each((c=v((function(e,s){var c,g,f,p,v,d,I,w,y,b,P,x;return m(this,(function(m){if(c=0,g=0,f=0,p=0,v=i,d=o,I=s.classList.contains("fv__thumb-cover-resize"),w=h.currPages&&h.currPages.includes(t+1)){if(!h.currPageBoxes||!h.currPageBoxes.cropBox)return[2];h.isMoveWhite?(y=h.currPageBoxes.calcBoxes[t])||(y={left:0,bottom:0,right:v,top:d}):y=h.currPageBoxes[I?h.currSelectBoxes:a[e]],1==h.currPageRotate?(f=y.right*o/n,g=y.left*o/n,c=y.bottom*i/r,p=y.top*i/r):2==h.currPageRotate?(f=y.bottom*o/r,g=y.top*o/r,c=(1-y.right/n)*i,p=(1-y.left/n)*i):3==h.currPageRotate?(f=(1-y.left/n)*o,g=(1-y.right/n)*o,c=(1-y.top/r)*i,p=(1-y.left/r)*i):(f=(1-y.bottom/r)*o,g=(1-y.top/r)*o,c=y.left*i/n,p=y.right*i/n),v=p-c,d=f-g}return b=R(s),I?(P=v<=0||d<=0,s.classList="fv__thumb-cover-resize fv__thumb-cover-resize-".concat(h.currSelectBoxes).concat(P?" fv__thumb-cover-resize-zero":""),w&&l?b.show():b.hide()):u?h.currSelectBoxes!==a[e]?b.show():l?b.hide():b.show():h.currSelectBoxes===a[e]?b.show():b.hide(),s.showWidth=v,s.showHeight=d,s.showLeft=c,s.showTop=g,b.css("width",v+"px"),b.css("height",d+"px"),b.css("left",c-1+"px"),b.css("top",g+"px"),I?(x=F[h.currSelectBoxes],b.css("outlineColor",x),b.children().css("outlineColor",x)):b.css("outlineColor",F[a[e]]),[2]}))})),function(e,t){return c.apply(this,arguments)}))}},{key:"setCropDialog",value:function(e){this.cropDialogComponent=e}},{key:"initPageItems",value:function(e,t){d(s(r.prototype),"initPageItems",this).call(this,e,t,!0,this._bindEvent.bind(this))}},{key:"_bindEvent",value:function(){var e=this;R(this.element).find(".fv__thumb-cover").each((function(t,n){var r=n.querySelector(".fv__thumb-cover-resize");e.bindThumbCoverResizeEvent(n,r)}))}},{key:"bindThumbCoverResizeEvent",value:function(e,t){var n=this,r=null,i=null,o=null,a=null,u=null,s=function(e,t){return{top:Math.min(e[1],t[1]),left:Math.min(e[0],t[0]),width:Math.abs(e[0]-t[0]),height:Math.abs(e[1]-t[1])}},c=function(e,r,i){if(e){(function(e){if(e){var n={};for(var r in e)Object.hasOwnProperty.call(e,r)&&(n[r]="".concat(e[r],"px"));R(t).css(n)}})(e=S(e,r,i));var o={left:e.left,top:e.top,right:e.left+e.width,bottom:e.top+e.height},a=n.zoomBoxToPDFRect(o,n.currNum-1);n.cropDialogComponent.controller.setCropBox(Z({},a))}};this.startHandler=function(o){if(n.currPages&&n.currPages.includes(n.currNum)){var s=t.getBoundingClientRect();if(!(s.width<=0||s.height<=0)&&(a=R(o.target).attr("action-type"))){var c=e.getBoundingClientRect(),l=c.left,h=c.top;if(r=[z(o,"clientX")-l,z(o,"clientY")-h],"resize"===a){var g=t.getBoundingClientRect(),f=R(o.target).index();0===f?i=[g.left+g.width-l,g.top+g.height-h]:1===f?i=[g.left-l,g.top+g.height-h]:2===f?i=[g.left+g.width-l,g.top-h]:3===f&&(i=[g.left-l,g.top-h])}"move"===a&&(u=[z(o,"offsetX"),z(o,"offsetY")])}}},this.moveHandler=function(n){if(r){var l=e.getBoundingClientRect(),h=l.left,g=l.top,f=l.width,p=l.height,v=null,d=[z(n,"clientX")-h-r[0],z(n,"clientY")-g-r[1]],m=d[0],I=d[1];if(o=[r[0]+m,r[1]+I],"resize"===a)v=s(i,o);else if("move"===a){var w=[z(n,"offsetX"),z(n,"offsetY")],y=[w[0]-u[0],w[1]-u[1]],b=y[0],P=y[1],x=t.getBoundingClientRect();v={top:parseFloat(R(t).css("top"))+P,left:parseFloat(R(t).css("left"))+b,width:x.width,height:x.height}}c(v,f,p)}},this.endHandler=function(n){if(r){var l=null;if(o){var h=e.getBoundingClientRect(),g=h.top,f=h.left,p=h.width,v=h.height,d=[z(n,"clientX")-f-r[0],z(n,"clientY")-g-r[1]],m=d[0],I=d[1];if((o=[r[0]+m,r[1]+I])[0]=o[0]<0?0:o[0]>p?p:o[0],o[1]=o[1]<0?0:o[1]>v?v:o[1],"resize"===a)l=s(i,o);else if("move"===a){var w=t.getBoundingClientRect();l={top:parseFloat(R(t).css("top")),left:parseFloat(R(t).css("left")),width:w.width,height:w.height}}c(l,p,v)}r=null,i=null,o=null,a=null,u=null}},R(e).on("mousedown touchstart",this.startHandler).on("mousemove touchmove",this.moveHandler).on("mouseup touchend",this.endHandler).on("mouseleave touchcancel",this.endHandler)}},{key:"destroy",value:function(){var e=this;d(s(r.prototype),"destroy",this).call(this);var t=R(this.element).find(".fv__thumb-cover");t&&t.length>0&&t.each((function(t,n){R(n).off("mousedown touchstart",e.startHandler).off("mousemove touchmove",e.moveHandler).off("mouseup touchend",e.endHandler).off("mouseleave touchcancel",e.endHandler)}))}}],[{key:"getName",value:function(){return"crop-preview-panel"}}]),r}(x),z=function(e,t){if(0!==e.type.indexOf("touch"))return e[t];switch(e.type){case"touchstart":case"touchmove":return e.touches[0][t];case"touchend":case"touchcancel":return e.changedTouches[0][t]}},S=function(e,t,n){var r=11,i=Z({},e),o=i.left,a=i.top,u=i.width,s=i.height;return o+u>t-r&&(o=t-r-u),a+s>n-r&&(a=n-r-s),o<r&&(o=r),a<r&&(a=r),o+u>=t-r&&(u=t-r-o),a+s>=n-r&&(s=n-r-a),{left:o,top:a,width:u,height:s}},O=h.UIConsts.COMPONENT_EVENTS,N=function(e){u(r,e);var n=l(r);function r(){return t(this,r),n.apply(this,arguments)}return o(r,[{key:"mounted",value:function(){this.reload=!1,this.pageIndex=-1;var e=this;this.component.on(O.SHOWN,v((function(){return m(this,(function(t){switch(t.label){case 0:return[4,e.updatePageIndex()];case 1:return[2,t.sent()]}}))})))}},{key:"updatePageIndex",value:function(){var e=this;return v((function(){return m(this,(function(t){switch(t.label){case 0:return-1===e.pageIndex?[3,2]:[4,new Promise((function(e){return setTimeout(e,200)}))];case 1:t.sent(),e.component.moveToPage(e.pageIndex-1),e.pageIndex=-1,t.label=2;case 2:return[2]}}))}))()}},{key:"initData",value:function(){this.currentPDFDoc=void 0,this.reload=!1}},{key:"setProps",value:function(e){var t=e.doc,n=e.pageIndex,r=this;return v((function(){return m(this,(function(e){switch(e.label){case 0:return t&&t!==r.currentPDFDoc&&(r.currentPDFDoc=t,r.reload=!0,r.reset(n)),"number"!=typeof n?[3,2]:(r.pageIndex=n,r.component.isVisible?[4,r.updatePageIndex()]:[3,2]);case 1:e.sent(),e.label=2;case 2:return[2]}}))}))()}},{key:"reset",value:function(e){if(this.reload){var t=this.currentPDFDoc;if(t){var n=t.getPageCount();n<1||(this.component.initPageItems(n,e),this.reload=!1)}}else this.component.reset()}}],[{key:"getName",value:function(){return"PreviewPanelDocController"}}]),r}(_),Y=(h.PDFViewCtrl.Events,function(e){u(r,e);var n=l(r);function r(){return t(this,r),n.apply(this,arguments)}return o(r,null,[{key:"getName",value:function(){return"Preview"}},{key:"getLoader",value:function(){return f()}},{key:"initOnLoad",value:function(){var e=h.modular.module("preview",[]);e.registerComponent(x),e.registerController(_),e.registerComponent(k),e.registerController(A),e.registerController(N)}}]),r}(h.UIXAddon))})(),i=i.default})()));