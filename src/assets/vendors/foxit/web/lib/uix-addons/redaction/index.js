!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],t):"object"==typeof exports?exports.RedactionAddon=t(require("UIExtension")):e.RedactionAddon=t(e.UIExtension)}(self,(e=>(()=>{var t={819:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<layer name="redaction-page-popup" class="fv__redaction-page-popup center"  append-to="body" class="center" modal backdrop >\n<layer-header title="redaction:buttons.redact_page" @draggable="{type:\'parent\'}"></layer-header>\n<div class="fv__range-body">\n<div class="fv__range-title">redaction:dialog.pageRange</div>\n<div class="fv__range-types">\n<div class="fv__redaction-container">\n<label>\n<input name="redaction-page-type" class="redaction-page-radio" type="radio" checked value="1" />\n<span data-i18n="redaction:dialog.redaction_page.mark_current_page"></span>\n</label>\n</div>\n<div class="fv__redaction-container">\n<label>\n<input name="redaction-page-type" class="redaction-page-radio" type="radio" value="2" />\n<span data-i18n="redaction:dialog.redaction_page.mark_specific_page"></span>\n<div class="fv__redaction-range">\n<range:input\nname="redactPages"\nlayer-name="redaction-page-popup"\ntype="common"\nrange="1"\npage-count="1"></range:input>\n</div>\n</label>\n</div> \n</div> \n</div> \n<div class="fv__redaction-container footer" style="text-align:right">\n<button type="button" class="fv__redaction-btn fv__ui-dialog-ok-button" name="fv__ui-dialog-ok-button" data-i18n="redaction:buttons.ok"></button>\n<button type="button" class="fv__redaction-cancel fv__ui-dialog-cancel-button" name="fv__ui-dialog-cancel-button" data-i18n="redaction:buttons.cancel"></button>\n</div>\n</layer>','<layer name="redaction-page-popup" class="fv__redaction-page-popup center"  append-to="body" class="center" modal backdrop >\n<layer-header title="redaction:buttons.redact_page" @draggable="{type:\'parent\'}"></layer-header>\n<div class="fv__range-body">\n<div class="fv__range-title">redaction:dialog.pageRange</div>\n<div class="fv__range-types">\n<div class="fv__redaction-container">\n<label>\n<input name="redaction-page-type" class="redaction-page-radio" type="radio" checked value="1" />\n<span data-i18n="redaction:dialog.redaction_page.mark_current_page"></span>\n</label>\n</div>\n<div class="fv__redaction-container">\n<label>\n<input name="redaction-page-type" class="redaction-page-radio" type="radio" value="2" />\n<span data-i18n="redaction:dialog.redaction_page.mark_specific_page"></span>\n<div class="fv__redaction-range">\n<range:input\nname="redactPages"\nlayer-name="redaction-page-popup"\ntype="common"\nrange="1"\npage-count="1"></range:input>\n</div>\n</label>\n</div> \n</div> \n</div> \n<div class="fv__redaction-container footer" style="text-align:right">\n<button type="button" class="fv__redaction-btn fv__ui-dialog-ok-button" name="fv__ui-dialog-ok-button" data-i18n="redaction:buttons.ok"></button>\n<button type="button" class="fv__redaction-cancel fv__ui-dialog-cancel-button" name="fv__ui-dialog-cancel-button" data-i18n="redaction:buttons.cancel"></button>\n</div>\n</layer>'}},6:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<dropdown @tooltip name="create-redaction-controllers" tooltip-title="redaction:tooltips.redaction" icon-class="fv__icon-toolbar-redaction" popup-class="fv__ui-redaction-redaction-list" class="fv__ui-redaction-dropdown" text="redaction:buttons.title" separate="false">\n<dropdown-button class="fv__ui-redaction-item" name="create-text-redaction" @controller="redaction:RedactionTextAndImageController" icon-class="fv__icon-toolbar-text-redaction" tabindex="0">\nredaction:buttons.redact_text\n</dropdown-button>\n<dropdown-button class="fv__ui-redaction-item" name="create-area-redaction" @controller="redaction:RedactionController" icon-class="fv__icon-toolbar-area-redaction" tabindex="0">\nredaction:buttons.redact_area\n</dropdown-button>\n<dropdown-button class="fv__ui-redaction-item" name="create-page-redaction" @controller="redaction:RedactionPageController" icon-class="fv__icon-toolbar-page-redaction" tabindex="0">\nredaction:buttons.redact_page\n</dropdown-button>\n</dropdown>','<dropdown @tooltip name="create-redaction-controllers" tooltip-title="redaction:tooltips.redaction" icon-class="fv__icon-toolbar-redaction" popup-class="fv__ui-redaction-redaction-list" class="fv__ui-redaction-dropdown" text="redaction:buttons.title" separate="false">\n<dropdown-button class="fv__ui-redaction-item" name="create-text-redaction" @controller="redaction:RedactionTextAndImageController" icon-class="fv__icon-toolbar-text-redaction" tabindex="0">\nredaction:buttons.redact_text\n</dropdown-button>\n<dropdown-button class="fv__ui-redaction-item" name="create-area-redaction" @controller="redaction:RedactionController" icon-class="fv__icon-toolbar-area-redaction" tabindex="0">\nredaction:buttons.redact_area\n</dropdown-button>\n<dropdown-button class="fv__ui-redaction-item" name="create-page-redaction" @controller="redaction:RedactionPageController" icon-class="fv__icon-toolbar-page-redaction" tabindex="0">\nredaction:buttons.redact_page\n</dropdown-button>\n</dropdown>'}},437:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<ribbon-button icon-class="fv__icon-toolbar-redaction" @tooltip name="create-redaction-controllers" @var.self="$component"  tooltip-title="redaction:tooltips.redaction" text="redaction:buttons.title" not-immediately="true">\n<dropdown popup-class="fv__ui-redaction-redaction-list" class="fv__ui-redaction-dropdown" name="create-redactions-ribbon-inner-dropdown" separate="false">\n\x3c!-- <redaction:create-text-image-redaction-button></redaction:create-text-image-redaction-button> --\x3e\n\x3c!-- <redaction:create-area-redaction-button></redaction:create-area-redaction-button> --\x3e\n<redaction:create-text-images-redaction-button></redaction:create-text-images-redaction-button>\n<redaction:create-page-redaction-button @require-modules="range"></redaction:create-page-redaction-button>\n<redaction:redaction-search-button></redaction:redaction-search-button>\n<li class="fv__ui-dropdown-separator"></li>\n<redaction:apply-redactions-button></redaction:apply-redactions-button>\n</dropdown>\n</ribbon-button>','<ribbon-button icon-class="fv__icon-toolbar-redaction" @tooltip name="create-redaction-controllers" @var.self="$component"  tooltip-title="redaction:tooltips.redaction" text="redaction:buttons.title" not-immediately="true">\n<dropdown popup-class="fv__ui-redaction-redaction-list" class="fv__ui-redaction-dropdown" name="create-redactions-ribbon-inner-dropdown" separate="false">\n\x3c!-- <redaction:create-text-image-redaction-button></redaction:create-text-image-redaction-button> --\x3e\n\x3c!-- <redaction:create-area-redaction-button></redaction:create-area-redaction-button> --\x3e\n<redaction:create-text-images-redaction-button></redaction:create-text-images-redaction-button>\n<redaction:create-page-redaction-button @require-modules="range"></redaction:create-page-redaction-button>\n<redaction:redaction-search-button></redaction:redaction-search-button>\n<li class="fv__ui-dropdown-separator"></li>\n<redaction:apply-redactions-button></redaction:apply-redactions-button>\n</dropdown>\n</ribbon-button>'}},557:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<xbutton class="fv__ui-redaction-item"\nname="create-page-redaction"\n@tooltip\ntooltip-title="redaction:buttons.redact_page"\n@controller="redaction:RedactionPageController"\nicon-class="fx-icon-sm fv__icon-toolbar-page-redaction">\nredaction:buttons.redact_page\n</xbutton>','<xbutton class="fv__ui-redaction-item"\nname="create-page-redaction"\n@tooltip\ntooltip-title="redaction:buttons.redact_page"\n@controller="redaction:RedactionPageController"\nicon-class="fx-icon-sm fv__icon-toolbar-page-redaction">\nredaction:buttons.redact_page\n</xbutton>'}},683:(e,t,n)=>{n(779);e.exports=function(e){"use strict";e=e||{};return'<xbutton class="fv__ui-redaction-item"\nname="create-text-image-redaction"\n@tooltip\ntooltip-title="redaction:buttons.redact_text_image"\n@controller="redaction:RedactionController"\nicon-class="fx-icon-sm fv__icon-toolbar-text-image-redaction">\nredaction:buttons.redact_text_image\n</xbutton>','<xbutton class="fv__ui-redaction-item"\nname="create-text-image-redaction"\n@tooltip\ntooltip-title="redaction:buttons.redact_text_image"\n@controller="redaction:RedactionController"\nicon-class="fx-icon-sm fv__icon-toolbar-text-image-redaction">\nredaction:buttons.redact_text_image\n</xbutton>'}},408:e=>{e.exports=null},585:(e,t,n)=>{"use strict";
/*! art-template@runtime | https://github.com/aui/art-template */var o="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},r=Object.create(o),a=/["&'<>]/;function i(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?i(e.call(e)):JSON.stringify(e)),e}r.$escape=function(e){return function(e){var t=""+e,n=a.exec(t);if(!n)return e;var o="",r=void 0,i=void 0,c=void 0;for(r=n.index,i=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:c="&#34;";break;case 38:c="&#38;";break;case 39:c="&#39;";break;case 60:c="&#60;";break;case 62:c="&#62;";break;default:continue}i!==r&&(o+=t.substring(i,r)),i=r+1,o+=c}return i!==r?o+t.substring(i,r):o}(i(e))},r.$each=function(e,t){if(Array.isArray(e))for(var n=0,o=e.length;n<o;n++)t(e[n],n);else for(var r in e)t(e[r],r)},e.exports=r},779:(e,t,n)=>{"use strict";e.exports=n(585)},616:t=>{"use strict";t.exports=e}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,o),a.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";function e(t,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](t):e(t,n)}function t(t,n){if(!e(t,n))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function d(e,t){return!t||"object"!=((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t;var n}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=s(e);if(t){var r=s(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return d(this,n)}}o.d(r,{default:()=>pe});var u=o(616);function p(e,t,n){return p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n||e):r.value}},p(e,t,n||e)}const f="apply-redaction",g="apply-all-redaction",h="annotation-removed",v="add-redaction-area";function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(o=n.next()).done)&&(a.push(o.value),!t||a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var y=u.PDFViewCtrl,_=u.getDevicePagePoint,P=u.vendors.Hammer,x=y.shared.DebouncePromiseQueue,k=y.PDF.constant.Graphics_ObjectType,w=y.stateHandler.StateHandlerUtils,C=w.appendSelectMark,R=w.removeSelectMark,D=function(){function e(n){t(this,e),this.owner=n,this.cursorStyle="fv__cursor-highlight",this.destroyHooks=[],this.isTextSelect=!1,this.pdfViewer=n.pdfViewer}return a(e,[{key:"pageHandler",value:function(e){var t=this;this.pageRender=e;var n,o=e.$handler,r=o.get(0),a=function(e){t.owner.shapeControl||t.panStatus?n&&clearTimeout(n):(n&&clearTimeout(n),n=setTimeout((function(){var n=_(r,{srcEvent:e,deltaX:0,deltaY:0}),a=[n.x,n.y],i=[a[0]+10,a[1]+10];t.getTextRect(a,i,-1,-1).then((function(e){var n=t.isTextSelect=e&&e.length>0;o.removeClass(t.cursorStyle).removeClass(t.owner.cursorStyle).addClass(n?t.cursorStyle:t.owner.cursorStyle)}))}),50))};r.addEventListener("mousemove",a),this.destroyHooks.push((function(){r.removeEventListener("mousemove",a)}));var i=this.owner.hammer;i.add(new P.Tap({event:"doubletap",taps:2})),i.on("doubletap",(function(e){t.hideSelectMark(),t.doubleClickSelectHandle(e,r)}))}},{key:"panstart",value:function(e){this.panStatus="start";var t=this.pageRender.$handler.get(0);this.start=-1,this.end=-1;var n=_(t,e);this.startPoint=[n.x,n.y],this.hideSelectMark(),this.debouncePromiseQueue=new x}},{key:"panmove",value:function(e){var t=this;this.debouncePromiseQueue.push((function(){var n=t.pageRender,o=t.startPoint,r=[o[0]+e.deltaX,o[1]+e.deltaY];return t.getTextRect(o,r,t.start,t.end).then((function(e){var o;return(o=e[0])&&"string"==typeof o.text&&(t.start=o.start,t.end=o.end),Promise.all([n.getPDFPage(),e])})).then((function(e){var t=b(e,2),o=t[0],r=t[1];return n.transformRectArray(o,r)})).then((function(e){t.showSelectMark(e)}))}))}},{key:"panend",value:function(e){var t=this;this.debouncePromiseQueue.end(),this.debouncePromiseQueue=null,this.panStatus=void 0;var n=this.pageRender,o=this.startPoint,r=[o[0]+e.deltaX,o[1]+e.deltaY];return this.getTextRect(o,r,this.start,this.end).then((function(e){var o;return(o=e[0])&&"string"==typeof o.text&&(t.start=o.start,t.end=o.end),t.hideSelectMark(),Promise.all([n.getPDFPage(),e])})).then((function(e){var n=b(e,2),o=n[0],r=n[1];return r.length<1?Promise.resolve():t.addAnnot(o,r).then((function(e){var n=e[0],o=t.pageRender.annotsRender.getAnnotRender(n.getId()).component;return t.afterAddAnnot(o),t.pageRender.annotsRender.activeAnnot(n.getId()),e})).then((function(e){if(t.pdfViewer.config.showCommentList){var n=e[e.length-2];t.pageRender.annotsRender.getAnnotRender(n.getId()).component.showReplyDialog()}})).catch((function(e){}))}))}},{key:"getTextRect",value:function(e,t,n,o){return this.pageRender.getTextContinueRectAtDevicePoints(e,t,n,o)}},{key:"showSelectMark",value:function(e){C(this.pageRender.$handler,e)}},{key:"hideSelectMark",value:function(){R(this.pageRender.$handler)}},{key:"addAnnot",value:function(e,t){var n=this;return e.markRedactAnnot(t).then((function(e){var t=e[0];t.setSubject(n.pdfViewer.i18n.t("viewer_:annotSubjects.Redact"));var o=n.pdfViewer.getAnnotDefaultProperty("redact"),r=16711680;return o.defaultAppearance&&void 0!==o.defaultAppearance.textColor&&(r=o.defaultAppearance.textColor),t.setRedactAppearance(Object.assign({textColor:r},o)),e})).catch((function(e){if(-6===e.error)return n.pdfViewer.viewerUI.alert("dialog.error.noRedactionLicense"),Promise.reject(e)}))}},{key:"afterAddAnnot",value:function(e){this.pdfViewer.eventEmitter.emit("markRedactAnnotSuccess",e.annot)}},{key:"doubleClickSelectHandle",value:function(e,t){var n=this,o=_(t,e),r=[o.x,o.y],a=this.pageRender;a.getPDFPage().then((function(e){return[e,e.reverseDevicePoint(r,a.getScale(),a.getRotation())]})).then((function(e){var t=b(e,2),o=t[0],i=b(t[1],2),c=i[0],s=i[1];o.getGraphicsObjectAtPoint([c,s],0,k.All).then((function(e){if(e){var t=e.getType();if(t===k.Image||t===k.Text){var o=Promise.resolve([e.getRect()]);return t===k.Text&&(o=a.getDoubleClickTextRectAtPoint(r)),Promise.all([a.getPDFPage(),o]).then((function(e){var t=b(e,2),o=t[0],r=t[1];n.addAnnotWithRectArray(o,r)}))}}}))}))}},{key:"addAnnotWithRectArray",value:function(e,t){var n=this;return t.length<1?Promise.resolve():this.addAnnot(e,t).then((function(e){var t=e[0],o=n.pageRender.annotsRender.getAnnotRender(t.getId()).component;return n.afterAddAnnot(o),n.pageRender.annotsRender.activeAnnot(t.getId()),o})).then((function(e){n.pdfViewer.config.showCommentList&&e.showReplyDialog()})).catch((function(e){}))}},{key:"destroyPageHandler",value:function(){this.pageRender.$handler.removeClass(this.cursorStyle),this.destroyHooks.forEach((function(e){return e()}))}}]),e}(),A=function(e){c(o,e);var n=l(o);function o(e){var r;return t(this,o),(r=n.call(this,e,"square")).pdfViewer=e,r.cursorStyle="fv__cursor-cross",r.destroyHooks=[],r}return a(o,[{key:"correctPosition",value:function(e){var t=this.pageRender.getShowWidth(),n=this.pageRender.getShowHeight();return{x:Math.max(0,Math.min(t,e.x)),y:Math.max(0,Math.min(n,e.y))}}},{key:"start",value:function(e,t){var n=t.left,o=t.top;this.shapeControl||(this.shapeControl=new y.ShapeControl({resizable:!1,enableDiagonally:!0}),this.shapeControl.active(e.$handler,e.$handler,{left:n,top:o,width:0,height:0}))}},{key:"adjust",value:function(e,t,n){var o,r,a=t.x,i=t.y,c=n.x,s=n.y,d=Math.abs(a-c),l=Math.abs(i-s),u={left:o=Math.min(a,c),top:r=Math.min(i,s),width:d=Math.max(d,1),height:l=Math.max(l,1)},p={left:o,top:r,right:o+d,bottom:r+l};e._applyAnnotBoundary(u),e.shape.boundary=p,e.shape.shape=u,e._updatePreviewer()}},{key:"pageHandler",value:function(e){var t=this;this.pageRender=e;var n=e.$handler.get(0);e.$handler.addClass(this.cursorStyle);var o=this.hammer=new P.Manager(n),r=this.createnTextAndImageHandler=new D(this);r.pageHandler(e),o.add(new P.Pan({direction:P.DIRECTION_ALL})),o.on("panstart",(function(o){if(t.startPoint=_(n,o),r.isTextSelect)return r.panstart(o);e.getPDFPage().then((function(n){var o=b(n.reverseDevicePoint([t.startPoint.x,t.startPoint.y],t.pageRender.scale,t.pageRender.getRotation()),2),r=o[0],a=o[1];t.start(e,{left:r,top:a})}))})),o.on("panmove",(function(e){if(r.isTextSelect)return r.panmove(e);var n=t.correctPosition({x:t.startPoint.x+e.deltaX,y:t.startPoint.y+e.deltaY});return t.currentPoint=n,t.adjust(t.shapeControl,t.startPoint,t.currentPoint)})),o.on("panend",(function(n){if(r.isTextSelect)return r.panend(n);var o=t.correctPosition({x:t.startPoint.x+n.deltaX,y:t.startPoint.y+n.deltaY});t.currentPoint=o,t.adjust(t.shapeControl,t.startPoint,t.currentPoint),t.pdfViewer.eventEmitter.emit(v,e,t.shapeControl.shape.boundary),t.shapeControl.destroy(),t.shapeControl=null})),o.on("pancancel",(function(e){t.shapeControl.destroy(),t.shapeControl=null}))}},{key:"destroyPageHandler",value:function(){this.createnTextAndImageHandler&&(this.createnTextAndImageHandler.destroyPageHandler(),this.createnTextAndImageHandler=void 0),this.hammer&&this.hammer.destroy(),this.pageRender.$handler.removeClass(this.cursorStyle),this.destroyHooks.forEach((function(e){return e()}))}}],[{key:"getStateName",value:function(){return"create-redaction-state"}}]),o}(y.IStateHandler),S=u.PDFViewCtrl.ViewerEvents,F=u.PDFViewCtrl.Consts.PDFDocPermission;const E=function(e){c(o,e);var n=l(o);function o(e){return t(this,o),n.call(this,e,A)}return a(o,[{key:"changePermission",value:function(e){var t=this;this.getPDFUI().getPDFDocRender().then((function(e){return e.getUserPermission().getValue()})).then((function(e){e&F.AnnotForm?t.component.unlock&&t.component.unlock():t.component.lock&&t.component.lock()}))}},{key:"mounted",value:function(){var e=this,t=this.getPDFUI();this.addDestroyHook(t.addViewerEventListener(v,(function(e,n){e.getPDFPage().then((function(o){var r=o.reverseDeviceRect(n,e.scale,e.getRotation());return o.markRedactAnnot([r]).then((function(t){t[0].setSubject(e.pdfViewer.i18n.t("viewer_:annotSubjects.Redact"));var n=e.pdfViewer.getAnnotDefaultProperty("redact"),o=16711680;return n.defaultAppearance&&void 0!==n.defaultAppearance.textColor&&(o=n.defaultAppearance.textColor),t[0].setRedactAppearance(Object.assign({textColor:o},n)).then((function(e){return t}))})).catch((function(e){if(-6===e.error)return t.alert("dialog.error.noRedactionLicense"),Promise.reject(e);console.error(e)}))})).then((function(n){var o=n[0],r=e.annotsRender.getAnnotRender(o.getId()).component;return t.eventEmitter.emit("markRedactAnnotSuccess",r.annot),e.annotsRender.activeAnnot(o.getId()),r})).then((function(t){e.pdfViewer.config.showCommentList&&t.showReplyDialog()})).catch((function(){}))})),t.addViewerEventListener(S.openFileSuccess,(function(t){return e.changePermission(t)})),t.addViewerEventListener(S.permissionChanged,(function(t){return e.changePermission(t)})))}},{key:"stateOut",value:function(){p(s(o.prototype),"stateOut",this).call(this);var e=this.component.parent.element.classList;this.getPDFUI().getStateHandlerManager().then((function(t){"create-redaction-text-image-state"!==t.getCurrentStates().getStateName()&&e.remove("selected")}))}},{key:"handle",value:function(){p(s(o.prototype),"handle",this).call(this),this.component.parent.element.classList.add("selected"),this.getPDFUI().getStateHandlerManager().then((function(e){e.switchTo("create-redaction-state")}))}}],[{key:"getName",value:function(){return"RedactionController"}}]),o}(u.StatefulController);var I=u.PDFViewCtrl.PDF.constant.Graphics_ObjectType,V=u.PDFViewCtrl.stateHandler.StateHandlerUtils.getDevicePagePoint,T=u.vendors.Hammer,j=function(e){c(o,e);var n=l(o);function o(e){var r;return t(this,o),(r=n.call(this,e)).cursorStyle="fv__cursor-highlight",r}return a(o,[{key:"pageHandler",value:function(e){var t=this;p(s(o.prototype),"pageHandler",this).call(this,e);var n=e.$handler[0],r=this.hammer;r.add(new T.Tap({event:"doubletap",taps:2})),r.add(new T.Tap({event:"singletap"})),r.get("doubletap").recognizeWith("singletap"),r.get("singletap").requireFailure("doubletap"),r.on("doubletap",(function(e){t.hideSelectMark(),t.doubleClickSelectHandle(e,n)}))}},{key:"doubleClickSelectHandle",value:function(e,t){var n=this,o=V(t,e),r=[o.x,o.y],a=this.pageRender;a.getPDFPage().then((function(e){return[e,e.reverseDevicePoint(r,a.getScale(),a.getRotation())]})).then((function(e){var t=b(e,2),o=t[0],i=b(t[1],2),c=i[0],s=i[1];o.getGraphicsObjectAtPoint([c,s],0,I.All).then((function(e){if(e){var t=e.getType();if(t===I.Image||t===I.Text){var o=Promise.resolve([e.getRect()]);return t===I.Text&&(o=a.getDoubleClickTextRectAtPoint(r)),Promise.all([a.getPDFPage(),o]).then((function(e){var t=b(e,2),o=t[0],r=t[1];n.addAnnotWithRectArray(o,r)}))}}}))}))}},{key:"addAnnotWithRectArray",value:function(e,t){var n=this;return t.length<1?Promise.resolve():this.addAnnot(e,t).then((function(e){var t=e[0],o=n.pageRender.annotsRender.getAnnotRender(t.getId()).component;return n.afterAddAnnot(o),n.pageRender.annotsRender.activeAnnot(t.getId()),o})).then((function(e){n.pdfViewer.config.showCommentList&&e.showReplyDialog()})).catch((function(e){}))}},{key:"addAnnot",value:function(e,t){var n=this;return e.markRedactAnnot(t).then((function(e){var t=e[0];t.setSubject(n.pdfViewer.i18n.t("viewer_:annotSubjects.Redact"));var o=n.pdfViewer.getAnnotDefaultProperty("redact"),r=16711680;return o.defaultAppearance&&void 0!==o.defaultAppearance.textColor&&(r=o.defaultAppearance.textColor),t.setRedactAppearance(Object.assign({textColor:r},o)),e})).catch((function(e){if(-6===e.error)return n.pdfViewer.viewerUI.alert("dialog.error.noRedactionLicense"),Promise.reject(e)}))}},{key:"afterAddAnnot",value:function(e){this.pdfViewer.eventEmitter.emit("markRedactAnnotSuccess",e.annot)}}],[{key:"getStateName",value:function(){return"create-redaction-text-image-state"}}]),o}(u.TextMarkupStateHandler);const L=function(e){c(o,e);var n=l(o);function o(e){return t(this,o),n.call(this,e,j)}return a(o,[{key:"stateOut",value:function(){p(s(o.prototype),"stateOut",this).call(this);var e=this.component.parent.element.classList;this.getPDFUI().getStateHandlerManager().then((function(t){"create-redaction-state"!==t.getCurrentStates().getStateName()&&e.remove("selected")}))}},{key:"handle",value:function(){p(s(o.prototype),"handle",this).call(this),this.component.parent.element.classList.add("selected"),this.getPDFUI().getStateHandlerManager().then((function(e){e.switchTo("create-redaction-text-image-state")}))}}],[{key:"getName",value:function(){return"RedactionTextAndImageController"}},{key:"permission",get:function(){return u.PDFViewCtrl.Consts.PDFDocPermission.AnnotForm}}]),o}(u.StatefulController);var O=u.vendors.jQuery,H="password-input-tip",U=function(){O("."+H).remove()},M=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(U(),e){var o=O('<span class="'.concat(H,'"><span>')),r=O('<i class="password-input-tip-text" role="alert" aria-live="assertive" ><i>');if(r.text(e),o.empty().append(r),n)O(t).before(o),o.css({left:0,top:"calc(100% + 8px)"}).addClass("relative");else{var a=t.getBoundingClientRect();o.css({left:a.left-13+"px"}).appendTo("body"),o.css({top:a.top+35+"px"})}}},B=u.PDFViewCtrl.Deps.jQuery,N=function(e){c(o,e);var n=l(o);function o(e){var r;return t(this,o),(r=n.call(this,e)).unBindEventHooks=[],r}return a(o,[{key:"getElement",value:function(){return this.component.element}},{key:"updateText",value:function(e,t){this.docPageCount=t,B(this.getElement()).find("[name=pageCount]").text(t),this.getComponentByName("redactPages").updatePageCount(t)}},{key:"bindEvent",value:function(e,t,n){var o=this,r=this.getElement().querySelectorAll(e);0!=r.length&&r.forEach((function(e){e.addEventListener(t,n),o.unBindEventHooks.push((function(){e.removeEventListener(t,n)}))}))}},{key:"mounted",value:function(){var e=this;this.bindEvent(".redaction-page-radio","change",(function(t){if(t.target.checked){e.hideError();var n=e.getElement().querySelector(".range-input__input");if("1"==t.target.value)n.setAttribute("disabled","");else{n.removeAttribute("disabled");var o=e.pdfUI.pdfViewer.getPDFDocRender(),r=o.doc,a=o.getCurrentPageIndex()+1;e.getComponentByName("redactPages").reset({doc:r,pageCount:e.docPageCount,currentIndexOrPages:""+a})}}})),this.bindEvent(".fv__redaction-cancel","click",(function(t){e.hide()})),this.bindEvent(".fv__redaction-btn","click",(function(t){e.submit()})),this.bindEvent(".range-input__input","keydown",(function(t){e.hideError()}))}},{key:"setSubmitCallback",value:function(e){this.submitCallback=e}},{key:"submit",value:function(){this.docPageCount;var e=!1;this.getElement().querySelectorAll(".redaction-page-radio").forEach((function(t){t.checked&&"1"==t.value&&(e=!0)}));var t=[];if(e){var n=this.pdfUI.pdfViewer.getPDFDocRender();t.push(n.getCurrentPageIndex())}else t=this.computePages();this.submitCallback(t)}},{key:"reset",value:function(){this.hideError(),this.getElement().querySelector(".redaction-page-radio").click();var e=this.getElement().querySelector(".range-input__input");e.value="",e.disabled=1}},{key:"showError",value:function(e){var t=this.getElement().querySelector(".range-input__input");t.classList.add("fv__redaction-error"),M(t.getAttribute("placeholder"),t)}},{key:"hideError",value:function(){this.getElement().querySelector(".range-input__input").classList.remove("fv__redaction-error"),U()}},{key:"hide",value:function(){this.component.hide(),M()}},{key:"destroy",value:function(){this.unBindEventHooks.forEach((function(e){return e()})),p(s(o.prototype),"destroy",this).call(this)}},{key:"computePages",value:function(){for(var e=[],t=(this.getComponentByName("redactPages").getRange()+"").split(","),n=0;n<t.length;n++){var o=t[n];if(o)if(o.indexOf("-")<1){var r=parseInt(o);r>0&&e.push(r-1)}else{for(var a=o.split("-"),i=0,c=0,s=0;s<a.length;s++){var d=a[s];if(d){var l=parseInt(d);0===i?(i=l,c=l):l<i?i=l:l>c&&(c=l)}}if(i>0)for(var u=i;u<=c;u++)e.push(u-1)}}return e.length>0&&(e=e.sort()),e}}],[{key:"getName",value:function(){return"RedactionPagesController"}}]),o}(u.Controller),$=o(819),q=o.n($),Q=(u.PDFViewCtrl._internal.shared.Lazy,u.PDFViewCtrl.Events);const X=function(e){c(o,e);var n=l(o);function o(e){return t(this,o),n.call(this,e)}return a(o,[{key:"changePermission",value:function(e){var t=this;this.getPDFUI().getPDFDocRender().then((function(e){return e.getUserPermission().getValue()})).then((function(e){e&u.PDFViewCtrl.Consts.PDFDocPermission.AnnotForm?t.component.unlock&&t.component.unlock():t.component.lock&&t.component.lock()}))}},{key:"handle",value:function(){var e,t=this;this.uiInited?e=Promise.resolve(this.popop=this.getComponentByName("redaction-page-popup")).then((function(e){t.resetDialog()})):(e=this.getPDFUI().getComponentByName("template-container").then((function(e){e.append(q()(),[{target:"redaction-page-popup",config:{callback:N}}]),t.popop=e.getComponentByName("redaction-page-popup"),t.resetDialog()})),this.uiInited=!0),e.then((function(e){t.popop.show(),t.popop.controller.reset()}))}},{key:"mounted",value:function(){var e=this,t=this.getPDFUI(),n=function(){e.popop&&t.getCurrentPDFDoc().then((function(n){var o=n.getPageCount(),r=t.i18n.t("redaction:dialog.readaction_page_max")+o;e.popop.controller.updateText(r,o)}))},o=function(t){e.pdfDoc=t,e.resetDialog(),e.changePermission(t)};this.addDestroyHook(t.addViewerEventListener("change-language-success",(function(n){if(e.popop){var o=e.pdfDoc?e.pdfDoc.getPageCount():0,r=t.i18n.t("redaction:dialog.readaction_page_max")+o;e.popop.controller.updateText(r,o)}})),t.addViewerEventListener(Q.pageRemoved,n),t.addViewerEventListener(Q.pagesRemoved,n),t.addViewerEventListener(Q.pageAdded,n),t.addViewerEventListener(Q.insertPages,n),t.addViewerEventListener(Q.openFileSuccess,o),t.addViewerEventListener(Q.willCloseDocument,(function(){e.pdfDoc=null})),t.addViewerEventListener(Q.permissionChanged,(function(t){return e.changePermission(t)}))),t.getCurrentPDFDoc().then((function(e){return e&&o(e)}))}},{key:"resetDialog",value:function(){var e=this;if(this.popop){var t=this.pdfDoc,n=this.getPDFUI(),o=t.getPageCount();this.popop.controller.setSubmitCallback((function(t){n.activateElement(),0==t.length?n.getPDFViewer().then((function(o){t=[o.getPDFDocRender().getCurrentPageIndex()],e.pdfDoc.makeRedactByPages(t).then((function(t){a(t),e.popop.hide()})).catch((function(e){-6===e.error&&n.alert("dialog.error.noRedactionLicense")}))})):e.pdfDoc.makeRedactByPages(t).then((function(t){a(t),e.popop.hide()})).catch((function(e){-6===e.error&&n.alert("dialog.error.noRedactionLicense")}))}));var r=n.i18n.t("redaction:dialog.readaction_page_max")+o;this.popop.controller.updateText(r,o)}function a(e){n.getPDFViewer().then((function(t){var n=t.getAnnotDefaultProperty("redact"),o=[],r=16711680;n.defaultAppearance&&void 0!==n.defaultAppearance.textColor&&(r=n.defaultAppearance.textColor),e.map((function(e){var t=e[0];o.push(t),t.setRedactAppearance(Object.assign({textColor:r},n))})),t.eventEmitter.emit("makeRedactByPagesSuccess",o)}))}}}],[{key:"getName",value:function(){return"RedactionPageController"}}]),o}(u.Controller);const W={print:4,modify:8,extract:16,annotForm:32,fillForm:256,extractAccess:512,assemble:1024,printHigh:2048};var Y=u.PDFViewCtrl.Events;function G(e){return"redact"==e.info.type&&!1===e.info.isDeleted}const z=function(e){c(o,e);var n=l(o);function o(e){return t(this,o),n.call(this,e)}return a(o,[{key:"handle",value:function(){var e=this;if(!this.component.disabled){var t=this.getPDFUI();return t.getPDFViewer().then((function(n){e.checkApplicablePermission(n).then((function(e){e?t.confirm({message:"redaction:dialog.apply_alert",level:"warning",hideOnConfirm:!1}).then((function(e){e.hide();var o=n.getCurrentPDFDoc();o.applyRedaction().then((function(){t.eventEmitter.emit(u.UIEvents.undoRedoStoreChange,null,"clearAll")}),(function(e){if(-6!==e.error)throw e;t.alert({message:"dialog.error.noRedactionLicense",level:"warning"})})),o.redacted=!0}),(function(){})):t.alert({message:"dialog.error.noRedactionApplyPermission",level:"warning"})}))}))}}},{key:"mounted",value:function(){var e=this,t=this.getPDFUI();t.addDestroyHook(t.addViewerEventListener(g,(function(t,n){e.component.lock()})),t.addViewerEventListener(f,(function(t,n){e.isRedactExist()})),t.addViewerEventListener(Y.openFileSuccess,(function(t){e.component.lock()})),t.addViewerEventListener(Y.renderPageSuccess,(function(t){e.component.isLocked&&t.getPDFPage().then((function(e){return e.getAnnots()})).then((function(t){t.some((function(e){return G(e)}))&&e.component.unlock()}))})),t.addViewerEventListener(Y.annotationAdd,(function(n){e.component.isLocked&&t.getPDFDocRender().then((function(t){8&t.getUserPermission().getValue()&&(n.some((function(e){return G(e)}))&&e.component.unlock())}))})),t.addViewerEventListener(h,(function(n){t.getCurrentPDFDoc().then((function(t){t&&t.checkPermission(W.modify)&&t.checkPermission(W.annotForm)&&e.isRedactExist()}))}))),t.getCurrentPDFDoc().then((function(t){t&&t.checkPermission(W.modify)&&t.checkPermission(W.annotForm)&&t.pageCache.some((function(e){return e.annots.some((function(e){return"redact"==e.getType()}))}))?e.component.unlock():e.component.lock()}))}},{key:"isRedactExist",value:function(){var e=this;this.getPDFUI().getPDFViewer().then((function(e){return e.currentPDFDoc.getAnnots()})).then((function(t){for(var n=!1,o=0;o<t.length;o++){for(var r=t[o],a=0;a<r.length;a++){if(G(r[a])){n=!0;break}}if(n)break}n?e.component.unlock():e.component.lock()}))}},{key:"checkApplicablePermission",value:function(e){return Promise.resolve(!0)}}],[{key:"permission",get:function(){return u.PDFViewCtrl.Consts.PDFDocPermission.ModifyDocument}}]),o}(u.Controller);var J=u.UIEvents;const K=function(e){c(o,e);var n=l(o);function o(e){return t(this,o),n.call(this,e)}return a(o,[{key:"handle",value:function(){PDFViewCtrl.DeviceInfo.isMobile||PDFViewCtrl.DeviceInfo.isTablet?(this.getComponentByName("sidebar").expand(),this.getComponentByName("sidebar-search").active(),this.getComponentByName("fv-search-sidebar-panel").activeRedactionMode(),this.getPDFUI().eventEmitter.emit(J.redeModeShowSidebar)):this.pdfUI.callAddonAPI("SearchAddon","openPanel",["redaction","exact"])}}]),o}(u.Controller);var Z=o(6),ee=o.n(Z),te=o(437),ne=o.n(te),oe=o(557),re=o.n(oe),ae=o(683),ie=o.n(ae),ce=o(408),se=o.n(ce),de=u.shared.replaceRibbonButton2XButton,le=ee()(),ue=ne()(),pe=function(e){c(o,e);var n=l(o);function o(){return t(this,o),n.apply(this,arguments)}return a(o,[{key:"fragments",value:function(){return[]}}],[{key:"getName",value:function(){return"redaction"}},{key:"getLoader",value:function(){return se()}},{key:"initOnLoad",value:function(){var e=u.modular.module("redaction",[]),n=e.getRegistry();this.module=e,n.registerController(E),n.registerController(L),n.registerController(X);var o={template:le,config:[{target:"create-redaction-controllers",callback:function(e){c(o,e);var n=l(o);function o(){return t(this,o),n.apply(this,arguments)}return a(o,[{key:"changePermission",value:function(e){var t=this;this.getPDFUI().getPDFDocRender().then((function(e){return e&&e.getUserPermission().getValue()})).then((function(n){!(!e||e.isDestroyed)&&!e.isPortfolio()&&n&u.PDFViewCtrl.Consts.PDFDocPermission.AnnotForm?t.component.unlock&&t.component.unlock():t.component.lock&&t.component.lock()}))}}]),o}(u.Controller)}]};e.registerPreConfiguredComponent("create-redactions-dropdown",o),e.registerPreConfiguredComponent("create-redactions-ribbon-dropdown",Object.assign({},o,{template:ue}));var r={template:'<ribbon-button text="redaction:buttons.apply" name="redaction-apply"  icon-class="fx-icon-sm fv__icon-toolbar-apply-redaction"  @tooltip>redaction:buttons.apply</ribbon-button>',config:[{target:"redaction-apply",tooltip:{title:"redaction:tooltips.apply"},callback:z}]};e.registerPreConfiguredComponent("apply-redactions-button",Object.assign({},r,{template:de(r.template)}));var i={template:'<ribbon-button text="redaction:buttons.redact_search" name="redaction-search" icon-class="fx-icon-sm fv__icon-toolbar-search-redaction" @tooltip>redaction:buttons.redact_search</ribbon-button>',config:[{target:"redaction-search",tooltip:{title:"redaction:buttons.redact_search"},callback:K}]};e.registerPreConfiguredComponent("redaction-search-button",Object.assign({},i,{template:de(i.template)})),e.registerPreConfiguredComponent("create-page-redaction-button",{template:re()()}),e.registerPreConfiguredComponent("create-text-images-redaction-button",{template:ie()()})}}]),o}(u.UIXAddon)})(),r=r.default})()));